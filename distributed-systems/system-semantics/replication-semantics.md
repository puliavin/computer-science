# Replication Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –†–µ–ø–ª–∏–∫–∞—Ü–∏–∏)

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [–û—Å–Ω–æ–≤–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã-—Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏)
   - [Primary-Backup (Single-Leader) Replication](#1-primary-backup-single-leader-replication--—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è-—Å-–æ–¥–Ω–∏–º-–ª–∏–¥–µ—Ä–æ–º)
   - [Multi-Leader (Multi-Master) Replication](#2-multi-leader-multi-master-replication--–º—É–ª—å—Ç–∏–ª–∏–¥–µ—Ä–Ω–∞—è-—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è)
   - [Leaderless (Peer-to-Peer) Replication](#3-leaderless-peer-to-peer-replication--—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è-–±–µ–∑-–ª–∏–¥–µ—Ä–∞)
3. [–ú–æ–¥–µ–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏](#–º–æ–¥–µ–ª–∏-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)
   - [Synchronous Replication](#1-synchronous-replication--—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è-—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è)
   - [Asynchronous Replication](#2-asynchronous-replication--–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è-—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è)
   - [Semi-Synchronous Replication](#3-semi-synchronous-replication--–ø–æ–ª—É—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è-—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è)
4. [–ö–≤–æ—Ä—É–º–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã](#–∫–≤–æ—Ä—É–º–Ω—ã–µ-—Å–∏—Å—Ç–µ–º—ã)
   - [Quorum Replication](#quorum-replication--–∫–≤–æ—Ä—É–º–Ω–∞—è-—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è)
   - [Read/Write Quorum Semantics](#readwrite-quorum-semantics--—Å–µ–º–∞–Ω—Ç–∏–∫–∞-–∫–≤–æ—Ä—É–º–æ–≤-—á—Ç–µ–Ω–∏—è-–∏-–∑–∞–ø–∏—Å–∏)
5. [–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤](#—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ-–∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)
   - [Conflict Resolution Semantics](#conflict-resolution-semantics--—Å–µ–º–∞–Ω—Ç–∏–∫–∞-—Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è-–∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)
6. [–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞](#—Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è-—Ç–∞–±–ª–∏—Ü–∞)
7. [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

---

## –í–≤–µ–¥–µ–Ω–∏–µ

**Replication Semantics** (—Å–µ–º–∞–Ω—Ç–∏–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏) ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª –∏ –≥–∞—Ä–∞–Ω—Ç–∏–π, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏—Ö –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ, –∫–∞–∫ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ —ç—Ç–∏–º –∫–æ–ø–∏—è–º, –∏ —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.

–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —Ç—ã –ø–∏—à–µ—à—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç. –≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —É –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø—ã. –ù–æ –∫–∞–∫ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç?

- üì± –°–æ–æ–±—â–µ–Ω–∏–µ —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –æ–¥–∏–Ω –≥–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–µ—Ä, –∞ –ø–æ—Ç–æ–º –æ–Ω —Ä–∞–∑–¥–∞—ë—Ç –µ–≥–æ –≤—Å–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–º?
- üåê –°–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ª—é–±–æ–π —Å–µ—Ä–≤–µ—Ä, –∏ –æ–Ω–∏ —Å–∞–º–∏ –¥–æ–≥–æ–≤–æ—Ä—è—Ç—Å—è –º–µ–∂–¥—É —Å–æ–±–æ–π?
- üîÑ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤, –∏ –µ—Å–ª–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø—Ä–∏–Ω—è–ª–æ ‚Äî —Å—á–∏—Ç–∞–µ–º —É—Å–ø–µ—Ö–æ–º?
- ‚ö° –°–µ—Ä–≤–µ—Ä –≥–æ–≤–æ—Ä–∏—Ç "–ø—Ä–∏–Ω—è—Ç–æ" —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è, –∏–ª–∏ –∂–¥—ë—Ç, –ø–æ–∫–∞ –∫–æ–ø–∏–∏ —Ä–∞–∑–ª–µ—Ç—è—Ç—Å—è –ø–æ –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–µ—Ä–∞–º?
- üí• –ß—Ç–æ –µ—Å–ª–∏ –¥–≤–∞ —á–µ–ª–æ–≤–µ–∫–∞ –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç—è—Ö —Å–≤–µ—Ç–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–ø—Ä–∞–≤—è—Ç —Å–æ–æ–±—â–µ–Ω–∏—è ‚Äî –≤ –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ –≤—Å–µ –∏—Ö —É–≤–∏–¥—è—Ç?

–í—Å–µ —ç—Ç–∏ –≤–æ–ø—Ä–æ—Å—ã ‚Äî —ç—Ç–æ –≤–æ–ø—Ä–æ—Å—ã **replication semantics**.

**–ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ?**

–†–µ–ø–ª–∏–∫–∞—Ü–∏—è ‚Äî —ç—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è:
- **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ (Reliability):** –ï—Å–ª–∏ –æ–¥–∏–Ω —É–∑–µ–ª —É–ø–∞–¥—ë—Ç, –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ –¥—Ä—É–≥–∏—Ö
- **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (Availability):** –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ —Å–±–æ—è—Ö –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —É–∑–ª–æ–≤
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (Performance):** –ó–∞–ø—Ä–æ—Å—ã –º–æ–∂–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —É–∑–ª–∞–º–∏
- **–ë–ª–∏–∑–æ—Å—Ç–∏ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (Locality):** –î–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ –±–ª–∏–∑–∫–æ –∫ –∫–ª–∏–µ–Ω—Ç–∞–º

–ù–æ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å:
- üîÑ –î–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–º–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É–∑–ª–∞—Ö
- ‚è±Ô∏è –ü–æ—è–≤–ª—è–µ—Ç—Å—è –∑–∞–¥–µ—Ä–∂–∫–∞ (lag) –º–µ–∂–¥—É —É–∑–ª–∞–º–∏
- üí• –í–æ–∑–Ω–∏–∫–∞—é—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- üåê –°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –º–æ–≥—É—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –Ω–∞ —á–∞—Å—Ç–∏ (partitions)

**–ì–ª–∞–≤–Ω—ã–π trade-off —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏:**
```
–°–∏–ª—å–Ω—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏       –°–ª–∞–±—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏
(Consistency)          (Availability + Performance)
     ‚Üì                           ‚Üì
 –ú–µ–¥–ª–µ–Ω–Ω–µ–µ                   –ë—ã—Å—Ç—Ä–µ–µ
 –°–ª–æ–∂–Ω–µ–µ                     –ü—Ä–æ—â–µ
 –ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ                  –†–∏—Å–∫–æ–≤–∞–Ω–Ω–µ–µ
```

**–°–ø–µ–∫—Ç—Ä —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏:**
```
Synchronous ‚Üí Semi-sync ‚Üí Async ‚Üí Leaderless ‚Üí Multi-leader
  (—Å–∏–ª—å–Ω–∞—è      (–±–∞–ª–∞–Ω—Å)   (—Å–ª–∞–±–∞—è    (eventual    (eventual
   —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å)         —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å) consistency) consistency)

‚Üë –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
‚Üì –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
```

–í —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö (Postgres, MongoDB, Kafka, Redis, Cassandra, RabbitMQ) –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ replication semantics –ø—Ä–∏–≤–æ–¥–∏—Ç –∫:
- üí∏ –ü–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–±–æ—è—Ö
- üëª "–ü—Ä–∏–∑—Ä–∞—á–Ω—ã–º" –¥–∞–Ω–Ω—ã–º (–≤–∏–¥–Ω—ã –Ω–∞ –æ–¥–Ω–∏—Ö —É–∑–ª–∞—Ö, –Ω–µ –≤–∏–¥–Ω—ã –Ω–∞ –¥—Ä—É–≥–∏—Ö)
- üí• –ö–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º, –∫–æ—Ç–æ—Ä—ã–µ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç —Ä–∞–∑—Ä–µ—à–∏—Ç—å
- üêå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º –∑–∞–¥–µ—Ä–∂–∫–∞–º –∏ low throughput
- üò± Split-brain —Å–∏—Ç—É–∞—Ü–∏—è–º (—Å–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–¥–µ–ª–∏–ª–∞—Å—å –Ω–∞ —á–∞—Å—Ç–∏, –∫–∞–∂–¥–∞—è —Å—á–∏—Ç–∞–µ—Ç —Å–µ–±—è –≥–ª–∞–≤–Ω–æ–π)

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

–°—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç—Ä–∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–∞ –∫ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö. –ö–∞–∂–¥—ã–π –∏–∑ –Ω–∏—Ö –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫—Ç–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è –æ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –∫–∞–∫ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø.

---

## 1. Primary-Backup (Single-Leader) Replication ‚Äî –†–µ–ø–ª–∏–∫–∞—Ü–∏—è —Å –æ–¥–Ω–∏–º –ª–∏–¥–µ—Ä–æ–º

### –ß—Ç–æ —ç—Ç–æ?

**Primary-Backup replication** (—Ç–∞–∫–∂–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **Master-Slave** –∏–ª–∏ **Single-Leader replication**) ‚Äî —ç—Ç–æ –º–æ–¥–µ–ª—å, –≥–¥–µ –µ—Å—Ç—å –æ–¥–∏–Ω –≥–ª–∞–≤–Ω—ã–π —É–∑–µ–ª (**Primary/Master/Leader**), –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏, –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥—á–∏–Ω—ë–Ω–Ω—ã—Ö —É–∑–ª–æ–≤ (**Backup/Slave/Replica**), –∫–æ—Ç–æ—Ä—ã–µ –∫–æ–ø–∏—Ä—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –≥–ª–∞–≤–Ω–æ–≥–æ.

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:**
```
                    –ó–∞–ø–∏—Å—å
                      ‚Üì
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ   PRIMARY     ‚îÇ  ‚Üê –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —É–∑–µ–ª –¥–ª—è –∑–∞–ø–∏—Å–∏
              ‚îÇ   (Master)    ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ Replication Log
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚Üì            ‚Üì            ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ BACKUP ‚îÇ   ‚îÇ BACKUP ‚îÇ   ‚îÇ BACKUP ‚îÇ  ‚Üê –ö–æ–ø–∏—Ä—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
    ‚îÇ(Slave) ‚îÇ   ‚îÇ(Slave) ‚îÇ   ‚îÇ(Slave) ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üë            ‚Üë            ‚Üë
      –ß—Ç–µ–Ω–∏–µ      –ß—Ç–µ–Ω–∏–µ       –ß—Ç–µ–Ω–∏–µ
```

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å (write) —Ç–æ–ª—å–∫–æ –Ω–∞ Primary
2. Primary –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ
3. Primary –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ (—á–µ—Ä–µ–∑ replication log) –≤—Å–µ–º Backup —É–∑–ª–∞–º
4. Backup —É–∑–ª—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ —É —Å–µ–±—è
5. –ß—Ç–µ–Ω–∏–µ (read) –º–æ–∂–µ—Ç –∏–¥—Ç–∏ —Å Primary –∏–ª–∏ —Å –ª—é–±–æ–≥–æ Backup

### –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞:**
- –û–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –∑–∞–ø–∏—Å–µ–π
- –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∑–∞–ø–∏—Å–∏ (–≤—Å–µ –ø–∏—à—É—Ç –≤ –æ–¥–Ω–æ –º–µ—Å—Ç–æ)
- –ü–æ–Ω—è—Ç–Ω–∞—è —Å–µ–º–∞–Ω—Ç–∏–∫–∞: primary –∏–º–µ–µ—Ç —Å–∞–º—ã–µ —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ

‚úÖ **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–µ–π:**
- –í—Å–µ –∑–∞–ø–∏—Å–∏ –∏–¥—É—Ç —á–µ—Ä–µ–∑ –æ–¥–Ω—É —Ç–æ—á–∫—É
- –õ–µ–≥–∫–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å ordering (–ø–æ—Ä—è–¥–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π)

‚úÖ **–ü—Ä–æ—Å—Ç–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —á—Ç–µ–Ω–∏—è:**
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–Ω–æ–≥–æ backup —É–∑–ª–æ–≤
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å read-–∑–∞–ø—Ä–æ—Å—ã –º–µ–∂–¥—É –Ω–∏–º–∏

### –ß–µ–≥–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

‚ùå **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è:**
- Backup —É–∑–ª—ã –º–æ–≥—É—Ç –æ—Ç—Å—Ç–∞–≤–∞—Ç—å (replication lag)
- –ß–∏—Ç–∞—è —Å backup, –º–æ–∂–µ—à—å —É–≤–∏–¥–µ—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ

‚ùå **–ù–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å–∏:**
- –í—Å–µ –∑–∞–ø–∏—Å–∏ –∏–¥—É—Ç —á–µ—Ä–µ–∑ –æ–¥–∏–Ω —É–∑–µ–ª (bottleneck)

‚ùå **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –æ—Ç–∫–∞–∑–∞ (SPOF):**
- –ï—Å–ª–∏ Primary —É–ø–∞–¥—ë—Ç, –Ω—É–∂–µ–Ω failover –Ω–∞ backup
- –í–æ –≤—Ä–µ–º—è failover —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏

‚ùå **–°–ª–æ–∂–Ω–æ—Å—Ç—å failover:**
- –ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å –Ω–æ–≤–æ–≥–æ Primary?
- –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —É—Å–ø–µ–ª–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å—Å—è?

### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?

**PostgreSQL (Streaming Replication):**
```
Primary (–ø–æ—Ä—Ç 5432)
   ‚Üì WAL streaming
Secondary Replicas (read-only)

–ó–∞–ø–∏—Å—å ‚Üí Primary ‚Üí WAL ‚Üí Replicas
–ß—Ç–µ–Ω–∏–µ ‚Üí Primary –∏–ª–∏ Replicas (–º–æ–∂–µ—Ç –±—ã—Ç—å stale)
```

**MySQL (Master-Slave):**
```
Master (read/write)
   ‚Üì Binary log
Slaves (read-only)

–¢–∏–ø–∏—á–Ω–∞—è —Å–≤—è–∑–∫–∞: 1 Master + N Slaves
```

**MongoDB (Replica Set):**
```
Primary (read/write)
   ‚Üì Oplog
Secondaries (read: –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º)

Replica Set: 1 Primary + 2+ Secondaries
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π failover —á–µ—Ä–µ–∑ –≤—ã–±–æ—Ä—ã
```

**Redis (Master-Replica):**
```
Master (read/write)
   ‚Üì Replication stream
Replicas (read-only)

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

**RabbitMQ (Mirrored Queues - —Å—Ç–∞—Ä—ã–π –º–µ—Ö–∞–Ω–∏–∑–º):**
```
Master queue
   ‚Üì Mirror synchronization
Slave mirrors

–û–¥–Ω–∞ –æ—á–µ—Ä–µ–¥—å = –æ–¥–∏–Ω master
```

### –†–µ–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ –ø—Ä–æ–±–ª–µ–º—ã

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: Replication Lag (–æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ —Ä–µ–ø–ª–∏–∫)**

–ü—Ä–µ–¥—Å—Ç–∞–≤—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑:
```
10:00:00.000 ‚Üí –ö–ª–∏–µ–Ω—Ç POST /orders ‚Üí Primary
10:00:00.010 ‚Üí Primary: INSERT INTO orders ‚Üí OK
10:00:00.020 ‚Üí Primary: –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É "–ó–∞–∫–∞–∑ #12345 —Å–æ–∑–¥–∞–Ω"
10:00:00.030 ‚Üí –ö–ª–∏–µ–Ω—Ç: redirect –Ω–∞ GET /orders/12345
10:00:00.035 ‚Üí Load balancer: –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ Replica
10:00:00.040 ‚Üí Replica: SELECT * FROM orders WHERE id=12345
              ‚Ü≥ NOT FOUND üò± (—Ä–µ–ø–ª–∏–∫–∞ –µ—â—ë –Ω–µ –ø–æ–ª—É—á–∏–ª–∞ –¥–∞–Ω–Ω—ã–µ)

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç: "–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω"
```

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- Replica –æ—Ç—Å—Ç–∞—ë—Ç –æ—Ç Primary –Ω–∞ 50ms
- –ö–ª–∏–µ–Ω—Ç –±—ã—Å—Ç—Ä–æ —Å–¥–µ–ª–∞–ª —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å
- Load balancer –Ω–∞–ø—Ä–∞–≤–∏–ª read –Ω–∞ replica, –≥–¥–µ –¥–∞–Ω–Ω—ã—Ö –µ—â—ë –Ω–µ—Ç

**–ö–∞–∫ —Ä–µ—à–∏—Ç—å:**
- **Read-after-write consistency:** –ü–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ —á–∏—Ç–∞—Ç—å —Å Primary –≤ —Ç–µ—á–µ–Ω–∏–µ N —Å–µ–∫—É–Ω–¥
- **Session affinity:** –ü—Ä–∏–≤—è–∑–∞—Ç—å —Å–µ—Å—Å–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ Primary
- **Sync replication:** –ñ–¥–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç replicas (–∑–∞–º–µ–¥–ª–∏—Ç —Å–∏—Å—Ç–µ–º—É)
- **Version/timestamp tracking:** –ö–ª–∏–µ–Ω—Ç –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –≤–µ—Ä—Å–∏—é –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ—Å–∏—Ç replica –ø–æ–¥–æ–∂–¥–∞—Ç—å

---

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: Failover Data Loss (–ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏)**

E-commerce —Å–∏—Å—Ç–µ–º–∞. Primary —É–ø–∞–ª:
```
10:00:00 ‚Üí Primary: –ø—Ä–∏–Ω—è–ª 1000 –∑–∞–∫–∞–∑–æ–≤
10:00:05 ‚Üí Primary: –æ—Ç–ø—Ä–∞–≤–∏–ª —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –¥–æ –∑–∞–∫–∞–∑–∞ 950
10:00:06 ‚Üí Primary: CRASHED üí•
10:00:07 ‚Üí –°–∏—Å—Ç–µ–º–∞: –∑–∞–ø—É—Å–∫–∞–µ—Ç failover –Ω–∞ Replica
10:00:10 ‚Üí Replica: —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–æ–≤—ã–º Primary
10:00:11 ‚Üí –ö–ª–∏–µ–Ω—Ç—ã: –Ω–∞—á–∏–Ω–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–æ–≤—ã–º Primary

–†–µ–∑—É–ª—å—Ç–∞—Ç: –ó–∞–∫–∞–∑—ã 951-1000 –ü–û–¢–ï–†–Ø–ù–´ üò±
```

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- Primary –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é
- –ú–µ–∂–¥—É "–∑–∞–ø–∏—Å—å –Ω–∞ Primary" –∏ "—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –Ω–∞ Backup" –±—ã–ª–∞ –∑–∞–¥–µ—Ä–∂–∫–∞
- –í –º–æ–º–µ–Ω—Ç –ø–∞–¥–µ–Ω–∏—è Primary —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ —Ç–æ–ª—å–∫–æ –≤ –µ–≥–æ –ø–∞–º—è—Ç–∏

**–†–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç (–ø–æ—Ö–æ–∂–∏–π –Ω–∞ GitHub, 2012):**
GitHub –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª MySQL Master-Slave. –ü—Ä–∏ —Å–±–æ–µ master –ø–æ—Ç–µ—Ä—è–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –¥–∞–Ω–Ω—ã—Ö (issues, comments, commits). –ß–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –∏–∑ –¥—Ä—É–≥–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, –Ω–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Ç–µ—Ä—è–ª–∏ –Ω–∞–≤—Å–µ–≥–¥–∞.

**–ö–∞–∫ —Ä–µ—à–∏—Ç—å:**
- **Synchronous replication:** –ñ–¥–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π replica
- **Semi-synchronous:** –ñ–¥–∞—Ç—å –æ—Ç –æ–¥–Ω–æ–π replica, –Ω–æ –Ω–µ –æ—Ç –≤—Å–µ—Ö
- **WAL archiving:** –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å WAL –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- **Accept data loss:** –ï—Å–ª–∏ latency –≤–∞–∂–Ω–µ–µ, –ø—Ä–∏–∑–Ω–∞—Ç—å —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

---

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: Split-Brain (—Ä–∞–∑–¥–≤–æ–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã)**

–ö–ª–∞—Å—Ç–µ—Ä –∏–∑ 1 Primary + 2 Replicas. –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç network partition:
```
        –ò—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ Datacenter 1        ‚îÇ   Datacenter 2
      ‚îÇ                     ‚îÇ
      ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ  ‚îÇ Primary ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚î§ Replica ‚îÇ
      ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ       ‚ñ≤             ‚îÇ
      ‚îÇ       ‚îÇ             ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚î§ Replica ‚îÇ
      ‚îÇ                     ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

        –°–µ—Ç–µ–≤–æ–π —Ä–∞–∑–¥–µ–ª:
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ   ‚îÇ Replica ‚îÇ
      ‚îÇ ‚îÇ Primary ‚îÇ ‚úó‚úó‚úó‚úó‚úó‚úó‚úó‚úó‚úó‚úó‚ñ∂‚îÇ(–∏–∑–æ–ª–∏—Ä.)‚îÇ
      ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ      ‚ñ≤              ‚îÇ
      ‚îÇ      ‚îÇ ‚úó‚úó‚úó‚úó‚úó‚úó‚úó‚úó‚úó‚úó‚úó‚ñ∂‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÇ Replica ‚îÇ
      ‚îÇ                     ‚îÇ   ‚îÇ(–∏–∑–æ–ª–∏—Ä.)‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–û–±–µ Replicas –Ω–µ –≤–∏–¥—è—Ç Primary ‚Üí —Ä–µ—à–∞—é—Ç, —á—Ç–æ –æ–Ω —É–º–µ—Ä
‚Üí –í—ã–±–∏—Ä–∞—é—Ç –æ–¥–Ω—É –∏–∑ —Å–µ–±—è –Ω–æ–≤—ã–º Primary
‚Üí –¢–µ–ø–µ—Ä—å –î–í–ê Primary! üò±

Client A ‚Üí –ø–∏—à–µ—Ç –≤ —Å—Ç–∞—Ä—ã–π Primary (DC1)
Client B ‚Üí –ø–∏—à–µ—Ç –≤ –Ω–æ–≤—ã–π Primary (DC2)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –î–≤–∞ Primary –ø—Ä–∏–Ω–∏–º–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –∑–∞–ø–∏—Å–∏
- –î–∞–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—è—Ç—Å—è (divergence)
- –ö–æ–≥–¥–∞ —Å–µ—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è ‚Äî –∫–æ–Ω—Ñ–ª–∏–∫—Ç

**–ö–∞–∫ —Ä–µ—à–∏—Ç—å:**
- **Quorum-based election:** –ù—É–∂–Ω–æ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É–∑–ª–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞ Primary
- **Fencing:** –°—Ç–∞—Ä—ã–π Primary –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "—É–±–∏—Ç" (STONITH - Shoot The Other Node In The Head)
- **Distributed consensus:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Raft/Paxos –¥–ª—è –≤—ã–±–æ—Ä–∞ –ª–∏–¥–µ—Ä–∞
- **Witness node:** –¢—Ä–µ—Ç–∏–π —É–∑–µ–ª-–∞—Ä–±–∏—Ç—Ä, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ, –Ω–æ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –≤—ã–±–æ—Ä–∞—Ö

---

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Primary-Backup:**

‚úÖ **–•–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:**
- –ü—Ä–æ—Å—Ç—ã–µ —Å–∏—Å—Ç–µ–º—ã —Å –æ–¥–Ω–∏–º —Ä–µ–≥–∏–æ–Ω–æ–º
- Read-heavy –Ω–∞–≥—Ä—É–∑–∫–∞ (–º–Ω–æ–≥–æ —á—Ç–µ–Ω–∏–π, –º–∞–ª–æ –∑–∞–ø–∏—Å–µ–π)
- –ö–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç–∞ –∏ –ø–æ–Ω—è—Ç–Ω–æ—Å—Ç—å
- –ö–æ–≥–¥–∞ –º–æ–∂–Ω–æ –∂–∏—Ç—å —Å –Ω–µ–±–æ–ª—å—à–∏–º replication lag

‚ùå **–ü–ª–æ—Ö–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:**
- Write-heavy –Ω–∞–≥—Ä—É–∑–∫–∞ (Primary —Å—Ç–∞–Ω–µ—Ç bottleneck)
- –°–∏—Å—Ç–µ–º—ã —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ–º low latency –¥–ª—è –∑–∞–ø–∏—Å–∏
- Geo-distributed —Å–∏—Å—Ç–µ–º—ã (high latency —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏)
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ 100% availability –¥–ª—è –∑–∞–ø–∏—Å–∏

---

## 2. Multi-Leader (Multi-Master) Replication ‚Äî –ú—É–ª—å—Ç–∏–ª–∏–¥–µ—Ä–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è

### –ß—Ç–æ —ç—Ç–æ?

**Multi-Leader replication** (—Ç–∞–∫–∂–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **Multi-Master**) ‚Äî —ç—Ç–æ –º–æ–¥–µ–ª—å, –≥–¥–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–∑–ª–æ–≤ –º–æ–≥—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø–∏—Å–∏. –ö–∞–∂–¥—ã–π –ª–∏–¥–µ—Ä —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç —Å–≤–æ–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–º –ª–∏–¥–µ—Ä–∞–º.

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:**
```
         –ó–∞–ø–∏—Å—å                    –ó–∞–ø–∏—Å—å
           ‚Üì                          ‚Üì
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇLeader 1‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇLeader 2‚îÇ
      ‚îÇ  (US)  ‚îÇ  Bi-directional ‚îÇ  (EU)  ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò    Replication  ‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚Üì                          ‚Üì
        Replicas                   Replicas
```

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
1. –ö–ª–∏–µ–Ω—Ç –ø–∏—à–µ—Ç –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–π –∫ –Ω–µ–º—É Leader
2. Leader –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ
3. Leader –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Å–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–º Leaders
4. –î—Ä—É–≥–∏–µ Leaders –ø—Ä–∏–º–µ–Ω—è—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ —É —Å–µ–±—è
5. –ï—Å–ª–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ ‚Äî –Ω—É–∂–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è

### –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

‚úÖ **–ù–∏–∑–∫–∞—è latency –¥–ª—è –∑–∞–ø–∏—Å–∏:**
- –ö–ª–∏–µ–Ω—Ç –ø–∏—à–µ—Ç –Ω–∞ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ –±–ª–∏–∑–∫–∏–π —É–∑–µ–ª
- –ù–µ –Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –¥–∞–ª—ë–∫–∏—Ö –¥–∞—Ç–∞—Ü–µ–Ω—Ç—Ä–æ–≤

‚úÖ **–í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–ª—è –∑–∞–ø–∏—Å–∏:**
- –ï—Å–ª–∏ –æ–¥–∏–Ω –ª–∏–¥–µ—Ä —É–ø–∞–ª, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- –ù–µ—Ç –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–∏ –æ—Ç–∫–∞–∑–∞ –¥–ª—è –∑–∞–ø–∏—Å–µ–π

‚úÖ **Tolerance –∫ —Å–µ—Ç–µ–≤—ã–º —Ä–∞–∑–¥–µ–ª–∞–º:**
- –î–∞—Ç–∞—Ü–µ–Ω—Ç—Ä—ã –º–æ–≥—É—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ —Ç–µ—Ä—è—Ç—å —Å–≤—è–∑—å –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º
- –ö–∞–∂–¥—ã–π –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∞–≤—Ç–æ–Ω–æ–º–Ω–æ

‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏:**
- –ó–∞–ø–∏—Å–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —É–∑–ª–∞–º–∏

### –ß–µ–≥–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

‚ùå **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤:**
- –î–≤–∞ –ª–∏–¥–µ—Ä–∞ –º–æ–≥—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –æ–¥–Ω–∏ –¥–∞–Ω–Ω—ã–µ
- –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç (—á–∞—Å—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∏–Ω–æ–≥–¥–∞ —Å –ø–æ—Ç–µ—Ä–µ–π –¥–∞–Ω–Ω—ã—Ö)

‚ùå **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π:**
- –†–∞–∑–Ω—ã–µ –ª–∏–¥–µ—Ä—ã –º–æ–≥—É—Ç —É–≤–∏–¥–µ—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ä–∞–∑–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
- –ú–æ–∂–µ—Ç –Ω–∞—Ä—É—à–∏—Ç—å—Å—è –ø—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–≤—è–∑—å (causality)

‚ùå **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—É—é —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å:**
- Eventual consistency: –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–Ω–µ—á–Ω–æ–º –∏—Ç–æ–≥–µ —Å—Ç–∞–Ω—É—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏
- –ù–æ –≤ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç –º–æ–≥—É—Ç —Ä–∞–∑–ª–∏—á–∞—Ç—å—Å—è

‚ùå **–°–ª–æ–∂–Ω–æ—Å—Ç—å:**
- –ù–∞–º–Ω–æ–≥–æ —Å–ª–æ–∂–Ω–µ–µ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –æ—Ç–ª–∞–¥–∫–µ
- –ë–æ–ª—å—à–µ edge cases –∏ corner cases

### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?

**Multi-datacenter setup:**
```
US West (Leader)          EU (Leader)          Asia (Leader)
     ‚Üï                        ‚Üï                      ‚Üï
Cross-region replication —Å latency 100-300ms
```

**CouchDB / PouchDB:**
```
Server (Leader) ‚Üî Client Browser (Leader)
Offline-first –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å–µ—Ç–∏
```

**Postgres (—Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ —Ç–∏–ø–∞ BDR - Bi-Directional Replication):**
```
Postgres Node 1 (US) ‚Üî Postgres Node 2 (EU)
–û–±–∞ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –∑–∞–ø–∏—Å–∏
–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º
```

**MySQL Group Replication (Multi-Primary Mode):**
```
MySQL Node 1 ‚Üî MySQL Node 2 ‚Üî MySQL Node 3
–í—Å–µ —É–∑–ª—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç –∑–∞–ø–∏—Å–∏
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç Paxos –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏
```

**Collaborative editing (Google Docs, Figma):**
```
User A ‚Üí Server 1 ‚Üí —Ç–∏–ø–∞ "Leader"
User B ‚Üí Server 2 ‚Üí —Ç–∏–ø–∞ "Leader"
Operational Transform / CRDT –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
```

### –†–µ–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ –ø—Ä–æ–±–ª–µ–º—ã

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: Write Conflicts (–∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∑–∞–ø–∏—Å–∏)**

–î–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç –æ–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö:
```
–í—Ä–µ–º—è     US Leader                EU Leader
-----     ---------                ---------
10:00:00  User A: "title = Draft"
10:00:00                           User B: "title = Final"
10:00:01  Replicate to EU ‚Üí
10:00:01                           ‚Üê Replicate from US

–ö–æ–Ω—Ñ–ª–∏–∫—Ç! üò±
US Leader –∏–º–µ–µ—Ç: title = "Draft" ‚Üí –∑–∞—Ç–µ–º –ø–æ–ª—É—á–∞–µ—Ç "Final"
EU Leader –∏–º–µ–µ—Ç: title = "Final" ‚Üí –∑–∞—Ç–µ–º –ø–æ–ª—É—á–∞–µ—Ç "Draft"

–ö–∞–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ?
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è:**
1. **Last-Write-Wins (LWW):** –ü–æ–±–µ–∂–¥–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å –ø–æ timestamp
   - –ü—Ä–æ–±–ª–µ–º–∞: —á–∞—Å—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö –º–æ–≥—É—Ç –∏–¥—Ç–∏ –ø–æ-—Ä–∞–∑–Ω–æ–º—É
   - –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö

2. **Conflict Detection + Manual Resolution:** –°–∏—Å—Ç–µ–º–∞ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç, –ø—Ä–æ—Å–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—ã–±—Ä–∞—Ç—å
   - –ü—Ä–∏–º–µ—Ä: Git merge conflicts
   - –•–æ—Ä–æ—à–æ –¥–ª—è collaborative editing, –ø–ª–æ—Ö–æ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º

3. **Application-level Resolution:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–µ—à–∞–µ—Ç, –∫–∞–∫ –º–µ—Ä–∂–∏—Ç—å
   - –ü—Ä–∏–º–µ—Ä: –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ conflicting events –º–æ–∂–Ω–æ –æ–±–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
   - –¢—Ä–µ–±—É–µ—Ç domain knowledge

4. **CRDTs (Conflict-free Replicated Data Types):** –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–µ—Ä–∂–∞—Ç—Å—è –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
   - –ü—Ä–∏–º–µ—Ä: Riak, Redis Enterprise, Akka Distributed Data
   - –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

---

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: Causality Violation (–Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∏—á–∏–Ω–Ω–æ—Å—Ç–∏)**

–§–æ—Ä—É–º —Å –º—É–ª—å—Ç–∏–ª–∏–¥–µ—Ä–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π:
```
US Leader:
  10:00:00 ‚Üí Alice —Å–æ–∑–¥–∞—ë—Ç –ø–æ—Å—Ç "–ö—Ç–æ —Ö–æ—á–µ—Ç –ø–∏—Ü—Ü—É?"
  10:00:05 ‚Üí Bob –æ—Ç–≤–µ—á–∞–µ—Ç "–Ø —Ö–æ—á—É!"

EU Leader:
  10:00:03 ‚Üí –ü–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç Bob'–∞ "–Ø —Ö–æ—á—É!"
  10:00:07 ‚Üí –ü–æ–ª—É—á–∞–µ—Ç –ø–æ—Å—Ç Alice "–ö—Ç–æ —Ö–æ—á–µ—Ç –ø–∏—Ü—Ü—É?"

–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ EU:
  –°–Ω–∞—á–∞–ª–∞ –≤–∏–¥—è—Ç "–Ø —Ö–æ—á—É!" (reply)
  –ü–æ—Ç–æ–º "–ö—Ç–æ —Ö–æ—á–µ—Ç –ø–∏—Ü—Ü—É?" (original post)

  ‚Üí –û—Ç–≤–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –†–ê–ù–¨–®–ï –≤–æ–ø—Ä–æ—Å–∞! üò±
```

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –°–æ–æ–±—â–µ–Ω–∏—è —Ä–µ–ø–ª–∏—Ü–∏—Ä—É—é—Ç—Å—è —Å —Ä–∞–∑–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é
- –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π –ø–æ—Ä—è–¥–∫–∞ (ordering) –º–µ–∂–¥—É –ª–∏–¥–µ—Ä–∞–º–∏

**–ö–∞–∫ —Ä–µ—à–∏—Ç—å:**
- **Vector clocks / Version vectors:** –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏
- **Lamport timestamps:** –õ–æ–≥–∏—á–µ—Å–∫–∏–µ —á–∞—Å—ã –¥–ª—è ordering
- **–ù–æ:** –≠—Ç–æ —É—Å–ª–æ–∂–Ω—è–µ—Ç —Å–∏—Å—Ç–µ–º—É –∏ –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å –µ—ë

---

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å –ø–æ—Ç–µ—Ä–µ–π –¥–∞–Ω–Ω—ã—Ö**

E-commerce –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å. Last-Write-Wins —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:
```
US Leader:
  10:00:00 ‚Üí stock[iPhone] = 10
  10:00:10 ‚Üí Customer A –∫—É–ø–∏–ª 1 —à—Ç
           ‚Üí stock[iPhone] = 9 (timestamp: 10:00:10.500)

EU Leader:
  10:00:00 ‚Üí stock[iPhone] = 10
  10:00:10 ‚Üí Customer B –∫—É–ø–∏–ª 2 —à—Ç
           ‚Üí stock[iPhone] = 8 (timestamp: 10:00:10.800)

–†–µ–ø–ª–∏–∫–∞—Ü–∏—è:
  US ‚Üí EU: stock[iPhone] = 9 (ts: 10:00:10.500)
  EU ‚Üí US: stock[iPhone] = 8 (ts: 10:00:10.800)

LWW –ø–æ–±–µ–∂–¥–∞–µ—Ç: timestamp 10:00:10.800 > 10:00:10.500
–†–µ–∑—É–ª—å—Ç–∞—Ç: stock[iPhone] = 8 –Ω–∞ –û–ë–û–ò–• –ª–∏–¥–µ—Ä–∞—Ö

–ù–û! –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: 10 - 1 - 2 = 7

–ü—Ä–æ–¥–∞–ª–∏ 3 —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –Ω–æ inventory –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–¥–∞–ª–∏ 2
‚Üí overselling! üò±
```

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- LWW –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç —Å–µ–º–∞–Ω—Ç–∏–∫—É –æ–ø–µ—Ä–∞—Ü–∏–∏ (—ç—Ç–æ –Ω–µ SET, —ç—Ç–æ DECREMENT)
- –ü–æ—Ç–µ—Ä—è–ª–∏ –æ–¥–Ω—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é

**–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CRDT Counter (–∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –º–µ—Ä–∂–∏—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—ã/–¥–µ–∫—Ä–µ–º–µ–Ω—Ç—ã)
- –ò–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Multi-Leader –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å—á—ë—Ç—á–∏–∫–æ–≤
- –ò–ª–∏ —Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –Ω–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ (operation-based replication)

---

**–†–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç (–ø–æ—Ö–æ–∂–∏–π –Ω–∞ Amazon DynamoDB early days):**

–í —Ä–∞–Ω–Ω–∏—Ö –≤–µ—Ä—Å–∏—è—Ö —Å–∏—Å—Ç–µ–º —Å Multi-Leader —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π (–¥–æ –º–∞—Å—Å–æ–≤–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CRDTs) –±—ã–ª–∏ —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞:
- Shopping cart –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö –æ–±–Ω–æ–≤–ª—è–ª—Å—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω–æ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–∏–ª —Ç–æ–≤–∞—Ä A –≤ US, —Ç–æ–≤–∞—Ä B –≤ EU (—Ä–æ—É–º–∏–Ω–≥)
- LWW –ø—Ä–∏–≤—ë–ª –∫ —Ç–æ–º—É, —á—Ç–æ –æ–¥–∏–Ω –∏–∑ —Ç–æ–≤–∞—Ä–æ–≤ "–∏—Å—á–µ–∑" –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
- Amazon —Ä–µ—à–∏–ª: –ª—É—á—à–µ –ø–æ–∫–∞–∑–∞—Ç—å –í–°–ï –≤–µ—Ä—Å–∏–∏ –∏ –¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–±—Ä–∞—Ç—å, —á–µ–º –ø–æ—Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ
- –û—Ç—Å—é–¥–∞ –ø–æ—è–≤–∏–ª–∞—Å—å –∫–æ–Ω—Ü–µ–ø—Ü–∏—è "sibling values" –≤ Riak –∏ –¥—Ä—É–≥–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö

---

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Multi-Leader:**

‚úÖ **–•–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:**
- Geo-distributed —Å–∏—Å—Ç–µ–º—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É
- Offline-first –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (CouchDB/PouchDB –º–æ–¥–µ–ª—å)
- Collaborative editing (Google Docs, Notion)
- –°–∏—Å—Ç–µ–º—ã, –≥–¥–µ conflicts —Ä–µ–¥–∫–∏ –∏–ª–∏ –ª–µ–≥–∫–æ —Ä–∞–∑—Ä–µ—à–∏–º—ã
- –ö–æ–≥–¥–∞ latency –∑–∞–ø–∏—Å–∏ –∫—Ä–∏—Ç–∏—á–Ω–∞

‚ùå **–ü–ª–æ—Ö–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:**
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã (—Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–µ–Ω–µ–≥ –∏–∑-–∑–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)
- –°–∏—Å—Ç–µ–º—ã —Å —á–∞—Å—Ç—ã–º–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–º–∏ –∑–∞–ø–∏—Å—è–º–∏
- –ö–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å
- –ö–æ–≥–¥–∞ –∫–æ–º–∞–Ω–¥–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞ –∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–ª–∞–¥–∫–∏

---

## 3. Leaderless (Peer-to-Peer) Replication ‚Äî –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –±–µ–∑ –ª–∏–¥–µ—Ä–∞

### –ß—Ç–æ —ç—Ç–æ?

**Leaderless replication** ‚Äî —ç—Ç–æ –º–æ–¥–µ–ª—å, –≥–¥–µ –Ω–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –ª–∏–¥–µ—Ä–∞. –í—Å–µ —É–∑–ª—ã —Ä–∞–≤–Ω–æ–ø—Ä–∞–≤–Ω—ã (peers). –ö–ª–∏–µ–Ω—Ç –ø–∏—à–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–∑–ª–æ–≤ –∏ —á–∏—Ç–∞–µ—Ç —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É–∑–ª–æ–≤. –°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–≤–æ—Ä—É–º—ã (quorums) –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è "–∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö" –¥–∞–Ω–Ω—ã—Ö.

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:**
```
         Client –ø–∏—à–µ—Ç –Ω–∞ 3 —É–∑–ª–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
              ‚Üô        ‚Üì        ‚Üò
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ Node A ‚îÇ‚îÇ Node B ‚îÇ‚îÇ Node C ‚îÇ ‚Üê –í—Å–µ —Ä–∞–≤–Ω—ã
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚Üñ        ‚Üë        ‚Üó
           Client —á–∏—Ç–∞–µ—Ç —Å 2 —É–∑–ª–æ–≤
```

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
1. –ö–ª–∏–µ–Ω—Ç —Ä–µ—à–∞–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `X = 10`
2. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –Ω–∞ N —É–∑–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 3)
3. –ö–ª–∏–µ–Ω—Ç –∂–¥—ë—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç W —É–∑–ª–æ–≤ (write quorum, –Ω–∞–ø—Ä–∏–º–µ—Ä, 2)
4. –ö–∞–∫ —Ç–æ–ª—å–∫–æ W —É–∑–ª–æ–≤ –æ—Ç–≤–µ—Ç–∏–ª–∏ "–û–ö" ‚Äî –∑–∞–ø–∏—Å—å —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ–π
5. –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å R —É–∑–ª–æ–≤ (read quorum, –Ω–∞–ø—Ä–∏–º–µ—Ä, 2)
6. –ö–ª–∏–µ–Ω—Ç —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –≤–µ—Ä—Å–∏–∏ –∏ –≤—ã–±–∏—Ä–∞–µ—Ç —Å–∞–º—É—é —Å–≤–µ–∂—É—é (–ø–æ timestamp/version)

### –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

‚úÖ **–í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:**
- –ù–µ—Ç –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–∏ –æ—Ç–∫–∞–∑–∞
- –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –¥–∞–∂–µ –µ—Å–ª–∏ —á–∞—Å—Ç—å —É–∑–ª–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
- –ü–æ–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ W —É–∑–ª–æ–≤ ‚Äî –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å
- –ü–æ–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ R —É–∑–ª–æ–≤ ‚Äî –º–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å

‚úÖ **–ü—Ä–æ—Å—Ç–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å —É–∑–ª—ã –±–µ–∑ —Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ "–ª–∏–¥–µ—Ä–∞"
- –ù–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ

‚úÖ **–¢–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫ –º–µ–¥–ª–µ–Ω–Ω—ã–º —É–∑–ª–∞–º:**
- –ï—Å–ª–∏ –æ–¥–∏–Ω —É–∑–µ–ª —Ç–æ—Ä–º–æ–∑–∏—Ç, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—è—Ç
- –ö–ª–∏–µ–Ω—Ç –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∞–º–æ–≥–æ –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —É–∑–ª–∞

### –ß–µ–≥–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

‚ùå **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—É—é —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å:**
- –†–∞–∑–Ω—ã–µ —É–∑–ª—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- Eventual consistency (–≤ –∫–æ–Ω–µ—á–Ω–æ–º –∏—Ç–æ–≥–µ –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–Ω—É—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏)

‚ùå **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤:**
- –ü—Ä–∏ W < N –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —É–∑–ª—ã –º–æ–≥—É—Ç –Ω–µ –ø–æ–ª—É—á–∏—Ç—å –∑–∞–ø–∏—Å—å
- –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–ø–∏—Å–∏ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç –≤–µ—Ä—Å–∏–π

‚ùå **–°–ª–æ–∂–Ω–æ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç–∞:**
- –ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –æ–±—â–∞—Ç—å—Å—è —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —É–∑–ª–∞–º–∏
- –ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å —Ä–∞–∑—Ä–µ—à–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤–µ—Ä—Å–∏–π

### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?

**Amazon DynamoDB:**
```
N = 3 (—Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 3 —É–∑–ª–∞)
W = 2 (–∂–¥–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç 2)
R = 2 (—á–∏—Ç–∞—Ç—å —Å 2)
```

**Apache Cassandra:**
```
N, R, W ‚Äî –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ keyspace
Consistency Level: ONE, QUORUM, ALL
```

**Riak:**
```
N/R/W ‚Äî –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è per-bucket
–ü–æ–¥–¥–µ—Ä–∂–∫–∞ sibling values (–∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–µ –≤–µ—Ä—Å–∏–∏)
```

**Voldemort (LinkedIn):**
```
Leaderless key-value store
Vector clocks –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
```

### –†–µ–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ –ø—Ä–æ–±–ª–µ–º—ã

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: Quorum –¥–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ (R + W > N)**

–°–∏—Å—Ç–µ–º–∞ –∏–∑ 3 —É–∑–ª–æ–≤: A, B, C. –ù–∞—Å—Ç—Ä–æ–π–∫–∏: N=3, W=2, R=2

```
–ó–∞–ø–∏—Å—å X=10:
  Client ‚Üí A, B, C
  –ü–æ–ª—É—á–∏–ª–∏ OK –æ—Ç A, B ‚Üí SUCCESS
  (C –º–æ–≥ –Ω–µ —É—Å–ø–µ—Ç—å –∏–ª–∏ –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)

  –°–æ—Å—Ç–æ—è–Ω–∏–µ:
  A: X=10 (version 1)
  B: X=10 (version 1)
  C: X=—Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–ª–∏ X=10 (–º–æ–∂–µ—Ç –±—ã—Ç—å out-of-date)

–ß—Ç–µ–Ω–∏–µ X:
  Client ‚Üí –∑–∞–ø—Ä–æ—Å –∫ A, C
  A: X=10 (v1)
  C: X=10 (v1) –∏–ª–∏ —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

  Client –≤—ã–±–∏—Ä–∞–µ—Ç —Å–∞–º—É—é —Å–≤–µ–∂—É—é –≤–µ—Ä—Å–∏—é ‚Üí X=10 ‚úÖ
```

**–ü–æ—á–µ–º—É —Ä–∞–±–æ—Ç–∞–µ—Ç:**
–ï—Å–ª–∏ W=2 –∏ R=2, —Ç–æ R+W=4 > N=3
‚Üí –ú–Ω–æ–∂–µ—Å—Ç–≤–∞ —É–∑–ª–æ–≤ –¥–ª—è –∑–∞–ø–∏—Å–∏ –∏ —á—Ç–µ–Ω–∏—è **–ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç—Å—è**
‚Üí –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —É–∑–µ–ª, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ —á–∏—Ç–∞–µ–º, –∏–º–µ–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é

---

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ù–∞—Ä—É—à–µ–Ω–∏–µ –∫–≤–æ—Ä—É–º–∞ (R + W ‚â§ N)**

–°–∏—Å—Ç–µ–º–∞: N=3, W=1, R=1 (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏)

```
–ó–∞–ø–∏—Å—å X=10:
  Client ‚Üí A, B, C
  –ü–æ–ª—É—á–∏–ª–∏ OK –æ—Ç A ‚Üí SUCCESS (–Ω–µ –∂–¥—ë–º B –∏ C)

  –°–æ—Å—Ç–æ—è–Ω–∏–µ:
  A: X=10 (v1)
  B: X=—Å—Ç–∞—Ä–æ–µ (–µ—â—ë –Ω–µ –¥–æ—à–ª–æ)
  C: X=—Å—Ç–∞—Ä–æ–µ (–µ—â—ë –Ω–µ –¥–æ—à–ª–æ)

–ß—Ç–µ–Ω–∏–µ X:
  Client ‚Üí –∑–∞–ø—Ä–æ—Å –∫ B
  B: X=—Å—Ç–∞—Ä–æ–µ ‚ùå

  Client –ø–æ–ª—É—á–∞–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ!
```

**–ü–æ—á–µ–º—É –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
R+W = 1+1 = 2 ‚â§ N=3
‚Üí –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è
‚Üí –ú–æ–∂–µ–º –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å —É–∑–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —É—á–∞—Å—Ç–≤–æ–≤–∞–ª–∏ –≤ –∑–∞–ø–∏—Å–∏

**–ö–æ–≥–¥–∞ —Ç–∞–∫–æ–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç:**
- –ö–æ–≥–¥–∞ latency –∫—Ä–∏—Ç–∏—á–Ω–µ–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏
- Eventual consistency –ø—Ä–∏–µ–º–ª–µ–º–∞
- –ü—Ä–∏–º–µ—Ä: —Å—á—ë—Ç—á–∏–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤, –º–µ—Ç—Ä–∏–∫–∏ (–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ OK)

---

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: Network Partition (—Å–µ—Ç–µ–≤–æ–π —Ä–∞–∑–¥–µ–ª)**

–°–∏—Å—Ç–µ–º–∞: N=5 —É–∑–ª–æ–≤, W=3, R=3. –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç network partition:

```
          Network Split
        ‚ï±                ‚ï≤
   A, B, C              D, E
   (3 —É–∑–ª–∞)           (2 —É–∑–ª–∞)

Client 1 (–≤ —Å–µ—Ç–∏ A,B,C):
  –ü–∏—à–µ—Ç X=10 ‚Üí –ü–æ–ª—É—á–∞–µ—Ç OK –æ—Ç A,B,C (3 —É–∑–ª–∞ ‚â• W=3) ‚úÖ

Client 2 (–≤ —Å–µ—Ç–∏ D,E):
  –ü–∏—à–µ—Ç X=20 ‚Üí –ü–æ–ª—É—á–∞–µ—Ç OK —Ç–æ–ª—å–∫–æ –æ—Ç D,E (2 —É–∑–ª–∞ < W=3) ‚ùå
  ‚Üí –ó–∞–ø–∏—Å—å –û–¢–ö–õ–û–ù–ï–ù–ê (quorum –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç)

–ö–æ–≥–¥–∞ —Å–µ—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è:
  A,B,C: X=10
  D,E: X=—Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

  Anti-entropy repair / Read repair —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç D,E
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- –°–∏—Å—Ç–µ–º–∞ **–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏** —Ç–æ–ª—å–∫–æ –≤ –±–æ–ª—å—à–µ–π —á–∞—Å—Ç–∏ —Ä–∞–∑–¥–µ–ª–∞ (A,B,C)
- –ú–µ–Ω—å—à–∞—è —á–∞—Å—Ç—å (D,E) **–Ω–µ –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å** (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–∑–ª–æ–≤ –¥–ª—è –∫–≤–æ—Ä—É–º–∞)
- –≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç split-brain

**Trade-off:**
- –ï—Å–ª–∏ –±—ã W=2, –æ–±–µ —á–∞—Å—Ç–∏ –º–æ–≥–ª–∏ –±—ã –ø–∏—Å–∞—Ç—å ‚Üí split-brain
- –ï—Å–ª–∏ W=4, –¥–∞–∂–µ –±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –Ω–µ –º–æ–≥–ª–∞ –±—ã –ø–∏—Å–∞—Ç—å ‚Üí –Ω–∏–∑–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

---

**–°—Ü–µ–Ω–∞—Ä–∏–π 4: Sloppy Quorum –∏ Hinted Handoff**

–°–∏—Å—Ç–µ–º–∞: N=3 (A,B,C), W=2. –£–∑–µ–ª B –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:

```
–û–±—ã—á–Ω—ã–π –∫–≤–æ—Ä—É–º:
  Client –ø–∏—à–µ—Ç X=10 ‚Üí A, B, C
  B –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚ùå
  –ü–æ–ª—É—á–∏–ª–∏ OK —Ç–æ–ª—å–∫–æ –æ—Ç A, C (2 —É–∑–ª–∞ = W=2) ‚úÖ

Sloppy Quorum (Cassandra, Riak):
  Client –ø–∏—à–µ—Ç X=10 ‚Üí A, ?, C
  B –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚ùå
  Client –Ω–∞—Ö–æ–¥–∏—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é –∑–∞–º–µ–Ω—É B ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–∑–µ–ª D
  –ü–æ–ª—É—á–∏–ª–∏ OK –æ—Ç A, D, C (3 —É–∑–ª–∞ ‚â• W=2) ‚úÖ

  –°–æ—Å—Ç–æ—è–Ω–∏–µ:
  A: X=10
  B: –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
  C: X=10
  D: X=10 (–≤—Ä–µ–º–µ–Ω–Ω–æ —Ö—Ä–∞–Ω–∏—Ç –¥–ª—è B) + hint "—ç—Ç–æ –¥–ª—è B"

–ö–æ–≥–¥–∞ B –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è:
  D –ø–µ—Ä–µ–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ B (hinted handoff)
  D —É–¥–∞–ª—è–µ—Ç X (—ç—Ç–æ –±—ã–ª–æ –≤—Ä–µ–º–µ–Ω–Ω–æ)
```

**–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ:**
- –ü–æ–≤—ã—à–∞–µ—Ç **availability** (–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏)
- –î–∞–∂–µ –µ—Å–ª–∏ "–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ" —É–∑–ª—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, —Å–∏—Å—Ç–µ–º–∞ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–∏–º–µ—Ç –∑–∞–ø–∏—Å—å

**–ù–æ:**
- –ù–∞—Ä—É—à–∞–µ—Ç —Å—Ç—Ä–æ–≥—É—é —Å–µ–º–∞–Ω—Ç–∏–∫—É –∫–≤–æ—Ä—É–º–∞
- R+W > N **–Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç** —á—Ç–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏ (–ø–æ–∫–∞ hinted handoff –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω)

---

**–†–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç (–ø–æ—Ö–æ–∂–∏–π –Ω–∞ GitHub, 2012 - —Å–Ω–æ–≤–∞ –æ–Ω–∏ üòÖ):**

GitHub –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ Redis replicas. –ü—Ä–∏ network partition –ø—Ä–æ–∏–∑–æ—à–ª–æ —Å–ª–µ–¥—É—é—â–µ–µ:
- –ö–ª–∏–µ–Ω—Ç—ã –≤ –æ–¥–Ω–æ–π —á–∞—Å—Ç–∏ —Å–µ—Ç–∏ –ø–∏—Å–∞–ª–∏ –≤ –æ–¥–Ω—É –≥—Ä—É–ø–ø—É —É–∑–ª–æ–≤
- –ö–ª–∏–µ–Ω—Ç—ã –≤ –¥—Ä—É–≥–æ–π —á–∞—Å—Ç–∏ ‚Äî –≤ –¥—Ä—É–≥—É—é –≥—Ä—É–ø–ø—É
- –ö–æ–≥–¥–∞ —Å–µ—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å, –≤–µ—Ä—Å–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–∑–æ—à–ª–∏—Å—å
- Last-Write-Wins –ø—Ä–∏–≤—ë–ª –∫ –ø–æ—Ç–µ—Ä–µ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö writes

**–£—Ä–æ–∫:** Leaderless —Å–∏—Å—Ç–µ–º—ã —Ç—Ä–µ–±—É—é—Ç —Ç—â–∞—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ R, W, N –∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è trade-offs.

---

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Leaderless:**

‚úÖ **–•–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:**
- –°–∏—Å—Ç–µ–º—ã —Å –≤—ã—Å–æ–∫–∏–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫ availability
- Geo-distributed —Å–∏—Å—Ç–µ–º—ã
- –ö–æ–≥–¥–∞ eventual consistency –ø—Ä–∏–µ–º–ª–µ–º–∞
- Shopping carts, session storage, caching
- –ú–µ—Ç—Ä–∏–∫–∏, –ª–æ–≥–∏, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (–ø—Ä–∏–±–ª–∏–∂—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ OK)

‚ùå **–ü–ª–æ—Ö–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:**
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–Ω—É–∂–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å)
- –°–∏—Å—Ç–µ–º—ã —Å strong consistency —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏
- –ö–æ–≥–¥–∞ conflicts —Ç—Ä—É–¥–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å
- –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–º–Ω—ã–º (dumb clients)

---

## –ú–æ–¥–µ–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

–ü–æ–º–∏–º–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–∫—Ç–æ –ª–∏–¥–µ—Ä?), –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å **–º–æ–¥–µ–ª—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏** ‚Äî –∫–æ–≥–¥–∞ –∏–º–µ–Ω–Ω–æ Primary/Leader –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç—É?

---

## 1. Synchronous Replication ‚Äî –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è

### –ß—Ç–æ —ç—Ç–æ?

**Synchronous replication** ‚Äî —ç—Ç–æ –º–æ–¥–µ–ª—å, –≥–¥–µ Primary –∂–¥—ë—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç **–≤—Å–µ—Ö** (–∏–ª–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞) Backup —É–∑–ª–æ–≤ –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –æ—Ç–≤–µ—Ç–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É "OK".

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:**
```
Client ‚Üí Primary: write(X=10)
           ‚Üì
Primary ‚Üí Local: apply X=10
           ‚Üì
Primary ‚Üí Backup1: replicate X=10
Primary ‚Üí Backup2: replicate X=10
           ‚Üì (–ñ–î–Å–ú)
Primary ‚Üê Backup1: ACK ‚úÖ
Primary ‚Üê Backup2: ACK ‚úÖ
           ‚Üì
Primary ‚Üí Client: OK ‚úÖ (—Ç–æ–ª—å–∫–æ —Ç–µ–ø–µ—Ä—å!)
```

### –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

‚úÖ **Durability (–¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å):**
- –î–∞–Ω–Ω—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É–∑–ª–∞—Ö
- –ï—Å–ª–∏ Primary —É–ø–∞–¥—ë—Ç, –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ—Ç–µ—Ä—è—é—Ç—Å—è

‚úÖ **Consistency (—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å):**
- –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç OK ‚Üí –¥–∞–Ω–Ω—ã–µ —Ç–æ—á–Ω–æ –Ω–∞ –≤—Å–µ—Ö —Ä–µ–ø–ª–∏–∫–∞—Ö
- –ù–µ—Ç "partially committed" –¥–∞–Ω–Ω—ã—Ö

‚úÖ **–ù–µ—Ç data loss –ø—Ä–∏ failover:**
- –õ—é–±–∞—è Backup –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å Primary –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

### –ß–µ–≥–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

‚ùå **–í—ã—Å–æ–∫–∞—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:**
- –ù—É–∂–Ω–æ –∂–¥–∞—Ç—å —Å–µ—Ç–µ–≤–æ–≥–æ roundtrip –¥–æ Backup —É–∑–ª–æ–≤
- –ï—Å–ª–∏ Backup –¥–∞–ª–µ–∫–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ ‚Äî latency –æ–≥—Ä–æ–º–Ω–∞—è

‚ùå **–ù–∏–∑–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–ª—è –∑–∞–ø–∏—Å–∏:**
- –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω Backup –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –∑–∞–ø–∏—Å—å –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
- –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º–µ–Ω–µ–µ fault-tolerant

‚ùå **–ù–∏–∑–∫–∞—è throughput:**
- Primary –¥–æ–ª–∂–µ–Ω –∂–¥–∞—Ç—å, –ø—Ä–µ–∂–¥–µ —á–µ–º –ø—Ä–∏–Ω—è—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∑–∞–ø–∏—Å—å

### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?

**PostgreSQL (synchronous_standby_names):**
```sql
-- postgresql.conf
synchronous_standby_names = 'standby1,standby2'

-- Primary –∂–¥—ë—Ç —Ö–æ—Ç—è –±—ã 1 standby –ø–µ—Ä–µ–¥ COMMIT
```

**MySQL (Semi-Sync Replication –≤ —Ä–µ–∂–∏–º–µ WAIT_FOR_N):**
```
Primary ‚Üí N Slaves
–ñ–¥—ë–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç —Ö–æ—Ç—è –±—ã K slaves
```

**Kafka (acks=all):**
```
Producer ‚Üí Leader: message
Leader ‚Üí replicates to all in-sync replicas
Leader ‚Üí Producer: ACK (—Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –≤—Å–µ ISR –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏)
```

**ZooKeeper:**
```
–í—Å–µ –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ Zab protocol (–∫–æ–Ω—Å–µ–Ω—Å—É—Å)
–ó–∞–ø–∏—Å—å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ quorum –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª
```

**etcd / Consul:**
```
–ò—Å–ø–æ–ª—å–∑—É—é—Ç Raft consensus
–ó–∞–ø–∏—Å—å committed, —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É–∑–ª–æ–≤ –∑–∞–ø–∏—Å–∞–ª–æ –≤ log
```

### –†–µ–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å (—Ñ–∏–Ω–∞–Ω—Å—ã)**

–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞. –ü–µ—Ä–µ–≤–æ–¥ –¥–µ–Ω–µ–≥:
```
Client: transfer 1000$ from Alice to Bob
  ‚Üì
Primary:
  1. BEGIN TRANSACTION
  2. Alice.balance -= 1000
  3. Bob.balance += 1000
  4. Replication to Backup1 (US-East)
  5. Replication to Backup2 (US-West)
  6. WAIT for both ACKs ‚è≥
  7. Backup1: ACK ‚úÖ (5ms)
  8. Backup2: ACK ‚úÖ (50ms ‚Äî cross-region)
  9. COMMIT
  10. Client: OK ‚úÖ

Latency: ~50-60ms (+ processing)

–ù–æ —Ç–µ–ø–µ—Ä—å Primary –º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å ‚Äî –¥–µ–Ω—å–≥–∏ –Ω–µ –ø–æ—Ç–µ—Ä—è—é—Ç—Å—è! ‚úÖ
```

**–†–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä:** –ë–∞–Ω–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç synchronous replication –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π. Latency –≤ 50-100ms –ø—Ä–∏–µ–º–ª–µ–º–∞, –∫–æ–≥–¥–∞ —Ä–µ—á—å –æ –¥–µ–Ω—å–≥–∞—Ö.

---

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏–∑-–∑–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Backup**

E-commerce. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞:
```
Client: POST /orders
  ‚Üì
Primary: INSERT INTO orders ...
  ‚Üì
Primary ‚Üí Backup1: replicate (US) ‚Üí ACK ‚úÖ (10ms)
Primary ‚Üí Backup2: replicate (EU) ‚Üí TIMEOUT ‚è∞ (network issue)
  ‚Üì
Primary: –ñ–î–Å–ú Backup2... ‚è≥‚è≥‚è≥
  ‚Üì
[30 —Å–µ–∫—É–Ω–¥ —Å–ø—É—Å—Ç—è]
  ‚Üì
Primary: Backup2 –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç ‚Üí ABORT transaction ‚ùå
Client: ERROR 500 "Service unavailable" üò±
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–¥–∏–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–π Backup –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –≤—Å—é —Å–∏—Å—Ç–µ–º—É.

**–†–µ—à–µ–Ω–∏–µ:**
- **Semi-synchronous:** –ñ–¥–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ—Ç —á–∞—Å—Ç–∏ Backups (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1 –∏–∑ 2)
- **Timeouts:** –ï—Å–ª–∏ Backup –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª –∑–∞ N –º—Å, —Å—á–∏—Ç–∞—Ç—å –µ–≥–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
- **Dynamic adjustment:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–∫–ª—é—á–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ/–Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ Backups –∏–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –≥—Ä—É–ø–ø—ã

---

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Synchronous:**

‚úÖ **–•–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:**
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–µ–ª—å–∑—è –ø–æ—Ç–µ—Ä—è—Ç—å)
- Single-region deployments (–Ω–∏–∑–∫–∞—è latency –º–µ–∂–¥—É —É–∑–ª–∞–º–∏)
- –ö–æ–≥–¥–∞ durability –≤–∞–∂–Ω–µ–µ performance

‚ùå **–ü–ª–æ—Ö–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:**
- Geo-distributed —Å–∏—Å—Ç–µ–º—ã (high latency)
- High-throughput —Å–∏—Å—Ç–µ–º—ã
- –ö–æ–≥–¥–∞ availability –≤–∞–∂–Ω–µ–µ durability
- Real-time —Å–∏—Å—Ç–µ–º—ã (–Ω—É–∂–Ω–∞ low latency)

---

## 2. Asynchronous Replication ‚Äî –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è

### –ß—Ç–æ —ç—Ç–æ?

**Asynchronous replication** ‚Äî —ç—Ç–æ –º–æ–¥–µ–ª—å, –≥–¥–µ Primary –æ—Ç–≤–µ—á–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç—É "OK" **—Å—Ä–∞–∑—É** –ø–æ—Å–ª–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è, –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç Backup —É–∑–ª–æ–≤. –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ–æ–Ω–µ.

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:**
```
Client ‚Üí Primary: write(X=10)
           ‚Üì
Primary ‚Üí Local: apply X=10
           ‚Üì
Primary ‚Üí Client: OK ‚úÖ (—Å—Ä–∞–∑—É!)
           ‚Üì
(–í —Ñ–æ–Ω–µ, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ:)
Primary ‚Üí Backup1: replicate X=10
Primary ‚Üí Backup2: replicate X=10
```

### –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

‚úÖ **–ù–∏–∑–∫–∞—è latency:**
- –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –±—ã—Å—Ç—Ä–æ
- –ù–µ –∂–¥—ë–º —Å–µ—Ç–∏ –¥–æ Backups

‚úÖ **–í—ã—Å–æ–∫–∞—è throughput:**
- Primary –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
- –ú–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤

‚úÖ **–í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–ª—è –∑–∞–ø–∏—Å–∏:**
- –î–∞–∂–µ –µ—Å–ª–∏ –≤—Å–µ Backups –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, Primary –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

### –ß–µ–≥–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

‚ùå **–†–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö:**
- –ï—Å–ª–∏ Primary —É–ø–∞–¥—ë—Ç –¥–æ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞ Backups, –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è—é—Ç—Å—è
- "–í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ" (replication lag), –≤ –∫–æ—Ç–æ—Ä–æ–º –¥–∞–Ω–Ω—ã–µ —É—è–∑–≤–∏–º—ã

‚ùå **Stale reads –Ω–∞ Backups:**
- Backups –æ—Ç—Å—Ç–∞—é—Ç –æ—Ç Primary
- –ß–∏—Ç–∞—è —Å Backup, –≤–∏–¥–∏—à—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ

‚ùå **–í–æ–∑–º–æ–∂–µ–Ω "data loss window":**
- –ú–µ–∂–¥—É "OK –∫–ª–∏–µ–Ω—Ç—É" –∏ "–¥–∞–Ω–Ω—ã–µ –Ω–∞ Backups" –µ—Å—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫

### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?

**PostgreSQL (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):**
```
Primary ‚Üí WAL ‚Üí Async streaming to Standby
Standby –æ—Ç—Å—Ç–∞—ë—Ç –Ω–∞ N –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥/—Å–µ–∫—É–Ω–¥
```

**MySQL (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):**
```
Master ‚Üí Binary log ‚Üí Async to Slaves
```

**MongoDB (writeConcern: 1):**
```javascript
db.collection.insert({...}, {writeConcern: {w: 1}})
// w:1 = —Ç–æ–ª—å–∫–æ Primary, –Ω–µ –∂–¥—ë–º Secondaries
```

**Redis (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):**
```
Master ‚Üí Commands ‚Üí Async to Replicas
Replicas –º–æ–≥—É—Ç –æ—Ç—Å—Ç–∞–≤–∞—Ç—å
```

**Kafka (acks=1):**
```
Producer ‚Üí Leader: message
Leader ‚Üí Producer: ACK (—Å—Ä–∞–∑—É, –Ω–µ –∂–¥—ë–º follower replicas)
```

**RabbitMQ (non-mirrored queues):**
```
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—á–µ—Ä–µ–¥—å –Ω–∞ –æ–¥–Ω–æ–º —É–∑–ª–µ
–†–µ–ø–ª–∏–∫–∞—Ü–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è
```

### –†–µ–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ Primary**

–ë–ª–æ–≥-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—É–±–ª–∏–∫—É–µ—Ç –ø–æ—Å—Ç:
```
10:00:00.000 ‚Üí Client: POST /posts "–ú–æ–π –Ω–æ–≤—ã–π –ø–æ—Å—Ç"
10:00:00.010 ‚Üí Primary: INSERT INTO posts ... ‚Üí OK
10:00:00.020 ‚Üí Primary ‚Üí Client: "–ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω! ID=12345" ‚úÖ
10:00:00.030 ‚Üí Primary: –Ω–∞—á–∏–Ω–∞—é —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –Ω–∞ Backup...
10:00:00.040 ‚Üí Primary: CRASHED üí• (hardware failure)

Backup: –Ω–µ –ø–æ–ª—É—á–∏–ª –ø–æ—Å—Ç 12345 ‚ùå

10:00:10.000 ‚Üí Failover –Ω–∞ Backup
10:00:11.000 ‚Üí Backup —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è Primary
10:00:12.000 ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ì–¥–µ –º–æ–π –ø–æ—Å—Ç?!" üò±
                 GET /posts/12345 ‚Üí 404 Not Found
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–∏—Å—Ç–µ–º–∞ —Å–∫–∞–∑–∞–ª–∞ "OK", –Ω–æ –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–ª–∏—Å—å.

**–†–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä:** –¢–∞–∫–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∏ –≤–æ –º–Ω–æ–≥–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö. GitHub –∏–Ω—Ü–∏–¥–µ–Ω—Ç 2012 –≥–æ–¥–∞ –≤–∫–ª—é—á–∞–ª –ø–æ–¥–æ–±–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π.

**–ö–∞–∫ –∂–∏—Ç—å —Å —ç—Ç–∏–º:**
- **–ü—Ä–∏–Ω—è—Ç—å —Ä–∏—Å–∫:** –î–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–∫–µ—à, –ª–æ–≥–∏, –º–µ—Ç—Ä–∏–∫–∏) —ç—Ç–æ –û–ö
- **Monitoring replication lag:** –°–ª–µ–¥–∏—Ç—å –∑–∞ –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ–º Backups
- **Write-Ahead Log archiving:** –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å WAL –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (S3, GCS)
- **Upgrade to semi-sync:** –î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é

---

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: Replication Lag –∏ Read-after-Write –ø—Ä–æ–±–ª–µ–º—ã**

–°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Ç—å. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç –∞–≤–∞—Ç–∞—Ä:
```
10:00:00 ‚Üí Client (Europe): POST /avatar ‚Üí Primary (US)
10:00:01 ‚Üí Primary: UPDATE users SET avatar='new.jpg' ‚Üí OK
10:00:02 ‚Üí Primary ‚Üí Client: "Avatar updated" ‚úÖ
10:00:03 ‚Üí Client: redirect to profile page
10:00:04 ‚Üí Load Balancer: –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ Backup (Europe)
10:00:05 ‚Üí Backup (Europe): SELECT avatar FROM users
            ‚Üí avatar='old.jpg' ‚ùå (replication lag 200ms)

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å—Ç–∞—Ä—ã–π –∞–≤–∞—Ç–∞—Ä üòï
```

**Replication lag:**
- Primary (US) ‚Üí Backup (Europe): ~100-200ms
- –í —ç—Ç–æ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ —á–∏—Ç–∞—è —Å Backup, –≤–∏–¥–∏–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ

**–†–µ—à–µ–Ω–∏—è:**
- **Read from Primary after write:** –ü–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ —á–∏—Ç–∞—Ç—å —Å Primary
- **Session stickiness:** –ü—Ä–∏–≤—è–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ Primary –Ω–∞ N —Å–µ–∫—É–Ω–¥
- **Read-your-writes consistency:** –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤–µ—Ä—Å–∏—é –¥–∞–Ω–Ω—ã—Ö –∏ –∂–¥–∞—Ç—å –Ω–∞ Backup
- **Monotonic reads:** –í—Å–µ–≥–¥–∞ —á–∏—Ç–∞—Ç—å —Å –æ–¥–Ω–æ–≥–æ —É–∑–ª–∞ (–Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É Primary/Backup)

---

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: Monitoring –∏ –∞–ª–µ—Ä—Ç—ã –Ω–∞ Replication Lag**

Production system:
```
Normal state:
  Primary ‚Üí Backup: lag ~50ms ‚úÖ

Network degradation:
  Primary ‚Üí Backup: lag ~5 seconds ‚ö†Ô∏è

  Alert: "Replication lag > 1s on backup-eu-1"

Backup –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Å—Ç–∞–ª:
  Primary ‚Üí Backup: lag ~5 minutes üö®

  Alert: "Critical: Replication lag > 1min"
  Action: Exclude backup from read pool
```

**–ú–µ—Ç—Ä–∏–∫–∏:**
- PostgreSQL: `pg_stat_replication.replay_lag`
- MySQL: `SHOW SLAVE STATUS; Seconds_Behind_Master`
- MongoDB: `rs.status().members[].optimeDate`
- Redis: `INFO replication; master_repl_offset vs slave_repl_offset`

**–ü—Ä–∞–∫—Ç–∏–∫–∞:**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å replication lag
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –ø–æ—Ä–æ–≥–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, >1s warning, >10s critical)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–∫–ª—é—á–∞—Ç—å –æ—Ç—Å—Ç–∞—é—â–∏–µ Backups –∏–∑ read pool

---

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Asynchronous:**

‚úÖ **–•–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:**
- –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ web-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- Read-heavy –Ω–∞–≥—Ä—É–∑–∫–∞
- –ö–æ–≥–¥–∞ latency –∫—Ä–∏—Ç–∏—á–Ω–∞
- –ö–æ–≥–¥–∞ availability –≤–∞–∂–Ω–µ–µ durability
- –ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∫–µ—à–∏, –ª–æ–≥–∏, –º–µ—Ç—Ä–∏–∫–∏)

‚ùå **–ü–ª–æ—Ö–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:**
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã (—Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–µ–Ω–µ–≥)
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –≥–¥–µ –ø–æ—Ç–µ—Ä—è –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–∞
- –°–∏—Å—Ç–µ–º—ã —Å —Å—Ç—Ä–æ–≥–∏–º–∏ durability —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏

---

## 3. Semi-Synchronous Replication ‚Äî –ü–æ–ª—É—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è

### –ß—Ç–æ —ç—Ç–æ?

**Semi-synchronous replication** ‚Äî —ç—Ç–æ –≥–∏–±—Ä–∏–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏. Primary –∂–¥—ë—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç **—Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ** (–∏–ª–∏ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —á–∏—Å–ª–∞) Backup —É–∑–ª–∞, –Ω–æ –Ω–µ –æ—Ç –≤—Å–µ—Ö.

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:**
```
Client ‚Üí Primary: write(X=10)
           ‚Üì
Primary ‚Üí Local: apply X=10
           ‚Üì
Primary ‚Üí Backup1: replicate X=10
Primary ‚Üí Backup2: replicate X=10
Primary ‚Üí Backup3: replicate X=10
           ‚Üì (–ñ–î–Å–ú –º–∏–Ω–∏–º—É–º 1 ACK)
Primary ‚Üê Backup1: ACK ‚úÖ (–ø–µ—Ä–≤—ã–π –æ—Ç–≤–µ—Ç–∏–ª)
           ‚Üì
Primary ‚Üí Client: OK ‚úÖ (–Ω–µ –∂–¥—ë–º Backup2, Backup3)
           ‚Üì
(–í —Ñ–æ–Ω–µ:)
Primary ‚Üê Backup2: ACK ‚úÖ
Primary ‚Üê Backup3: ACK ‚úÖ
```

### –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

‚úÖ **–ë–∞–ª–∞–Ω—Å durability –∏ performance:**
- –î–∞–Ω–Ω—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –º–∏–Ω–∏–º—É–º –Ω–∞ 2 —É–∑–ª–∞—Ö (Primary + 1 Backup)
- Latency –Ω–∏–∂–µ, —á–µ–º —É –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç single point of failure:**
- –ï—Å–ª–∏ Primary —É–ø–∞–ª, –¥–∞–Ω–Ω—ã–µ –Ω–∞ –∫–∞–∫ –º–∏–Ω–∏–º—É–º –æ–¥–Ω–æ–º Backup

‚úÖ **–¢–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫ –º–µ–¥–ª–µ–Ω–Ω—ã–º Backups:**
- –ù–µ –∂–¥—ë–º —Å–∞–º–æ–≥–æ –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ Backup
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–∞–º–æ–≥–æ –±—ã—Å—Ç—Ä–æ–≥–æ

### –ß–µ–≥–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

‚ùå **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—É—é durability:**
- –ï—Å–ª–∏ Primary + 1 Backup —É–ø–∞–ª–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–µ—Ç –ø–æ—Ç–µ—Ä—è—Ç—å—Å—è

‚ùå **Replication lag –Ω–∞ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö Backups:**
- Backups, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —É—á–∞—Å—Ç–≤–æ–≤–∞–ª–∏ –≤ –∫–≤–æ—Ä—É–º–µ, –º–æ–≥—É—Ç –æ—Ç—Å—Ç–∞–≤–∞—Ç—å

### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?

**MySQL (Semi-Sync Replication):**
```sql
-- –ù–∞ Master:
INSTALL PLUGIN rpl_semi_sync_master SONAME 'semisync_master.so';
SET GLOBAL rpl_semi_sync_master_enabled = 1;

-- Master –∂–¥—ë—Ç ACK —Ö–æ—Ç—è –±—ã –æ—Ç 1 Slave
```

**PostgreSQL (—Å synchronous_standby_names):**
```
synchronous_standby_names = 'FIRST 1 (standby1, standby2, standby3)'
# –ñ–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –∏–∑ —Å–ø–∏—Å–∫–∞
```

**MongoDB (writeConcern: {w: 2}):**
```javascript
db.collection.insert({...}, {writeConcern: {w: 2}})
// Primary + 1 Secondary
```

**Kafka (min.insync.replicas):**
```
min.insync.replicas = 2
acks = all

Leader + –º–∏–Ω–∏–º—É–º 1 in-sync replica –¥–æ–ª–∂–Ω—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
```

### –†–µ–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

**–°—Ü–µ–Ω–∞—Ä–∏–π: E-commerce —Å –±–∞–ª–∞–Ω—Å–æ–º —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏**

–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω. –ó–∞–∫–∞–∑:
```
Settings: N=3 backups, wait for 1

Client: POST /orders
  ‚Üì
Primary: INSERT INTO orders ...
  ‚Üì
Primary ‚Üí Backup-US: replicate ‚Üí ACK ‚úÖ (10ms)
Primary ‚Üí Backup-EU: replicate ‚Üí ... (100ms, –Ω–µ –∂–¥—ë–º)
Primary ‚Üí Backup-Asia: replicate ‚Üí ... (200ms, –Ω–µ –∂–¥—ë–º)
  ‚Üì
Primary ‚Üí Client: OK ‚úÖ (latency ~15ms)

–î–∞–Ω–Ω—ã–µ —É–∂–µ –Ω–∞ 2 —É–∑–ª–∞—Ö (Primary + Backup-US)
```

**Failover scenario:**
```
Primary —É–ø–∞–ª üí•
  ‚Üì
Backup-US: –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ ‚úÖ
Backup-EU: –æ—Ç—Å—Ç–∞—ë—Ç –Ω–∞ 50ms (–Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–∫–∞–∑–æ–≤)
Backup-Asia: –æ—Ç—Å—Ç–∞—ë—Ç –Ω–∞ 150ms
  ‚Üì
Failover –Ω–∞ Backup-US ‚úÖ (–¥–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã)
```

**Trade-off:**
- Latency: ~15ms (vs ~10ms async, vs ~100ms+ full sync)
- Durability: –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ Primary (vs —Ä–∏—Å–∫ –≤ async)
- Availability: –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–∂–µ –µ—Å–ª–∏ 2 –∏–∑ 3 Backups –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã

---

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Semi-Synchronous:**

‚úÖ **–•–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:**
- –°–∏—Å—Ç–µ–º—ã, –≥–¥–µ –Ω—É–∂–µ–Ω –±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏
- E-commerce, SaaS-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ö–æ–≥–¥–∞ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ Backups, –Ω–æ –∂–¥–∞—Ç—å –≤—Å–µ—Ö –¥–æ—Ä–æ–≥–æ
- Production-grade —Å–∏—Å—Ç–µ–º—ã —Å —É–º–µ—Ä–µ–Ω–Ω—ã–º–∏ durability —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏

‚ùå **–ü–ª–æ—Ö–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:**
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å—ã (–Ω—É–∂–Ω–∞ full sync)
- –°–∏—Å—Ç–µ–º—ã —Å —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ low latency —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ (–Ω—É–∂–Ω–∞ async)

---

## –ö–≤–æ—Ä—É–º–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã

–í Leaderless —Å–∏—Å—Ç–µ–º–∞—Ö –Ω–µ—Ç –µ–¥–∏–Ω–æ–≥–æ Primary, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ—à–∞–µ—Ç, —á—Ç–æ —Å—á–∏—Ç–∞—Ç—å "–ø—Ä–∞–≤–¥–æ–π". –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–∫–≤–æ—Ä—É–º—ã** ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ —É–∑–ª–æ–≤, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏.

---

## Quorum Replication ‚Äî –ö–≤–æ—Ä—É–º–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

**Quorum** (–∫–≤–æ—Ä—É–º) ‚Äî —ç—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è. –í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏:

- **N** = total number of replicas (–æ–±—â–µ–µ —á–∏—Å–ª–æ —Ä–µ–ø–ª–∏–∫)
- **W** = write quorum (—Å–∫–æ–ª—å–∫–æ —É–∑–ª–æ–≤ –¥–æ–ª–∂–Ω—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–ø–∏—Å—å)
- **R** = read quorum (—Å —Å–∫–æ–ª—å–∫–∏—Ö —É–∑–ª–æ–≤ –Ω—É–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å)

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:**
```
    N = 5 replicas
    ‚îå‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ A ‚îÇ B ‚îÇ C ‚îÇ D ‚îÇ E ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îò

Write —Å W=3:
    Client ‚Üí A, B, C, D, E
    –ñ–¥—ë–º ACK –æ—Ç 3 —É–∑–ª–æ–≤ ‚Üí Success

Read —Å R=3:
    Client ‚Üí –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç A, B, C
    –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –≤–µ—Ä—Å–∏–∏
    –í—ã–±–∏—Ä–∞–µ—Ç latest
```

### –ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ –∫–≤–æ—Ä—É–º–æ–≤

**R + W > N** ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å

–ü–æ—á–µ–º—É? –ü–æ—Ç–æ–º—É —á—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —É–∑–ª–æ–≤ –¥–ª—è —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏ **–ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç—Å—è**:
- –ï—Å–ª–∏ W=3 –∏ R=3, —Ç–æ –∏–∑ 5 —É–∑–ª–æ–≤: {A,B,C} ‚à© {C,D,E} = {C}
- –ö–∞–∫ –º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω —É–∑–µ–ª, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ —á–∏—Ç–∞–µ–º, —É—á–∞—Å—Ç–≤–æ–≤–∞–ª –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏
- ‚Üí –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤–∏–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏)

**–ü—Ä–∏–º–µ—Ä—ã:**
```
N=3, W=2, R=2: R+W=4 > N=3 ‚úÖ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å
N=3, W=1, R=1: R+W=2 ‚â§ N=3 ‚ùå Eventual consistency
N=5, W=3, R=3: R+W=6 > N=5 ‚úÖ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å
N=5, W=1, R=5: R+W=6 > N=5 ‚úÖ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å (read-heavy)
N=5, W=5, R=1: R+W=6 > N=5 ‚úÖ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å (write-heavy)
```

### –¢–∏–ø–∏—á–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**1. Strong consistency (W=N, R=1 –∏–ª–∏ W+R>N):**
```
N=3, W=3, R=1
–í—Å–µ —É–∑–ª—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç –∑–∞–ø–∏—Å—å ‚Üí –ú–æ–∂–µ–º —á–∏—Ç–∞—Ç—å —Å –æ–¥–Ω–æ–≥–æ
–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å, –±—ã—Å—Ç—Ä–æ–µ —á—Ç–µ–Ω–∏–µ
```

**2. Balanced (W=‚åàN/2‚åâ, R=‚åàN/2‚åâ):**
```
N=3, W=2, R=2
–ë–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏
```

**3. Fast writes (W=1, R=N):**
```
N=3, W=1, R=N
–ë—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å, –º–µ–¥–ª–µ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ
–†–∏—Å–∫: –µ—Å–ª–∏ —É–∑–µ–ª —Å W=1 —É–ø–∞–¥—ë—Ç, –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã
```

**4. Eventual consistency (W=1, R=1):**
```
N=3, W=1, R=1
–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å, —Å–ª–∞–±—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏
–î–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```

---

## Read/Write Quorum Semantics ‚Äî –°–µ–º–∞–Ω—Ç–∏–∫–∞ –∫–≤–æ—Ä—É–º–æ–≤ —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏

### –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–ö–≤–æ—Ä—É–º–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–≤–µ–∂–µ–µ.

**–ü–æ–¥—Ö–æ–¥—ã:**
1. **Timestamps:** –ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å –ø–æ–º–µ—á–∞–µ—Ç—Å—è timestamp. Latest timestamp = latest data
   - –ü—Ä–æ–±–ª–µ–º–∞: —á–∞—Å—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É–∑–ª–∞—Ö –º–æ–≥—É—Ç —Ä–∞—Å—Ö–æ–¥–∏—Ç—å—Å—è (clock skew)

2. **Version numbers:** –ú–æ–Ω–æ—Ç–æ–Ω–Ω–æ –≤–æ–∑—Ä–∞—Å—Ç–∞—é—â–∏–µ —á–∏—Å–ª–∞
   - –ü—Ä–æ–±–ª–µ–º–∞: –≤ Leaderless —Å–∏—Å—Ç–µ–º–∞—Ö –Ω–µ—Ç –µ–¥–∏–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤–µ—Ä—Å–∏–π

3. **Vector clocks / Version vectors:** –ö–∞–∂–¥—ã–π —É–∑–µ–ª –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–≤–æ—é –≤–µ—Ä—Å–∏—é –∏ –≤–µ—Ä—Å–∏–∏ –¥—Ä—É–≥–∏—Ö —É–∑–ª–æ–≤
   - –ú–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å causality (–ø—Ä–∏—á–∏–Ω–Ω–æ—Å—Ç—å) –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Riak, Voldemort

### Read Quorum Process

**–®–∞–≥–∏ —á—Ç–µ–Ω–∏—è —Å –∫–≤–æ—Ä—É–º–æ–º:**
```
1. Client ‚Üí Coordinator: GET key=X
2. Coordinator ‚Üí –≤—ã–±–∏—Ä–∞–µ—Ç R —É–∑–ª–æ–≤
3. Coordinator ‚Üí –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç X —Å R —É–∑–ª–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
4. –£–∑–ª—ã –æ—Ç–≤–µ—á–∞—é—Ç: (value, version)
   A: (X=10, v3)
   B: (X=10, v3)
   C: (X=5,  v1)  ‚Üê –£—Å—Ç–∞—Ä–µ–≤—à–∞—è –≤–µ—Ä—Å–∏—è!
5. Coordinator: —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç versions
   Latest version: v3 ‚Üí value=10
6. Coordinator ‚Üí Client: X=10
7. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Read Repair:
   Coordinator ‚Üí C: –æ–±–Ω–æ–≤–∏ X –¥–æ (10, v3)
```

**Read Repair:**
- –ü–æ—Å–ª–µ —á—Ç–µ–Ω–∏—è Coordinator –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç, —á—Ç–æ —É–∑–µ–ª C —É—Å—Ç–∞—Ä–µ–ª
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–º—É –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (repair)
- –≠—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º **anti-entropy** (–±–æ—Ä—å–±–∞ —Å —Ä–∞—Å—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å—é)

### Write Quorum Process

**–®–∞–≥–∏ –∑–∞–ø–∏—Å–∏ —Å –∫–≤–æ—Ä—É–º–æ–º:**
```
1. Client ‚Üí Coordinator: PUT key=X, value=20
2. Coordinator ‚Üí –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—É—é version (v4)
3. Coordinator ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç (X=20, v4) –Ω–∞ N —É–∑–ª–æ–≤
4. –£–∑–ª—ã –ª–æ–∫–∞–ª—å–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç (X=20, v4)
5. –£–∑–ª—ã –æ—Ç–≤–µ—á–∞—é—Ç: ACK
   A: ACK ‚úÖ
   B: ACK ‚úÖ
   C: ...timeout...
   D: ACK ‚úÖ
   E: ...timeout...
6. Coordinator: –ø–æ–ª—É—á–∏–ª–∏ 3 ACKs ‚â• W=3 ‚Üí Success
7. Coordinator ‚Üí Client: OK ‚úÖ

(C –∏ E –≤ –∏—Ç–æ–≥–µ –ø–æ–ª—É—á–∞—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ anti-entropy repair)
```

### –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤–µ—Ä—Å–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞: Concurrent Writes**
```
–í—Ä–µ–º—è    | Client A           | Client B
---------|--------------------|-----------------
10:00:00 | –ß–∏—Ç–∞–µ—Ç X=(10, v3)  |
10:00:01 |                    | –ß–∏—Ç–∞–µ—Ç X=(10, v3)
10:00:02 | –ü–∏—à–µ—Ç X=(15, v4)   |
10:00:03 |                    | –ü–∏—à–µ—Ç X=(20, v5)

–ö–æ–Ω—Ñ–ª–∏–∫—Ç! –ö–∞–∫–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è?
```

**–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è timestamps:**
```
v4: timestamp 10:00:02.500
v5: timestamp 10:00:03.100

Last-Write-Wins: v5 –ø–æ–±–µ–∂–¥–∞–µ—Ç (20) ‚úÖ
```

**–ù–æ: –ü—Ä–æ–±–ª–µ–º–∞ clock skew:**
```
v4: timestamp 10:00:03.000 (—á–∞—Å—ã —É–∑–ª–∞ A –≤–ø–µ—Ä–µ–¥–∏)
v5: timestamp 10:00:02.500 (—á–∞—Å—ã —É–∑–ª–∞ B –æ—Ç—Å—Ç–∞—é—Ç)

LWW: v4 –ø–æ–±–µ–∂–¥–∞–µ—Ç (15)
–ù–æ –æ–ø–µ—Ä–∞—Ü–∏—è v5 –ø—Ä–æ–∏–∑–æ—à–ª–∞ –ü–û–ó–ñ–ï! ‚ùå
```

**–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è Vector Clocks:**
```
A: [A:1, B:0] ‚Üí X=15
B: [A:0, B:1] ‚Üí X=20

–ö–æ–Ω—Ñ–ª–∏–∫—Ç! –í–µ—Ä—Å–∏–∏ concurrent (–Ω–µ—Å—Ä–∞–≤–Ω–∏–º—ã –ø–æ causality)
‚Üí –°–∏—Å—Ç–µ–º–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –û–ë–ï –≤–µ—Ä—Å–∏–∏ (siblings)
‚Üí –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç
```

### Sloppy Quorum

**–ü—Ä–æ–±–ª–µ–º–∞:** –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–∑–ª–æ–≤ –∏–∑ "–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ" N –¥–æ—Å—Ç—É–ø–Ω–æ?

**Sloppy Quorum:**
- –ï—Å–ª–∏ –∏–∑ N —É–∑–ª–æ–≤ –¥–æ—Å—Ç—É–ø–Ω–æ –º–µ–Ω—å—à–µ W, —Å–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç **–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–º–µ–Ω—ã** (hint handoff)
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —É–∑–ª—ã —Å –ø–æ–º–µ—Ç–∫–æ–π "—ç—Ç–æ –¥–ª—è —É–∑–ª–∞ X"
- –ö–æ–≥–¥–∞ —É–∑–µ–ª X –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è, –≤—Ä–µ–º–µ–Ω–Ω—ã–π —É–∑–µ–ª –ø–µ—Ä–µ–¥–∞—Å—Ç –¥–∞–Ω–Ω—ã–µ (hinted handoff)

**–ü—Ä–∏–º–µ—Ä:**
```
N=3 (A, B, C), W=2
–£–∑–µ–ª B –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

Sloppy Quorum:
  Client ‚Üí A, D (–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–º–µ–Ω–∞ B), C
  D —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è B + hint

–ö–æ–≥–¥–∞ B –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è:
  D ‚Üí B: –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö
```

**Trade-off:**
- **+** –ü–æ–≤—ã—à–∞–µ—Ç availability (–∑–∞–ø–∏—Å—å –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–º–æ–∂–Ω–∞)
- **-** –ù–∞—Ä—É—à–∞–µ—Ç —Å—Ç—Ä–æ–≥—É—é —Å–µ–º–∞–Ω—Ç–∏–∫—É R+W>N (–ø–æ–∫–∞ handoff –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω)

### Anti-Entropy –ø—Ä–æ—Ü–µ—Å—Å—ã

–î–∞–∂–µ –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö R, W, N –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è:
- –£–∑–µ–ª –≤—Ä–µ–º–µ–Ω–Ω–æ –±—ã–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- Sloppy quorum
- Hinted handoff –µ—â—ë –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω

**Anti-entropy –º–µ—Ö–∞–Ω–∏–∑–º—ã:**

**1. Read Repair:**
- –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ Coordinator –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏–º —É–∑–ª–∞–º

**2. Merkle Trees / Hashing:**
- –£–∑–ª—ã –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è —Ö–µ—à–∞–º–∏ —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –û–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç —Ä–∞–∑–ª–∏—á–∏—è
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç —Ç–æ–ª—å–∫–æ —Ä–∞–∑–ª–∏—á–∞—é—â–∏–µ—Å—è —á–∞—Å—Ç–∏

**3. Active Anti-Entropy:**
- –§–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —É–∑–ª—ã
- Cassandra: `nodetool repair`
- Riak: active anti-entropy (AAE)

---

## –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

–ö–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–∑–ª–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω—è—é—Ç –¥–∞–Ω–Ω—ã–µ (Multi-Leader, Leaderless), –≤–æ–∑–Ω–∏–∫–∞—é—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã. –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –∏—Ö —Ä–∞–∑—Ä–µ—à–∏—Ç—å.

---

## Conflict Resolution Semantics ‚Äî –°–µ–º–∞–Ω—Ç–∏–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

### 1. Last-Write-Wins (LWW)

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ü–æ–±–µ–∂–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å —Å —Å–∞–º—ã–º –ø–æ–∑–¥–Ω–∏–º timestamp.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```
Write A: X=10, timestamp=1000
Write B: X=20, timestamp=1005

–ö–æ–Ω—Ñ–ª–∏–∫—Ç ‚Üí –í—ã–±–∏—Ä–∞–µ–º timestamp 1005 ‚Üí X=20
```

**–ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞
‚úÖ –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å (–≤—Å–µ —É–∑–ª—ã –ø—Ä–∏–¥—É—Ç –∫ –æ–¥–Ω–æ–º—É –æ—Ç–≤–µ—Ç—É)
‚úÖ Convergence (—Å–∏—Å—Ç–µ–º–∞ —Å–æ–π–¥—ë—Ç—Å—è –∫ –æ–¥–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é)

**–ß–µ–≥–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
‚ùå –ú–æ–∂–µ—Ç –ø–æ—Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ (Write A –ø—Ä–æ—Å—Ç–æ –∏—Å—á–µ–∑–∞–µ—Ç)
‚ùå –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —á–∞—Å–æ–≤ —Å–∏—Å—Ç–µ–º—ã (clock skew –ø—Ä–æ–±–ª–µ–º–∞)
‚ùå –ù–∞—Ä—É—à–∞–µ—Ç causality (–∑–∞–ø–∏—Å—å A –º–æ–≥–ª–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –î–û B –ø–æ —Ä–µ–∞–ª—å–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏)

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- Cassandra (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- DynamoDB
- Riak (–æ–ø—Ü–∏—è)
- –°–∏—Å—Ç–µ–º—ã, –≥–¥–µ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ = –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, sensor readings)

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã (shopping cart):**
```
User –¥–æ–±–∞–≤–ª—è–µ—Ç iPhone ‚Üí cart=[iPhone] (ts:1000)
User –¥–æ–±–∞–≤–ª—è–µ—Ç MacBook ‚Üí cart=[iPhone, MacBook] (ts:1001)

–ù–æ –∏–∑-–∑–∞ clock skew:
  ts:1001 –∑–∞–ø–∏—Å–∞–ª–æ—Å—å —Ä–∞–Ω—å—à–µ, —á–µ–º ts:1000 –¥–æ—à–ª–æ

LWW –≤—ã–±–µ—Ä–µ—Ç ts:1001 ‚Üí cart=[iPhone, MacBook]
  –∑–∞—Ç–µ–º –ø—Ä–∏–¥—ë—Ç ts:1000 ‚Üí –Ω–æ –æ–Ω —Å—Ç–∞—Ä—à–µ ‚Üí –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º

–ù–û –°–¢–û–ü! ts:1000 –±—ã–ª–æ –ü–û–ó–ñ–ï –ø–æ —Ä–µ–∞–ª—å–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏!
–†–µ–∑—É–ª—å—Ç–∞—Ç: MacBook –∏—Å—á–µ–∑ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã üò±
```

---

### 2. Multi-Value (Sibling Values)

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ï—Å–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –í–°–ï –≤–µ—Ä—Å–∏–∏. –ü—É—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑—Ä–µ—à–∏—Ç.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```
Write A: X=10 [versionA]
Write B: X=20 [versionB]

–ö–æ–Ω—Ñ–ª–∏–∫—Ç ‚Üí –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–∞:
  X = {10 [versionA], 20 [versionB]} ‚Üê Siblings
```

**–ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
‚úÖ –ù–∏–∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è
‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω–∏—Ç—å domain logic –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è

**–ß–µ–≥–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞
‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –î–û–õ–ñ–ù–û —É–º–µ—Ç—å —Ä–∞–∑—Ä–µ—à–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- Riak (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ CRDTs
- –í–µ—Ä—Å–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ CouchDB

**–ü—Ä–∏–º–µ—Ä (shopping cart):**
```
User –≤ US: –¥–æ–±–∞–≤–ª—è–µ—Ç iPhone ‚Üí cart=[iPhone]
User –≤ EU: –¥–æ–±–∞–≤–ª—è–µ—Ç MacBook ‚Üí cart=[MacBook]

–ö–æ–Ω—Ñ–ª–∏–∫—Ç ‚Üí Siblings:
  cart = {[iPhone], [MacBook]}

Application logic:
  Merge: cart = [iPhone, MacBook] ‚úÖ

–ù–∏–∫–∞–∫–æ–π —Ç–æ–≤–∞—Ä –Ω–µ –ø–æ—Ç–µ—Ä—è–Ω!
```

---

### 3. CRDTs (Conflict-free Replicated Data Types)

**–ü—Ä–∏–Ω—Ü–∏–ø:** –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç, —á—Ç–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

**–¢–∏–ø—ã CRDTs:**

**3.1. G-Counter (Grow-only Counter):**
```
–£–∑–µ–ª A: counter_A = 5
–£–∑–µ–ª B: counter_B = 3

Merge: counter = counter_A + counter_B = 8 ‚úÖ

–ú–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, merge = SUM
```

**3.2. PN-Counter (Positive-Negative Counter):**
```
–î–≤–∞ G-Counters: increments –∏ decrements

–£–∑–µ–ª A: increments=10, decrements=3 ‚Üí value=7
–£–∑–µ–ª B: increments=5, decrements=1 ‚Üí value=4

Merge:
  increments = 10+5 = 15
  decrements = 3+1 = 4
  value = 15-4 = 11 ‚úÖ
```

**3.3. G-Set (Grow-only Set):**
```
–£–∑–µ–ª A: set = {apple, banana}
–£–∑–µ–ª B: set = {banana, cherry}

Merge: set = {apple, banana, cherry} ‚úÖ (union)

–ú–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã
```

**3.4. OR-Set (Observed-Remove Set):**
```
–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∏ —É–¥–∞–ª—è—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã

–£–∑–µ–ª A: add("apple") ‚Üí {apple [tag:A1]}
–£–∑–µ–ª B: add("apple") ‚Üí {apple [tag:B1]}
–£–∑–µ–ª A: remove("apple" [tag:A1]) ‚Üí {}

Merge:
  {apple [tag:B1]} ‚úÖ (B1 –Ω–µ –±—ã–ª —É–¥–∞–ª—ë–Ω)

–≠–ª–µ–º–µ–Ω—Ç –æ—Å—Ç–∞—ë—Ç—Å—è, –µ—Å–ª–∏ —Ö–æ—Ç—å –æ–¥–Ω–∞ –≤–µ—Ä—Å–∏—è –Ω–µ —É–¥–∞–ª–µ–Ω–∞
```

**3.5. LWW-Register:**
```
–ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å —Å timestamp

value=10, ts=1000
value=20, ts=1005

Merge: –≤—ã–±–∏—Ä–∞–µ–º max timestamp ‚Üí value=20
```

**–ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
‚úÖ Strong eventual consistency (–≤—Å–µ —É–∑–ª—ã —Å–æ–π–¥—É—Ç—Å—è –∫ –æ–¥–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é)
‚úÖ Commutative, Associative, Idempotent –æ–ø–µ—Ä–∞—Ü–∏–∏

**–ß–µ–≥–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
‚ùå –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å (–Ω–µ –≤—Å–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏–º–µ—é—Ç CRDT-–≤–µ—Ä—Å–∏—é)
‚ùå –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–æ–∂–Ω–µ–µ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
‚ùå –ú–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏ (—Ö—Ä–∞–Ω–µ–Ω–∏–µ metadata)

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- Redis Enterprise (CRDT-based geo-replication)
- Riak Data Types
- Akka Distributed Data
- Apple CloudKit
- Automerge (collaborative editing library)

**–ü—Ä–∏–º–µ—Ä (collaborative counter ‚Äî —Å–∏—Å—Ç–µ–º–∞ –ª–∞–π–∫–æ–≤):**
```
–ë–µ–∑ CRDT (LWW):
  US: likes=100 ‚Üí increment ‚Üí likes=101
  EU: likes=100 ‚Üí increment ‚Üí likes=101
  Merge LWW: 101 ‚ùå (–ø–æ—Ç–µ—Ä—è–ª–∏ –æ–¥–∏–Ω –ª–∞–π–∫)

–° PN-Counter CRDT:
  US: increments[US]=1
  EU: increments[EU]=1
  Merge: total = base:100 + sum(increments)=2 = 102 ‚úÖ
```

---

### 4. Application-Level Conflict Resolution

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–∞–º–æ —Ä–µ—à–∞–µ—Ç, –∫–∞–∫ –º–µ—Ä–∂–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–µ –≤–µ—Ä—Å–∏–∏.

**–ü—Ä–∏–º–µ—Ä—ã:**

**4.1. Shopping Cart (add-wins semantics):**
```
Version A: cart=[iPhone]
Version B: cart=[MacBook]

Application: –æ–±—ä–µ–¥–∏–Ω—è–µ–º —Ç–æ–≤–∞—Ä—ã
Merge: cart=[iPhone, MacBook]

–õ–æ–≥–∏–∫–∞: –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω, –æ–Ω –Ω–µ –¥–æ–ª–∂–µ–Ω —Ç–µ—Ä—è—Ç—å—Å—è
```

**4.2. Collaborative Document Editing:**
```
Version A: "Hello World" ‚Üí "Hello Beautiful World"
Version B: "Hello World" ‚Üí "Hi World"

Operational Transform:
  –û–ø–µ—Ä–∞—Ü–∏—è A: insert "Beautiful" at position 6
  –û–ø–µ—Ä–∞—Ü–∏—è B: replace "Hello" with "Hi"

  Merge: "Hi Beautiful World" ‚úÖ
```

**4.3. Calendar (keep both events):**
```
Version A: meeting at 10:00 with Alice
Version B: meeting at 10:00 with Bob

Merge: –æ–±–∞ —Å–æ–±—ã—Ç–∏—è, –ø–æ–º–µ—Ç–∫–∞ "Conflict: overlapping meetings"
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–µ—Ä–µ—Ç, –∫–∞–∫–æ–π –æ—Å—Ç–∞–≤–∏—Ç—å
```

**–ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–∏–±–∫–æ—Å—Ç—å
‚úÖ Domain-specific logic

**–ß–µ–≥–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚ùå –ù—É–∂–Ω–æ —Ö–æ—Ä–æ—à–æ –ø–æ–Ω–∏–º–∞—Ç—å domain

---

### 5. Versioning –∏ Causal Consistency

**Vector Clocks:**

–û—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç –ø—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Å–æ–±—ã—Ç–∏—è–º–∏.

**–ü—Ä–∏–º–µ—Ä:**
```
–£–∑–µ–ª A: [A:1, B:0, C:0] ‚Üí X=10
–£–∑–µ–ª B: [A:1, B:1, C:0] ‚Üí X=20 (–∑–Ω–∞–µ—Ç –æ –∑–∞–ø–∏—Å–∏ A)
–£–∑–µ–ª C: [A:1, B:0, C:1] ‚Üí X=30 (–∑–Ω–∞–µ—Ç –æ –∑–∞–ø–∏—Å–∏ A, –Ω–µ –∑–Ω–∞–µ—Ç –æ B)

B ‚Üí C: X=20 [A:1, B:1, C:0]
C ‚Üí B: X=30 [A:1, B:0, C:1]

–°—Ä–∞–≤–Ω–µ–Ω–∏–µ:
  [A:1, B:1, C:0] –∏ [A:1, B:0, C:1]
  –ù–µ—Å—Ä–∞–≤–Ω–∏–º—ã! ‚Üí Concurrent writes ‚Üí –ö–æ–Ω—Ñ–ª–∏–∫—Ç

Merge:
  –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è: [A:1, B:1, C:1]
  –ù—É–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å: 20 –∏–ª–∏ 30?
```

**Causally consistent:**
- –ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è B –≤–∏–¥–µ–ª–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ A, —Ç–æ –≤–µ—Ä—Å–∏—è B "–±–æ–ª—å—à–µ"
- –ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ –≤–∏–¥–µ–ª–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞, –æ–Ω–∏ concurrent ‚Üí –∫–æ–Ω—Ñ–ª–∏–∫—Ç

---

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Primary-Backup | Multi-Leader | Leaderless | Synchronous | Async | Semi-Sync |
|---|---|---|---|---|---|---|
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å** | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω—è—è | –ù–∏–∑–∫–∞—è | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω—è—è |
| **Write Latency** | –°—Ä–µ–¥–Ω—è—è | –ù–∏–∑–∫–∞—è (local) | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω—è—è |
| **Read Latency** | –ù–∏–∑–∫–∞—è | –ù–∏–∑–∫–∞—è (local) | –°—Ä–µ–¥–Ω—è—è (R —É–∑–ª–æ–≤) | –ù–∏–∑–∫–∞—è | –ù–∏–∑–∫–∞—è | –ù–∏–∑–∫–∞—è |
| **Write Availability** | –ù–∏–∑–∫–∞—è (SPOF) | –í—ã—Å–æ–∫–∞—è | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω—è—è |
| **Consistency** | –°–∏–ª—å–Ω–∞—è (–Ω–∞ Primary) | Eventual | Eventual (R+W>N) | –°–∏–ª—å–Ω–∞—è | –°–ª–∞–±–∞—è | –°—Ä–µ–¥–Ω—è—è |
| **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã** | –ù–µ—Ç (–æ–¥–∏–Ω Primary) | –î–∞ (–Ω—É–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–∞—Ç—å) | –î–∞ (–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ) | –ù–µ—Ç | –ù–µ—Ç (–Ω–æ lag) | –ù–µ—Ç (–Ω–æ lag) |
| **Failover** | –°–ª–æ–∂–Ω—ã–π | –ü—Ä–æ—Å—Ç–æ–π | –ü—Ä–æ—Å—Ç–æ–π | –°–ª–æ–∂–Ω—ã–π | –ü—Ä–æ—Å—Ç–æ–π | –°—Ä–µ–¥–Ω–∏–π |
| **Data Loss —Ä–∏—Å–∫** | –ù–∏–∑–∫–∏–π (sync) / –°—Ä–µ–¥–Ω–∏–π (async) | –ù–∏–∑–∫–∏–π (distributed) | –ù–∏–∑–∫–∏–π (quorum) | –û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π | –°—Ä–µ–¥–Ω–∏–π | –ù–∏–∑–∫–∏–π |
| **Geo-Distribution** | –ü–ª–æ—Ö–æ (high latency) | –û—Ç–ª–∏—á–Ω–æ | –•–æ—Ä–æ—à–æ | –ü–ª–æ—Ö–æ | –•–æ—Ä–æ—à–æ | –°—Ä–µ–¥–Ω–µ |
| **–ü—Ä–∏–º–µ—Ä—ã** | Postgres, MySQL, Mongo | CouchDB, Postgres BDR | Cassandra, Dynamo, Riak | etcd, Zookeeper | Redis (default), Postgres (default) | MySQL semi-sync, Mongo w:2 |

---

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –í—ã–±–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

**–ò—Å–ø–æ–ª—å–∑—É–π Primary-Backup –µ—Å–ª–∏:**
- –°–∏—Å—Ç–µ–º–∞ –≤ –æ–¥–Ω–æ–º –¥–∞—Ç–∞—Ü–µ–Ω—Ç—Ä–µ
- Read-heavy –Ω–∞–≥—Ä—É–∑–∫–∞ (–º–∞–ª–æ –∑–∞–ø–∏—Å–µ–π)
- –ù—É–∂–Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç–∞
- Eventual consistency –ø—Ä–∏–µ–º–ª–µ–º–∞ (–¥–ª—è reads —Å backups)

**–ò—Å–ø–æ–ª—å–∑—É–π Multi-Leader –µ—Å–ª–∏:**
- Geo-distributed —Å–∏—Å—Ç–µ–º–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö
- –ö–∞–∂–¥—ã–π —Ä–µ–≥–∏–æ–Ω –¥–æ–ª–∂–µ–Ω –ø–∏—Å–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ (low latency)
- –ì–æ—Ç–æ–≤ –∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- Offline-first –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ò—Å–ø–æ–ª—å–∑—É–π Leaderless –µ—Å–ª–∏:**
- –ù—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è availability
- –ì–æ—Ç–æ–≤ –∫ eventual consistency
- –ú–æ–∂–µ—à—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å R, W, N –ø–æ–¥ –∑–∞–¥–∞—á–∏
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ä–µ–¥–∫–∏ –∏–ª–∏ –ª–µ–≥–∫–æ —Ä–∞–∑—Ä–µ—à–∏–º—ã

### 2. –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ò—Å–ø–æ–ª—å–∑—É–π Synchronous –µ—Å–ª–∏:**
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–¥–µ–Ω—å–≥–∏, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
- –ê–±—Å–æ–ª—é—Ç–Ω–∞—è durability –∫—Ä–∏—Ç–∏—á–Ω–∞
- Latency –ø—Ä–∏–µ–º–ª–µ–º–∞ (–º–æ–∂–µ—à—å –∂–∏—Ç—å —Å 50-200ms)
- –£–∑–ª—ã –≤ –æ–¥–Ω–æ–º —Ä–µ–≥–∏–æ–Ω–µ (low latency –º–µ–∂–¥—É –Ω–∏–º–∏)

**–ò—Å–ø–æ–ª—å–∑—É–π Asynchronous –µ—Å–ª–∏:**
- –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ web-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- Latency –∫—Ä–∏—Ç–∏—á–Ω–∞
- –ú–æ–∂–µ—à—å –ø—Ä–∏–Ω—è—Ç—å –Ω–µ–±–æ–ª—å—à–æ–π —Ä–∏—Å–∫ data loss
- Monitoring replication lag –Ω–∞—Å—Ç—Ä–æ–µ–Ω

**–ò—Å–ø–æ–ª—å–∑—É–π Semi-Synchronous –µ—Å–ª–∏:**
- –ù—É–∂–µ–Ω –±–∞–ª–∞–Ω—Å (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ production —Å–∏—Å—Ç–µ–º)
- Durability –≤–∞–∂–Ω–∞, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞
- Latency –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–∞–∑—É–º–Ω–æ–π
- E-commerce, SaaS

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–≤–æ—Ä—É–º–æ–≤ (–¥–ª—è Leaderless)

**–î–ª—è strong consistency:**
```
R + W > N
–ù–∞–ø—Ä–∏–º–µ—Ä: N=3, R=2, W=2
```

**–î–ª—è read-heavy –Ω–∞–≥—Ä—É–∑–∫–∏:**
```
W=N, R=1 (–≤—Å–µ —É–∑–ª—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç –∑–∞–ø–∏—Å—å, –±—ã—Å—Ç—Ä–æ–µ —á—Ç–µ–Ω–∏–µ)
–ù–∞–ø—Ä–∏–º–µ—Ä: N=3, W=3, R=1
```

**–î–ª—è write-heavy –Ω–∞–≥—Ä—É–∑–∫–∏:**
```
W=1, R=N (–±—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å, —á–∏—Ç–∞—Ç—å —Å–æ –≤—Å–µ—Ö)
–ù–æ: —Ä–∏—Å–∫ data loss –µ—Å–ª–∏ —É–∑–µ–ª —É–ø–∞–¥—ë—Ç –ø–æ—Å–ª–µ W=1
```

**–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π availability:**
```
W=1, R=1 (eventual consistency)
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```

### 4. –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

**–ò—Å–ø–æ–ª—å–∑—É–π LWW –µ—Å–ª–∏:**
- –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ = –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ (sensor data, cache)
- –î–∞–Ω–Ω—ã–µ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ –≤–∞–∂–Ω–µ–µ accuracy

**–ò—Å–ø–æ–ª—å–∑—É–π Multi-Value + Application Logic –µ—Å–ª–∏:**
- –ù—É–∂–Ω–∞ domain-specific –ª–æ–≥–∏–∫–∞
- –ì–æ—Ç–æ–≤ –∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (shopping cart)

**–ò—Å–ø–æ–ª—å–∑—É–π CRDTs –µ—Å–ª–∏:**
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç CRDT (counter, set, map)
- –ù—É–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä–≥–µ–Ω—Ü–∏—è
- Collaborative editing, distributed counters

### 5. Monitoring

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
- **Replication Lag:** –ù–∞—Å–∫–æ–ª—å–∫–æ backups –æ—Ç—Å—Ç–∞—é—Ç –æ—Ç primary
- **Failed Replications:** –ß–∏—Å–ª–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
- **Quorum Failures:** –ß–∏—Å–ª–æ –∑–∞–ø—Ä–æ—Å–æ–≤, –Ω–µ –¥–æ—Å—Ç–∏–≥—à–∏—Ö –∫–≤–æ—Ä—É–º–∞
- **Conflict Rate:** –ß–∞—Å—Ç–æ—Ç–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (–¥–ª—è Multi-Leader/Leaderless)
- **Divergence:** –ù–∞—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –Ω–∞ —É–∑–ª–∞—Ö

**–ê–ª–µ—Ä—Ç—ã:**
- Replication lag > 1s (warning), > 10s (critical)
- Quorum failures > 1% requests
- Node down > 5 –º–∏–Ω—É—Ç

### 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**Chaos Engineering:**
- –£–±–∏–≤–∞–π —Å–ª—É—á–∞–π–Ω—ã–µ —É–∑–ª—ã (simulate failures)
- –í–Ω–æ—Å–∏ —Å–µ—Ç–µ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ (network partition testing)
- –°–∏–º—É–ª–∏—Ä—É–π clock skew (–¥–ª—è LWW —Å–∏—Å—Ç–µ–º)
- –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (concurrency testing)

**–°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- Failover: –£–±–∏—Ç—å primary, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ç–µ—Ä—é –¥–∞–Ω–Ω—ã—Ö
- Split-brain: –†–∞–∑–¥–µ–ª–∏—Ç—å —Å–µ—Ç—å, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ
- Replication lag: –ó–∞–º–µ–¥–ª–∏—Ç—å —Å–µ—Ç—å, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å stale reads
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã: –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –≤ —Ä–∞–∑–Ω—ã–µ –ª–∏–¥–µ—Ä—ã

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Replication ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ "—Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä". –≠—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º trade-offs:

- **Consistency vs Availability vs Latency**
- **Durability vs Performance**
- **Simplicity vs Fault Tolerance**

–ù–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç "–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π" –º–æ–¥–µ–ª–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤. –í—ã–±–æ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç:
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ consistency
- –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- –¢–∏–ø–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ (read-heavy vs write-heavy)
- –¢–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –∫ data loss
- –°–ª–æ–∂–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—É—é –∫–æ–º–∞–Ω–¥–∞ –º–æ–∂–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

**–ì–ª–∞–≤–Ω—ã–π —Å–æ–≤–µ—Ç:** –ù–∞—á–Ω–∏ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ (Primary-Backup async), –º–æ–Ω–∏—Ç–æ—Ä—å, —Ç–µ—Å—Ç–∏—Ä—É–π, –∏ —É—Å–ª–æ–∂–Ω—è–π —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –ø–æ—è–≤—è—Ç—Å—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã. Premature optimization –≤ distributed systems ‚Äî –≤–µ—Ä–Ω—ã–π –ø—É—Ç—å –∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –±–µ–∑ –≤—ã–≥–æ–¥—ã.

–ò –ø–æ–º–Ω–∏: **–†–µ–ø–ª–∏–∫–∞—Ü–∏—è –Ω–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫** (—Å–ª—É—á–∞–π–Ω—ã–π DELETE FROM users –≥–¥–µ-—Ç–æ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç—Å—è —Ç–æ–∂–µ üòÖ). –ù—É–∂–Ω—ã backups!
