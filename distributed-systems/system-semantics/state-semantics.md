# State Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∏ –°–æ—Å—Ç–æ—è–Ω–∏—è)

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [Stateless Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –ë–µ–∑ –°–æ—Å—Ç–æ—è–Ω–∏—è)](#1-stateless-semantics-—Å–µ–º–∞–Ω—Ç–∏–∫–∞-–±–µ–∑-—Å–æ—Å—Ç–æ—è–Ω–∏—è)
3. [Stateful Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –° –°–æ—Å—Ç–æ—è–Ω–∏–µ–º)](#2-stateful-semantics-—Å–µ–º–∞–Ω—Ç–∏–∫–∞-—Å-—Å–æ—Å—Ç–æ—è–Ω–∏–µ–º)
4. [Ephemeral State (–≠—Ñ–µ–º–µ—Ä–Ω–æ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ)](#3-ephemeral-state-—ç—Ñ–µ–º–µ—Ä–Ω–æ–µ-—Å–æ—Å—Ç–æ—è–Ω–∏–µ)
5. [Durable State (–î–æ–ª–≥–æ–≤–µ—á–Ω–æ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ)](#4-durable-state-–¥–æ–ª–≥–æ–≤–µ—á–Ω–æ–µ-—Å–æ—Å—Ç–æ—è–Ω–∏–µ)
6. [Checkpoint Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö –¢–æ—á–µ–∫)](#5-checkpoint-semantics-—Å–µ–º–∞–Ω—Ç–∏–∫–∞-–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö-—Ç–æ—á–µ–∫)
7. [Snapshot Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –°–Ω–∏–º–∫–æ–≤)](#6-snapshot-semantics-—Å–µ–º–∞–Ω—Ç–∏–∫–∞-—Å–Ω–∏–º–∫–æ–≤)
8. [State Recovery Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –°–æ—Å—Ç–æ—è–Ω–∏—è)](#7-state-recovery-semantics-—Å–µ–º–∞–Ω—Ç–∏–∫–∞-–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è-—Å–æ—Å—Ç–æ—è–Ω–∏—è)
9. [–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞](#—Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è-—Ç–∞–±–ª–∏—Ü–∞)
10. [–ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å–µ–º–∞–Ω—Ç–∏–∫](#–∫–æ–º–±–∏–Ω–∞—Ü–∏–∏-—Å–µ–º–∞–Ω—Ç–∏–∫)
11. [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)
12. [–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∫–∞–∫ –∏—Ö –∏–∑–±–µ–∂–∞—Ç—å](#—Ç–∏–ø–∏—á–Ω—ã–µ-–æ—à–∏–±–∫–∏-–∏-–∫–∞–∫-–∏—Ö-–∏–∑–±–µ–∂–∞—Ç—å)
13. [–ó–∞–∫–ª—é—á–µ–Ω–∏–µ](#–∑–∞–∫–ª—é—á–µ–Ω–∏–µ)

---

## –í–≤–µ–¥–µ–Ω–∏–µ

**State Semantics** (—Å–µ–º–∞–Ω—Ç–∏–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è) –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç, –ö–ê–ö –∏ –ì–î–ï —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–≤–æ—ë–º —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏, –∫–∞–∫ —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç —Å–±–æ–∏, –∏ –∫–∞–∫–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏.

–ü—Ä–µ–¥—Å—Ç–∞–≤—å –∫–æ—Ñ–µ–π–Ω—é:
- **Stateless (–±–µ–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è)**: –∫–∞–∂–¥—ã–π –±–∞—Ä–∏—Å—Ç–∞ –Ω–µ –ø–æ–º–Ω–∏—Ç —Ç–≤–æ–π –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∑–∞–∫–∞–∑, —Ç—ã –∫–∞–∂–¥—ã–π —Ä–∞–∑ –≥–æ–≤–æ—Ä–∏—à—å –∑–∞–Ω–æ–≤–æ
- **Stateful (—Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º)**: –±–∞—Ä–∏—Å—Ç–∞ –ø–æ–º–Ω–∏—Ç "—Ç–≤–æ–π –æ–±—ã—á–Ω—ã–π –∑–∞–∫–∞–∑" –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **Ephemeral state (—ç—Ñ–µ–º–µ—Ä–Ω–æ–µ)**: –±–∞—Ä–∏—Å—Ç–∞ –ø–æ–º–Ω–∏—Ç –∑–∞–∫–∞–∑—ã —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞ –Ω–∞ —Å–º–µ–Ω–µ, –ø–æ—Ç–æ–º –∑–∞–±—ã–≤–∞–µ—Ç
- **Durable state (–¥–æ–ª–≥–æ–≤–µ—á–Ω–æ–µ)**: –≤—Å–µ –∑–∞–∫–∞–∑—ã –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –∂—É—Ä–Ω–∞–ª, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç—Å—è –≥–æ–¥–∞–º–∏
- **Checkpoint (–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ç–æ—á–∫–∞)**: –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç –±–∞—Ä–∏—Å—Ç–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –æ—á–µ—Ä–µ–¥—å –∑–∞–∫–∞–∑–æ–≤
- **Snapshot (—Å–Ω–∏–º–æ–∫)**: –≤ –∫–æ–Ω—Ü–µ –¥–Ω—è –¥–µ–ª–∞–µ—Ç—Å—è —Ñ–æ—Ç–æ –≤—Å–µ—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- **State recovery (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ)**: –Ω–æ–≤—ã–π –±–∞—Ä–∏—Å—Ç–∞ —á–∏—Ç–∞–µ—Ç –∂—É—Ä–Ω–∞–ª –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å –∑–∞–∫–∞–∑–æ–≤

–í —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º ‚Äî —ç—Ç–æ –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö —Å–ª–æ–∂–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä —Å–µ–º–∞–Ω—Ç–∏–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–≤–æ–¥–∏—Ç –∫:
- üíÄ –ü–æ—Ç–µ—Ä–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–ª–∞—Ç–µ–∂–∏, –∑–∞–∫–∞–∑—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–µ—Å—Å–∏–∏)
- üî• –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å–±–æ–µ–≤
- üêå –î–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (—Ç—è–∂—ë–ª–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º —É–∑–ª–µ)
- üí∏ –ò–∑–±—ã—Ç–æ—á–Ω—ã–º –∑–∞—Ç—Ä–∞—Ç–∞–º –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (snapshot –≤—Å–µ–π –±–∞–∑—ã –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)
- üêõ –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö (—á–∞—Å—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Ç–µ—Ä—è–Ω–∞, —á–∞—Å—Ç—å –æ—Å—Ç–∞–ª–∞—Å—å)
- üé≠ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è (—Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫ —É–∑–ª–∞–º)

---

## 1. Stateless Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –ë–µ–∑ –°–æ—Å—Ç–æ—è–Ω–∏—è)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Stateless Semantics** ‚Äî —ç—Ç–æ –º–æ–¥–µ–ª—å —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è **–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ**, –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö. –°–∏—Å—Ç–µ–º–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏ –∏ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π.

```
–ó–∞–ø—Ä–æ—Å #1              –ó–∞–ø—Ä–æ—Å #2              –ó–∞–ø—Ä–æ—Å #3
   |                      |                      |
   v                      v                      v
[–°–µ—Ä–≤–µ—Ä]              [–°–µ—Ä–≤–µ—Ä]              [–°–µ—Ä–≤–µ—Ä]
(–Ω–∏—á–µ–≥–æ –Ω–µ            (–Ω–∏—á–µ–≥–æ –Ω–µ            (–Ω–∏—á–µ–≥–æ –Ω–µ
 –ø–æ–º–Ω–∏—Ç –ø—Ä–æ #1)        –ø–æ–º–Ω–∏—Ç –ø—Ä–æ #1,#2)     –ø–æ–º–Ω–∏—Ç –ø—Ä–æ #1,#2,#3)
```

–ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —Å–æ–¥–µ—Ä–∂–∏—Ç **–í–°–Æ** –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏.

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ò–¥–µ–∞–ª—å–Ω–∞—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ª—é–±–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ª—é–±–æ–π –∑–∞–ø—Ä–æ—Å
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è**: —É–ø–∞–ª —Å–µ—Ä–≤–µ—Ä ‚Äî –∑–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π, –Ω–∏–∫–∞–∫–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è
- **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ session affinity**: –Ω–µ –Ω—É–∂–Ω–æ "–ø—Ä–∏–ª–µ–ø–ª—è—Ç—å" –∫–ª–∏–µ–Ω—Ç–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É
- **–ò–∑–æ–ª—è—Ü–∏—è —Å–±–æ–µ–≤**: –ø–∞–¥–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**: –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**: –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∑–∞–ø—Ä–æ—Å –≤—Å–µ–≥–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ —Ö—Ä–∞–Ω–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç**: –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –Ω–µ—Å—Ç–∏ –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- **–ù–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∑–∞–ø—Ä–æ—Å—ã**: –Ω–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞
- **–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏**: –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã —Ç—Ä–µ–±—É—é—Ç –≤–Ω–µ—à–Ω–µ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- **–ù–µ —ç–∫–æ–Ω–æ–º–∏—Ç —Ç—Ä–∞—Ñ–∏–∫**: –≤—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**Nginx –∫–∞–∫ reverse proxy**

Nginx –≤ —Ä–µ–∂–∏–º–µ reverse proxy ‚Äî –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π stateless —Å–µ—Ä–≤–∏—Å. –ö–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç HTTP-–∑–∞–ø—Ä–æ—Å:
- Nginx –Ω–µ –ø–æ–º–Ω–∏—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç —ç—Ç–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ (–ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É round-robin, least-connections –∏ —Ç.–¥.)
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å/—É–±—Ä–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä Nginx –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
- –£–ø–∞–ª –æ–¥–∏–Ω Nginx ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—à—å —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –¥—Ä—É–≥–æ–π

–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:
```
–ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 3 –∑–∞–ø—Ä–æ—Å–∞ ‚Üí Load Balancer

–ó–∞–ø—Ä–æ—Å #1 ‚Üí Nginx-1 ‚Üí Backend-A
–ó–∞–ø—Ä–æ—Å #2 ‚Üí Nginx-2 ‚Üí Backend-B  (Nginx-2 –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ –ó–∞–ø—Ä–æ—Å #1)
–ó–∞–ø—Ä–æ—Å #3 ‚Üí Nginx-1 ‚Üí Backend-C  (Nginx-1 –Ω–µ –ø–æ–º–Ω–∏—Ç –ó–∞–ø—Ä–æ—Å #1)
```

**Kafka –∫–∞–∫ –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π (—Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –ø—Ä–æ–¥—é—Å–µ—Ä–∞)**

–ö–æ–≥–¥–∞ –ø—Ä–æ–¥—é—Å–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Kafka:
- –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (—Ç–æ–ø–∏–∫, –∫–ª—é—á, –¥–∞–Ω–Ω—ã–µ)
- Kafka-–±—Ä–æ–∫–µ—Ä –Ω–µ –ø–æ–º–Ω–∏—Ç "–ø—Ä–µ–¥—ã–¥—É—â–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è" –ø—Ä–æ–¥—é—Å–µ—Ä–∞
- –ú–æ–∂–Ω–æ —Ä–µ—Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –ø—Ä–æ–¥—é—Å–µ—Ä ‚Äî Kafka –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –±—Ä–æ–∫–µ—Ä ‚Äî –æ–Ω —Å—Ä–∞–∑—É –≥–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è

**REST API –±–µ–∑ —Å–µ—Å—Å–∏–π**

–¢–∏–ø–∏—á–Ω—ã–π REST API, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç JWT-—Ç–æ–∫–µ–Ω –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ:
```
GET /api/users/123
Authorization: Bearer eyJhbGc...

POST /api/orders
Authorization: Bearer eyJhbGc...
Content: {"item": "laptop", "quantity": 1}
```

–°–µ—Ä–≤–µ—Ä:
- –ù–µ —Ö—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º, —á—Ç–æ —ç—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "–∑–∞–ª–æ–≥–∏–Ω–µ–Ω"
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω (—Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–∫–µ–Ω —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞)
- –ú–æ–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å API-—Å–µ—Ä–≤–µ—Ä–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º
- –£–ø–∞–ª —Å–µ—Ä–≤–µ—Ä ‚Äî –∫–ª–∏–µ–Ω—Ç –ø—Ä–æ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –¥—Ä—É–≥–æ–º—É —Å–µ—Ä–≤–µ—Ä—É

### üî• –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç: "–ü–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–∫—É–ø–æ–∫"**

–ö–æ–º–ø–∞–Ω–∏—è –∑–∞–ø—É—Å—Ç–∏–ª–∞ e-commerce —Å–∞–π—Ç –Ω–∞ stateless API. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
- Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ API
- API –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã stateless
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —Å–æ–¥–µ—Ä–∂–∏—Ç JWT-—Ç–æ–∫–µ–Ω

–ü—Ä–æ–±–ª–µ–º–∞ –≤–æ–∑–Ω–∏–∫–ª–∞, –∫–æ–≥–¥–∞ –ø—ã—Ç–∞–ª–∏—Å—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ—Ä–∑–∏–Ω—É –ø–æ–∫—É–ø–æ–∫:
```
1. –ö–ª–∏–µ–Ω—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä A ‚Üí POST /cart {"item": "A"}
   API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: {"cart": ["A"]}

2. –ö–ª–∏–µ–Ω—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä B ‚Üí POST /cart {"item": "B"}
   API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: {"cart": ["B"]}  ‚Üê –ì–¥–µ —Ç–æ–≤–∞—Ä A?
```

–û—à–∏–±–∫–∞: —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ–∂–∏–¥–∞–ª–∏, —á—Ç–æ stateless API "–ø–æ–º–Ω–∏—Ç" –∫–æ—Ä–∑–∏–Ω—É. –ù–æ stateless –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ:
- –ó–∞–ø—Ä–æ—Å #2 –Ω–µ –∑–Ω–∞–µ—Ç –æ –∑–∞–ø—Ä–æ—Å–µ #1
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –í–°–Æ —Ç–µ–∫—É—â—É—é –∫–æ—Ä–∑–∏–Ω—É –∏–ª–∏ —Å—Å—ã–ª–∫—É –Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –ë–î

–†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤–∏–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ Redis –∏–ª–∏ –ë–î, API —Å—Ç–∞–ª stateless, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:
```
1. POST /cart {"item": "A"}
   ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Redis: user_123_cart = ["A"]

2. POST /cart {"item": "B"}
   ‚Üí –ü—Ä–æ—á–∏—Ç–∞—Ç—å –∏–∑ Redis: user_123_cart = ["A"]
   ‚Üí –î–æ–±–∞–≤–∏—Ç—å B: user_123_cart = ["A", "B"]
   ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ
```

**–ü—Ä–æ–±–ª–µ–º–∞: "Session affinity –ø—Ä–∏ stateless –¥–∏–∑–∞–π–Ω–µ"**

–ö–æ–º–ø–∞–Ω–∏—è —Ä–∞–∑–≤–µ—Ä–Ω—É–ª–∞ stateless –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞ 10 —ç–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö –∑–∞ load balancer. –ù–æ –∫–ª–∏–µ–Ω—Ç—ã —Å—Ç–∞–ª–∏ –∂–∞–ª–æ–≤–∞—Ç—å—Å—è –Ω–∞ "—Å—Ç—Ä–∞–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ":
- –û—Ç–ø—Ä–∞–≤–ª—è—é—Ç –∑–∞–ø—Ä–æ—Å ‚Üí –ø–æ–ª—É—á–∞—é—Ç –æ—Ç–≤–µ—Ç A
- –û—Ç–ø—Ä–∞–≤–ª—è—é—Ç —Ç–æ—Ç –∂–µ –∑–∞–ø—Ä–æ—Å ‚Üí –ø–æ–ª—É—á–∞—é—Ç –æ—Ç–≤–µ—Ç B
- –°–Ω–æ–≤–∞ —Ç–æ—Ç –∂–µ –∑–∞–ø—Ä–æ—Å ‚Üí —Å–Ω–æ–≤–∞ –æ—Ç–≤–µ—Ç A

–ü—Ä–∏—á–∏–Ω–∞: –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –±—ã–ª –æ–±—ä—è–≤–ª–µ–Ω stateless, –Ω–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ:
- –ö–∞–∂–¥—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∑–∞–≥—Ä—É–∂–∞–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ —Ñ–∞–π–ª–∞
- –†–∞–∑–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –∏–º–µ–ª–∏ —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- Load balancer —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–ª –∑–∞–ø—Ä–æ—Å—ã round-robin

–≠—Ç–æ **–Ω–∞—Ä—É—à–µ–Ω–∏–µ stateless —Å–µ–º–∞–Ω—Ç–∏–∫–∏**. –ò—Å—Ç–∏–Ω–Ω—ã–π stateless —Å–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä–∞.

–†–µ—à–µ–Ω–∏–µ: —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (Consul, etcd) –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å, —á—Ç–æ–±—ã –≤—Å–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –∏–º–µ–ª–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

### üõ† –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å stateless —Å–µ–º–∞–Ω—Ç–∏–∫–æ–π

**–ü—Ä–∏–Ω—Ü–∏–ø 1: –í—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –∑–∞–ø—Ä–æ—Å–µ**
- –ò—Å–ø–æ–ª—å–∑—É–π JWT-—Ç–æ–∫–µ–Ω—ã –≤–º–µ—Å—Ç–æ server-side —Å–µ—Å—Å–∏–π
- –í–∫–ª—é—á–∞–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å
- –ü–µ—Ä–µ–¥–∞–≤–∞–π pagination cursors, –∞ –Ω–µ —Ö—Ä–∞–Ω–∏ "—Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É" –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–ü—Ä–∏–Ω—Ü–∏–ø 2: –í–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è**
- –ò—Å–ø–æ–ª—å–∑—É–π Redis/Memcached –¥–ª—è –∫—ç—à–µ–π
- –ò—Å–ø–æ–ª—å–∑—É–π PostgreSQL/MongoDB –¥–ª—è persistent state
- API-—Å–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞—ë—Ç—Å—è stateless, –Ω–æ —á–∏—Ç–∞–µ—Ç/–ø–∏—à–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑–≤–Ω–µ

**–ü—Ä–∏–Ω—Ü–∏–ø 3: –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**
- –°–¥–µ–ª–∞–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º–∏ (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å = —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
- –ò—Å–ø–æ–ª—å–∑—É–π idempotency keys –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–ü—Ä–∏–Ω—Ü–∏–ø 4: –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –ü—Ä–æ–µ–∫—Ç–∏—Ä—É–π —Ç–∞–∫, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –¥–æ–±–∞–≤–∏—Ç—å/—É–±—Ä–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç
- –ù–µ –ø–æ–ª–∞–≥–∞–π—Å—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã, in-memory –∫—ç—à–∏ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —ç–∫–∑–µ–º–ø–ª—è—Ä–µ

---

## 2. Stateful Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –° –°–æ—Å—Ç–æ—è–Ω–∏–µ–º)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Stateful Semantics** ‚Äî —ç—Ç–æ –º–æ–¥–µ–ª—å —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π —Å–µ—Ä–≤–µ—Ä **—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é** –æ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è—Ö —Å –∫–ª–∏–µ–Ω—Ç–æ–º. –¢–µ–∫—É—â–∏–π –∑–∞–ø—Ä–æ—Å –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

```
–ó–∞–ø—Ä–æ—Å #1              –ó–∞–ø—Ä–æ—Å #2              –ó–∞–ø—Ä–æ—Å #3
   |                      |                      |
   v                      v                      v
[–°–µ—Ä–≤–µ—Ä]              [–°–µ—Ä–≤–µ—Ä]              [–°–µ—Ä–≤–µ—Ä]
‚îî‚îÄ State: A          ‚îî‚îÄ State: A,B         ‚îî‚îÄ State: A,B,C
```

–°–µ—Ä–≤–µ—Ä "–ø–æ–º–Ω–∏—Ç" –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: –Ω–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤–µ—Å—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- **–°–ª–æ–∂–Ω—ã–µ –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏**: —Å–∏—Å—Ç–µ–º–∞ –ø–æ–º–Ω–∏—Ç "–≥–¥–µ –º—ã –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å"
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**: –º–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è**: —Å–∏—Å—Ç–µ–º–∞ –ø–æ–º–Ω–∏—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**: –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ—Å—Ç–æ—Ç—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è**: –Ω–µ–ª—å–∑—è –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∏–∑–æ–ª—è—Ü–∏—é —Å–±–æ–µ–≤**: –ø–æ—Ç–µ—Ä—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–¥–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ª—ë–≥–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: –Ω—É–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å/–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- **–ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç "–∑–∞—Å—Ç—Ä–µ–≤–∞–Ω–∏—è"**: –∫–ª–∏–µ–Ω—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Å–µ—Ä–≤–µ—Ä—É —Å –µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**Kafka Consumers —Å offset tracking**

Kafka consumer ‚Äî –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π stateful –∫–æ–º–ø–æ–Ω–µ–Ω—Ç. –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏–π:
- –•—Ä–∞–Ω–∏—Ç offset (–ø–æ–∑–∏—Ü–∏—é) –≤ –∫–∞–∂–¥–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏ —Ç–æ–ø–∏–∫–∞
- –ß–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç ‚Üí —Å–¥–≤–∏–≥–∞–µ—Ç offset
- –ü—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ offset

–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:
```
–¢–æ–ø–∏–∫: orders
–ü–∞—Ä—Ç–∏—Ü–∏—è 0: [msg1, msg2, msg3, msg4, msg5, ...]

Consumer-A:
1. –ß–∏—Ç–∞–µ—Ç msg1, offset=0
2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç msg1
3. Commit offset=1 (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
4. –ß–∏—Ç–∞–µ—Ç msg2, offset=1
5. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç msg2
6. Commit offset=2

--- Consumer-A –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è ---

7. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ: offset=2
8. –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å msg3
```

–°–æ—Å—Ç–æ—è–Ω–∏–µ (offset) –∫—Ä–∏—Ç–∏—á–Ω–æ:
- –ü–æ—Ç–µ—Ä—è–µ—à—å offset ‚Üí –±—É–¥–µ—à—å —á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞–Ω–æ–≤–æ (–¥—É–±–ª–∏–∫–∞—Ç—ã)
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—à—å offset ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏—à—å —Å–æ–æ–±—â–µ–Ω–∏—è

**PostgreSQL: —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏**

–ö–æ–≥–¥–∞ —Ç—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—à—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ PostgreSQL –∏ –Ω–∞—á–∏–Ω–∞–µ—à—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é:
```
BEGIN;
UPDATE accounts SET balance = balance - 100 WHERE id = 1;
UPDATE accounts SET balance = balance + 100 WHERE id = 2;
COMMIT;
```

–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è stateful:
- Postgres –ø–æ–º–Ω–∏—Ç, —á—Ç–æ —Ç—ã –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –î–µ—Ä–∂–∏—Ç –ª–æ–∫–∏ –Ω–∞ —Å—Ç—Ä–æ–∫–∞—Ö
- –ü–æ–º–Ω–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ COMMIT
- –î—Ä—É–≥–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤–∏–¥—è—Ç —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (–∏–∑–æ–ª—è—Ü–∏—è)

–ï—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑–æ—Ä–≤—ë—Ç—Å—è –¥–æ COMMIT:
- –í—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- –°–æ—Å—Ç–æ—è–Ω–∏–µ (–∏–∑–º–µ–Ω–µ–Ω–∏—è) —Ç–µ—Ä—è–µ—Ç—Å—è

**WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**

WebSocket ‚Äî stateful –ø—Ä–æ—Ç–æ–∫–æ–ª. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç HTTP (–æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å ‚Üí –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç), WebSocket:
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –°–µ—Ä–≤–µ—Ä –ø–æ–º–Ω–∏—Ç, –∫–∞–∫–æ–π –∫–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á—ë–Ω
- –ú–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—É –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ (push)

–ü—Ä–∏–º–µ—Ä: —á–∞—Ç-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```
–ö–ª–∏–µ–Ω—Ç A –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è ‚Üí WebSocket Server
‚îî‚îÄ State: {clientA: connected, room: "general"}

–ö–ª–∏–µ–Ω—Ç A –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ "Hello"
‚Üí –°–µ—Ä–≤–µ—Ä –∑–Ω–∞–µ—Ç, —á—Ç–æ clientA –≤ –∫–æ–º–Ω–∞—Ç–µ "general"
‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç "Hello" –≤—Å–µ–º –≤ –∫–æ–º–Ω–∞—Ç–µ "general"

--- –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç—Å—è ---
‚Üí –ö–ª–∏–µ–Ω—Ç A —Ç–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
‚Üí –ü—Ä–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ –∑–∞–Ω–æ–≤–æ "–≤–æ–π—Ç–∏ –≤ –∫–æ–º–Ω–∞—Ç—É"
```

**Redis: Pipelining –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ MULTI/EXEC**

Redis –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç stateful –æ–ø–µ—Ä–∞—Ü–∏–∏:
```
MULTI
SET key1 "value1"
SET key2 "value2"
INCR counter
EXEC
```

–ú–µ–∂–¥—É MULTI –∏ EXEC:
- Redis –ø–æ–º–Ω–∏—Ç, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ö–æ–º–∞–Ω–¥—ã –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è, –∞ —Å—Ç–∞–≤—è—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å
- EXEC –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å—ë –∞—Ç–æ–º–∞—Ä–Ω–æ

–ï—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑–æ—Ä–≤—ë—Ç—Å—è –º–µ–∂–¥—É MULTI –∏ EXEC ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Ç–µ—Ä—è–µ—Ç—Å—è.

### üî• –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç: "–ü–æ—Ç–µ—Ä—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø—Ä–∏ –¥–µ–ø–ª–æ–µ"**

–ö–æ–º–ø–∞–Ω–∏—è –∑–∞–ø—É—Å—Ç–∏–ª–∞ real-time dashboard –Ω–∞ WebSocket. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
- Frontend –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ WebSocket —Å–µ—Ä–≤–µ—Ä—É
- –°–µ—Ä–≤–µ—Ä –¥–µ—Ä–∂–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ: –∫—Ç–æ –ø–æ–¥–∫–ª—é—á—ë–Ω, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª
- –°–µ—Ä–≤–µ—Ä push-–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º

–ü—Ä–∏ –¥–µ–ø–ª–æ–µ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏:
```
1. Rolling update: –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
2. WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Ä–∞–∑—Ä—ã–≤–∞—é—Ç—Å—è
3. –ö–ª–∏–µ–Ω—Ç—ã –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ –Ω–æ–≤–æ–º—É —ç–∫–∑–µ–º–ø–ª—è—Ä—É
4. –ù–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–µ –∑–Ω–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ ‚Üí –∫–ª–∏–µ–Ω—Ç—ã —Ç–µ—Ä—è—é—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç
```

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∂–∞–ª–æ–≤–∞–ª–∏—Å—å: "–ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∞–π—Ç –∑–∞–±—ã–≤–∞–µ—Ç, —á—Ç–æ —è —Å–º–æ—Ç—Ä—é".

–†–µ—à–µ–Ω–∏–µ:
- Graceful shutdown: —Å–æ–æ–±—â–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞–º –æ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∑–∞—Ä–∞–Ω–µ–µ
- –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è (–∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç "–ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–±—ã—Ç–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤–∏–¥–µ–ª")
- –ò–ª–∏: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sticky sessions (–Ω–æ —ç—Ç–æ —É—Å–ª–æ–∂–Ω—è–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)

**–ü—Ä–æ–±–ª–µ–º–∞: "Memory leak –≤ stateful —Å–µ—Ä–≤–∏—Å–µ"**

–°–µ—Ä–≤–∏—Å —Ö—Ä–∞–Ω–∏–ª —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–µ—Å—Å–∏–π in-memory:
```
sessions = {
  "session_123": {user_id: 1, data: {...}},
  "session_456": {user_id: 2, data: {...}},
  ...
}
```

–ü—Ä–æ–±–ª–µ–º–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞–∫—Ä—ã–≤–∞–ª–∏ –±—Ä–∞—É–∑–µ—Ä, –Ω–æ —Å–µ—Å—Å–∏–∏ –Ω–µ —É–¥–∞–ª—è–ª–∏—Å—å. –ó–∞ –Ω–µ–¥–µ–ª—é:
- 1 –º–ª–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- 10 KB –Ω–∞ —Å–µ—Å—Å–∏—é
- = 10 GB –ø–∞–º—è—Ç–∏ –Ω–∞ –æ–¥–Ω–æ–º —ç–∫–∑–µ–º–ø–ª—è—Ä–µ
- OOM kill, —Å–µ—Ä–≤–∏—Å –ø–∞–¥–∞–µ—Ç

–†–µ—à–µ–Ω–∏–µ:
- Expiration policy: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–µ—Å—Å–∏–∏
- –ò–ª–∏: —Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Å—Å–∏–∏ –≤ Redis —Å TTL, –∞ –Ω–µ in-memory

**–ü—Ä–æ–±–ª–µ–º–∞: "Kafka consumer rebalance loop"**

Kafka consumer group —Å 10 —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏. –ö–∞–∂–¥—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä:
- –ß–∏—Ç–∞–µ—Ç —Å–≤–æ–∏ –ø–∞—Ä—Ç–∏—Ü–∏–∏
- –•—Ä–∞–Ω–∏—Ç offset –ª–æ–∫–∞–ª—å–Ω–æ

–û–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä —Å—Ç–∞–ª –º–µ–¥–ª–µ–Ω–Ω—ã–º (–∑–∞–≤–∏—Å–∞–ª –Ω–∞ 30 —Å–µ–∫—É–Ω–¥):
```
1. Consumer-3 –∑–∞–≤–∏—Å–∞–µ—Ç ‚Üí –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç heartbeat
2. Kafka –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä —Ä–µ—à–∞–µ—Ç: "Consumer-3 —É–º–µ—Ä"
3. Rebalance: –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–∞—Ä—Ç–∏—Ü–∏–∏ –º–µ–∂–¥—É 9 —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏
4. Consumer-3 –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è ‚Üí –≤–∏–¥–∏—Ç, —á—Ç–æ –µ–≥–æ –∏—Å–∫–ª—é—á–∏–ª–∏
5. Consumer-3 –ø—ã—Ç–∞–µ—Ç—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
6. Rebalance: —Å–Ω–æ–≤–∞ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ–∂–¥—É 10 —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏
7. Consumer-3 —Å–Ω–æ–≤–∞ –∑–∞–≤–∏—Å–∞–µ—Ç...
```

–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª rebalance ‚Üí –Ω–∏–∫—Ç–æ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.

–†–µ—à–µ–Ω–∏–µ: —É–≤–µ–ª–∏—á–∏—Ç—å session timeout –∏–ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É –∑–∞–≤–∏—Å–∞–Ω–∏–π.

### üõ† –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å stateful —Å–µ–º–∞–Ω—Ç–∏–∫–æ–π

**–ü—Ä–∏–Ω—Ü–∏–ø 1: Externalize state –∫–æ–≥–¥–∞ –≤–æ–∑–º–æ–∂–Ω–æ**
- –ù–µ —Ö—Ä–∞–Ω–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ in-memory, –µ—Å–ª–∏ –º–æ–∂–µ—à—å –≤ Redis/DB
- –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: –∫—ç—à–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø–æ—Ç–µ—Ä—è—Ç—å –±–µ–∑ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π

**–ü—Ä–∏–Ω—Ü–∏–ø 2: Graceful shutdown**
- –ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞: –¥–∞–π –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —Ç–µ–∫—É—â–∏–º –æ–ø–µ—Ä–∞—Ü–∏—è–º
- –°–æ—Ö—Ä–∞–Ω–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º
- –£–≤–µ–¥–æ–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–ü—Ä–∏–Ω—Ü–∏–ø 3: State recovery**
- –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ: –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- Kafka consumer: —á–∏—Ç–∞–π committed offsets
- WebSocket: –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç "–ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–±—ã—Ç–∏–µ"

**–ü—Ä–∏–Ω—Ü–∏–ø 4: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è**
- –°–ª–µ–¥–∏ –∑–∞ —Ä–∞–∑–º–µ—Ä–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è (memory usage)
- –ê–ª–µ—Ä—Ç–∏–Ω–≥ –ø—Ä–∏ —Ä–æ—Å—Ç–µ (–≤–æ–∑–º–æ–∂–Ω–∞—è —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏)
- –ú–µ—Ç—Ä–∏–∫–∏: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π/—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

**–ü—Ä–∏–Ω—Ü–∏–ø 5: Sticky sessions —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é**
- Sticky sessions = –∫–ª–∏–µ–Ω—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —ç–∫–∑–µ–º–ø–ª—è—Ä—É
- –ü–ª—é—Å: –Ω–µ –Ω—É–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –ú–∏–Ω—É—Å: –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞, —Å–ª–æ–∂–Ω–æ—Å—Ç—å –¥–µ–ø–ª–æ—è
- –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–ª–∏—à–∫–æ–º –¥–æ—Ä–æ–≥–æ

---

## 3. Ephemeral State (–≠—Ñ–µ–º–µ—Ä–Ω–æ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Ephemeral State** (—ç—Ñ–µ–º–µ—Ä–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ) ‚Äî —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ **—Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã** –ø—Ä–æ—Ü–µ—Å—Å–∞/—Å–µ—Å—Å–∏–∏ –∏ **—Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ** –∏–ª–∏ —Å–±–æ–µ. –≠—Ç–æ "–≤—Ä–µ–º–µ–Ω–Ω–æ–µ" —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã.

```
–°–µ—Ä–≤–µ—Ä —Å—Ç–∞—Ä—Ç—É–µ—Ç
     |
     v
[In-memory State]
  ‚îú‚îÄ cache: {...}
  ‚îú‚îÄ connections: [...]
  ‚îú‚îÄ temp data: {...}
     |
     | (—Ä–∞–±–æ—Ç–∞–µ—Ç)
     |
     v
–°–µ—Ä–≤–µ—Ä –ø–∞–¥–∞–µ—Ç / —Ä–µ—Å—Ç–∞—Ä—Ç—É–µ—Ç
     |
     v
[State –ø–æ—Ç–µ—Ä—è–Ω–æ]
```

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –¥–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏ –≤ —Ç—ã—Å—è—á–∏ —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ –¥–∏—Å–∫–∞
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**: –Ω–µ –Ω—É–∂–Ω—ã –º–µ—Ö–∞–Ω–∏–∑–º—ã persistence
- **–ù–∏–∑–∫–∞—è latency**: –Ω–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏ –Ω–∞ –¥–∏—Å–∫
- **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ overhead**: –Ω–µ –Ω—É–∂–Ω–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞**: —Ä–µ—Å—Ç–∞—Ä—Ç = —á–∏—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç —Ä–µ—Å—Ç–∞—Ä—Ç—ã**: –ª—é–±–æ–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ = –ø–æ—Ç–µ—Ä—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
- **–ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —Å–±–æ–µ–≤**: —É–ø–∞–ª –ø—Ä–æ—Ü–µ—Å—Å = —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ
- **–ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**: –Ω–µ–ª—å–∑—è —Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- **–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—é –º–µ–∂–¥—É —É–∑–ª–∞–º–∏**: —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø—Ä–æ—Ü–µ—Å—Å—É

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**Redis –±–µ–∑ persistence (appendonly=no, save="")**

Redis –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–∞–∫ pure in-memory –∫—ç—à:
```
# redis.conf
save ""
appendonly no
```

–ü–æ–≤–µ–¥–µ–Ω–∏–µ:
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –≤ RAM
- SET/GET —Ä–∞–±–æ—Ç–∞—é—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±—ã—Å—Ç—Ä–æ
- –†–µ—Å—Ç–∞—Ä—Ç Redis ‚Üí –≤—Å—ë –ø–æ—Ç–µ—Ä—è–Ω–æ

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, rate limiting

–ü—Ä–∏–º–µ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è:
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–æ–≥–∏–Ω–∏—Ç—Å—è ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ—Å—Å–∏—é –≤ Redis
   SET session:abc123 "user_id=1" EX 3600

2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã ‚Üí —á–∏—Ç–∞–µ–º –∏–∑ Redis
   GET session:abc123 ‚Üí "user_id=1"

3. Redis —Ä–µ—Å—Ç–∞—Ä—Ç—É–µ—Ç (–¥–µ–ø–ª–æ–π, —Å–±–æ–π) ‚Üí —Å–µ—Å—Å–∏—è –ø–æ—Ç–µ—Ä—è–Ω–∞

4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å ‚Üí —Å–µ—Å—Å–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ login
```

–≠—Ç–æ –ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è —Å–µ—Å—Å–∏–π (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å—Ç–æ –∑–∞–Ω–æ–≤–æ –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—Å—è), –Ω–æ –Ω–µ–ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–∫—É–ø–æ–∫ (–ø–æ—Ç–µ—Ä—è—é—Ç—Å—è —Ç–æ–≤–∞—Ä—ã).

**Nginx: upstream health checks**

Nginx —Ö—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–¥–æ—Ä–æ–≤—å–µ upstream —Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ –ø–∞–º—è—Ç–∏:
```
upstream backend {
    server backend1.example.com;
    server backend2.example.com;
}
```

–ï—Å–ª–∏ backend1 –æ—Ç–≤–µ—á–∞–µ—Ç 500 –æ—à–∏–±–∫–∞–º–∏:
- Nginx –ø–æ–º–µ—á–∞–µ—Ç –µ–≥–æ –∫–∞–∫ "unhealthy" –≤ –ø–∞–º—è—Ç–∏
- –ü–µ—Ä–µ—Å—Ç–∞—ë—Ç —Å–ª–∞—Ç—å —Ç—É–¥–∞ —Ç—Ä–∞—Ñ–∏–∫

–†–µ—Å—Ç–∞—Ä—Ç Nginx:
- –°–æ—Å—Ç–æ—è–Ω–∏–µ "backend1 unhealthy" —Ç–µ—Ä—è–µ—Ç—Å—è
- Nginx —Å–Ω–æ–≤–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç —Å–ª–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ backend1
- –ï—Å–ª–∏ backend1 –≤—Å—ë –µ—â—ë —Å–ª–æ–º–∞–Ω ‚Üí –∫–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –æ—à–∏–±–∫–∏

–≠—Ç–æ ephemeral state: –ø–æ–ª–µ–∑–Ω–æ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ.

**RabbitMQ: non-durable queues**

RabbitMQ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥–∏ –±–µ–∑ persistence:
```
# –°–æ–∑–¥–∞—Ç—å ephemeral –æ—á–µ—Ä–µ–¥—å
queue.declare(queue='temp_queue', durable=False)
```

–ü–æ–≤–µ–¥–µ–Ω–∏–µ:
- –û—á–µ—Ä–µ–¥—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞ RabbitMQ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –†–µ—Å—Ç–∞—Ä—Ç RabbitMQ ‚Üí –æ—á–µ—Ä–µ–¥—å –∏—Å—á–µ–∑–∞–µ—Ç –≤–º–µ—Å—Ç–µ —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å, real-time —Å–æ–±—ã—Ç–∏—è (—Å—Ç–∞—Ä—ã–µ –Ω–µ –Ω—É–∂–Ω—ã –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞).

**ClickHouse: Buffer tables**

ClickHouse –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Buffer tables –∫–∞–∫ ephemeral –±—É—Ñ–µ—Ä –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É:
```
CREATE TABLE buffer_table (...)
ENGINE = Buffer(database, main_table, ...)
```

–î–∞–Ω–Ω—ã–µ –≤ Buffer table:
- –•—Ä–∞–Ω—è—Ç—Å—è –≤ RAM
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è (flush) –≤ main_table
- –ü—Ä–∏ —Å–±–æ–µ ClickHouse –¥–æ flush ‚Üí –¥–∞–Ω–Ω—ã–µ –≤ –±—É—Ñ–µ—Ä–µ —Ç–µ—Ä—è—é—Ç—Å—è

–≠—Ç–æ trade-off: –≤—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏ vs —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–±–æ–µ.

### üî• –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç: "–ú–∞—Å—Å–æ–≤—ã–π –ª–æ–≥–∞—É—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è"**

–ö–æ–º–ø–∞–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–µ—Å—Å–∏–∏ –≤ Redis –±–µ–∑ persistence (ephemeral state). –ü—Ä–∏ –ø–ª–∞–Ω–æ–≤–æ–º –¥–µ–ø–ª–æ–µ:
```
1. –î–µ–ø–ª–æ–π –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ Redis
2. –°—Ç–∞—Ä—ã–π Redis –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è ‚Üí –≤—Å–µ —Å–µ—Å—Å–∏–∏ –≤ RAM –ø–æ—Ç–µ—Ä—è–Ω—ã
3. 100,000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–Ω–µ–∑–∞–ø–Ω–æ "—Ä–∞–∑–ª–æ–≥–∏–Ω–µ–Ω—ã"
4. –í—Å–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø—ã—Ç–∞—é—Ç—Å—è –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è ‚Üí auth —Å–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω
5. Cascading failure: —Å–∞–π—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω 30 –º–∏–Ω—É—Ç
```

–û—à–∏–±–∫–∞: –∫—Ä–∏—Ç–∏—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (—Å–µ—Å—Å–∏–∏) —Ö—Ä–∞–Ω–∏–ª–æ—Å—å –≤ ephemeral —Ñ–æ—Ä–º–µ.

–†–µ—à–µ–Ω–∏–µ:
- –í–∫–ª—é—á–∏—Ç—å Redis persistence (AOF –∏–ª–∏ RDB snapshots)
- –ò–ª–∏: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å separate cache –¥–ª—è "–º–æ–∂–Ω–æ –ø–æ—Ç–µ—Ä—è—Ç—å" –¥–∞–Ω–Ω—ã—Ö
- Graceful migration: –¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤—Ä–µ–º—è –∑–∞–Ω–æ–≤–æ –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞: "–ü–æ—Ç–µ—Ä—è rate limiting –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ"**

API —Å–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª in-memory —Å—á—ë—Ç—á–∏–∫–∏ –¥–ª—è rate limiting:
```
rate_limits = {
  "user_123": {"requests": 95, "window_start": timestamp},
  "user_456": {"requests": 30, "window_start": timestamp}
}
```

–ü—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–∏—Å–∞:
- –°—á—ë—Ç—á–∏–∫–∏ –æ–±–Ω—É–ª—è—é—Ç—Å—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —Å–¥–µ–ª–∞–ª 95/100 –∑–∞–ø—Ä–æ—Å–æ–≤, –ø–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–µ 100

–ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç —ç–∫—Å–ø–ª—É–∞—Ç–∏—Ä–æ–≤–∞—Ç—å:
- –°–¥–µ–ª–∞—Ç—å 100 –∑–∞–ø—Ä–æ—Å–æ–≤
- –†–µ—Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ DoS)
- –°–Ω–æ–≤–∞ —Å–¥–µ–ª–∞—Ç—å 100 –∑–∞–ø—Ä–æ—Å–æ–≤

–†–µ—à–µ–Ω–∏–µ: —Ö—Ä–∞–Ω–∏—Ç—å rate limits –≤ Redis —Å TTL (durable –∏–ª–∏ ephemeral Redis, –Ω–æ –Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ –æ–¥–Ω–æ–≥–æ API —ç–∫–∑–µ–º–ø–ª—è—Ä–∞).

**–ü—Ä–æ–±–ª–µ–º–∞: "ClickHouse Buffer table data loss"**

–°–∏—Å—Ç–µ–º–∞ —Å–æ–±–∏—Ä–∞–ª–∞ –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ ClickHouse Buffer table:
```
–ú–µ—Ç—Ä–∏–∫–∏ ‚Üí Buffer table (RAM) ‚Üí [flush –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫] ‚Üí Main table (disk)
```

–ü—Ä–∏ —Å–±–æ–µ —Å–µ—Ä–≤–µ—Ä–∞:
- –î–∞–Ω–Ω—ã–µ –≤ Buffer table (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 60 —Å–µ–∫—É–Ω–¥) —Ç–µ—Ä—è—é—Ç—Å—è
- Monitoring –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ø—Ä–æ–≤–∞–ª—ã" –≤ –º–µ—Ç—Ä–∏–∫–∞—Ö –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞

–ï—Å–ª–∏ —Ä–µ—Å—Ç–∞—Ä—Ç—ã —á–∞—Å—Ç—ã–µ (unstable —Å–∏—Å—Ç–µ–º–∞):
- –¢–µ—Ä—è–µ—Ç—Å—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10% –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫)

–†–µ—à–µ–Ω–∏–µ:
- –£–º–µ–Ω—å—à–∏—Ç—å flush interval (–Ω–æ –≤—ã—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –¥–∏—Å–∫)
- –ò–ª–∏: –ø–∏—Å–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é –≤ main table (–Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ)
- –ò–ª–∏: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å replication (flush –Ω–∞ —Ä–µ–ø–ª–∏–∫—É –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–∞—â–µ)

### üõ† –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å ephemeral state

**–ü—Ä–∏–Ω—Ü–∏–ø 1: –û–ø—Ä–µ–¥–µ–ª–∏, —á—Ç–æ –º–æ–∂–Ω–æ –ø–æ—Ç–µ—Ä—è—Ç—å**
- ‚úÖ –ö—ç—à–∏ (–º–æ–∂–Ω–æ –∑–∞–Ω–æ–≤–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ DB)
- ‚úÖ Rate limiting (–ø–æ—Ç–µ—Ä—è —Å—á—ë—Ç—á–∏–∫–æ–≤ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞)
- ‚úÖ Real-time metrics (—Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ –Ω–µ –Ω—É–∂–Ω—ã)
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–∫—É–ø–æ–∫
- ‚ùå –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- ‚ùå –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã–µ

**–ü—Ä–∏–Ω—Ü–∏–ø 2: Warm-up strategy**
- –ü–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ ephemeral state –ø—É—Å—Ç ‚Üí —Ö–æ–ª–æ–¥–Ω—ã–π –∫—ç—à
- –ü–µ—Ä–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –º–µ–¥–ª–µ–Ω–Ω—ã–µ (cache misses)
- –°—Ç—Ä–∞—Ç–µ–≥–∏–∏:
  - Pre-warm: –∑–∞–≥—Ä—É–∑–∏—Ç—å popular –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
  - Gradual ramp-up: –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä

**–ü—Ä–∏–Ω—Ü–∏–ø 3: Monitoring –∏ alerting**
- –°–ª–µ–¥–∏ –∑–∞ cache hit ratio
- –ü–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ –æ–∂–∏–¥–∞–π –ø–∞–¥–µ–Ω–∏–µ hit ratio ‚Üí —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- Alert –µ—Å–ª–∏ hit ratio –Ω–∏–∑–∫–∏–π –¥–æ–ª–≥–æ–µ –≤—Ä–µ–º—è (–≤–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ —Å warm-up)

**–ü—Ä–∏–Ω—Ü–∏–ø 4: Graceful degradation**
- –ï—Å–ª–∏ ephemeral state –ø–æ—Ç–µ—Ä—è–Ω ‚Üí —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å
- –ü—Ä–∏–º–µ—Ä: –ø–æ—Ç–µ—Ä—è–Ω –∫—ç—à ‚Üí –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –≤ DB)
- –ü—Ä–∏–º–µ—Ä: –ø–æ—Ç–µ—Ä—è–Ω rate limit ‚Üí –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, –Ω–æ –Ω–µ –ø–∞–¥–∞–µ—Ç

**–ü—Ä–∏–Ω—Ü–∏–ø 5: TTL –¥–ª—è –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏**
- Ephemeral state –º–æ–∂–µ—Ç "–ø—Ä–æ—Ç—É—Ö–∞—Ç—å"
- –ò—Å–ø–æ–ª—å–∑—É–π TTL –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–∏–º–µ—Ä: Redis EXPIRE, in-memory LRU cache

---

## 4. Durable State (–î–æ–ª–≥–æ–≤–µ—á–Ω–æ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Durable State** (–¥–æ–ª–≥–æ–≤–µ—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ) ‚Äî —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ **–ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç —Ä–µ—Å—Ç–∞—Ä—Ç—ã**, —Å–±–æ–∏ –∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –ø–∏—Ç–∞–Ω–∏—è. –û–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–¥–∏—Å–∫, SSD, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ) –∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.

```
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç
     |
     v
[Durable Storage]
  ‚îú‚îÄ Disk / SSD
  ‚îú‚îÄ Database
  ‚îú‚îÄ Distributed FS
     |
     | (—Å–±–æ–π, —Ä–µ—Å—Ç–∞—Ä—Ç)
     |
     v
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
     |
     v
[–ß–∏—Ç–∞–µ—Ç State –∏–∑ Storage]
```

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ü–µ—Ä–µ–∂–∏–≤–∞–µ—Ç —Ä–µ—Å—Ç–∞—Ä—Ç—ã**: –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
- **–ü–µ—Ä–µ–∂–∏–≤–∞–µ—Ç —Å–±–æ–∏**: –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã –¥–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è
- **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≥–æ–¥–∞–º–∏
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º–æ—Å—Ç—å**: –ø–æ—Å–ª–µ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup
- **ACID –≥–∞—Ä–∞–Ω—Ç–∏–∏** (–¥–ª—è –ë–î): —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤—ã—Å–æ–∫—É—é —Å–∫–æ—Ä–æ—Å—Ç—å**: –∑–∞–ø–∏—Å—å –Ω–∞ –¥–∏—Å–∫ –º–µ–¥–ª–µ–Ω–Ω–µ–µ RAM –≤ ~1000 —Ä–∞–∑
- **–ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫**: –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –¥–∏—Å–∫–∏ –ª–æ–º–∞—é—Ç—Å—è, –Ω—É–∂–Ω—ã backups
- **–ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç disk corruption**: –±–∏—Ç—ã–µ —Å–µ–∫—Ç–æ—Ä–∞, filesystem errors

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**PostgreSQL: WAL –∏ data files**

PostgreSQL —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö:
1. **Data files**: —Ç–∞–±–ª–∏—Ü—ã, –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ –¥–∏—Å–∫–µ
2. **WAL (Write-Ahead Log)**: –∂—É—Ä–Ω–∞–ª –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç durability:
```
1. BEGIN;
2. UPDATE users SET balance = 100 WHERE id = 1;
   ‚Üí Postgres –ø–∏—à–µ—Ç –≤ WAL: "UPDATE users..."
   ‚Üí WAL —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –¥–∏—Å–∫ (fsync)
3. COMMIT;
   ‚Üí Postgres –ø–∏—à–µ—Ç –≤ WAL: "COMMIT transaction X"
   ‚Üí –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–∞ –¥–∏—Å–∫–µ

--- –°–±–æ–π –ø–∏—Ç–∞–Ω–∏—è ---

4. Postgres —Å—Ç–∞—Ä—Ç—É–µ—Ç –ø–æ—Å–ª–µ —Å–±–æ—è
5. –ß–∏—Ç–∞–µ—Ç WAL ‚Üí –≤–∏–¥–∏—Ç "UPDATE ... COMMIT"
6. –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫ data files
7. –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã ‚úì
```

Durability –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ WAL + fsync:
- –î–∞–∂–µ –µ—Å–ª–∏ data files –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–±–æ—è
- WAL —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ commit'—ã
- Recovery –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ WAL

**Kafka: log segments –Ω–∞ –¥–∏—Å–∫–µ**

Kafka —Ö—Ä–∞–Ω–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ log segments –Ω–∞ –¥–∏—Å–∫–µ:
```
/var/lib/kafka/
  orders-0/
    00000000000000000000.log  ‚Üê —Å–æ–æ–±—â–µ–Ω–∏—è 0-999
    00000000000001000000.log  ‚Üê —Å–æ–æ–±—â–µ–Ω–∏—è 1000-1999
    00000000000002000000.log  ‚Üê —Å–æ–æ–±—â–µ–Ω–∏—è 2000-...
```

–ö–æ–≥–¥–∞ –ø—Ä–æ–¥—é—Å–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:
1. Kafka –ø–∏—à–µ—Ç –≤ –ª–æ–≥-—Ñ–∞–π–ª
2. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: fsync –Ω–∞ –¥–∏—Å–∫ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫)
3. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø—Ä–æ–¥—é—Å–µ—Ä—É: "—Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ"

–ü—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ Kafka:
- –ß–∏—Ç–∞–µ—Ç log segments —Å –¥–∏—Å–∫–∞
- –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤
- Consumers –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö offsets

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ durability:
- `log.flush.interval.messages`: –∫–∞–∫ —á–∞—Å—Ç–æ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –Ω–∞ –¥–∏—Å–∫
- `acks=all`: –∂–¥–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –≤—Å–µ—Ö —Ä–µ–ø–ª–∏–∫ (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è durability)

**MongoDB: WiredTiger storage engine**

MongoDB —Å WiredTiger –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- **Data files**: –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω–∞ –¥–∏—Å–∫–µ
- **Journal (WAL)**: –∂—É—Ä–Ω–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏:
```
1. db.users.insertOne({name: "Alice"})
2. WiredTiger –ø–∏—à–µ—Ç –≤ journal (fsync –∫–∞–∂–¥—ã–µ 100ms –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
3. WiredTiger –ø–∏—à–µ—Ç –≤ in-memory cache
4. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ (–∫–∞–∂–¥—ã–µ 60 —Å–µ–∫): checkpoint ‚Üí —Å–±—Ä–æ—Å cache –Ω–∞ –¥–∏—Å–∫

--- –°–±–æ–π –¥–æ checkpoint ---

5. MongoDB —Å—Ç–∞—Ä—Ç—É–µ—Ç
6. –ß–∏—Ç–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π checkpoint
7. –ü—Ä–∏–º–µ–Ω—è–µ—Ç journal —Å –º–æ–º–µ–Ω—Ç–∞ checkpoint
8. –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
```

Trade-off:
- –ß–∞—Å—Ç—ã–µ fsync ‚Üí –≤—ã—Å–æ–∫–∞—è durability, –Ω–∏–∑–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –†–µ–¥–∫–∏–µ fsync ‚Üí –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–±–æ–µ

**Redis: AOF (Append-Only File)**

Redis —Å AOF persistence:
```
# redis.conf
appendonly yes
appendfsync everysec
```

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ö–ª–∏–µ–Ω—Ç: `SET key "value"`
2. Redis –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –≤ –ø–∞–º—è—Ç–∏
3. Redis –¥–æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤ AOF —Ñ–∞–π–ª: `SET key "value"`
4. –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É (everysec): fsync AOF –Ω–∞ –¥–∏—Å–∫

–ü—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ Redis:
- –ß–∏—Ç–∞–µ—Ç AOF —Ñ–∞–π–ª
- –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ

–û–ø—Ü–∏–∏ appendfsync:
- `always`: fsync –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã (–º–µ–¥–ª–µ–Ω–Ω–æ, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è durability)
- `everysec`: fsync –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É (–±–∞–ª–∞–Ω—Å)
- `no`: OS —Ä–µ—à–∞–µ—Ç, –∫–æ–≥–¥–∞ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å (–±—ã—Å—Ç—Ä–æ, —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö)

### üî• –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç: "–ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –≤ Kafka –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫"**

–ö–æ–º–ø–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ Kafka –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–ª–∞—Ç—ë–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π. –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
```
# Producer
acks=1  ‚Üê –∂–¥–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –æ—Ç leader

# Broker
log.flush.interval.messages=10000  ‚Üê —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –Ω–∞ –¥–∏—Å–∫ –∫–∞–∂–¥—ã–µ 10k —Å–æ–æ–±—â–µ–Ω–∏–π
min.insync.replicas=1
```

–°—Ü–µ–Ω–∞—Ä–∏–π —Å–±–æ—è:
```
1. Producer –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–ª–∞—Ç–µ–∂–µ
2. Leader –ø–æ–ª—É—á–∞–µ—Ç ‚Üí –ø–∏—à–µ—Ç –≤ RAM ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç producer
3. –°–æ–æ–±—â–µ–Ω–∏–µ –µ—â—ë –Ω–µ —Å–±—Ä–æ—à–µ–Ω–æ –Ω–∞ –¥–∏—Å–∫ (< 10k —Å–æ–æ–±—â–µ–Ω–∏–π)
4. Leader –ø–∞–¥–∞–µ—Ç (–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è)
5. RAM –æ—á–∏—â–∞–µ—Ç—Å—è ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ
6. Follower —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è leader ‚Üí —É –Ω–µ–≥–æ –Ω–µ—Ç —ç—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
7. –ü–ª–∞—Ç—ë–∂ –ø–æ—Ç–µ—Ä—è–Ω üí∏
```

–û—à–∏–±–∫–∞: –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

–†–µ—à–µ–Ω–∏–µ:
```
# Producer
acks=all  ‚Üê –∂–¥–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –≤—Å–µ—Ö in-sync —Ä–µ–ø–ª–∏–∫

# Broker
min.insync.replicas=2  ‚Üê –º–∏–Ω–∏–º—É–º 2 —Ä–µ–ø–ª–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
log.flush.interval.ms=1000  ‚Üê —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å —á–∞—â–µ
```

–¶–µ–Ω–∞: –≤—ã—à–µ latency, –Ω–∏–∂–µ throughput, –Ω–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è.

**–ü—Ä–æ–±–ª–µ–º–∞: "Corrupted PostgreSQL data –ø–æ—Å–ª–µ disk failure"**

–°–µ—Ä–≤–µ—Ä —Å PostgreSQL –∏—Å–ø—ã—Ç–∞–ª —Å–±–æ–π –¥–∏—Å–∫–∞ (bad sectors). –ü—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ:
```
PANIC: could not read block 123 in file "base/16384/12345": Input/output error
```

PostgreSQL –Ω–µ –º–æ–∂–µ—Ç —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å ‚Üí –¥–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.

–ü—Ä–∏—á–∏–Ω—ã:
- –î–∏—Å–∫ —á–∞—Å—Ç–∏—á–Ω–æ —Å–ª–æ–º–∞–Ω
- Filesystem corruption
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ (–Ω–µ graceful shutdown)

–†–µ—à–µ–Ω–∏–µ:
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup + WAL –∞—Ä—Ö–∏–≤–æ–≤
- –ò–ª–∏: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å replication (–ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Ä–µ–ø–ª–∏–∫—É)
- –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞: RAID, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ S.M.A.R.T., —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ backups

**–ü—Ä–æ–±–ª–µ–º–∞: "–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å –∏–∑-–∑–∞ aggressive fsync"**

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ Redis —Å `appendfsync always`:
```
appendfsync always  ‚Üê fsync –ø–æ—Å–ª–µ –ö–ê–ñ–î–û–ô –∫–æ–º–∞–Ω–¥—ã
```

–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- SET –∫–æ–º–∞–Ω–¥–∞: 0.1ms –≤ –ø–∞–º—è—Ç–∏ + 5ms fsync = 5.1ms
- Throughput: ~200 ops/sec (–≤–º–µ—Å—Ç–æ 100,000 ops/sec –±–µ–∑ fsync)

–ü–æ—á–µ–º—É –º–µ–¥–ª–µ–Ω–Ω–æ:
- –ö–∞–∂–¥—ã–π fsync ‚Äî —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
- –î–∏—Å–∫ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å ~200 fsync/sec (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç HDD/SSD)
- –ë–ª–æ–∫–∏—Ä—É–µ—Ç –¥—Ä—É–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

–†–µ—à–µ–Ω–∏–µ:
- –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ `appendfsync everysec` (–ø—Ä–∏–µ–º–ª–µ–º—ã–π trade-off –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞)
- –ò–ª–∏: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSD (–±—ã—Å—Ç—Ä–µ–µ fsync)
- –ò–ª–∏: –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ batches

### üõ† –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å durable state

**–ü—Ä–∏–Ω—Ü–∏–ø 1: –û–ø—Ä–µ–¥–µ–ª–∏ —É—Ä–æ–≤–µ–Ω—å durability**

–°–ø—Ä–æ—Å–∏ —Å–µ–±—è: "–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç, –µ—Å–ª–∏ —è –ø–æ—Ç–µ—Ä—è—é –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–µ–∫—É–Ω–¥ –¥–∞–Ω–Ω—ã—Ö?"
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–ª–∞—Ç–µ–∂–∏, –∑–∞–∫–∞–∑—ã): N=0, –Ω—É–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è durability
- –ú–µ—Ç—Ä–∏–∫–∏, –ª–æ–≥–∏: N=60, –º–æ–∂–Ω–æ –ø–æ—Ç–µ—Ä—è—Ç—å –º–∏–Ω—É—Ç—É
- –ö—ç—à–∏: –º–æ–∂–Ω–æ –ø–æ—Ç–µ—Ä—è—Ç—å –≤—Å—ë

**–ü—Ä–∏–Ω—Ü–∏–ø 2: Trade-off –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å vs durability**

–°–ø–µ–∫—Ç—Ä:
```
–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è                                    –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è
durability                                      –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    |                                                  |
    v                                                  v
[fsync –ø–æ—Å–ª–µ     [fsync –∫–∞–∂–¥—É—é    [fsync –∫–∞–∂–¥—ã–µ    [OS —Ä–µ—à–∞–µ—Ç,
 –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏]   —Å–µ–∫—É–Ω–¥—É]         10 —Å–µ–∫]          –∫–æ–≥–¥–∞ fsync]
```

–í—ã–±–∏—Ä–∞–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.

**–ü—Ä–∏–Ω—Ü–∏–ø 3: Replication –¥–ª—è durability**

–û–¥–∏–Ω–æ—á–Ω—ã–π –¥–∏—Å–∫:
- –ú–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è
- –ú–æ–∂–µ—Ç –±—ã—Ç—å corrupted

Replication:
- –î–∞–Ω–Ω—ã–µ –Ω–∞ 3+ —É–∑–ª–∞—Ö
- –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Å–±–æ—è –≤—Å–µ—Ö —É–∑–ª–æ–≤ ‚Üí –∫—Ä–∞–π–Ω–µ –º–∞–ª–∞
- Kafka: replication factor = 3
- PostgreSQL: streaming replication –Ω–∞ 2+ —Ä–µ–ø–ª–∏–∫–∏

**–ü—Ä–∏–Ω—Ü–∏–ø 4: Backups**

Durability ‚â† –∑–∞—â–∏—Ç–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è/corruption.

–ù—É–∂–Ω—ã backups:
- –ü–æ–ª–Ω—ã–µ backups (daily)
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ backups (hourly)
- Point-in-time recovery (PITR)

–ü—Ä–∏–º–µ—Ä: PostgreSQL
- –ë–∞–∑–æ–≤—ã–π backup (pg_basebackup)
- –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ WAL —Ñ–∞–π–ª–æ–≤
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: base backup + WAL –¥–æ –Ω—É–∂–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏

**–ü—Ä–∏–Ω—Ü–∏–ø 5: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–∏—Å–∫–æ–≤**

- S.M.A.R.T. –º–µ—Ç—Ä–∏–∫–∏ (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Å–∫–æ—Ä–æ–º —Å–±–æ–µ –¥–∏—Å–∫–∞)
- I/O latency (—Ä–æ—Å—Ç latency ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ —Å –¥–∏—Å–∫–æ–º)
- Disk utilization (–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∏—Å–∫–∞ ‚Üí –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏)

**–ü—Ä–∏–Ω—Ü–∏–ø 6: –¢–µ—Å—Ç–∏—Ä—É–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**

–†–µ–≥—É–ª—è—Ä–Ω–æ —Ç–µ—Å—Ç–∏—Ä—É–π:
- –ú–æ–∂–µ—à—å –ª–∏ —Ç—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup?
- –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω–∏–º–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ?
- –í—Å–µ –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è?

Chaos engineering: —Å–∏–º—É–ª–∏—Ä—É–π —Å–±–æ–∏ –¥–∏—Å–∫–æ–≤, –ø—Ä–æ–≤–µ—Ä—è–π, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.

---

## 5. Checkpoint Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö –¢–æ—á–µ–∫)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Checkpoint Semantics** (—Å–µ–º–∞–Ω—Ç–∏–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Ç–æ—á–µ–∫) ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –≤—Ä–µ–º–µ–Ω–∏. Checkpoint —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç "—Å–Ω–∏–º–æ–∫" –ø—Ä–æ–≥—Ä–µ—Å—Å–∞, –ø–æ–∑–≤–æ–ª—è—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ç–æ—á–∫–∏, –∞ –Ω–µ –Ω–∞—á–∏–Ω–∞—Ç—å —Å –Ω—É–ª—è.

```
–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
     |
     v
[Checkpoint #1] ‚Üê —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
     |
     v
(–ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É)
     |
     v
[Checkpoint #2] ‚Üê —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
     |
     v
--- –°–ë–û–ô ---
     |
     v
–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å Checkpoint #2
```

–ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è: –Ω–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–µ–ª—ã–≤–∞—Ç—å –≤—Å—é —Ä–∞–±–æ—Ç—É, —Ç–æ–ª—å–∫–æ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ checkpoint.

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—É—é –ø–æ—Ç–µ—Ä—é –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**: —Ç–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç—É –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ checkpoint
- **–ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: –Ω–µ –Ω—É–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å —Å –Ω–∞—á–∞–ª–∞
- **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—É—é —Ç–æ—á–∫—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è**: –∑–Ω–∞–µ–º, –æ—Ç–∫—É–¥–∞ –ø—Ä–æ–¥–æ–ª–∂–∏–º
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è**: –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å –æ–¥–Ω–æ–≥–æ checkpoint

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç zero data loss**: —Ä–∞–±–æ—Ç–∞ –º–µ–∂–¥—É checkpoint –ø–æ—Ç–µ—Ä—è–Ω–∞
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å**: checkpoint –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º
- **–ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —á–∞—Å—Ç—ã—Ö —Å–±–æ–µ–≤**: –µ—Å–ª–∏ checkpoint –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç, –∞ —Å–±–æ–∏ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç ‚Üí –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç consistency**: checkpoint –º–æ–∂–µ—Ç –∑–∞—Ö–≤–∞—Ç–∏—Ç—å inconsistent state

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**Kafka Consumer Group: offset commits**

Kafka consumer –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç offset (checkpoint):
```
–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π:
1. –ß–∏—Ç–∞–µ–º msg #100 ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º
2. –ß–∏—Ç–∞–µ–º msg #101 ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º
3. –ß–∏—Ç–∞–µ–º msg #102 ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º
4. Checkpoint: commit offset=103 (–æ–±—Ä–∞–±–æ—Ç–∞–ª–∏ –¥–æ 102 –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ)
5. –ß–∏—Ç–∞–µ–º msg #103 ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º
6. –ß–∏—Ç–∞–µ–º msg #104 ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º
7. --- –°–ë–û–ô ---
8. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: —á–∏—Ç–∞–µ–º committed offset=103
9. –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å msg #103 (msg #103-104 –æ–±—Ä–∞–±–æ—Ç–∞—é—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ)
```

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ checkpoint:
- `enable.auto.commit=true`: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ commit –∫–∞–∂–¥—ã–µ N —Å–µ–∫—É–Ω–¥
- `auto.commit.interval.ms=5000`: checkpoint –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- –ò–ª–∏: manual commit –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ batch

Trade-off:
- –ß–∞—Å—Ç—ã–µ commits ‚Üí –º–µ–Ω—å—à–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –±–æ–ª—å—à–µ overhead
- –†–µ–¥–∫–∏–µ commits ‚Üí –±–æ–ª—å—à–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –º–µ–Ω—å—à–µ overhead

**Apache Flink: distributed checkpoints**

Flink –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç stream –¥–∞–Ω–Ω—ã—Ö –∏ –¥–µ–ª–∞–µ—Ç periodic checkpoints:
```
Stream: [event1] ‚Üí [event2] ‚Üí [event3] ‚Üí [event4] ‚Üí ...
            |          |          |          |
            v          v          v          v
        [Map] ‚Üí [Filter] ‚Üí [Reduce] ‚Üí [Sink]

Checkpoint Coordinator:
  –ö–∞–∂–¥—ã–µ 60 —Å–µ–∫: "–°–¥–µ–ª–∞–π—Ç–µ checkpoint!"

Checkpoint #5:
  ‚îú‚îÄ Map operator: state = {...}
  ‚îú‚îÄ Filter operator: state = {...}
  ‚îú‚îÄ Reduce operator: state = {...}
  ‚îî‚îÄ Sink: offset = 12345

--- –°–±–æ–π —É–∑–ª–∞ —Å Map operator ---

Recovery:
  1. –ß–∏—Ç–∞–µ–º Checkpoint #5
  2. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º state –≤—Å–µ—Ö operators
  3. –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Å offset=12345
```

Flink checkpoint ‚Äî —ç—Ç–æ **distributed snapshot**: —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ–≥–æ pipeline.

**PostgreSQL: CHECKPOINT –∫–æ–º–∞–Ω–¥–∞**

PostgreSQL –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –¥–µ–ª–∞–µ—Ç checkpoint:
```
1. –ö–ª–∏–µ–Ω—Ç—ã –ø–∏—à—É—Ç –¥–∞–Ω–Ω—ã–µ ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ WAL
2. –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∞–∫–∂–µ –≤ shared_buffers (RAM)
3. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ (–∫–∞–∂–¥—ã–µ checkpoint_timeout —Å–µ–∫—É–Ω–¥):
   CHECKPOINT –∫–æ–º–∞–Ω–¥–∞
   ‚Üí –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –≤—Å–µ dirty pages –∏–∑ RAM –Ω–∞ –¥–∏—Å–∫
   ‚Üí –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ WAL: "checkpoint at LSN X"

--- –°–±–æ–π ---

Recovery:
1. Postgres —á–∏—Ç–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π checkpoint (LSN X)
2. –ü—Ä–∏–º–µ–Ω—è–µ—Ç WAL –∑–∞–ø–∏—Å–∏ –ø–æ—Å–ª–µ LSN X
3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–º–Ω–æ–≥–æ –±—ã—Å—Ç—Ä–µ–µ (–Ω–µ –Ω—É–∂–Ω–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –≤–µ—Å—å WAL)
```

–ù–∞—Å—Ç—Ä–æ–π–∫–∏:
- `checkpoint_timeout`: —á–∞—Å—Ç–æ—Ç–∞ checkpoint (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5 –º–∏–Ω—É—Ç)
- `checkpoint_completion_target`: —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞—Å—Ç—è–≥–∏–≤–∞—Ç—å I/O –æ–ø–µ—Ä–∞—Ü–∏–∏ checkpoint

**MongoDB: checkpoint –≤ WiredTiger**

WiredTiger –¥–µ–ª–∞–µ—Ç checkpoint –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
```
1. –î–æ–∫—É–º–µ–Ω—Ç—ã –ø–∏—à—É—Ç—Å—è –≤ cache (RAM)
2. –ö–∞–∂–¥—ã–µ 60 —Å–µ–∫: checkpoint
   ‚Üí –°–±—Ä–æ—Å cache –Ω–∞ –¥–∏—Å–∫
   ‚Üí –°–æ–∑–¥–∞—ë—Ç—Å—è consistent snapshot –¥–∞–Ω–Ω—ã—Ö
3. Journal (WAL) –º–µ–∂–¥—É checkpoint

--- –°–±–æ–π ---

Recovery:
1. –ß–∏—Ç–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π checkpoint
2. –ü—Ä–∏–º–µ–Ω—è–µ–º journal —Å –º–æ–º–µ–Ω—Ç–∞ checkpoint
```

### üî• –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç: "–ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–π"**

Kafka consumer –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –¥–µ–ª–∞–ª checkpoint:
```
1. –ß–∏—Ç–∞–µ–º msg #100-109 (batch –∏–∑ 10 —Å–æ–æ–±—â–µ–Ω–∏–π)
2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π
3. Checkpoint: commit offset=110
4. --- –û—à–∏–±–∫–∞ –ø—Ä–∏ commit (—Å–µ—Ç—å —É–ø–∞–ª–∞) ---
5. Consumer —Ä–µ—Å—Ç–∞—Ä—Ç—É–µ—Ç
6. –ß–∏—Ç–∞–µ—Ç committed offset=100 (—Å—Ç–∞—Ä—ã–π checkpoint)
7. –°–Ω–æ–≤–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç msg #100-109
8. –°–Ω–æ–≤–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ commit
9. –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª...
```

–ü—Ä–∏—á–∏–Ω–∞: –Ω–µ–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ + —Å–±–æ–π –ø—Ä–∏ checkpoint.

–†–µ—à–µ–Ω–∏–µ:
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ = —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
- –ò–ª–∏: commit offset –î–û –æ–±—Ä–∞–±–æ—Ç–∫–∏ (at-most-once, –Ω–æ –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
- –ò–ª–∏: transactional semantics (commit offset –≤–º–µ—Å—Ç–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º)

**–ü—Ä–æ–±–ª–µ–º–∞: "–†–µ–¥–∫–∏–µ checkpoint ‚Üí –±–æ–ª—å—à–∞—è –ø–æ—Ç–µ—Ä—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞"**

Batch job –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 10 –º–ª–Ω –∑–∞–ø–∏—Å–µ–π, checkpoint –∫–∞–∂–¥—ã–µ 1 –º–ª–Ω:
```
1. –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ 0 ‚Üí Checkpoint #0
2. –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ 1,000,000 ‚Üí Checkpoint #1
3. –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ 2,000,000 ‚Üí Checkpoint #2
4. –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ 2,999,000 (–ø–æ—á—Ç–∏ 3 –º–ª–Ω)
5. --- –°–ë–û–ô ---
6. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å Checkpoint #2 (2 –º–ª–Ω)
7. –ù—É–∂–Ω–æ –∑–∞–Ω–æ–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å 999,000 –∑–∞–ø–∏—Å–µ–π
```

–ï—Å–ª–∏ —Å–±–æ–∏ —á–∞—Å—Ç—ã–µ ‚Üí –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–¥–µ–ª—ã–≤–∞–µ–º –æ–¥–Ω—É –∏ —Ç—É –∂–µ —Ä–∞–±–æ—Ç—É.

–†–µ—à–µ–Ω–∏–µ: —á–∞—â–µ –¥–µ–ª–∞—Ç—å checkpoint (–∫–∞–∂–¥—ã–µ 100k –≤–º–µ—Å—Ç–æ 1–º–ª–Ω).

Trade-off: —á–∞—Å—Ç—ã–µ checkpoint ‚Üí –±–æ–ª—å—à–µ overhead –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.

**–ü—Ä–æ–±–ª–µ–º–∞: "Inconsistent checkpoint"**

Distributed —Å–∏—Å—Ç–µ–º–∞ —Å 3 —É–∑–ª–∞–º–∏ –¥–µ–ª–∞–µ—Ç checkpoint:
```
–£–∑–µ–ª A: checkpoint state={counter: 100}
–£–∑–µ–ª B: checkpoint state={counter: 105}  ‚Üê —É—Å–ø–µ–ª –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –±–æ–ª—å—à–µ —Å–æ–±—ã—Ç–∏–π
–£–∑–µ–ª C: checkpoint state={counter: 98}   ‚Üê –æ—Ç—Å—Ç–∞–ª

--- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ ---

–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑ —Ä–∞–∑–Ω—ã—Ö checkpoint ‚Üí inconsistent state
```

–†–µ—à–µ–Ω–∏–µ: **coordinated checkpoint** (–≤—Å–µ —É–∑–ª—ã –¥–µ–ª–∞—é—Ç checkpoint —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–π —Ç–æ—á–∫–µ).

–ü—Ä–∏–º–µ—Ä: Flink barrier-based checkpointing.

### üõ† –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å checkpoint semantics

**–ü—Ä–∏–Ω—Ü–∏–ø 1: –û–ø—Ä–µ–¥–µ–ª–∏ —á–∞—Å—Ç–æ—Ç—É checkpoint**

–í–æ–ø—Ä–æ—Å—ã:
- –°–∫–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–µ–º–ª–µ–º–æ –ø–æ—Ç–µ—Ä—è—Ç—å –ø—Ä–∏ —Å–±–æ–µ?
- –ö–∞–∫–æ–π overhead –Ω–∞ checkpoint?

–ü—Ä–∏–º–µ—Ä:
- –û–±—Ä–∞–±–æ—Ç–∫–∞ 1000 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫
- Checkpoint –∑–∞–Ω–∏–º–∞–µ—Ç 100ms
- Checkpoint –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫ ‚Üí overhead 1% (100ms / 10sec)
- –ü—Ä–∏ —Å–±–æ–µ —Ç–µ—Ä—è–µ–º –º–∞–∫—Å–∏–º—É–º 10 —Å–µ–∫ —Ä–∞–±–æ—Ç—ã (10,000 —Å–æ–æ–±—â–µ–Ω–∏–π)

**–ü—Ä–∏–Ω—Ü–∏–ø 2: –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**

Checkpoint –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç exactly-once. –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:
- –ß–∞—Å—Ç—å —Ä–∞–±–æ—Ç—ã –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ–π

–ü—Ä–∏–º–µ—Ä:
- ‚ùå `counter += 1` ‚Äî –Ω–µ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ (–ø–æ–≤—Ç–æ—Ä–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç)
- ‚úÖ `SET counter = 100` ‚Äî –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ (–ø–æ–≤—Ç–æ—Ä–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ = —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç)

**–ü—Ä–∏–Ω—Ü–∏–ø 3: Coordinated checkpoint –¥–ª—è distributed —Å–∏—Å—Ç–µ–º**

–ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–∑–ª–æ–≤:
- Checkpoint –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å consistent snapshot
- –ò—Å–ø–æ–ª—å–∑—É–π –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Ç–∏–ø–∞ Chandy-Lamport
- –ò–ª–∏: barrier-based (Flink)

**–ü—Ä–∏–Ω—Ü–∏–ø 4: Asynchronous checkpoint**

–ù–µ –±–ª–æ–∫–∏—Ä—É–π –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–∞ –≤—Ä–µ–º—è checkpoint:
- Checkpoint –¥–µ–ª–∞–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

–ü—Ä–∏–º–µ—Ä: Flink –¥–µ–ª–∞–µ—Ç async checkpoint (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è).

**–ü—Ä–∏–Ω—Ü–∏–ø 5: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ checkpoint**

–ú–µ—Ç—Ä–∏–∫–∏:
- –ß–∞—Å—Ç–æ—Ç–∞ checkpoint (checkpoint/sec)
- –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è checkpoint (duration)
- –†–∞–∑–º–µ—Ä checkpoint (bytes)
- Failed checkpoints (count)

–ê–ª–µ—Ä—Ç—ã:
- Checkpoint –∑–∞–Ω–∏–º–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ —Å I/O
- Checkpoint failures ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º

---

## 6. Snapshot Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –°–Ω–∏–º–∫–æ–≤)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Snapshot Semantics** (—Å–µ–º–∞–Ω—Ç–∏–∫–∞ —Å–Ω–∏–º–∫–æ–≤) ‚Äî —ç—Ç–æ —Å–æ–∑–¥–∞–Ω–∏–µ **–ø–æ–ª–Ω–æ–π –∫–æ–ø–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã** –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏. Snapshot –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ "–∫–∞–∫ –µ—Å—Ç—å" –≤ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–æ—á–∫–µ, –ø–æ–∑–≤–æ–ª—è—è –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —ç—Ç–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å backup.

```
–í—Ä–µ–º—è: T0      T1      T2      T3
        |       |       |       |
        v       v       v       v
–î–∞–Ω–Ω—ã–µ: A ‚Üí A,B ‚Üí A,B,C ‚Üí A,B,C,D
                 |
                 v
         [Snapshot at T2]
         Copy: A,B,C
```

Snapshot ‚Äî —ç—Ç–æ "—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è" –≤—Å–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –º–æ–º–µ–Ω—Ç T2.

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–¢–æ—á–Ω–∞—è –∫–æ–ø–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è**: snapshot —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è
- **Consistency**: snapshot ‚Äî —ç—Ç–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω–µ "—Ä–∞–∑–æ—Ä–≤–∞–Ω–Ω–æ–µ")
- **–ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π**: snapshot –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è, –¥–∞–∂–µ –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–µ–Ω—è—é—Ç—Å—è
- **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è**: –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ snapshot
- **Point-in-time recovery**: –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –º–æ–º–µ–Ω—Ç—É –≤—Ä–µ–º–µ–Ω–∏

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫**: snapshot —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏ –æ—à–∏–±–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å**: snapshot —É—Å—Ç–∞—Ä–µ–≤–∞–µ—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
- **–ù–µ —ç–∫–æ–Ω–æ–º–∏—Ç –º–µ—Å—Ç–æ**: –ø–æ–ª–Ω–∞—è –∫–æ–ø–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–≥—Ä–æ–º–Ω–æ–π
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ—Å—Ç—å**: —Å–æ–∑–¥–∞–Ω–∏–µ snapshot –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**PostgreSQL: pg_dump**

`pg_dump` —Å–æ–∑–¥–∞—ë—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏–π snapshot –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
```
$ pg_dump mydb > snapshot_2025-01-15.sql

–†–µ–∑—É–ª—å—Ç–∞—Ç: SQL-—Ñ–∞–π–ª —Å–æ –≤—Å–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏
  CREATE TABLE users (...);
  INSERT INTO users VALUES (1, 'Alice');
  INSERT INTO users VALUES (2, 'Bob');
  ...
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
- Backup: —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã
- Migration: –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä
- Testing: —Å–æ–∑–¥–∞—Ç—å –∫–æ–ø–∏—é –ø—Ä–æ–¥–∞–∫—à–Ω-–¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–æ–≤

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- Snapshot ‚Äî consistent (–≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏)
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–∏–º (–≥–∏–≥–∞–±–∞–π—Ç—ã SQL)
- –°–æ–∑–¥–∞–Ω–∏–µ snapshot –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–ª–≥–∏–º (—á–∞—Å—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö –±–∞–∑)

**Redis: RDB snapshots**

Redis —Å–æ–∑–¥–∞—ë—Ç RDB snapshot:
```
# redis.conf
save 900 1      # snapshot –µ—Å–ª–∏ 1+ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞ 15 –º–∏–Ω—É—Ç
save 300 10     # snapshot –µ—Å–ª–∏ 10+ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–∞ 5 –º–∏–Ω—É—Ç
save 60 10000   # snapshot –µ—Å–ª–∏ 10k+ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–∞ 1 –º–∏–Ω—É—Ç—É

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
SAVE / BGSAVE
```

–ü—Ä–æ—Ü–µ—Å—Å:
```
1. –î–∞–Ω–Ω—ã–µ –≤ RAM: {key1: "value1", key2: "value2", ...}
2. BGSAVE –∫–æ–º–∞–Ω–¥–∞
3. Redis fork() ‚Üí –¥–æ—á–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å
4. –î–æ—á–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç snapshot –Ω–∞ –¥–∏—Å–∫ (dump.rdb)
5. –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤

--- –°–±–æ–π ---

6. Redis —Å—Ç–∞—Ä—Ç—É–µ—Ç
7. –ß–∏—Ç–∞–µ—Ç dump.rdb ‚Üí –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
```

Trade-off:
- –ß–∞—Å—Ç—ã–µ snapshots ‚Üí –±–æ–ª—å—à–µ I/O, –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ backups
- –†–µ–¥–∫–∏–µ snapshots ‚Üí –º–µ–Ω—å—à–µ I/O, –±–æ–ª—å—à–µ –ø–æ—Ç–µ—Ä—å –ø—Ä–∏ —Å–±–æ–µ

**MongoDB: backup —á–µ—Ä–µ–∑ mongodump**

`mongodump` —Å–æ–∑–¥–∞—ë—Ç snapshot –∫–æ–ª–ª–µ–∫—Ü–∏–π:
```
$ mongodump --db mydb --out /backup/snapshot-2025-01-15/

–†–µ–∑—É–ª—å—Ç–∞—Ç: BSON-—Ñ–∞–π–ª—ã —Å –¥–∞–Ω–Ω—ã–º–∏
  /backup/snapshot-2025-01-15/
    mydb/
      users.bson
      orders.bson
      products.bson
```

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
```
$ mongorestore --db mydb /backup/snapshot-2025-01-15/mydb/
```

**ClickHouse: FREEZE TABLE**

ClickHouse –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞—Ç—å snapshot —Ç–∞–±–ª–∏—Ü—ã:
```
ALTER TABLE my_table FREEZE;
```

–°–æ–∑–¥–∞—ë—Ç—Å—è hardlink-–∫–æ–ø–∏—è –¥–∞–Ω–Ω—ã—Ö:
```
/var/lib/clickhouse/
  data/mydb/my_table/  ‚Üê –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  shadow/1/mydb/my_table/  ‚Üê snapshot (hardlinks)
```

Hardlinks = —ç–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞ (–Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –±–ª–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö, —Ç–æ–ª—å–∫–æ metadata).

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: backup –ø–µ—Ä–µ–¥ –æ–ø–∞—Å–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ (ALTER, DROP PARTITION).

**VM snapshots (VMware, AWS, GCP)**

–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç snapshots:
```
VM running:
  ‚îú‚îÄ Disk: 100GB
  ‚îú‚îÄ RAM: 16GB
  ‚îî‚îÄ State: running processes

Snapshot:
  ‚îú‚îÄ Disk snapshot (copy-on-write)
  ‚îú‚îÄ RAM snapshot (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  ‚îî‚îÄ Timestamp: 2025-01-15 10:30:00

–ú–æ–∂–Ω–æ:
1. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É VM (–∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∏—à—É—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ)
2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∫ snapshot (–æ—Ç–∫–∞—Ç–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
```

–¢–∏–ø–∏—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
- –ü–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –û–° / –∫—Ä–∏—Ç–∏—á–Ω–æ–≥–æ —Å–æ—Ñ—Ç–∞
- –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Å–¥–µ–ª–∞—Ç—å snapshot ‚Üí —Ç–µ—Å—Ç ‚Üí –æ—Ç–∫–∞—Ç–∏—Ç—å)

### üî• –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç: "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ snapshot –ø—Ä–∏–≤–µ–ª–æ –∫ data loss"**

–ö–æ–º–ø–∞–Ω–∏—è –¥–µ–ª–∞–ª–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ snapshots PostgreSQL –≤ 02:00. –°–±–æ–π –ø—Ä–æ–∏–∑–æ—à—ë–ª –≤ 14:00:
```
02:00 - Snapshot —Å–æ–∑–¥–∞–Ω (–≤—Å–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç)
02:00 - 14:00 - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ–∑–¥–∞—é—Ç –Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã
14:00 - –°–±–æ–π, –±–∞–∑–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞
14:30 - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ snapshot 02:00

–†–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ –∑–∞–∫–∞–∑—ã —Å 02:00 –¥–æ 14:00 –ø–æ—Ç–µ—Ä—è–Ω—ã (12 —á–∞—Å–æ–≤ –¥–∞–Ω–Ω—ã—Ö)
```

–û—à–∏–±–∫–∞: snapshot –±–µ–∑ incremental backups (WAL –∞—Ä—Ö–∏–≤—ã).

–†–µ—à–µ–Ω–∏–µ: –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å snapshot + continuous WAL archiving:
- 02:00: base snapshot
- 02:00-14:00: –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å WAL —Ñ–∞–π–ª—ã
- 14:00: –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å base snapshot + replay WAL –¥–æ 14:00
- –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ –º–∏–Ω—É—Ç—ã

**–ü—Ä–æ–±–ª–µ–º–∞: "Inconsistent snapshot –≤ distributed —Å–∏—Å—Ç–µ–º–µ"**

Distributed —Å–∏—Å—Ç–µ–º–∞ —Å 3 —É–∑–ª–∞–º–∏:
```
–£–∑–µ–ª A: {balance: 100}
–£–∑–µ–ª B: {balance: 200}
–£–∑–µ–ª C: {balance: 300}

Snapshot –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ:
  10:00:00 - –£–∑–µ–ª A snapshot (balance: 100)
  10:00:05 - –ü–µ—Ä–µ–≤–æ–¥ $50 —Å B –Ω–∞ C
  10:00:06 - –£–∑–µ–ª B snapshot (balance: 150)  ‚Üê –ø–æ—Å–ª–µ –ø–µ—Ä–µ–≤–æ–¥–∞
  10:00:07 - –£–∑–µ–ª C snapshot (balance: 350)  ‚Üê –ø–æ—Å–ª–µ –ø–µ—Ä–µ–≤–æ–¥–∞

Snapshot —Å–æ–¥–µ—Ä–∂–∏—Ç:
  A: 100, B: 150, C: 350
  –°—É–º–º–∞: 600 (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 600)

–ù–æ –µ—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –±—ã–ª–∞:
  –£–∑–µ–ª B: -50 (–≤ 10:00:04)
  –£–∑–µ–ª C: +50 (–≤ 10:00:08 - –ø–æ—Å–ª–µ snapshot C)

Snapshot —Å–æ–¥–µ—Ä–∂–∏—Ç:
  A: 100, B: 150, C: 300  ‚Üê C snapshot —Å–¥–µ–ª–∞–Ω –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è +50
  –°—É–º–º–∞: 550 (–ø–æ—Ç–µ—Ä—è–ª–∏ $50!)
```

–ü—Ä–æ–±–ª–µ–º–∞: **inconsistent snapshot** (—Ä–∞–∑–Ω—ã–µ —É–∑–ª—ã –Ω–∞ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è).

–†–µ—à–µ–Ω–∏–µ: **coordinated snapshot** (–≤—Å–µ —É–∑–ª—ã freeze –Ω–∞ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç, snapshot, resume).

–ü—Ä–∏–º–µ—Ä: distributed snapshot algorithms (Chandy-Lamport).

**–ü—Ä–æ–±–ª–µ–º–∞: "Snapshot –∑–∞–Ω–∏–º–∞–µ—Ç –≤–µ—Å—å –¥–∏—Å–∫"**

–ö–æ–º–ø–∞–Ω–∏—è –¥–µ–ª–∞–ª–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ snapshots MongoDB (2TB –±–∞–∑—ã):
```
/data/mongodb/ - 2TB (–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
/backup/
  snapshot-2025-01-10/ - 2TB
  snapshot-2025-01-11/ - 2TB
  snapshot-2025-01-12/ - 2TB
  snapshot-2025-01-13/ - 2TB
  snapshot-2025-01-14/ - 2TB
  snapshot-2025-01-15/ - 2TB

–ò—Ç–æ–≥–æ: 12TB –∑–∞–Ω—è—Ç–æ
–î–∏—Å–∫: 10TB ‚Üí –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ
```

–†–µ–∑—É–ª—å—Ç–∞—Ç: –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π snapshot, —Å–∏—Å—Ç–µ–º–∞ –ø–∞–¥–∞–µ—Ç.

–†–µ—à–µ–Ω–∏–µ:
- Retention policy: —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ N –ø–æ—Å–ª–µ–¥–Ω–∏—Ö snapshots
- Incremental backups: —Ö—Ä–∞–Ω–∏—Ç—å full snapshot + –¥–µ–ª—å—Ç—ã
- Compression: —Å–∂–∏–º–∞—Ç—å snapshots
- External storage: S3, Google Cloud Storage (–¥–µ—à—ë–≤–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ)

### üõ† –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å snapshot semantics

**–ü—Ä–∏–Ω—Ü–∏–ø 1: –û–ø—Ä–µ–¥–µ–ª–∏ retention policy**

–í–æ–ø—Ä–æ—Å—ã:
- –ö–∞–∫ –¥–æ–ª–≥–æ —Ö—Ä–∞–Ω–∏—Ç—å snapshots?
- –°–∫–æ–ª—å–∫–æ snapshots –Ω—É–∂–Ω–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?

–°—Ç—Ä–∞—Ç–µ–≥–∏—è: GFS (Grandfather-Father-Son)
- Daily snapshots: —Ö—Ä–∞–Ω–∏—Ç—å 7 –¥–Ω–µ–π
- Weekly snapshots: —Ö—Ä–∞–Ω–∏—Ç—å 4 –Ω–µ–¥–µ–ª–∏
- Monthly snapshots: —Ö—Ä–∞–Ω–∏—Ç—å 12 –º–µ—Å—è—Ü–µ–≤

**–ü—Ä–∏–Ω—Ü–∏–ø 2: Full vs Incremental**

Full snapshot:
- –ü–æ–ª–Ω–∞—è –∫–æ–ø–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ—Å—Ç–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
- –ó–∞–Ω–∏–º–∞–µ—Ç –º–Ω–æ–≥–æ –º–µ—Å—Ç–∞

Incremental snapshot:
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –ø—Ä–æ—à–ª–æ–≥–æ snapshot
- –≠–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞
- –°–ª–æ–∂–Ω–µ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å (–Ω—É–∂–µ–Ω full + –≤—Å–µ incremental)

–ö–æ–º–±–∏–Ω–∞—Ü–∏—è:
- Weekly: full snapshot
- Daily: incremental

**–ü—Ä–∏–Ω—Ü–∏–ø 3: Consistency**

–î–ª—è distributed —Å–∏—Å—Ç–µ–º:
- –ò—Å–ø–æ–ª—å–∑—É–π coordinated snapshot (–≤—Å–µ —É–∑–ª—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
- –ò–ª–∏: quiesce —Å–∏—Å—Ç–µ–º–∞ –Ω–∞ –≤—Ä–µ–º—è snapshot (–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å)
- –ò–ª–∏: –∏—Å–ø–æ–ª—å–∑—É–π transactionally consistent snapshot (MVCC)

–ü—Ä–∏–º–µ—Ä: PostgreSQL pg_dump –∏—Å–ø–æ–ª—å–∑—É–µ—Ç snapshot isolation (–≤–∏–¥–∏—Ç consistent –¥–∞–Ω–Ω—ã–µ –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞).

**–ü—Ä–∏–Ω—Ü–∏–ø 4: –¢–µ—Å—Ç–∏—Ä—É–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**

–†–µ–≥—É–ª—è—Ä–Ω–æ:
- –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π –∏–∑ snapshot –≤ —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- –ü—Ä–æ–≤–µ—Ä—è–π, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- –ó–∞–º–µ—Ä—è–π –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

–ò–Ω–∞—á–µ: –æ–±–Ω–∞—Ä—É–∂–∏—à—å, —á—Ç–æ backup —Å–ª–æ–º–∞–Ω, —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ–Ω —Ä–µ–∞–ª—å–Ω–æ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è (disaster).

**–ü—Ä–∏–Ω—Ü–∏–ø 5: –•—Ä–∞–Ω–∏ snapshots off-site**

- –ù–µ —Ö—Ä–∞–Ω–∏ snapshots –Ω–∞ —Ç–æ–º –∂–µ —Å–µ—Ä–≤–µ—Ä–µ (—Å–≥–æ—Ä–∏—Ç —Å–µ—Ä–≤–µ—Ä = –ø–æ—Ç–µ—Ä—è –≤—Å–µ–≥–æ)
- –ò—Å–ø–æ–ª—å–∑—É–π remote storage: S3, GCS, Azure Blob
- Encryption –¥–ª—è snapshots (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

**–ü—Ä–∏–Ω—Ü–∏–ø 6: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ snapshot –ø—Ä–æ—Ü–µ—Å—Å–∞**

–ú–µ—Ç—Ä–∏–∫–∏:
- Snapshot duration (—Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω–∏–º–∞–µ—Ç)
- Snapshot size (—Å–∫–æ–ª—å–∫–æ –º–µ—Å—Ç–∞)
- Last successful snapshot (–¥–∞–≤–Ω–æ—Å—Ç—å)

–ê–ª–µ—Ä—Ç—ã:
- Snapshot failed ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ —Å –¥–∏—Å–∫–æ–º/—Å–µ—Ç—å—é
- Snapshot –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª—Å—è > 24 —á–∞—Å–∞ ‚Üí –Ω–µ—Ç —Å–≤–µ–∂–∏—Ö backups

---

## 7. State Recovery Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –°–æ—Å—Ç–æ—è–Ω–∏—è)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**State Recovery Semantics** (—Å–µ–º–∞–Ω—Ç–∏–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è) ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª –∏ –≥–∞—Ä–∞–Ω—Ç–∏–π, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏—Ö, –ö–ê–ö —Å–∏—Å—Ç–µ–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ—è, –∏ –≤ –ö–ê–ö–û–ú —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–Ω–∞ –æ–∫–∞–∂–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.

```
–ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞
     |
     v
--- –°–ë–û–ô ---
     |
     v
[Recovery Process]
  ‚îú‚îÄ –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ consistent state
  ‚îú‚îÄ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
  ‚îú‚îÄ Replay —É—Ç–µ—Ä—è–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  ‚îî‚îÄ –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–∞–±–æ—Ç–µ
     |
     v
–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤ –∫–∞–∫–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏?)
```

–ö–ª—é—á–µ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã:
- –° –∫–∞–∫–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è?
- –ö–∞–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ—Ç–µ—Ä—è–Ω—ã?
- –ö–∞–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±—É–¥—É—Ç –ø–æ–≤—Ç–æ—Ä–µ–Ω—ã?
- –ö–∞–∫ –¥–æ–ª–≥–æ –¥–ª–∏—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ?

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–∞–±–æ—Ç–µ**: —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –ø–æ—Å–ª–µ —Å–±–æ—è
- **–û–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å**: –∏–∑–≤–µ—Å—Ç–Ω–æ, –≤ –∫–∞–∫–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–∫–∞–∂–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–∞
- **Bounded recovery time**: –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–Ω–∏–º–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è
- **Data integrity**: –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω—ã –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –≤—Å–µ–≥–¥–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç zero data loss**: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ recovery
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è
- **–ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫**: –µ—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å –ø–ª–æ—Ö–∏–µ –¥–∞–Ω–Ω—ã–µ, –æ–Ω–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç automatic recovery**: –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è manual intervention

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**PostgreSQL: Crash Recovery**

Postgres –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–±–æ—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
```
--- –°–ë–û–ô (–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è) ---

1. Postgres —Å—Ç–∞—Ä—Ç—É–µ—Ç
2. –ù–∞—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π checkpoint –≤ WAL
3. –ß–∏—Ç–∞–µ—Ç WAL –∑–∞–ø–∏—Å–∏ –ø–æ—Å–ª–µ checkpoint
4. Replay –≤—Å–µ—Ö committed —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
5. Rollback –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
6. –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ

–ü—Ä–æ—Ü–µ—Å—Å:
  Checkpoint at LSN 1000
  WAL:
    LSN 1001: BEGIN transaction A
    LSN 1002: UPDATE users SET balance=100 WHERE id=1
    LSN 1003: COMMIT transaction A  ‚Üê committed
    LSN 1004: BEGIN transaction B
    LSN 1005: UPDATE users SET balance=200 WHERE id=2
    (—Å–±–æ–π, –Ω–µ—Ç COMMIT –¥–ª—è transaction B)

Recovery:
  ‚îú‚îÄ Replay LSN 1001-1003 ‚Üí transaction A –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
  ‚îú‚îÄ LSN 1004-1005 ‚Üí transaction B rollback (–Ω–µ –±—ã–ª–æ COMMIT)
  ‚îî‚îÄ –†–µ–∑—É–ª—å—Ç–∞—Ç: balance(1)=100, balance(2)=—Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
```

–ì–∞—Ä–∞–Ω—Ç–∏–∏:
- –í—Å–µ committed —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ù–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç–∫–∞—á–µ–Ω—ã
- –î–∞–Ω–Ω—ã–µ consistent

Recovery time: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É checkpoint –∏ –∫–æ–Ω—Ü–æ–º WAL.

**Kafka: Consumer recovery**

Kafka consumer –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–±–æ—è:
```
1. Consumer –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª —Å–æ–æ–±—â–µ–Ω–∏—è, committed offset=1000
2. --- –°–ë–û–ô ---
3. Consumer —Ä–µ—Å—Ç–∞—Ä—Ç—É–µ—Ç
4. –ß–∏—Ç–∞–µ—Ç committed offset –∏–∑ Kafka
5. –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å offset=1000

–ï—Å–ª–∏ consumer –æ–±—Ä–∞–±–æ—Ç–∞–ª msg 1000-1050, –Ω–æ –Ω–µ —É—Å–ø–µ–ª commit:
  ‚Üí –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—á–Ω—ë—Ç —Å 1000
  ‚Üí msg 1000-1050 –æ–±—Ä–∞–±–æ—Ç–∞—é—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ (at-least-once)
```

–ì–∞—Ä–∞–Ω—Ç–∏–∏:
- At-least-once delivery (—Å–æ–æ–±—â–µ–Ω–∏—è –º–æ–≥—É—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ)
- –ù–µ –ø–æ—Ç–µ—Ä—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è (–µ—Å–ª–∏ offset committed –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)

**Redis: AOF recovery**

Redis —Å AOF –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è:
```
--- –°–ë–û–ô ---

1. Redis —Å—Ç–∞—Ä—Ç—É–µ—Ç
2. –ß–∏—Ç–∞–µ—Ç AOF —Ñ–∞–π–ª (–ª–æ–≥ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥)
3. Replay –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥ –≤ –ø–æ—Ä—è–¥–∫–µ

AOF —Ñ–∞–π–ª:
  SET key1 "value1"
  SET key2 "value2"
  DEL key1
  INCR counter
  ...

Recovery:
  –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã ‚Üí —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
```

–í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ AOF —Ñ–∞–π–ª–∞
- –ë–æ–ª—å—à–æ–π AOF (–≥–∏–≥–∞–±–∞–π—Ç—ã) = –¥–æ–ª–≥–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (–º–∏–Ω—É—Ç—ã)

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: AOF rewrite (–∫–æ–º–ø–∞–∫—Ç–Ω—ã–π AOF –±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –∫–æ–º–∞–Ω–¥).

**RabbitMQ: Durable queues recovery**

RabbitMQ —Å durable queues:
```
–û—á–µ—Ä–µ–¥—å: orders (durable=true)
–°–æ–æ–±—â–µ–Ω–∏—è: [msg1, msg2, msg3] (persistent)

--- –°–ë–û–ô ---

Recovery:
1. RabbitMQ —á–∏—Ç–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å —Å –¥–∏—Å–∫–∞
2. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è [msg1, msg2, msg3]
3. Consumers –º–æ–≥—É—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É
```

Non-durable queues:
- –û—á–µ—Ä–µ–¥—å —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ
- –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—Ç–µ—Ä—è–Ω—ã

**ClickHouse: Distributed table recovery**

ClickHouse distributed table:
```
–¢–∞–±–ª–∏—Ü–∞: events
–®–∞—Ä–¥—ã: shard1, shard2, shard3

Shard1 –ø–∞–¥–∞–µ—Ç:
  1. ClickHouse –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ ‚Üí timeout
  2. –î–∞–Ω–Ω—ã–µ –±—É—Ñ–µ—Ä–∏–∑–∏—Ä—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (distributed_directory_monitor)
  3. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ retry –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ shard1

Shard1 –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è:
  1. ClickHouse –≤–∏–¥–∏—Ç, —á—Ç–æ shard1 –¥–æ—Å—Ç—É–ø–µ–Ω
  2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –±—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  3. –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (—Å –∑–∞–¥–µ—Ä–∂–∫–æ–π)
```

### üî• –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç: "–î–æ–ª–≥–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ PostgreSQL"**

–ë–∞–∑–∞ PostgreSQL —É–ø–∞–ª–∞, –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ:
```
2025-01-15 10:00:00 LOG: database system was interrupted
2025-01-15 10:00:01 LOG: starting crash recovery
2025-01-15 10:00:01 LOG: redo starts at 5F/12000028
...
2025-01-15 11:30:00 LOG: redo done at 5F/F8000028
2025-01-15 11:30:05 LOG: database system is ready to accept connections

Recovery –∑–∞–Ω—è–ª–æ 1.5 —á–∞—Å–∞!
```

–ü—Ä–∏—á–∏–Ω–∞:
- Checkpoint –¥–µ–ª–∞–ª—Å—è —Ä–µ–¥–∫–æ (checkpoint_timeout=1 hour)
- –ú–µ–∂–¥—É checkpoint –∏ —Å–±–æ–µ–º –ø—Ä–æ—à–ª–æ 50 –º–∏–Ω—É—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–ø–∏—Å–∏
- –û–≥—Ä–æ–º–Ω—ã–π WAL –¥–ª—è replay

–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:
- –ë–∞–∑–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ 1.5 —á–∞—Å–∞
- –ö–ª–∏–µ–Ω—Ç—ã –Ω–µ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- –ü–æ—Ç–µ—Ä—è revenue

–†–µ—à–µ–Ω–∏–µ:
- –£–º–µ–Ω—å—à–∏—Ç—å checkpoint_timeout (30 –º–∏–Ω—É—Ç –≤–º–µ—Å—Ç–æ 1 —á–∞—Å–∞)
- –ò–ª–∏: —É–≤–µ–ª–∏—á–∏—Ç—å max_wal_size (checkpoint —á–∞—â–µ)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: –∞–ª–µ—Ä—Ç –µ—Å–ª–∏ recovery time > X –º–∏–Ω—É—Ç

**–ü—Ä–æ–±–ª–µ–º–∞: "Kafka consumer stuck –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º recovery"**

Consumer –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–±–æ—è:
```
1. –ß–∏—Ç–∞–µ—Ç committed offset=1000
2. –ü—ã—Ç–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å msg 1000
3. –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ (poison message - –±–∏—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ)
4. Consumer –ø–∞–¥–∞–µ—Ç
5. –†–µ—Å—Ç–∞—Ä—Ç—É–µ—Ç ‚Üí —á–∏—Ç–∞–µ—Ç offset=1000
6. –°–Ω–æ–≤–∞ –æ—à–∏–±–∫–∞ –Ω–∞ msg 1000
7. –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª...
```

–û—á–µ—Ä–µ–¥—å –∑–∞—Å—Ç—Ä—è–ª–∞: msg 1000 –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ.

–†–µ—à–µ–Ω–∏–µ:
- Dead Letter Queue (DLQ): –æ—Ç–ø—Ä–∞–≤–∏—Ç—å poison message –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å
- Skip: —Ä—É—á–Ω–æ–π commit offset=1001 (–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å msg 1000)
- Fix and retry: –∏—Å–ø—Ä–∞–≤–∏—Ç—å consumer logic, —á—Ç–æ–±—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞: "RabbitMQ –ø–æ—Ç–µ—Ä—è–ª —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏"**

RabbitMQ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:
```
–û—á–µ—Ä–µ–¥—å: orders (durable=false)  ‚Üê –Ω–µ durable!
–°–æ–æ–±—â–µ–Ω–∏—è: persistent (delivery_mode=2)
```

–°–±–æ–π ‚Üí RabbitMQ —Ä–µ—Å—Ç–∞—Ä—Ç:
```
–û—á–µ—Ä–µ–¥—å "orders" –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (durable=false)
‚Üí –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—Ç–µ—Ä—è–Ω—ã
```

–û—à–∏–±–∫–∞: inconsistent –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (persistent —Å–æ–æ–±—â–µ–Ω–∏—è –≤ non-durable –æ—á–µ—Ä–µ–¥–∏).

–ü—Ä–∞–≤–∏–ª—å–Ω–æ:
- durable=true –¥–ª—è –æ—á–µ—Ä–µ–¥–∏
- delivery_mode=2 –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç: "ClickHouse –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ —Å–±–æ—è"**

ClickHouse —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:
```
Engine = MergeTree()
ORDER BY (date, user_id)
```

–ü–æ—Å–ª–µ —Å–±–æ—è —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø–æ—Ç–µ—Ä—è–Ω–∞. –ü—Ä–∏—á–∏–Ω–∞: async INSERT.

```
INSERT INTO events VALUES (...);
‚Üê –û—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É: "OK"

--- –°–ë–û–ô –¥–æ fsync ---

–î–∞–Ω–Ω—ã–µ –≤ RAM, –Ω–µ –Ω–∞ –¥–∏—Å–∫–µ ‚Üí –ø–æ—Ç–µ—Ä—è–Ω—ã
```

ClickHouse –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
- INSERT –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç OK –¥–æ fsync)
- –î–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–†–µ—à–µ–Ω–∏–µ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
- `insert_quorum=2` (–∂–¥–∞—Ç—å –∑–∞–ø–∏—Å–∏ –Ω–∞ 2 —Ä–µ–ø–ª–∏–∫–∏)
- `insert_quorum_timeout` (—Ç–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è)

### üõ† –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å recovery semantics

**–ü—Ä–∏–Ω—Ü–∏–ø 1: –û–ø—Ä–µ–¥–µ–ª–∏ Recovery Time Objective (RTO)**

RTO = –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø—Ä–∏–µ–º–ª–µ–º–æ–µ –≤—Ä–µ–º—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏.

–ü—Ä–∏–º–µ—Ä—ã:
- –ö—Ä–∏—Ç–∏—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂–Ω—ã–π —Å–µ—Ä–≤–∏—Å: RTO = 5 –º–∏–Ω—É—Ç
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π dashboard: RTO = 1 —á–∞—Å
- –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –ë–î: RTO = 4 —á–∞—Å–∞

–ü—Ä–æ–µ–∫—Ç–∏—Ä—É–π recovery, —á—Ç–æ–±—ã —É–ª–æ–∂–∏—Ç—å—Å—è –≤ RTO:
- –ß–∞—Å—Ç—ã–µ checkpoint (–º–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è replay)
- Fast storage (SSD, NVMe –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ replay)
- Replication (failover –Ω–∞ —Ä–µ–ø–ª–∏–∫—É –≤–º–µ—Å—Ç–æ recovery)

**–ü—Ä–∏–Ω—Ü–∏–ø 2: –û–ø—Ä–µ–¥–µ–ª–∏ Recovery Point Objective (RPO)**

RPO = –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–∏–µ–º–ª–µ–º–∞—è –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö.

–ü—Ä–∏–º–µ—Ä—ã:
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: RPO = 0 (zero data loss)
- –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π: RPO = 5 –º–∏–Ω—É—Ç
- –ú–µ—Ç—Ä–∏–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: RPO = 1 –º–∏–Ω—É—Ç–∞

–ü—Ä–æ–µ–∫—Ç–∏—Ä—É–π –¥–ª—è RPO:
- RPO=0: —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è, fsync –Ω–∞ –∫–∞–∂–¥—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
- RPO=5 –º–∏–Ω—É—Ç: checkpoint –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- RPO=1 —á–∞—Å: snapshot –∫–∞–∂–¥—ã–π —á–∞—Å

**–ü—Ä–∏–Ω—Ü–∏–ø 3: Automatic vs Manual recovery**

Automatic recovery:
- –°–∏—Å—Ç–µ–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å–∞–º–∞ (Postgres crash recovery)
- –ë—ã—Å—Ç—Ä–æ
- –†–∏—Å–∫: –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

Manual recovery:
- –¢—Ä–µ–±—É–µ—Ç –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ —á–µ–ª–æ–≤–µ–∫–∞
- –ú–µ–¥–ª–µ–Ω–Ω–æ
- –ö–æ–Ω—Ç—Ä–æ–ª—å: —á–µ–ª–æ–≤–µ–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å

–°—Ç—Ä–∞—Ç–µ–≥–∏—è:
- Automatic –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–±–æ–µ–≤ (crashes, network)
- Manual –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π (data corruption, security breach)

**–ü—Ä–∏–Ω—Ü–∏–ø 4: Idempotent recovery**

Recovery –º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑:
- –ü–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ failed ‚Üí –ø–æ–≤—Ç–æ—Ä—è–µ–º
- –û–ø–µ—Ä–∞—Ü–∏–∏ recovery –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º–∏

–ü—Ä–∏–º–µ—Ä:
- ‚ùå `balance += 100` (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π replay —É–¥–≤–æ–∏—Ç)
- ‚úÖ `balance = 100` (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π replay = —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç)

**–ü—Ä–∏–Ω—Ü–∏–ø 5: –¢–µ—Å—Ç–∏—Ä—É–π recovery —Ä–µ–≥—É–ª—è—Ä–Ω–æ**

Chaos engineering:
- –°–∏–º—É–ª–∏—Ä—É–π —Å–±–æ–∏ –≤ production-like –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- Kill –ø—Ä–æ—Ü–µ—Å—Å—ã —Å–ª—É—á–∞–π–Ω–æ
- –û—Ç–∫–ª—é—á–∞–π –¥–∏—Å–∫–∏, —Å–µ—Ç—å
- –ü—Ä–æ–≤–µ—Ä—è–π, —á—Ç–æ recovery —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

Netflix: Chaos Monkey —É–±–∏–≤–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã –≤ production.

–ú–µ—Ç—Ä–∏–∫–∏ recovery:
- –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω—è–ª recovery?
- –í—Å–µ –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã?
- –ë—ã–ª–∏ –ª–∏ –æ—à–∏–±–∫–∏?

**–ü—Ä–∏–Ω—Ü–∏–ø 6: Graceful degradation**

–ï—Å–ª–∏ recovery –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω:
- –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ fail gracefully
- –ù–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å corrupted –¥–∞–Ω–Ω—ã–µ
- –ê–ª–µ—Ä—Ç–∏—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤

–ü—Ä–∏–º–µ—Ä: Postgres –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç, –µ—Å–ª–∏ WAL corrupted ‚Üí –ª—É—á—à–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å, —á–µ–º corrupted –¥–∞–Ω–Ω—ã–µ.

---

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –°–µ–º–∞–Ω—Ç–∏–∫–∞ | –ì–¥–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ | –ü–µ—Ä–µ–∂–∏–≤–∞–µ—Ç —Å–±–æ–π | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –¢–∏–ø–∏—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|-----------|---------------|-----------------|-------------------|-----------|------------------------|
| **Stateless** | –ù–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è | N/A | ‚ö°‚ö°‚ö° –í—ã—Å–æ–∫–∞—è | ‚úÖ –ü—Ä–æ—Å—Ç–∞—è | REST API, reverse proxy, stateless –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã |
| **Stateful** | –í –ø—Ä–æ—Ü–µ—Å—Å–µ/–Ω–∞ —É–∑–ª–µ | ‚ùå –ù–µ—Ç (–±–µ–∑ –¥–æ–ø. –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤) | ‚ö°‚ö° –°—Ä–µ–¥–Ω—è—è | ‚ö†Ô∏è –°—Ä–µ–¥–Ω—è—è | WebSocket —Å–µ—Ä–≤–µ—Ä—ã, Kafka consumers, TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è |
| **Ephemeral** | RAM (–ø–∞–º—è—Ç—å) | ‚ùå –ù–µ—Ç | ‚ö°‚ö°‚ö° –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è | ‚úÖ –ü—Ä–æ—Å—Ç–∞—è | –ö—ç—à–∏, —Å–µ—Å—Å–∏–∏, rate limiting, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| **Durable** | –î–∏—Å–∫/–ë–î | ‚úÖ –î–∞ | ‚ö° –ù–∏–∑–∫–∞—è-—Å—Ä–µ–¥–Ω—è—è | ‚ö†Ô∏è –°—Ä–µ–¥–Ω—è—è | –ë–î (Postgres, MongoDB), Kafka logs, persistent queues |
| **Checkpoint** | –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –Ω–∞ –¥–∏—Å–∫ | ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ (–¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ checkpoint) | ‚ö°‚ö° –°—Ä–µ–¥–Ω—è—è | ‚ö†Ô∏è –°—Ä–µ–¥–Ω—è—è | Stream processing (Flink), batch jobs, consumer offsets |
| **Snapshot** | –ü–æ–ª–Ω–∞—è –∫–æ–ø–∏—è –Ω–∞ –¥–∏—Å–∫ | ‚úÖ –î–∞ (–Ω–∞ –º–æ–º–µ–Ω—Ç snapshot) | ‚ö° –ù–∏–∑–∫–∞—è (–ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏) | ‚ö†Ô∏è‚ö†Ô∏è –í—ã—Å–æ–∫–∞—è | Backups, VM snapshots, DB dumps, disaster recovery |
| **State Recovery** | –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ durable/checkpoint/snapshot | ‚úÖ –î–∞ | ‚ö° –ù–∏–∑–∫–∞—è (–≤–æ –≤—Ä–µ–º—è recovery) | ‚ö†Ô∏è‚ö†Ô∏è –í—ã—Å–æ–∫–∞—è | Crash recovery, failover, disaster recovery |

---

## –ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å–µ–º–∞–Ω—Ç–∏–∫

–í —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö —á–∞—Å—Ç–æ –∫–æ–º–±–∏–Ω–∏—Ä—É—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–º–∞–Ω—Ç–∏–∫:

### 1. Stateless API + Stateful Backend

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
[Stateless API Servers] ‚Üí [Stateful Database]
       |                          |
   (–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ)        (—Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
```

**–ü—Ä–∏–º–µ—Ä:**
- API —Å–µ—Ä–≤–µ—Ä—ã: stateless, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å/—É–±–∏—Ä–∞—Ç—å
- PostgreSQL: stateful, —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ API
- –î–∞–Ω–Ω—ã–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ durable

### 2. Ephemeral Cache + Durable Storage

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
[Redis Cache] ‚Üí [PostgreSQL]
   ephemeral      durable
```

**–ü—Ä–∏–º–µ—Ä:**
```
1. –ó–∞–ø—Ä–æ—Å: GET /user/123
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Redis ‚Üí cache miss
3. –ß–∏—Ç–∞—Ç—å –∏–∑ PostgreSQL
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Redis (TTL=5 –º–∏–Ω—É—Ç)
5. –í–µ—Ä–Ω—É—Ç—å –∫–ª–∏–µ–Ω—Ç—É

–°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å:
1. GET /user/123
2. Redis ‚Üí cache hit ‚Üí –≤–µ—Ä–Ω—É—Ç—å (–±—ã—Å—Ç—Ä–æ)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (cache)
- –î–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è (durable storage)

### 3. Stateful Processing + Checkpoints

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
[Stateful Stream Processor]
  ‚îú‚îÄ In-memory state (fast)
  ‚îî‚îÄ Periodic checkpoints (durable)
```

**–ü—Ä–∏–º–µ—Ä:** Apache Flink
- State –≤ –ø–∞–º—è—Ç–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- Checkpoint –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
- –ü—Ä–∏ —Å–±–æ–µ: –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ checkpoint

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- Bounded data loss (–º–∞–∫—Å–∏–º—É–º 60 —Å–µ–∫)

### 4. Durable State + Snapshots

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
[PostgreSQL]
  ‚îú‚îÄ WAL (continuous durable state)
  ‚îî‚îÄ Daily snapshots (point-in-time recovery)
```

**–ü—Ä–∏–º–µ—Ä:**
- –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º WAL
- –ö–∞–∂–¥—ã–π –¥–µ–Ω—å: full snapshot
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: snapshot + WAL —Å –º–æ–º–µ–Ω—Ç–∞ snapshot

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- Zero data loss (WAL)
- –ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (snapshot + –∫–æ—Ä–æ—Ç–∫–∏–π WAL)

### 5. Stateful + Replication –¥–ª—è High Availability

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
[Primary Node (stateful)] ‚Üí [Replica Node (stateful)]
```

**–ü—Ä–∏–º–µ—Ä:** PostgreSQL streaming replication
- Primary: –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã, —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- Replica: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å Primary
- Primary –ø–∞–¥–∞–µ—Ç ‚Üí failover –Ω–∞ Replica

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–∏–∑–∫–∏–π RTO (failover –±—ã—Å—Ç—Ä–µ–µ recovery)
- RPO –±–ª–∏–∑–æ–∫ –∫ –Ω—É–ª—é (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è)

---

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –í—ã–±–æ—Ä —Å–µ–º–∞–Ω—Ç–∏–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–í–æ–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è:**

| –í–æ–ø—Ä–æ—Å | Stateless | Stateful | Ephemeral | Durable |
|--------|-----------|----------|-----------|---------|
| –ú–æ–∂–Ω–æ –ª–∏ –ø–æ—Ç–µ—Ä—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ? | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç | ‚ö†Ô∏è –ò–Ω–æ–≥–¥–∞ | ‚ùå –ù–µ—Ç |
| –ù—É–∂–Ω–∞ –ª–∏ –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å? | ‚úÖ –î–∞ | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç |
| –ù—É–∂–Ω–æ –ª–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ? | ‚úÖ –õ–µ–≥–∫–æ | ‚ùå –°–ª–æ–∂–Ω–æ | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ | ‚ùå –°–ª–æ–∂–Ω–æ |
| –ö—Ä–∏—Ç–∏—á–Ω—ã –ª–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞? | N/A | ‚ö†Ô∏è –ó–∞–≤–∏—Å–∏—Ç | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |

### 2. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏

**Checklist:**
- [ ] –û–ø—Ä–µ–¥–µ–ª—ë–Ω RTO (Recovery Time Objective)
- [ ] –û–ø—Ä–µ–¥–µ–ª—ë–Ω RPO (Recovery Point Objective)
- [ ] –ï—Å—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º recovery (checkpoint/snapshot/replication)
- [ ] Recovery –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ê–ª–µ—Ä—Ç—ã –Ω–∞ —Å–±–æ–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ recovery –ø—Ä–æ—Ü–µ–¥—É—Ä–µ

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è stateful —Å–µ—Ä–≤–∏—Å–æ–≤:**
- Memory usage (—Ä–æ—Å—Ç ‚Üí –≤–æ–∑–º–æ–∂–Ω–∞—è —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏)
- State size (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π/—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)
- Checkpoint duration (—Ä–æ—Å—Ç ‚Üí –ø—Ä–æ–±–ª–µ–º—ã —Å I/O)
- Recovery time (–ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ)

**–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è durable storage:**
- Disk I/O latency (—Ä–æ—Å—Ç ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ —Å –¥–∏—Å–∫–æ–º)
- WAL/log size (—Ä–æ—Å—Ç ‚Üí —Ä–µ–¥–∫–∏–µ checkpoints)
- Replication lag (–æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ —Ä–µ–ø–ª–∏–∫–∏)

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏

**Chaos Engineering –ø—Ä–∞–∫—Ç–∏–∫–∏:**
- Kill –ø—Ä–æ—Ü–µ—Å—Å—ã —Å–ª—É—á–∞–π–Ω–æ (Chaos Monkey)
- –°–∏–º—É–ª–∏—Ä—É–π —Å–µ—Ç–µ–≤—ã–µ —Ä–∞–∑—Ä—ã–≤—ã (Chaos Network)
- –ó–∞–ø–æ–ª–Ω–∏ –¥–∏—Å–∫ (Chaos Disk)
- –°–∏–º—É–ª–∏—Ä—É–π –º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–∏—Å–∫–∏ (latency injection)

**Recovery Drills:**
- –†–µ–≥—É–ª—è—Ä–Ω–æ (–µ–∂–µ–º–µ—Å—è—á–Ω–æ) –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Å—è –∏–∑ backup
- –ó–∞–º–µ—Ä—è–π RTO/RPO –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ
- –ü—Ä–æ–≤–µ—Ä—è–π, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

### 5. –≠–≤–æ–ª—é—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–ü—É—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:**
```
Stateless ‚Üí Stateful ‚Üí Durable
```

**–ü—Ä–∏–º–µ—Ä:**
1. –ù–∞—á–∞–ª–æ: stateless API (–ø—Ä–æ—Å—Ç–æ—Ç–∞)
2. –†–æ—Å—Ç: –¥–æ–±–∞–≤–ª—è–µ–º Redis cache (ephemeral state –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
3. –ú–∞—Å—à—Ç–∞–±: –¥–æ–±–∞–≤–ª—è–µ–º PostgreSQL (durable state –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
4. –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å: –¥–æ–±–∞–≤–ª—è–µ–º replication (high availability)
5. Disaster recovery: –¥–æ–±–∞–≤–ª—è–µ–º snapshots + WAL archiving

–ù–µ –ø—ã—Ç–∞–π—Å—è –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –≤—Å—ë —Å—Ä–∞–∑—É ‚Äî —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É–π –ø–æ –º–µ—Ä–µ —Ä–æ—Å—Ç–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π.

---

## –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∫–∞–∫ –∏—Ö –∏–∑–±–µ–∂–∞—Ç—å

### 1. –•—Ä–∞–Ω–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ ephemeral state

**–û—à–∏–±–∫–∞:**
```
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–∫—É–ø–æ–∫ –≤ Redis –±–µ–∑ persistence
redis_config: {persistence: disabled}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –†–µ—Å—Ç–∞—Ä—Ç Redis ‚Üí –≤—Å–µ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ—Ç–µ—Ä—è–Ω—ã
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–µ—Ä—è—é—Ç —Ç–æ–≤–∞—Ä—ã ‚Üí —É—Ö–æ–¥—è—Ç –∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º

**–ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å:**
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∫–æ—Ä–∑–∏–Ω—ã, –∑–∞–∫–∞–∑—ã, –ø–ª–∞—Ç–µ–∂–∏) ‚Üí durable storage
- Ephemeral —Ç–æ–ª—å–∫–æ –¥–ª—è "–º–æ–∂–Ω–æ –ø–æ—Ç–µ—Ä—è—Ç—å" (–∫—ç—à–∏, rate limits)

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ checkpoint/snapshot

**–û—à–∏–±–∫–∞:**
```
Durable state –±–µ–∑ checkpoints
WAL —Ä–∞—Å—Ç—ë—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
Recovery —á–∏—Ç–∞–µ—Ç WAL —Å –Ω–∞—á–∞–ª–∞ –≤—Ä–µ–º—ë–Ω
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- Recovery –∑–∞–Ω–∏–º–∞–µ—Ç —á–∞—Å—ã
- –î–∏—Å–∫ –ø–µ—Ä–µ–ø–æ–ª–Ω—è–µ—Ç—Å—è WAL —Ñ–∞–π–ª–∞–º–∏

**–ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å:**
- –ù–∞—Å—Ç—Ä–æ–π periodic checkpoints
- Retention policy –¥–ª—è WAL (—É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ)

### 3. Inconsistent distributed snapshot

**–û—à–∏–±–∫–∞:**
```
3 —É–∑–ª–∞ –¥–µ–ª–∞—é—Ç snapshot –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
Snapshot –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è ‚Üí inconsistent state
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ snapshot ‚Üí corrupted –¥–∞–Ω–Ω—ã–µ
- –ù–∞—Ä—É—à–µ–Ω–∏–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—É–º–º–∞ –±–∞–ª–∞–Ω—Å–æ–≤)

**–ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å:**
- Coordinated snapshots (–≤—Å–µ —É–∑–ª—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
- –ê–ª–≥–æ—Ä–∏—Ç–º—ã: Chandy-Lamport, barrier-based

### 4. –ù–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è recovery

**–û—à–∏–±–∫–∞:**
```
–î–µ–ª–∞–µ–º backups –µ–∂–µ–¥–Ω–µ–≤–Ω–æ
–ù–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–æ–±—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- Disaster –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç ‚Üí –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ–º, —á—Ç–æ backup corrupted
- RTO –≤ 5 –º–∏–Ω—É—Ç –Ω–∞ –±—É–º–∞–≥–µ ‚Üí 5 —á–∞—Å–æ–≤ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ

**–ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å:**
- –ï–∂–µ–º–µ—Å—è—á–Ω–æ: –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup –≤ —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã recovery
- Chaos engineering (—Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å–±–æ–∏ –≤ —Ç–µ—Å—Ç–∞—Ö)

### 5. –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ RTO/RPO

**–û—à–∏–±–∫–∞:**
```
"–£ –Ω–∞—Å –µ—Å—Ç—å backups, –∑–Ω–∞—á–∏—Ç –º—ã –∑–∞—â–∏—â–µ–Ω—ã"
RTO –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω, RPO –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –°–±–æ–π ‚Üí —Ö–∞–æ—Å (—Å–∫–æ–ª—å–∫–æ –∂–¥–∞—Ç—å recovery?)
- –ö–ª–∏–µ–Ω—Ç—ã –Ω–µ–¥–æ–≤–æ–ª—å–Ω—ã (–æ–∂–∏–¥–∞–ª–∏ 5 –º–∏–Ω—É—Ç, –ø–æ–ª—É—á–∏–ª–∏ 2 —á–∞—Å–∞)

**–ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å:**
- –Ø–≤–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏ RTO/RPO –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- –ü—Ä–æ–µ–∫—Ç–∏—Ä—É–π recovery –ø–æ–¥ —ç—Ç–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- SLA –¥–æ–ª–∂–µ–Ω –æ—Ç—Ä–∞–∂–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ RTO/RPO

### 6. Sticky sessions –±–µ–∑ graceful shutdown

**–û—à–∏–±–∫–∞:**
```
Stateful WebSocket —Å–µ—Ä–≤–µ—Ä
Sticky sessions (–∫–ª–∏–µ–Ω—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —É–∑–ª—É)
–î–µ–ø–ª–æ–π ‚Üí —É–∑–µ–ª —É–±–∏–≤–∞–µ—Ç—Å—è ‚Üí –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Ä–∞–∑—Ä—ã–≤–∞—é—Ç—Å—è
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ö–ª–∏–µ–Ω—Ç—ã —Ç–µ—Ä—è—é—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –¢–µ—Ä—è—é—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç/—Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å:**
- Graceful shutdown: –¥–∞–π time –¥–ª—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ü—Ä–µ–¥—É–ø—Ä–µ–¥–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ –∑–∞–∫—Ä—ã—Ç–∏–∏ (WebSocket close frame)
- Externalize state: —Ö—Ä–∞–Ω–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ Redis, –Ω–µ in-memory

### 7. –†–µ–¥–∫–∏–µ fsync –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–û—à–∏–±–∫–∞:**
```
Kafka: log.flush.interval.messages=100000
–ü–ª–∞—Ç—ë–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –º–æ–≥—É—Ç –ø–æ—Ç–µ—Ä—è—Ç—å—Å—è –ø—Ä–∏ —Å–±–æ–µ
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –°–±–æ–π ‚Üí –ø–æ—Ç–µ—Ä—è –ø–ª–∞—Ç–µ–∂–µ–π ‚Üí —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏

**–ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å:**
- –î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π fsync (acks=all, min.insync.replicas=2)
- –ü—Ä–∏–µ–º–ª–µ–º—ã–π trade-off: latency vs durability

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**State Semantics** ‚Äî —ç—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∞—Å–ø–µ–∫—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π, –∫–∞–∫ —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–∏—Ç, —É–ø—Ä–∞–≤–ª—è–µ—Ç –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä —Å–µ–º–∞–Ω—Ç–∏–∫–∏ –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è:

### –ö–ª—é—á–µ–≤—ã–µ takeaways:

1. **Stateless vs Stateful** ‚Äî –ø–µ—Ä–≤—ã–π –≤—ã–±–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:
   - Stateless: –ø—Ä–æ—Å—Ç–æ—Ç–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
   - Stateful: —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –Ω–æ —Å–ª–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

2. **Ephemeral vs Durable** ‚Äî trade-off –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å vs –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å:
   - Ephemeral: —Å–∫–æ—Ä–æ—Å—Ç—å RAM, –Ω–æ —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ
   - Durable: –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç —Å–±–æ–∏

3. **Checkpoint vs Snapshot** ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è:
   - Checkpoint: –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏, –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ—Ç–µ—Ä—å
   - Snapshot: –ø–æ–ª–Ω–∞—è –∫–æ–ø–∏—è, –¥–ª—è backups –∏ recovery

4. **State Recovery** ‚Äî –∫–∞–∫ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è –ø–æ—Å–ª–µ —Å–±–æ—è:
   - RTO/RPO –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
   - Automatic vs manual recovery
   - –¢–µ—Å—Ç–∏—Ä—É–π recovery —Ä–µ–≥—É–ª—è—Ä–Ω–æ

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥:

**–ù–∞—á–Ω–∏ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ:**
- Stateless –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- –î–æ–±–∞–≤–ª—è–π state —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
- –ò—Å–ø–æ–ª—å–∑—É–π managed —Å–µ—Ä–≤–∏—Å—ã (–º–µ–Ω—å—à–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º)

**–≠–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É–π –ø–æ –º–µ—Ä–µ —Ä–æ—Å—Ç–∞:**
- –î–æ–±–∞–≤–ª—è–π caching (ephemeral state)
- –î–æ–±–∞–≤–ª—è–π checkpoints (bounded data loss)
- –î–æ–±–∞–≤–ª—è–π replication (high availability)

**–í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä—É–π:**
- Chaos engineering
- Recovery drills
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

### –ü–æ–º–Ω–∏:

> "State ‚Äî —ç—Ç–æ —Å–ª–æ–∂–Ω–æ—Å—Ç—å. –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π state, –Ω–æ –æ–±–µ—Å–ø–µ—á—å –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å —Ç–æ–≥–æ state, –∫–æ—Ç–æ—Ä—ã–π –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è –±–∏–∑–Ω–µ—Å–∞."

–£–¥–∞—á–∏ –≤ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –Ω–∞–¥—ë–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º! üöÄ
