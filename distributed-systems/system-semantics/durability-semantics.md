# Durability Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –î–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç–∏ –î–∞–Ω–Ω—ã—Ö)

## –í–≤–µ–¥–µ–Ω–∏–µ

**Durability Semantics** (—Å–µ–º–∞–Ω—Ç–∏–∫–∞ –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç–∏) ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä –≥–∞—Ä–∞–Ω—Ç–∏–π, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏—Ö –∫–æ–≥–¥–∞ –∏ –ø—Ä–∏ –∫–∞–∫–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º–∏ –∏ –ø–µ—Ä–µ–∂–∏–≤–∞—é—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã —Å–±–æ–µ–≤.

–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—à—å –≤–∞–∂–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–µ. –ü–æ—è–≤–∏–ª–∞—Å—å –≥–∞–ª–æ—á–∫–∞ "–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ". –ù–æ —á—Ç–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ?
- –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ –ø–æ–ø–∞–ª–æ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–º—è—Ç—å —Å–µ—Ä–≤–µ—Ä–∞?
- –ó–∞–ø–∏—Å–∞–ª–æ—Å—å –Ω–∞ –¥–∏—Å–∫?
- –ü—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞–ª–æ—Å—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤?
- –†–∞–∑–ª–µ—Ç–µ–ª–æ—Å—å –ø–æ –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–∞–º –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∞—Ö?

–û—Ç –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —ç—Ç–∏ –≤–æ–ø—Ä–æ—Å—ã –∑–∞–≤–∏—Å–∏—Ç, –ø–æ—Ç–µ—Ä—è–µ—à—å –ª–∏ —Ç—ã —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏:
- üî• –°–µ—Ä–≤–µ—Ä –≤–Ω–µ–∑–∞–ø–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
- ‚ö° –ü—Ä–æ–ø–∞–¥—ë—Ç —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ –≤ –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–µ
- üíæ –î–∏—Å–∫ –≤—ã–π–¥–µ—Ç –∏–∑ —Å—Ç—Ä–æ—è
- üåä –ü—Ä–æ–∏–∑–æ–π–¥—ë—Ç –∑–∞—Ç–æ–ø–ª–µ–Ω–∏–µ –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–∞
- ‚ò¢Ô∏è –¶–µ–ª—ã–π —Ä–µ–≥–∏–æ–Ω —Å—Ç–∞–Ω–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

Durability (–¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å) ‚Äî —ç—Ç–æ –±—É–∫–≤–∞ "D" –≤ ACID. –û–Ω–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∏—Å—á–µ–∑–Ω—É—Ç. –ù–æ —É—Ä–æ–≤–µ–Ω—å —ç—Ç–æ–π –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Å–∏–ª—å–Ω–æ –≤–∞—Ä—å–∏—Ä—É–µ—Ç—Å—è.

**–ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ?**

–í —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö (Kafka, Postgres, Redis, MongoDB, RabbitMQ) –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ durability –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:
- üí∏ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–º –ø–æ—Ç–µ—Ä—è–º (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏—Å—á–µ–∑–ª–∏)
- üìß –ü–æ—Ç–µ—Ä–µ —Å–æ–æ–±—â–µ–Ω–∏–π (–æ—á–µ—Ä–µ–¥—å —Å–∫–∞–∑–∞–ª–∞ "–ø—Ä–∏–Ω—è—Ç–æ", –Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏—Å–ø–∞—Ä–∏–ª–æ—Å—å)
- üìä –ü–æ—Ç–µ—Ä–µ –º–µ—Ç—Ä–∏–∫ –∏ –ª–æ–≥–æ–≤ (–¥—É–º–∞–ª–∏ –∑–∞–ø–∏—Å–∞–ª–æ—Å—å, –Ω–æ –Ω–µ—Ç)
- üîÑ –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- üò± –ü–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ (–∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π)

**–ì–ª–∞–≤–Ω—ã–π trade-off –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç–∏:**
```
–í—ã—à–µ –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å = –ë–æ–ª—å—à–µ –≥–∞—Ä–∞–Ω—Ç–∏–π = –ë–æ–ª—å—à–µ latency = –ù–∏–∂–µ throughput
–ù–∏–∂–µ –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å = –ú–µ–Ω—å—à–µ –≥–∞—Ä–∞–Ω—Ç–∏–π = –ú–µ–Ω—å—à–µ latency = –í—ã—à–µ throughput
```

**–°–ø–µ–∫—Ç—Ä –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç–∏:**
```
In-memory ‚Üí Local disk ‚Üí WAL ‚Üí Fsync ‚Üí Replicated ‚Üí Quorum ‚Üí Geo-replicated
(volatile)     (single point     (durable   (multiple   (globally
               of failure)        locally)   regions)    durable)

‚Üë –°–∫–æ—Ä–æ—Å—Ç—å, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
‚Üì –ì–∞—Ä–∞–Ω—Ç–∏–∏, –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å
```

---

## 1. In-memory Durability (Volatile) ‚Äî –≠–Ω–µ—Ä–≥–æ–∑–∞–≤–∏—Å–∏–º–∞—è –ü–∞–º—è—Ç—å

### –ß—Ç–æ —ç—Ç–æ?

**In-memory durability** (—ç–Ω–µ—Ä–≥–æ–∑–∞–≤–∏—Å–∏–º–∞—è –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å) ‚Äî –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ (RAM) –∏ –∏—Å—á–µ–∑–∞—é—Ç –ø—Ä–∏ –ª—é–±–æ–º —Å–±–æ–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞.

**–ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
- ‚úÖ –î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã, –ø–æ–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å –∏ —á—Ç–µ–Ω–∏–µ (–Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥—ã)
- ‚úÖ –ù–µ—Ç IO overhead (–Ω–µ –Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å –¥–∏—Å–∫)

**–ß–µ–≥–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
- ‚ùå –î–∞–Ω–Ω—ã–µ –ù–ï –ø–µ—Ä–µ–∂–∏–≤—É—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–æ—Ü–µ—Å—Å–∞
- ‚ùå –î–∞–Ω–Ω—ã–µ –ù–ï –ø–µ—Ä–µ–∂–∏–≤—É—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É —Å–µ—Ä–≤–µ—Ä–∞
- ‚ùå –î–∞–Ω–Ω—ã–µ –ù–ï –ø–µ—Ä–µ–∂–∏–≤—É—Ç —Å–±–æ–π –ø–∏—Ç–∞–Ω–∏—è
- ‚ùå –î–∞–Ω–Ω—ã–µ –ù–ï –ø–µ—Ä–µ–∂–∏–≤—É—Ç OOM kill
- ‚ùå –î–∞–Ω–Ω—ã–µ –ù–ï –ø–µ—Ä–µ–∂–∏–≤—É—Ç kernel panic

### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?

**Redis (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ–∑ RDB/AOF):**
```
> SET user:1234:session "active"
OK  ‚Üê –î–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –≤ RAM!

[–°–ï–†–í–ï–† –£–ü–ê–õ]

> GET user:1234:session
(nil)  ‚Üê –í—Å—ë –ø—Ä–æ–ø–∞–ª–æ!
```

**In-memory –æ—á–µ—Ä–µ–¥—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, Go channel, Java BlockingQueue):**
```
Producer ‚Üí [RAM Queue] ‚Üí Consumer

[–ü–†–û–¶–ï–°–° –£–ü–ê–õ]

‚Üí –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏ –ø–æ—Ç–µ—Ä—è–Ω—ã
```

**Memcached:**
–≠—Ç–æ pure in-memory cache. –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –≤—Å—ë –∏—Å—á–µ–∑–∞–µ—Ç. –≠—Ç–æ –Ω–µ –±–∞–≥, —ç—Ç–æ —Ñ–∏—á–∞ ‚Äî –±—ã—Å—Ç—Ä—ã–π –∫–µ—à, –Ω–µ –±–æ–ª–µ–µ.

### –†–µ–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**1. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
Redis –∫–∞–∫ –∫–µ—à –¥–ª—è —Å–µ—Å—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ï—Å–ª–∏ —Å–µ—Å—Å–∏—è –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è ‚Äî –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å—Ç–æ –∑–∞–Ω–æ–≤–æ –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—Å—è.

**2. Rate limiting counters:**
–°—á—ë—Ç—á–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –ø–∞–º—è—Ç–∏. –ï—Å–ª–∏ —Å–±—Ä–æ—Å—è—Ç—Å—è ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞—á–Ω—ë–º —Å—á–∏—Ç–∞—Ç—å –∑–∞–Ω–æ–≤–æ. –ù–µ –∏–¥–µ–∞–ª—å–Ω–æ, –Ω–æ –ø—Ä–∏–µ–º–ª–µ–º–æ.

**3. Temporary buffers:**
–í—Ä–µ–º–µ–Ω–Ω—ã–µ –±—É—Ñ–µ—Ä—ã –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π. –ü–æ—Ç–µ—Ä—è –æ–¥–Ω–æ–≥–æ –±–∞—Ç—á–∞ –º–µ—Ç—Ä–∏–∫ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞.

**4. Real-time analytics:**
Approximate counters –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤. –¢–æ—á–Ω–æ—Å—Ç—å –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞, –≤–∞–∂–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å.

### –¢–∏–ø–∏—á–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 1: –ü–æ—Ç–µ—Ä—è —Å–µ—Å—Å–∏–π –ø—Ä–∏ –¥–µ–ø–ª–æ–µ**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
–ö–æ–º–ø–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ Redis (in-memory mode) –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–π. –ü—Ä–∏ –¥–µ–ø–ª–æ–µ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª–∏ Redis.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ä–∞–∑–ª–æ–≥–∏–Ω–∏–ª–∏—Å—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –®–∫–≤–∞–ª –æ–±—Ä–∞—â–µ–Ω–∏–π –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
- –ü–ª–æ—Ö–æ–π UX

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis persistence (RDB –∏–ª–∏ AOF)
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å stateless tokens (JWT)

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 2: –ü–æ—Ç–µ—Ä—è –æ—á–µ—Ä–µ–¥–∏ –∑–∞–∫–∞–∑–æ–≤**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
E-commerce —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ in-memory –æ—á–µ—Ä–µ–¥—å (RabbitMQ –±–µ–∑ persistence) –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–æ–≤. –°–µ—Ä–≤–µ—Ä —É–ø–∞–ª.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–æ—Ç–µ—Ä—è–Ω—ã –∑–∞–∫–∞–∑—ã –Ω–∞ $50,000
- –ö–ª–∏–µ–Ω—Ç—ã –æ–ø–ª–∞—Ç–∏–ª–∏, –Ω–æ –∑–∞–∫–∞–∑—ã –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏—Å—å
- –ü—Ä–∏—à–ª–æ—Å—å –≤—Ä—É—á–Ω—É—é –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∏–∑ –ª–æ–≥–æ–≤ –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

**–†–µ—à–µ–Ω–∏–µ:**
- –í–∫–ª—é—á–∏—Ç—å durable queues –≤ RabbitMQ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å transactional outbox pattern

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å in-memory durability

**‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –ö–µ—à–∏ (–ø–æ—Ç–µ—Ä—è –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞)
- Temporary buffers
- Performance counters
- Rate limiting
- Session storage (–µ—Å–ª–∏ –º–æ–∂–µ—à—å –ø–æ–∑–≤–æ–ª–∏—Ç—å —Å–µ–±–µ –ª–æ–≥–∞—É—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

**‚ùå –ù–ï –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ó–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –õ—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–ª—å–∑—è –ø–æ—Ç–µ—Ä—è—Ç—å

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ in-memory:**
–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ–ª—å–∑—è –ø–æ—Ç–µ—Ä—è—Ç—å ‚Äî –Ω–µ –¥–µ—Ä–∂–∏ –∏—Ö —Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏. –ü–∞–º—è—Ç—å volatile (—ç–Ω–µ—Ä–≥–æ–∑–∞–≤–∏—Å–∏–º–∞).

---

## 2. Local Durability ‚Äî –õ–æ–∫–∞–ª—å–Ω–∞—è –î–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å

### –ß—Ç–æ —ç—Ç–æ?

**Local durability** (–ª–æ–∫–∞–ª—å–Ω–∞—è –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å) ‚Äî –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–∏—Å–∫ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞. –û–Ω–∏ –ø–µ—Ä–µ–∂–∏–≤–∞—é—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞, –Ω–æ –Ω–µ –ø–µ—Ä–µ–∂–∏–≤–∞—é—Ç —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –ø–æ—Ç–µ—Ä—é –¥–∏—Å–∫–∞.

**–ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
- ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∂–∏–≤—É—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–æ—Ü–µ—Å—Å–∞
- ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∂–∏–≤—É—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∂–∏–≤—É—Ç —Å–±–æ–π –ø–∏—Ç–∞–Ω–∏—è (–µ—Å–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fsync)
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ, —á–µ–º —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –¥–∏—Å–∫)

**–ß–µ–≥–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
- ‚ùå –î–∞–Ω–Ω—ã–µ –ù–ï –ø–µ—Ä–µ–∂–∏–≤—É—Ç –æ—Ç–∫–∞–∑ –¥–∏—Å–∫–∞
- ‚ùå –î–∞–Ω–Ω—ã–µ –ù–ï –ø–µ—Ä–µ–∂–∏–≤—É—Ç –æ—Ç–∫–∞–∑ —Å–µ—Ä–≤–µ—Ä–∞ (–∂–µ–ª–µ–∑–æ)
- ‚ùå –î–∞–Ω–Ω—ã–µ –ù–ï –ø–µ—Ä–µ–∂–∏–≤—É—Ç –ø–æ–∂–∞—Ä –≤ –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–µ
- ‚ùå –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç physical corruption
- ‚ùå Single point of failure (SPOF)

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–ö–æ–≥–¥–∞ —Ç—ã –ø–∏—à–µ—à—å –¥–∞–Ω–Ω—ã–µ, –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ –¥–∏—Å–∫ —Ç–æ–≥–æ –∂–µ —Å–µ—Ä–≤–µ—Ä–∞:

```
Application
    ‚Üì
[Local Disk]
    ‚Üì
File System Buffer (OS)
    ‚Üì
Disk Controller Buffer
    ‚Üì
Physical Disk
```

**–í–∞–∂–Ω–∞—è –¥–µ—Ç–∞–ª—å:** –ú–µ–∂–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –¥–∏—Å–∫–æ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ—ë–≤ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è. –î–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç "–∑–∞–≤–∏—Å–Ω—É—Ç—å" –≤ –±—É—Ñ–µ—Ä–∞—Ö.

### –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏

**SQLite:**
```
–õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫–µ.
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª –ø—Ä–æ—Ü–µ—Å—Å ‚Äî –¥–∞–Ω–Ω—ã–µ –Ω–∞ –º–µ—Å—Ç–µ ‚úÖ
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–ª —Å–µ—Ä–≤–µ—Ä ‚Äî –¥–∞–Ω–Ω—ã–µ –Ω–∞ –º–µ—Å—Ç–µ ‚úÖ
- –î–∏—Å–∫ —Å–≥–æ—Ä–µ–ª ‚Äî –≤—Å—ë –ø–æ—Ç–µ—Ä—è–Ω–æ ‚ùå
```

**Redis —Å RDB snapshots:**
```
SAVE  ‚Üê –°–æ—Ö—Ä–∞–Ω—è–µ—Ç snapshot –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–∏—Å–∫

[–°–ï–†–í–ï–† –ü–ï–†–ï–ó–ê–ì–†–£–ó–ò–õ–°–Ø]

Redis —Å—Ç–∞—Ä—Ç—É–µ—Ç ‚Üí –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π snapshot ‚úÖ

[–î–ò–°–ö –û–¢–ö–ê–ó–ê–õ]

‚Üí –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã ‚ùå
```

**Postgres (single instance, no replication):**
```
INSERT INTO orders VALUES (...);
COMMIT;  ‚Üê –ó–∞–ø–∏—Å–∞–ª–æ—Å—å –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–∏—Å–∫

[–°–ï–†–í–ï–† –£–ü–ê–õ –ò –í–û–°–°–¢–ê–ù–û–í–ò–õ–°–Ø]

‚Üí –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–∞ –º–µ—Å—Ç–µ ‚úÖ

[–§–ò–ó–ò–ß–ï–°–ö–ò–ô –û–¢–ö–ê–ó –î–ò–°–ö–ê]

‚Üí –ë–∞–∑–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –Ω—É–∂–µ–Ω restore –∏–∑ backup ‚ùå
```

### –¢–∏–ø–∏—á–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 1: –û—Ç–∫–∞–∑ –¥–∏—Å–∫–∞ –±–µ–∑ backup**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
Startup –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª single Postgres instance –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ. RAID –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, backups –Ω–µ –¥–µ–ª–∞–ª–∏—Å—å. –î–∏—Å–∫ –≤—ã—à–µ–ª –∏–∑ —Å—Ç—Ä–æ—è.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–æ—Ç–µ—Ä—è –≤—Å–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ü–æ—Ç–µ—Ä—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –ö–æ–Ω–µ—Ü –±–∏–∑–Ω–µ—Å–∞

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- Single point of failure
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ backups

**–†–µ—à–µ–Ω–∏–µ:**
- –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞—Ç—å backups
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- RAID –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –æ—Ç–∫–∞–∑–∞ –æ–¥–Ω–æ–≥–æ –¥–∏—Å–∫–∞

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 2: –ë–∏—Ç—ã–π –¥–∏—Å–∫ —Å silent corruption**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
MongoDB —Ö—Ä–∞–Ω–∏–ª–∞ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –æ–¥–Ω–æ–º –¥–∏—Å–∫–µ. –î–∏—Å–∫ –Ω–∞—á–∞–ª silent corruption (–±–∏—Ç—ã–µ —Å–µ–∫—Ç–æ—Ä–∞ –±–µ–∑ –æ—à–∏–±–æ–∫).

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –î–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–∏—á–Ω–æ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω—ã
- –û–±–Ω–∞—Ä—É–∂–∏–ª–∏ —á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é, –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—á–∞–ª–æ –ø–∞–¥–∞—Ç—å
- Backup —Ç–æ–∂–µ —É—Å–ø–µ–ª —Å—Ç–∞—Ç—å –±–∏—Ç—ã–º (incremental)

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- –ù–µ—Ç checksums –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
- Backups –Ω–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å filesystem —Å checksums (ZFS, Btrfs)
- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 3: –ü–æ—Ç–µ—Ä—è VM –≤ –æ–±–ª–∞–∫–µ**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
–ö–æ–º–ø–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ single EC2 instance –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–æ–π –±–∞–∑—ã. AWS –º–∏–≥—Ä–∏—Ä–æ–≤–∞–ª–∞ instance –Ω–∞ –¥—Ä—É–≥–æ–µ –∂–µ–ª–µ–∑–æ, –Ω–æ instance –Ω–µ –ø–æ–¥–Ω—è–ª—Å—è.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ë–∞–∑–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ 4 —á–∞—Å–∞
- –ü—Ä–∏—à–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∏–∑ backup (–ø–æ—Ç–µ—Ä—è–ª–∏ 2 —á–∞—Å–∞ –¥–∞–Ω–Ω—ã—Ö)

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- Single instance = single point of failure
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —á–∞—Å—Ç—ã–µ backups

**–†–µ—à–µ–Ω–∏–µ:**
- Multi-AZ deployment —Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π
- –ë–æ–ª–µ–µ —á–∞—Å—Ç—ã–µ backups –∏–ª–∏ continuous archiving

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å local durability

**‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- Development –∏ testing —Å—Ä–µ–¥—ã
- –ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã —Å backups
- Embedded databases (SQLite –≤ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö)
- –õ–æ–∫–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ (—Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
- –ö–µ—à —Å persistence (Redis RDB –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ—Å—Ç–∞—Ä—Ç–∞)

**‚ùå –ù–ï –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- Production –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏)
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ backups
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–Ω—É–∂–Ω–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è)
- High availability —Å–µ—Ä–≤–∏—Å—ã

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ local durability:**
–õ–æ–∫–∞–ª—å–Ω—ã–π –¥–∏—Å–∫ ‚Äî —ç—Ç–æ –ª—É—á—à–µ, —á–µ–º —Ç–æ–ª—å–∫–æ –ø–∞–º—è—Ç—å, –Ω–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è production. –í—Å–µ–≥–¥–∞ –Ω—É–∂–Ω—ã backups –∏–ª–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è.

---

## 3. Write-Ahead Logging (WAL) ‚Äî –ñ—É—Ä–Ω–∞–ª –û–ø–µ—Ä–µ–∂–∞—é—â–µ–π –ó–∞–ø–∏—Å–∏

### –ß—Ç–æ —ç—Ç–æ?

**Write-Ahead Logging (WAL)** (–∂—É—Ä–Ω–∞–ª –æ–ø–µ—Ä–µ–∂–∞—é—â–µ–π –∑–∞–ø–∏—Å–∏) ‚Äî —Ç–µ—Ö–Ω–∏–∫–∞, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫–µ —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ª–æ–≥ –∏–∑–º–µ–Ω–µ–Ω–∏—è. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ —Å–±–æ—è.

**–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–Ω—Ü–∏–ø:**
```
"–ó–∞–ø–∏—à–∏ –≤ –ª–æ–≥, –ß–¢–û —Ç—ã —Å–æ–±–∏—Ä–∞–µ—à—å—Å—è —Å–¥–µ–ª–∞—Ç—å, –ü–ï–†–ï–î —Ç–µ–º –∫–∞–∫ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å"
```

**–ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
- ‚úÖ –ú–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ—è
- ‚úÖ –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ Durability (–µ—Å–ª–∏ WAL –Ω–∞ –¥–∏—Å–∫–µ)
- ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (crash recovery)

**–ß–µ–≥–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
- ‚ùå –ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –æ—Ç–∫–∞–∑–∞ –¥–∏—Å–∫–∞ (–µ—Å–ª–∏ WAL –Ω–∞ —Ç–æ–º –∂–µ –¥–∏—Å–∫–µ)
- ‚ùå –ù–µ –∑–∞–º–µ–Ω—è–µ—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ fsync

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

**–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å—Ö–µ–º–∞ WAL:**
```
1. BEGIN transaction
2. –ó–∞–ø–∏—Å–∞—Ç—å –≤ WAL: "UPDATE accounts SET balance = 1000 WHERE id = 123"
3. Fsync WAL (—É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ!)
4. –í–µ—Ä–Ω—É—Ç—å ACK –∫–ª–∏–µ–Ω—Ç—É
5. –ü–æ–∑–∂–µ: –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫ –æ—Å–Ω–æ–≤–Ω—ã–º –¥–∞–Ω–Ω—ã–º (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
6. –ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ: –æ—Ç–º–µ—Ç–∏—Ç—å –≤ WAL –∫–∞–∫ "checkpoint"
```

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π:**

```
Transaction         WAL               Data Files
   ‚Üì
[UPDATE]
   ‚Üì
   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí [Log Entry] ‚îÄ‚îÄfsync‚Üí [Disk]
   ‚îÇ             ‚Üì
   ‚îÇ          [Synced!]
   ‚îÇ             ‚Üì
   ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ [ACK to client]
   ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí [Update Data]
                                (lazy)
```

**–ü–æ—Å–ª–µ —Å–±–æ—è:**
```
[CRASH!]

[Recovery Process:]
1. –ß–∏—Ç–∞–µ–º WAL —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ checkpoint
2. Replay –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏–∑ WAL
3. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º consistent state
4. –ì–æ—Ç–æ–≤–æ!
```

### –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏

**Postgres WAL (Write-Ahead Log):**

–ö–æ–≥–¥–∞ —Ç—ã –¥–µ–ª–∞–µ—à—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ Postgres:
```
BEGIN;
UPDATE accounts SET balance = balance - 100 WHERE id = 1;
UPDATE accounts SET balance = balance + 100 WHERE id = 2;
COMMIT;
```

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏:
1. Postgres –ø–∏—à–µ—Ç –≤ WAL: "Transaction 12345: UPDATE accounts..."
2. –î–µ–ª–∞–µ—Ç fsync WAL (–¥–∞–Ω–Ω—ã–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –Ω–∞ –¥–∏—Å–∫–µ)
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç SUCCESS –∫–ª–∏–µ–Ω—Ç—É
4. –ü–æ–∑–∂–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫ —Ç–∞–±–ª–∏—Ü–∞–º (background process)

**–ü—Ä–∏ —Å–±–æ–µ:**
```
[POSTGRES CRASHED!]

[Restart Postgres]
‚Üí Postgres —á–∏—Ç–∞–µ—Ç WAL
‚Üí –í–∏–¥–∏—Ç –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
‚Üí Replay –æ–ø–µ—Ä–∞—Ü–∏–π –∏–∑ WAL
‚Üí –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç consistent state
‚Üí –ë–∞–∑–∞ —Å–Ω–æ–≤–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç! ‚úÖ
```

**Kafka Log:**

Kafka –∏—Å–ø–æ–ª—å–∑—É–µ—Ç append-only log (—Ä–∞–∑–Ω–æ–≤–∏–¥–Ω–æ—Å—Ç—å WAL):
```
Producer –ø–∏—à–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
   ‚Üì
Kafka –ø–∏—à–µ—Ç –≤ partition log
   ‚Üì
Fsync (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫)
   ‚Üì
ACK producer'—É
```

–ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ broker –ø—Ä–æ—Å—Ç–æ —á–∏—Ç–∞–µ—Ç log —Å –¥–∏—Å–∫–∞. –≠—Ç–æ –∏ –µ—Å—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã.

**MongoDB Oplog (Operations Log):**

MongoDB –∏—Å–ø–æ–ª—å–∑—É–µ—Ç oplog –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏, –Ω–æ —ç—Ç–æ —Ç–æ–∂–µ –≤–∏–¥ WAL:
```
INSERT –≤ primary
   ‚Üì
–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ oplog
   ‚Üì
Secondaries —á–∏—Ç–∞—é—Ç oplog –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏
```

**Redis AOF (Append-Only File):**

Redis –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å –∫–∞–∂–¥—É—é –∫–æ–º–∞–Ω–¥—É –≤ AOF:
```
> SET user:1 "Alice"
‚Üí –ó–∞–ø–∏—Å–∞–Ω–æ –≤ AOF: SET user:1 "Alice"

> INCR counter
‚Üí –ó–∞–ø–∏—Å–∞–Ω–æ –≤ AOF: INCR counter

[REDIS CRASHED]

[Restart Redis]
‚Üí –ß–∏—Ç–∞–µ—Ç AOF
‚Üí –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –∑–∞–Ω–æ–≤–æ
‚Üí –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ! ‚úÖ
```

### WAL –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞ 1: –ö–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è = fsync**

WAL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å fsync'–Ω—É—Ç –Ω–∞ –¥–∏—Å–∫ –ø–µ—Ä–µ–¥ ACK. Fsync –º–µ–¥–ª–µ–Ω–Ω—ã–π (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã).

**–†–µ—à–µ–Ω–∏–µ: Group Commit**
```
–ù–µ—Å–∫–æ–ª—å–∫–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∂–¥—É—Ç –≤–º–µ—Å—Ç–µ
   ‚Üì
–ë–∞—Ç—á –∏–∑ N —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   ‚Üì
–û–¥–∏–Ω fsync –¥–ª—è –≤—Å–µ—Ö
   ‚Üì
–í—Å–µ –ø–æ–ª—É—á–∞—é—Ç ACK

–í–º–µ—Å—Ç–æ N fsync ‚Üí 1 fsync
```

Postgres –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤—ã—à–µ, –Ω–æ throughput –Ω–∞–º–Ω–æ–≥–æ –ª—É—á—à–µ.

**–ü—Ä–æ–±–ª–µ–º–∞ 2: WAL —Ä–∞—Å—Ç—ë—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ**

–ï—Å–ª–∏ –≤—Å—ë –≤—Ä–µ–º—è –ø–∏—Å–∞—Ç—å –≤ WAL, –æ–Ω –∑–∞–π–º—ë—Ç –≤–µ—Å—å –¥–∏—Å–∫.

**–†–µ—à–µ–Ω–∏–µ: Checkpoints**
```
–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏:
1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ WAL –∫ –æ—Å–Ω–æ–≤–Ω—ã–º –¥–∞–Ω–Ω—ã–º
2. –û—Ç–º–µ—Ç–∏—Ç—å checkpoint
3. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π WAL (–¥–æ checkpoint)

[WAL]  ‚Üí [Checkpoint] ‚Üí [Truncate old WAL]
```

Postgres –¥–µ–ª–∞–µ—Ç checkpoint –∫–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç –∏–ª–∏ –∫–æ–≥–¥–∞ WAL –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞.

**–ü—Ä–æ–±–ª–µ–º–∞ 3: WAL –Ω–∞ —Ç–æ–º –∂–µ –¥–∏—Å–∫–µ**

–ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ WAL –Ω–∞ –æ–¥–Ω–æ–º –¥–∏—Å–∫–µ, –∏ –¥–∏—Å–∫ –æ—Ç–∫–∞–∂–µ—Ç ‚Äî –≤—Å—ë –ø–æ—Ç–µ—Ä—è–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ: WAL –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º –¥–∏—Å–∫–µ**
```
Data Disk:   /mnt/data/postgres
WAL Disk:    /mnt/wal/postgres

[Data Disk Failed] ‚Üí WAL —Ü–µ–ª ‚Üí –ú–æ–∂–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å! ‚úÖ
[WAL Disk Failed]  ‚Üí Data —Ü–µ–ª ‚Üí –ü–æ—Ç–µ—Ä—è–ª–∏ recent changes ‚ùå
```

–õ—É—á—à–µ: WAL –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º –±—ã—Å—Ç—Ä–æ–º –¥–∏—Å–∫–µ (SSD), data –Ω–∞ –±–æ–ª—å—à–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ–º –¥–∏—Å–∫–µ (HDD).

### –¢–∏–ø–∏—á–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 1: WAL –±–µ–∑ fsync**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
–ö–æ–º–ø–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–∏–ª–∞ Postgres —Å `fsync=off` –¥–ª—è "–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏". –ü—Ä–æ–∏–∑–æ—à—ë–ª —Å–±–æ–π –ø–∏—Ç–∞–Ω–∏—è.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- WAL –≤ OS buffer, –Ω–æ –Ω–µ –Ω–∞ –¥–∏—Å–∫–µ
- –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–∑–∞ –≤ inconsistent —Å–æ—Å—Ç–æ—è–Ω–∏–∏
- –ü—Ä–∏—à–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∏–∑ backup

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- `fsync=off` –æ–∑–Ω–∞—á–∞–µ—Ç "–Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–π durability"
- OS buffer cache –ø–æ—Ç–µ—Ä—è–ª—Å—è –ø—Ä–∏ —Å–±–æ–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –ù–ò–ö–û–ì–î–ê –Ω–µ –æ—Ç–∫–ª—é—á–∞–π fsync –≤ production
- –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –±–∞—Ç—á commits –∏–ª–∏ –ª—É—á—à–µ–µ –∂–µ–ª–µ–∑–æ

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 2: WAL –∑–∞–ø–æ–ª–Ω–∏–ª –¥–∏—Å–∫**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
Postgres –ø–µ—Ä–µ—Å—Ç–∞–ª –¥–µ–ª–∞—Ç—å checkpoints (–±–∞–≥ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏). WAL —Ä–æ—Å –∏ –∑–∞–ø–æ–ª–Ω–∏–ª –¥–∏—Å–∫.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ë–∞–∑–∞ –ø–µ—Ä–µ—Å—Ç–∞–ª–∞ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø–∏—Å–∏
- Downtime –¥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –º–µ—Å—Ç–∞

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- Checkpoint –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª—Å—è
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–ª —Ä–∞–∑–º–µ—Ä WAL

**–†–µ—à–µ–Ω–∏–µ:**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä WAL
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã checkpoint
- –ê–ª–µ—Ä—Ç—ã –Ω–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∏—Å–∫–∞

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 3: –ú–µ–¥–ª–µ–Ω–Ω—ã–π WAL –¥–∏—Å–∫**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
Postgres WAL –±—ã–ª –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–º HDD. –ö–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∂–¥–∞–ª–∞ fsync –ø–æ 10ms.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- Latency —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π 10ms+
- –ü–ª–æ—Ö–æ–π UX, —Ç–æ—Ä–º–æ–∑–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ WAL –Ω–∞ SSD
- Latency —É–ø–∞–ª–∞ –¥–æ <1ms

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WAL

**‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –õ—é–±–∞—è —Å–∏—Å—Ç–µ–º–∞, –≥–¥–µ –Ω—É–∂–Ω–∞ durability (–ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞!)
- –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (Postgres, MySQL, MongoDB)
- Message queues (Kafka, RabbitMQ)
- Distributed logs (Kafka)

**‚ùå –ù–ï –∑–∞–º–µ–Ω—è–µ—Ç:**
- –†–µ–ø–ª–∏–∫–∞—Ü–∏—é (WAL –ª–æ–∫–∞–ª–µ–Ω)
- Backups (WAL –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤–µ—á–Ω–æ)

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ WAL:**
WAL ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ durability –≤ –ª—é–±–æ–π —Å–µ—Ä—å—ë–∑–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ. –ë–µ–∑ WAL –Ω–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏ –∏ –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç–∏.

---

## 4. Fsync Durability ‚Äî –ì–∞—Ä–∞–Ω—Ç–∏—è –ó–∞–ø–∏—Å–∏ –Ω–∞ –§–∏–∑–∏—á–µ—Å–∫–∏–π –î–∏—Å–∫

### –ß—Ç–æ —ç—Ç–æ?

**Fsync durability** ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ –¥–∏—Å–∫, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –±—É—Ñ–µ—Ä–∞—Ö –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∏–ª–∏ disk controller.

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–≥–¥–∞ —Ç—ã –ø–∏—à–µ—à—å –≤ —Ñ–∞–π–ª, –¥–∞–Ω–Ω—ã–µ –æ–±—ã—á–Ω–æ –ø–æ–ø–∞–¥–∞—é—Ç –≤:
```
Application Buffer
   ‚Üì
OS Page Cache (RAM)
   ‚Üì
Disk Controller Buffer (RAM on disk)
   ‚Üì
Physical Disk Platters / SSD Cells
```

–ï—Å–ª–∏ —Å–±–æ–π –ø–∏—Ç–∞–Ω–∏—è ‚Äî –≤—Å—ë –≤ RAM —Ç–µ—Ä—è–µ—Ç—Å—è!

**Fsync() —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤:**
```
"–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, —É–±–µ–¥–∏—Å—å, —á—Ç–æ –í–°–Å –∏–∑ –±—É—Ñ–µ—Ä–æ–≤ –∑–∞–ø–∏—Å–∞–Ω–æ –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –¥–∏—Å–∫!"
```

**–ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
- ‚úÖ –î–∞–Ω–Ω—ã–µ –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º –Ω–æ—Å–∏—Ç–µ–ª–µ (–Ω–µ –≤ RAM)
- ‚úÖ –ü–µ—Ä–µ–∂–∏–≤—É—Ç —Å–±–æ–π –ø–∏—Ç–∞–Ω–∏—è
- ‚úÖ –ü–µ—Ä–µ–∂–∏–≤—É—Ç kernel panic
- ‚úÖ Durability –≤ —Ä–∞–º–∫–∞—Ö –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã

**–ß–µ–≥–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
- ‚ùå –ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –æ—Ç–∫–∞–∑–∞ –¥–∏—Å–∫–∞
- ‚ùå –ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø–æ—Ç–µ—Ä–∏ —Å–µ—Ä–≤–µ—Ä–∞
- ‚ùå –ú–µ–¥–ª–µ–Ω–Ω–æ (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã vs –Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥—ã RAM)

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

**–ë–µ–∑ fsync:**
```
write(file, data)  ‚Üê –ë—ã—Å—Ç—Ä–æ (–¥–∞–Ω–Ω—ã–µ –≤ OS cache)
   ‚Üì
[OS Cache] ‚Üê –î–∞–Ω–Ω—ã–µ –∑–¥–µ—Å—å, –≤ RAM!
   ‚Üì
[Eventually flushed to disk]  ‚Üê –ö–æ–≥–¥–∞ OS —Ä–µ—à–∏—Ç (seconds later)

[POWER FAILURE]
‚Üí –î–∞–Ω–Ω—ã–µ –≤ OS Cache –ø–æ—Ç–µ—Ä—è–Ω—ã! ‚ùå
```

**–° fsync:**
```
write(file, data)
   ‚Üì
fsync(file)  ‚Üê –ë–õ–û–ö–ò–†–£–ï–¢ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏!
   ‚Üì
[OS flushes to disk immediately]
   ‚Üì
[Disk controller flushes its cache]
   ‚Üì
[Data on physical media]
   ‚Üì
fsync() returns ‚Üê –¢–æ–ª—å–∫–æ —Ç–µ–ø–µ—Ä—å!

[POWER FAILURE NOW]
‚Üí –î–∞–Ω–Ω—ã–µ –Ω–∞ –¥–∏—Å–∫–µ! ‚úÖ
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é

**–ü—Ä–æ–±–ª–µ–º–∞: Fsync –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω—ã–π**

–¢–∏–ø–∏—á–Ω—ã–µ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏:
- RAM write: ~100 nanoseconds
- fsync() to HDD: ~10 milliseconds (100,000x –º–µ–¥–ª–µ–Ω–Ω–µ–µ!)
- fsync() to SSD: ~1 millisecond (10,000x –º–µ–¥–ª–µ–Ω–Ω–µ–µ!)

**–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
–ï—Å–ª–∏ —Ç—ã –¥–µ–ª–∞–µ—à—å fsync –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏, throughput –ø–∞–¥–∞–µ—Ç –≤ —Ç—ã—Å—è—á–∏ —Ä–∞–∑!

**–ü—Ä–∏–º–µ—Ä:**
```
Without fsync:
- 1,000,000 writes/sec ‚úÖ

With fsync after each write:
- 100 writes/sec (on HDD) üò±
- 1,000 writes/sec (on SSD) üò±
```

### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**1. Group Commit (–±–∞—Ç—á–∏—Ä–æ–≤–∞–Ω–∏–µ)**

–í–º–µ—Å—Ç–æ fsync –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏, –±–∞—Ç—á—É–µ–º:
```
Write 1000 operations to buffer
   ‚Üì
One fsync()
   ‚Üì
Commit all 1000 operations

Throughput: 1000x better!
Latency: ~10ms for all (–≤–º–µ—Å—Ç–æ <1ms for each)
```

Postgres –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

**2. Async fsync —Å —Ä–∏—Å–∫–æ–º**

–î–µ–ª–∞—Ç—å fsync –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–≤ —Ñ–æ–Ω–µ):
```
Write data
Return ACK immediately  ‚Üê –ë—ã—Å—Ç—Ä–æ!
   ‚Üì
[Background thread]
   ‚Üì
fsync() later (every 1 second)
```

**Trade-off:**
- ‚úÖ –ë—ã—Å—Ç—Ä–æ (no blocking)
- ‚ùå –ú–æ–∂–µ—à—å –ø–æ—Ç–µ—Ä—è—Ç—å –¥–æ 1 —Å–µ–∫—É–Ω–¥—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–±–æ–µ

MongoDB, Redis (AOF with `everysec`) –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç–æ.

**3. Battery-Backed Write Cache**

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ RAID –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏–º–µ—é—Ç battery-backed cache:
```
Write ‚Üí [RAID Controller Cache with Battery]
   ‚Üì
fsync() returns immediately (cache is "safe")
   ‚Üì
[Background flush to disk]
```

–ë–∞—Ç–∞—Ä–µ—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ cache –Ω–µ –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ —Å–±–æ–µ –ø–∏—Ç–∞–Ω–∏—è.

**4. Disable disk write cache**

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–∏—Å–∫–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç fsync –∏ –≥–æ–≤–æ—Ä—è—Ç "–∑–∞–ø–∏—Å–∞–ª", —Ö–æ—Ç—è –¥–∞–Ω–Ω—ã–µ –≤ –∏—Ö cache!

–†–µ—à–µ–Ω–∏–µ:
```bash
hdparm -W0 /dev/sda  # Disable write cache
```

–ú–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ.

### –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏

**Postgres fsync:**

```
COMMIT;  ‚Üê –ë–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ fsync WAL!
```

Postgres –¥–µ–ª–∞–µ—Ç fsync WAL –ø–µ—Ä–µ–¥ ACK —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç durability.

–ù–∞—Å—Ç—Ä–æ–π–∫–∏:
```sql
-- NEVER do this in production!
SET fsync = off;  ‚Üê –û–ø–∞—Å–Ω–æ! –ú–æ–∂–µ—à—å –ø–æ—Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ!

-- Safe (default)
SET fsync = on;

-- Trade-off latency vs throughput
SET commit_delay = 10;  ‚Üê Wait 10Œºs for group commit
```

**Redis AOF fsync modes:**

```conf
# appendfsync always    ‚Üê Fsync after EVERY command (slow, safe)
# appendfsync everysec  ‚Üê Fsync every second (fast, can lose 1 sec)
# appendfsync no        ‚Üê Let OS decide (fast, unsafe)
```

–í—ã–±–æ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç trade-off:
- `always`: –ú–µ–¥–ª–µ–Ω–Ω–æ, –Ω–æ durability –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞
- `everysec`: –ë–∞–ª–∞–Ω—Å (default, –º–æ–∂–µ—à—å –ø–æ—Ç–µ—Ä—è—Ç—å 1 —Å–µ–∫ –¥–∞–Ω–Ω—ã—Ö)
- `no`: –ë—ã—Å—Ç—Ä–æ, –Ω–æ –º–æ–∂–µ—à—å –ø–æ—Ç–µ—Ä—è—Ç—å –≤—Å—ë, —á—Ç–æ –Ω–µ fsync'–Ω—É—Ç–æ (–º–æ–∂–µ—Ç –±—ã—Ç—å 30 —Å–µ–∫—É–Ω–¥!)

**MongoDB fsync (journal):**

MongoDB –ø–∏—à–µ—Ç –≤ journal (WAL) –∏ fsync'–∏—Ç –µ–≥–æ:
```js
// Default: fsync journal every 100ms
db.collection.insertOne({...})  ‚Üê Returns, –Ω–æ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ –Ω–∞ –¥–∏—Å–∫–µ!

// Force fsync
db.collection.insertOne({...}, {writeConcern: {j: true}})  ‚Üê –ë–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ fsync!
```

`{j: true}` (journaled) ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç fsync –ø–µ—Ä–µ–¥ ACK.

**Kafka fsync:**

Kafka –ù–ï –¥–µ–ª–∞–µ—Ç fsync –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
```
# flush.messages = infinite (default)
# OS flushes when it wants
```

–≠—Ç–æ –±—ã—Å—Ç—Ä–æ, –Ω–æ –º–æ–∂–µ—à—å –ø–æ—Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å–±–æ–µ.

–î–ª—è critical –¥–∞–Ω–Ω—ã—Ö:
```
# Force flush more often
flush.messages=1  ‚Üê Fsync after every message (slow!)
```

–ò–ª–∏ –ø–æ–ª–∞–≥–∞–π—Å—è –Ω–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é (–ª—É—á—à–µ!).

### –¢–∏–ø–∏—á–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 1: Postgres —Å fsync=off**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
–ö–æ–º–ø–∞–Ω–∏—è –æ—Ç–∫–ª—é—á–∏–ª–∞ fsync –≤ Postgres –¥–ª—è "—Å–∫–æ—Ä–æ—Å—Ç–∏". –ü—Ä–æ–∏–∑–æ—à—ë–ª —Å–±–æ–π –ø–∏—Ç–∞–Ω–∏—è.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ë–∞–∑–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞ (corrupted)
- –ü—Ä–∏—à–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∏–∑ backup
- –ü–æ—Ç–µ—Ä—è 4 —á–∞—Å–æ–≤ –¥–∞–Ω–Ω—ã—Ö

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- –î–∞–Ω–Ω—ã–µ –≤ OS cache, –Ω–µ –Ω–∞ –¥–∏—Å–∫–µ
- –°–±–æ–π –ø–∏—Ç–∞–Ω–∏—è —É–Ω–∏—á—Ç–æ–∂–∏–ª cache

**–†–µ—à–µ–Ω–∏–µ:**
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–∫–ª—é—á–∞–π fsync –≤ production
- –ò—Å–ø–æ–ª—å–∑—É–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –¥–ª—è performance, –Ω–µ "–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ" –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 2: –õ–∂–∏–≤—ã–π –¥–∏—Å–∫**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
–ö–æ–º–ø–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ –¥–µ—à—ë–≤—ã–µ –¥–∏—Å–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ "–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–ª–∏" fsync, –Ω–æ –¥–µ—Ä–∂–∞–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ volatile cache.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°–±–æ–π –ø–∏—Ç–∞–Ω–∏—è ‚Üí –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ "–¥–æ–ª–∂–Ω—ã –±—ã–ª–∏" –±—ã—Ç—å –Ω–∞ –¥–∏—Å–∫–µ
- –ë–∞–∑–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- Disk write cache –±—ã–ª –≤–∫–ª—é—á—ë–Ω
- –î–∏—Å–∫ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª fsync –∏ –≤—Ä–∞–ª, —á—Ç–æ –∑–∞–ø–∏—Å–∞–ª

**–†–µ—à–µ–Ω–∏–µ:**
- –û—Ç–∫–ª—é—á–∏—Ç—å disk write cache: `hdparm -W0 /dev/sda`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏—Å–∫–∏ —Å battery-backed cache
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å durability (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ reboots)

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 3: fsync –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–ø–∏—Å–∞–ª–∏ —Å–≤–æ—é —Å–∏—Å—Ç–µ–º—É –∏ –¥–µ–ª–∞–ª–∏ fsync –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏. Throughput –±—ã–ª —É–∂–∞—Å–µ–Ω.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- 10 writes/sec –≤–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–µ–º—ã—Ö 10,000
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–æ—Ä–º–æ–∑–∏—Ç

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- –ù–µ –ø–æ–Ω–∏–º–∞–ª–∏, —á—Ç–æ fsync –º–µ–¥–ª–µ–Ω–Ω—ã–π
- –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –±–∞—Ç—á–∏—Ä–æ–≤–∞–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –ë–∞—Ç—á–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å group commit
- Fsync —Ä–∞–∑ –≤ N –æ–ø–µ—Ä–∞—Ü–∏–π –∏–ª–∏ —Ä–∞–∑ –≤ X –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fsync

**‚úÖ –í—Å–µ–≥–¥–∞ fsync –¥–ª—è:**
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –õ—é–±–æ–π commit –≤ ACID –±–∞–∑–µ

**‚öñÔ∏è Trade-off –¥–ª—è:**
- –í—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã (–±–∞—Ç—á–∏—Ç—å fsync)
- –ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (fsync —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É)

**‚ùå –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–∫–ª—é—á–∞–π fsync –¥–ª—è:**
- Production –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º
- –õ—é–±—ã—Ö critical –¥–∞–Ω–Ω—ã—Ö

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ fsync:**
Fsync –º–µ–¥–ª–µ–Ω–Ω—ã–π, –Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –Ω–∞—Å—Ç–æ—è—â–µ–π durability. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π —á–µ—Ä–µ–∑ –±–∞—Ç—á–∏—Ä–æ–≤–∞–Ω–∏–µ, –Ω–µ —á–µ—Ä–µ–∑ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ.

---

## 5. Replicated Durability ‚Äî –†–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –î–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å

### –ß—Ç–æ —ç—Ç–æ?

**Replicated durability** (—Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å) ‚Äî –¥–∞–Ω–Ω—ã–µ —Å—á–∏—Ç–∞—é—Ç—Å—è durable, –∫–æ–≥–¥–∞ –æ–Ω–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤. –≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –æ—Ç–∫–∞–∑–∞ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.

**–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–Ω—Ü–∏–ø:**
```
"–î–∞–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –Ω–∞ N —Å–µ—Ä–≤–µ—Ä–∞—Ö ‚Üí –ø–æ—Ç–µ—Ä—è –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ —Å—Ç—Ä–∞—à–Ω–∞"
```

**–ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
- ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∂–∏–≤—É—Ç –æ—Ç–∫–∞–∑ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∂–∏–≤—É—Ç –æ—Ç–∫–∞–∑ –¥–∏—Å–∫–∞ –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (High Availability)
- ‚úÖ –ú–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å —Å —Ä–µ–ø–ª–∏–∫ (read scalability)

**–ß–µ–≥–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
- ‚ùå –ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ—Ç–∫–∞–∑–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
- ‚ùå –ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–¥–µ (–±–∏—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É—é—Ç—Å—è —Ç–æ–∂–µ!)
- ‚ùå –ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç logical corruption
- ‚ùå –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç latency (–Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å —Ä–µ–ø–ª–∏–∫–∏)

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

**Primary-Secondary —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è:**
```
Client
   ‚Üì
[Primary]  ‚Üê –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø–∏—Å–∏
   ‚Üì
   ‚îú‚îÄ‚îÄ‚Üí [Secondary 1]  ‚Üê –†–µ–ø–ª–∏–∫–∞
   ‚îú‚îÄ‚îÄ‚Üí [Secondary 2]  ‚Üê –†–µ–ø–ª–∏–∫–∞
   ‚îî‚îÄ‚îÄ‚Üí [Secondary 3]  ‚Üê –†–µ–ø–ª–∏–∫–∞
```

**Sequence –æ–ø–µ—Ä–∞—Ü–∏–π:**
```
1. Client ‚Üí Primary: INSERT data
2. Primary –ø–∏—à–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ (–≤ WAL)
3. Primary –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ Secondaries
4. Secondaries –ø–∏—à—É—Ç –ª–æ–∫–∞–ª—å–Ω–æ
5. Secondaries ACK Primary
6. Primary ACK Client

[–°–ï–†–í–ï–† PRIMARY –£–ü–ê–õ]

‚Üí –í—ã–±–∏—Ä–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π Primary –∏–∑ Secondaries
‚Üí –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ—Ç–µ—Ä—è–Ω—ã! ‚úÖ
```

### –í–∏–¥—ã —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

**1. Synchronous Replication (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è)**

Primary –∂–¥—ë—Ç ACK –æ—Ç —Ä–µ–ø–ª–∏–∫ –ø–µ—Ä–µ–¥ ACK –∫–ª–∏–µ–Ω—Ç—É:
```
Client ‚Üí Primary ‚Üí Write locally
                ‚Üí Send to Replicas
                ‚Üí Wait for ACK ‚Üê [Replicas]
                ‚Üí ACK Client ‚úÖ

[–õ–Æ–ë–û–ô –°–ï–†–í–ï–† –£–ü–ê–õ]
‚Üí –î–∞–Ω–Ω—ã–µ —Ç–æ—á–Ω–æ –Ω–∞ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö! ‚úÖ
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ù–µ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö (zero data loss)
- ‚úÖ Strong durability

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –í—ã—Å–æ–∫–∞—è latency (–∂–¥—ë–º —Ä–µ–ø–ª–∏–∫–∏)
- ‚ùå –ï—Å–ª–∏ —Ä–µ–ø–ª–∏–∫–∞ –º–µ–¥–ª–µ–Ω–Ω–∞—è ‚Üí –≤—Å—ë –º–µ–¥–ª–µ–Ω–Ω–æ

**2. Asynchronous Replication (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è)**

Primary ACK'–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç—É —Å—Ä–∞–∑—É, —Ä–µ–ø–ª–∏–∫–∏ –¥–æ–≥–æ–Ω—è—é—Ç:
```
Client ‚Üí Primary ‚Üí Write locally
                ‚Üí ACK Client ‚úÖ  ‚Üê –ë—ã—Å—Ç—Ä–æ!
                ‚Üí Send to Replicas (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)

[PRIMARY –£–ü–ê–õ –î–û –†–ï–ü–õ–ò–ö–ê–¶–ò–ò]
‚Üí –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã! ‚ùå
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ù–∏–∑–∫–∞—è latency
- ‚úÖ –†–µ–ø–ª–∏–∫–∏ –Ω–µ –∑–∞–º–µ–¥–ª—è—é—Ç Primary

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ú–æ–∂–µ—à—å –ø–æ—Ç–µ—Ä—è—Ç—å recent –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ failover
- ‚ùå Replication lag (—Ä–µ–ø–ª–∏–∫–∏ –æ—Ç—Å—Ç–∞—é—Ç)

**3. Semi-Synchronous Replication (–ø–æ–ª—É—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è)**

Primary –∂–¥—ë—Ç ACK —Ö–æ—Ç—è –±—ã –æ—Ç –æ–¥–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∏:
```
Primary ‚Üí Write locally
       ‚Üí Send to All Replicas
       ‚Üí Wait for at least 1 ACK  ‚Üê –ë–∞–ª–∞–Ω—Å!
       ‚Üí ACK Client

[PRIMARY –£–ü–ê–õ]
‚Üí –•–æ—Ç—è –±—ã –Ω–∞ –æ–¥–Ω–æ–π —Ä–µ–ø–ª–∏–∫–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ! ‚úÖ
```

**–ë–∞–ª–∞–Ω—Å:**
- –õ—É—á—à–µ durability, —á–µ–º async
- –õ—É—á—à–µ latency, —á–µ–º full sync

### –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏

**Postgres Streaming Replication:**

**Async mode (default):**
```
Primary commits ‚Üí ACK immediately
   ‚Üì
Standby servers apply WAL later
```

–ú–æ–∂–µ—à—å –ø–æ—Ç–µ—Ä—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ failover.

**Sync mode:**
```sql
-- –ù–∞ primary
ALTER SYSTEM SET synchronous_standby_names = 'standby1';

-- –¢–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π COMMIT –∂–¥—ë—Ç standby1
BEGIN;
INSERT INTO orders VALUES (...);
COMMIT;  ‚Üê –ë–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ ACK –æ—Ç standby1!
```

**MongoDB Replica Set:**

```js
// Async (default)
db.collection.insertOne({...})
// ACK immediately, —Ä–µ–ø–ª–∏–∫–∏ –¥–æ–≥–æ–Ω—è—Ç

// Sync (wait for majority)
db.collection.insertOne(
  {...},
  {writeConcern: {w: "majority"}}  ‚Üê –ñ–¥—ë—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ä–µ–ø–ª–∏–∫!
)
```

`w: "majority"` ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –Ω–æ–¥ –ø–µ—Ä–µ–¥ ACK.

**Kafka Replication:**

Kafka —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç partitions:
```
Topic: orders (3 partitions, replication factor = 3)

Partition 0:
- Leader: Broker 1
- Replicas: Broker 2, Broker 3

Producer –ø–∏—à–µ—Ç ‚Üí Leader
Leader ‚Üí Replicates to followers
```

**Acknowledgement modes:**
```java
// acks=0: –ù–µ –∂–¥—ë–º ACK (very fast, unsafe)
props.put("acks", "0");

// acks=1: –ñ–¥—ë–º ACK —Ç–æ–ª—å–∫–æ –æ—Ç leader (fast, can lose data)
props.put("acks", "1");

// acks=all: –ñ–¥—ë–º ACK –æ—Ç –≤—Å–µ—Ö in-sync replicas (safe, slower)
props.put("acks", "all");
```

**Redis Sentinel (automatic failover):**

```
Master ‚Üí Replica1, Replica2

[MASTER FAILED]

Sentinel detects failure
   ‚Üì
Promotes Replica1 to Master
   ‚Üì
Applications switch to new Master

–î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ—Ç–µ—Ä—è–Ω—ã! ‚úÖ
```

### –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞ 1: Split Brain**

–ß—Ç–æ –µ—Å–ª–∏ —Å–µ—Ç—å —Ä–∞–∑–¥–µ–ª–∏–ª–∞—Å—å –∏ —Ç–µ–ø–µ—Ä—å –¥–≤–∞ Primary?

```
Client A ‚Üí [Primary 1] ‚Üí Write X
Client B ‚Üí [Primary 2] ‚Üí Write Y

[Network heals]

‚Üí Conflict! –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ? üò±
```

**–†–µ—à–µ–Ω–∏–µ: Quorum (–∫–≤–æ—Ä—É–º)**
–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –Ω–æ–¥ –¥–æ–ª–∂–Ω–æ —Å–æ–≥–ª–∞—Å–∏—Ç—å—Å—è. –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–º–µ—Ç—å –¥–≤–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞.

**–ü—Ä–æ–±–ª–µ–º–∞ 2: Replication Lag**

Async —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ä–µ–ø–ª–∏–∫–∏ –æ—Ç—Å—Ç–∞—é—Ç:
```
Primary: [1, 2, 3, 4, 5]  ‚Üê Latest data
Replica: [1, 2, 3]        ‚Üê Lagging by 2

Client reads from Replica ‚Üí –í–∏–¥–∏—Ç old data! üò±
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å lag
- –ß–∏—Ç–∞—Ç—å —Å Primary –¥–ª—è critical reads
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sync —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –¥–ª—è important writes

**–ü—Ä–æ–±–ª–µ–º–∞ 3: Cascading Failure**

Primary —É–ø–∞–ª ‚Üí –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Ä–µ–ø–ª–∏–∫–∏ ‚Üí –æ–Ω–∏ —Ç–æ–∂–µ —É–ø–∞–ª–∏:
```
[PRIMARY DOWN]
   ‚Üì
All clients ‚Üí Replica1
   ‚Üì
Replica1 overloaded
   ‚Üì
Replica1 DOWN
   ‚Üì
All clients ‚Üí Replica2
   ‚Üì
[Cascading failure!] üò±
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π capacity planning
- –†–µ–ø–ª–∏–∫–∏ –¥–æ–ª–∂–Ω—ã —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å full load
- Circuit breakers

### –¢–∏–ø–∏—á–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 1: GitHub outage 2018**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
GitHub –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª MySQL —Å async —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π –º–µ–∂–¥—É –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–∞–º–∏. –ü—Ä–æ–∏–∑–æ—à—ë–ª network partition.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –î–≤–µ –±–∞–∑—ã –¥—É–º–∞–ª–∏, —á—Ç–æ –æ–Ω–∏ Primary
- Split brain
- Inconsistent data
- –ü–æ—Ç—Ä–µ–±–æ–≤–∞–ª–∞—Å—å manual reconciliation

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- Async —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è
- Network partition
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π quorum logic

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Raft/Paxos –¥–ª—è consensus
- Quorum-based writes

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 2: –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ failover**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
–ö–æ–º–ø–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ async —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é Postgres. Primary —É–ø–∞–ª. Failover –Ω–∞ Standby.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–æ—Ç–µ—Ä—è–Ω—ã –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 —Å–µ–∫—É–Ω–¥ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ö–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∏–ª–∏ ACK, –Ω–æ –¥–∞–Ω–Ω—ã–µ –∏—Å—á–µ–∑–ª–∏

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- Async —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è
- Replication lag

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å synchronous_standby_names –¥–ª—è critical –¥–∞–Ω–Ω—ã—Ö
- Monitoring replication lag

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 3: –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞ –∑–∞–º–µ–¥–ª–∏–ª–∞ –≤—Å—ë**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
–ö–æ–º–ø–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–∏–ª–∞ sync —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é. –û–¥–Ω–∞ —Ä–µ–ø–ª–∏–∫–∞ –±—ã–ª–∞ –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–º –¥–∏—Å–∫–µ.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ö–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∂–¥–∞–ª–∞ –º–µ–¥–ª–µ–Ω–Ω—É—é —Ä–µ–ø–ª–∏–∫—É
- Latency –≤—ã—Ä–æ—Å–ª–∞ –¥–æ 100ms
- Throughput —É–ø–∞–ª

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å "wait for at least N replicas" (–Ω–µ –≤—Å–µ—Ö!)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å performance —Ä–µ–ø–ª–∏–∫
- –£–±—Ä–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω—É—é —Ä–µ–ø–ª–∏–∫—É –∏–∑ sync set

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å replicated durability

**‚úÖ –í—Å–µ–≥–¥–∞ –¥–ª—è:**
- Production –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- High availability —Å–∏—Å—Ç–µ–º—ã

**‚öñÔ∏è Trade-off:**
- Sync vs Async (durability vs latency)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ø–ª–∏–∫ (durability vs cost)

**‚ùå –ú–æ–∂–µ—Ç –Ω–µ –Ω—É–∂–Ω–∞ –¥–ª—è:**
- Development —Å—Ä–µ–¥—ã
- –ö–µ—à–∏ (–¥–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è)
- Temporary data

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ replicated durability:**
–†–µ–ø–ª–∏–∫–∞—Ü–∏—è ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ high availability –∏ durability –≤ production. –ù–æ –Ω—É–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å trade-offs –º–µ–∂–¥—É sync –∏ async.

---

## 6. Quorum Durability ‚Äî –ö–≤–æ—Ä—É–º–Ω–∞—è –î–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å

### –ß—Ç–æ —ç—Ç–æ?

**Quorum durability** (–∫–≤–æ—Ä—É–º–Ω–∞—è –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å) ‚Äî –¥–∞–Ω–Ω—ã–µ —Å—á–∏—Ç–∞—é—Ç—Å—è durable, –∫–æ–≥–¥–∞ –æ–Ω–∏ –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ **–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ** (quorum) —Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã, –¥–∞–∂–µ –µ—Å–ª–∏ –º–µ–Ω—å—à–∏–Ω—Å—Ç–≤–æ —Å–µ—Ä–≤–µ—Ä–æ–≤ —É–ø–∞–¥—ë—Ç.

**–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–Ω—Ü–∏–ø:**
```
"–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ —Å–æ–≥–ª–∞—Å–∏—Ç—å—Å—è, –ø—Ä–µ–∂–¥–µ —á–µ–º –¥–∞–Ω–Ω—ã–µ —Å—á–∏—Ç–∞—é—Ç—Å—è committed"
```

**Quorum:**
```
N = –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ø–ª–∏–∫
W = Write quorum (—Å–∫–æ–ª—å–∫–æ ACK –Ω—É–∂–Ω–æ –¥–ª—è write)
R = Read quorum (—Å–∫–æ–ª—å–∫–æ –Ω–æ–¥ –Ω—É–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å)

–î–ª—è consistency: W + R > N

–û–±—ã—á–Ω–æ: W = R = (N/2) + 1 (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ)
```

**–ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
- ‚úÖ –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ—Ç–µ—Ä—è—é—Ç—Å—è, –µ—Å–ª–∏ < –ø–æ–ª–æ–≤–∏–Ω—ã –Ω–æ–¥ —É–ø–∞–¥—ë—Ç
- ‚úÖ Consistency (–µ—Å–ª–∏ W + R > N)
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç split brain
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π failover –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

**–ß–µ–≥–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
- ‚ùå –ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –æ—Ç–∫–∞–∑–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –Ω–æ–¥
- ‚ùå –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç latency (–∂–¥—ë–º –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö ACK)
- ‚ùå –ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç logical errors

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

**–ü—Ä–∏–º–µ—Ä —Å 5 –Ω–æ–¥–∞–º–∏:**
```
N = 5 (5 —Ä–µ–ø–ª–∏–∫)
W = 3 (–Ω—É–∂–Ω–æ 3 ACK –¥–ª—è write)
R = 3 (—á–∏—Ç–∞–µ–º —Å 3 –Ω–æ–¥)

Write:
Client ‚Üí Node1: Write X
      ‚Üí Node2: Write X
      ‚Üí Node3: Write X
      ‚Üí Node4: Write X
      ‚Üí Node5: Write X

Wait for 3 ACK:
Node1: ACK ‚úÖ
Node2: ACK ‚úÖ
Node3: ACK ‚úÖ  ‚Üê Quorum –¥–æ—Å—Ç–∏–≥–Ω—É—Ç!

‚Üí Return SUCCESS to client

Node4: ACK ‚úÖ  ‚Üê –ü—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ–∑–∂–µ (–Ω–µ –≤–∞–∂–Ω–æ)
Node5: Failed ‚ùå  ‚Üê –ù–µ –ø—Ä–æ–±–ª–µ–º–∞, –µ—Å—Ç—å quorum!
```

**Failover —Å—Ü–µ–Ω–∞—Ä–∏–π:**
```
[2 –Ω–æ–¥—ã —É–ø–∞–ª–∏]

–û—Å—Ç–∞–ª–æ—Å—å: 3 –∏–∑ 5
Quorum = 3
‚Üí –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç! ‚úÖ

[–ï—â—ë –æ–¥–Ω–∞ –Ω–æ–¥–∞ —É–ø–∞–ª–∞]

–û—Å—Ç–∞–ª–æ—Å—å: 2 –∏–∑ 5
Quorum = 3
‚Üí –°–∏—Å—Ç–µ–º–∞ –ù–ï –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å! ‚ùå
‚Üí –ù–æ –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å old data (–µ—Å–ª–∏ R <= 2)
```

### –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –∫–≤–æ—Ä—É–º–∞

**–ü–æ—á–µ–º—É W + R > N?**

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ read –∏ write "–ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è":
```
N = 5
W = 3 (write quorum)
R = 3 (read quorum)

W + R = 6 > 5 (N)

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
‚Üí –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Å 3 –Ω–æ–¥ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –±—É–¥–µ—Ç —Å latest write!
```

**–ü—Ä–∏–º–µ—Ä:**
```
Write –Ω–∞ Node1, Node2, Node3
   ‚Üì
[Node1, Node2, Node3 –∏–º–µ—é—Ç latest data]

Read —Å Node2, Node3, Node4
   ‚Üì
Node2 –∏ Node3 –∏–º–µ—é—Ç latest data
   ‚Üì
–í—ã–±–∏—Ä–∞–µ–º latest –≤–µ—Ä—Å–∏—é (–ø–æ timestamp/–≤–µ—Ä—Å–∏–∏)
   ‚Üì
–í–æ–∑–≤—Ä–∞—â–∞–µ–º consistent data! ‚úÖ
```

**–¢–∏–ø–∏—á–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**

| N | W | R | –°–≤–æ–π—Å—Ç–≤–∞ |
|---|---|---|----------|
| 3 | 2 | 2 | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è HA, –ø–µ—Ä–µ–∂–∏–≤—ë—Ç –æ—Ç–∫–∞–∑ 1 –Ω–æ–¥—ã |
| 5 | 3 | 3 | –•–æ—Ä–æ—à–∞—è HA, –ø–µ—Ä–µ–∂–∏–≤—ë—Ç –æ—Ç–∫–∞–∑ 2 –Ω–æ–¥ |
| 7 | 4 | 4 | –í—ã—Å–æ–∫–∞—è HA, –ø–µ—Ä–µ–∂–∏–≤—ë—Ç –æ—Ç–∫–∞–∑ 3 –Ω–æ–¥ |
| 5 | 3 | 1 | –ë—ã—Å—Ç—Ä—ã–µ reads (eventual consistency) |
| 5 | 5 | 1 | Slow writes, fast reads (–¥–ª—è —Ä–µ–¥–∫–æ –º–µ–Ω—è—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö) |

### –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏

**Cassandra Quorum:**

```java
// Write —Å quorum
session.execute(
  "INSERT INTO users (id, name) VALUES (?, ?)",
  1, "Alice"
).setConsistencyLevel(ConsistencyLevel.QUORUM);

// Cassandra –∂–¥—ë—Ç ACK –æ—Ç (N/2 + 1) –Ω–æ–¥
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```
Replication Factor (N) = 3
Write consistency = QUORUM (2 –Ω–æ–¥)
Read consistency = QUORUM (2 –Ω–æ–¥)

‚Üí –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è strong consistency
‚Üí –ü–µ—Ä–µ–∂–∏–≤—ë—Ç –æ—Ç–∫–∞–∑ 1 –Ω–æ–¥—ã
```

**MongoDB Replica Set (write concern majority):**

```js
db.collection.insertOne(
  {name: "Alice"},
  {writeConcern: {w: "majority"}}
)

// –ñ–¥—ë—Ç ACK –æ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –Ω–æ–¥ –≤ replica set
```

**–ü—Ä–∏–º–µ—Ä:**
```
Replica Set: 3 –Ω–æ–¥—ã (Primary + 2 Secondaries)
Majority = 2

Write ‚Üí Primary + 1 Secondary ACK ‚Üí SUCCESS
```

**Etcd (Raft consensus):**

Etcd –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Raft ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º consensus based on quorum:
```
Cluster: 5 –Ω–æ–¥
Leader –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç write ‚Üí Followers
–ñ–¥—ë—Ç ACK –æ—Ç 3 –Ω–æ–¥ (quorum)
‚Üí Commit

[2 –Ω–æ–¥—ã —É–ø–∞–ª–∏]
‚Üí Quorum –µ—â—ë –µ—Å—Ç—å ‚Üí —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

[3 –Ω–æ–¥—ã —É–ø–∞–ª–∏]
‚Üí –ù–µ—Ç quorum ‚Üí —Ç–æ–ª—å–∫–æ read-only mode ‚ùå
```

**Kafka (min.insync.replicas):**

```properties
# Topic config
replication.factor=3
min.insync.replicas=2

# Producer config
acks=all
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
- 3 —Ä–µ–ø–ª–∏–∫–∏
- Producer –∂–¥—ë—Ç ACK –æ—Ç –º–∏–Ω–∏–º—É–º 2 —Ä–µ–ø–ª–∏–∫ (in-sync)
- –ï—Å–ª–∏ < 2 —Ä–µ–ø–ª–∏–∫ –¥–æ—Å—Ç—É–ø–Ω—ã ‚Üí write fails (safety!)

### –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞ 1: –ù–µ—á—ë—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–¥**

–ü–æ—á–µ–º—É –æ–±—ã—á–Ω–æ 3, 5, 7, –∞ –Ω–µ 4, 6?

```
4 –Ω–æ–¥—ã: Quorum = 3
- –ü–µ—Ä–µ–∂–∏–≤—ë—Ç –æ—Ç–∫–∞–∑ 1 –Ω–æ–¥—ã
- –ù–µ –ø–µ—Ä–µ–∂–∏–≤—ë—Ç –æ—Ç–∫–∞–∑ 2 –Ω–æ–¥

3 –Ω–æ–¥—ã: Quorum = 2
- –ü–µ—Ä–µ–∂–∏–≤—ë—Ç –æ—Ç–∫–∞–∑ 1 –Ω–æ–¥—ã
- –ù–µ –ø–µ—Ä–µ–∂–∏–≤—ë—Ç –æ—Ç–∫–∞–∑ 2 –Ω–æ–¥

‚Üí 4 –Ω–æ–¥—ã –Ω–µ –ª—É—á—à–µ 3, –Ω–æ –¥–æ—Ä–æ–∂–µ!
```

**–ü—Ä–∞–≤–∏–ª–æ:** –ò—Å–ø–æ–ª—å–∑—É–π –Ω–µ—á—ë—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–¥.

**–ü—Ä–æ–±–ª–µ–º–∞ 2: –ú–µ–¥–ª–µ–Ω–Ω–∞—è –Ω–æ–¥–∞ –≤ quorum**

–ï—Å–ª–∏ –æ–¥–Ω–∞ –Ω–æ–¥–∞ –º–µ–¥–ª–µ–Ω–Ω–∞—è, –Ω–æ –≤—Ö–æ–¥–∏—Ç –≤ quorum:
```
Write ‚Üí Node1 (fast): 1ms
     ‚Üí Node2 (fast): 1ms
     ‚Üí Node3 (slow): 100ms  ‚Üê Slow!

–ñ–¥—ë–º quorum (2 –∏–∑ 3):
‚Üí ACK –æ—Ç Node1 –∏ Node2
‚Üí SUCCESS (–Ω–µ –∂–¥—ë–º Node3!) ‚úÖ
```

–ù–æ –µ—Å–ª–∏ slow –Ω–æ–¥–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞:
```
Write ‚Üí Node1 (fast): 1ms
     ‚Üí Node2 (down): timeout
     ‚Üí Node3 (slow): 100ms

–ñ–¥—ë–º quorum (2 –∏–∑ 3):
‚Üí Node1 ACK
‚Üí Node2 timeout
‚Üí MUST wait for Node3... 100ms! üò±
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å latency –Ω–æ–¥
- –£–¥–∞–ª—è—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ/–±–∏—Ç—ã–µ –Ω–æ–¥—ã –∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞
- Health checks

**–ü—Ä–æ–±–ª–µ–º–∞ 3: Partial writes**

–ß—Ç–æ –µ—Å–ª–∏ write –Ω–∞ quorum —É—Å–ø–µ—à–µ–Ω, –Ω–æ –Ω–µ –≤—Å–µ –Ω–æ–¥—ã –ø–æ–ª—É—á–∏–ª–∏ –¥–∞–Ω–Ω—ã–µ?

```
Write X ‚Üí Node1 ‚úÖ
       ‚Üí Node2 ‚úÖ  ‚Üê Quorum!
       ‚Üí Node3 ‚ùå  ‚Üê Failed

[Node3 –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è]
‚Üí Node3 –∏–º–µ–µ—Ç old data!
```

**–†–µ—à–µ–Ω–∏–µ: Read Repair**
```
Read ‚Üí Node1: X (version 5)
    ‚Üí Node2: X (version 5)
    ‚Üí Node3: Y (version 3)  ‚Üê Old!

‚Üí Detect inconsistency
‚Üí Update Node3 with latest version
```

Cassandra, Riak –¥–µ–ª–∞—é—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

**–ü—Ä–æ–±–ª–µ–º–∞ 4: Quorum –≤ multi-datacenter**

–ï—Å–ª–∏ –Ω–æ–¥—ã –≤ —Ä–∞–∑–Ω—ã—Ö –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–∞—Ö:
```
DC1: Node1, Node2
DC2: Node3, Node4, Node5

Quorum = 3

Write ‚Üí –ñ–¥—ë–º ACK –æ—Ç 3 –Ω–æ–¥
‚Üí –ú–æ–∂–µ—Ç –±—ã—Ç—å –≤—Å–µ 3 –≤ DC2
‚Üí DC1 –º–æ–∂–µ—Ç –±—ã—Ç—å outdated!
```

**–†–µ—à–µ–Ω–∏–µ: Local Quorum**
```
Local Quorum –≤ –∫–∞–∂–¥–æ–º DC:
DC1: 2 –∏–∑ 2
DC2: 2 –∏–∑ 3

‚Üí –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–∞–∂–¥—ã–π DC –∏–º–µ–µ—Ç quorum
```

Cassandra –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `LOCAL_QUORUM`.

### –¢–∏–ø–∏—á–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 1: Even number of nodes**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
–ö–æ–º–ø–∞–Ω–∏—è —Ä–∞–∑–≤–µ—Ä–Ω—É–ª–∞ Kafka —Å 4 brokers, `min.insync.replicas=2`.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü—Ä–∏ –æ—Ç–∫–∞–∑–µ 2 brokers —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Å—Ç–∞–ª–∞ —Ä–∞–±–æ—Ç–∞—Ç—å
- –•–æ—Ç—è 2 broker –≤—Å—ë –µ—â—ë –∂–∏–≤—ã!

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- –ù—É–∂–Ω–æ –±—ã–ª–æ 3 broker –¥–ª—è quorum, –Ω–æ —Ç–æ–ª—å–∫–æ 2 –∂–∏–≤—ã
- 4 –Ω–æ–¥—ã –Ω–µ –ª—É—á—à–µ 3 –¥–ª—è fault tolerance

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—á—ë—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–¥ (3 –∏–ª–∏ 5)

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 2: Latency –∏–∑-–∑–∞ slow node**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
MongoDB replica set (3 –Ω–æ–¥—ã) —Å `w: majority`. –û–¥–Ω–∞ –Ω–æ–¥–∞ –±—ã–ª–∞ –≤ –¥—Ä—É–≥–æ–º —Ä–µ–≥–∏–æ–Ω–µ (high latency).

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ö–∞–∂–¥—ã–π write –∂–¥–∞–ª slow –Ω–æ–¥—É
- Latency writes: 200ms+

**–†–µ—à–µ–Ω–∏–µ:**
- –ù–µ —Å–º–µ—à–∏–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏ —É–¥–∞–ª—ë–Ω–Ω—ã–µ –Ω–æ–¥—ã –≤ –æ–¥–Ω–æ–º replica set
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LOCAL_QUORUM –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö writes

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 3: Lost quorum**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
Etcd –∫–ª–∞—Å—Ç–µ—Ä (3 –Ω–æ–¥—ã). 2 –Ω–æ–¥—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —É–ø–∞–ª–∏ (hardware failure).

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –û—Å—Ç–∞–ª—Å—è 1 –∏–∑ 3 ‚Üí –Ω–µ—Ç quorum
- Etcd –ø–µ—Ä–µ—à—ë–ª –≤ read-only mode
- Kubernetes (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª etcd) –Ω–µ –º–æ–≥ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- Partial outage

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 5 –Ω–æ–¥ –¥–ª—è critical —Å–∏—Å—Ç–µ–º (–ø–µ—Ä–µ–∂–∏–≤—É—Ç –æ—Ç–∫–∞–∑ 2 –Ω–æ–¥)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å health –∫–ª–∞—Å—Ç–µ—Ä–∞

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å quorum durability

**‚úÖ –í—Å–µ–≥–¥–∞ –¥–ª—è:**
- Distributed consensus (etcd, ZooKeeper)
- Distributed databases (Cassandra, MongoDB)
- Critical data, –≥–¥–µ –Ω—É–∂–Ω–∞ strong consistency

**‚öñÔ∏è Trade-off:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–¥ (fault tolerance vs cost)
- W/R values (consistency vs latency)

**‚ùå –ú–æ–∂–µ—Ç –Ω–µ –Ω—É–∂–Ω–∞ –¥–ª—è:**
- Single datacenter —Å good redundancy
- –ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ quorum:**
Quorum ‚Äî —ç—Ç–æ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç split brain –∏ data loss. –ù–æ —Ç—Ä–µ–±—É–µ—Ç –º–∏–Ω–∏–º—É–º 3 –Ω–æ–¥—ã –∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è trade-offs.

---

## 7. Geo-Replicated Durability ‚Äî –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –î–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å

### –ß—Ç–æ —ç—Ç–æ?

**Geo-replicated durability** (–≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å) ‚Äî –¥–∞–Ω–Ω—ã–µ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É—é—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–æ–≤ (—Ä–µ–≥–∏–æ–Ω–æ–≤). –≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∏—Ö —Å–±–æ–µ–≤ —Ü–µ–ª–æ–≥–æ –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–∞.

**–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–Ω—Ü–∏–ø:**
```
"–î–∞–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∞—Ö/–∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–∞—Ö ‚Üí –ø–æ—Ç–µ—Ä—è –æ–¥–Ω–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞ –Ω–µ —Å—Ç—Ä–∞—à–Ω–∞"
```

**–ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
- ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∂–∏–≤—É—Ç –æ—Ç–∫–∞–∑ —Ü–µ–ª–æ–≥–æ –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–∞
- ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∂–∏–≤—É—Ç –ø—Ä–∏—Ä–æ–¥–Ω—ã–µ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã (–∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–µ, –Ω–∞–≤–æ–¥–Ω–µ–Ω–∏–µ)
- ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∂–∏–≤—É—Ç —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–∞ –≤ –≥–æ—Ä–æ–¥–µ)
- ‚úÖ –ù–∏–∑–∫–∞—è latency –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—á–∏—Ç–∞—é—Ç –∏–∑ –±–ª–∏–∂–∞–π—à–µ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞)
- ‚úÖ Disaster Recovery (DR)

**–ß–µ–≥–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:**
- ‚ùå –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è latency –¥–ª—è writes (–º–µ–∂—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–µ—Ç—å)
- ‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å consistency (CAP theorem)
- ‚ùå –û—á–µ–Ω—å –¥–æ—Ä–æ–≥–æ (–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö)
- ‚ùå –ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç logical errors (–±–∏—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É—é—Ç—Å—è –≤–µ–∑–¥–µ)

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

**Multi-region —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è:**
```
     [US-East]
        ‚Üì
Client ‚Üí Primary DC
        ‚Üì
        ‚îú‚îÄ‚îÄ‚Üí [US-West]    (sync/async)
        ‚îú‚îÄ‚îÄ‚Üí [EU-Central] (sync/async)
        ‚îî‚îÄ‚îÄ‚Üí [Asia-Pacific] (sync/async)
```

**Latency –º–µ–∂–¥—É —Ä–µ–≥–∏–æ–Ω–∞–º–∏:**
```
Same DC:           < 1 ms
Same city:         ~ 1-2 ms
Same country:      ~ 10-50 ms
Cross-continent:   ~ 100-300 ms
Around the world:  ~ 200-500 ms
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç: geo-replication –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—É—é latency!

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã geo-replication

**1. Active-Passive (Disaster Recovery)**

–û–¥–∏–Ω region –∞–∫—Ç–∏–≤–µ–Ω, –æ—Å—Ç–∞–ª—å–Ω—ã–µ backup:
```
[US-East] ‚Üê Active (–≤—Å–µ writes)
   ‚Üì
[US-West] ‚Üê Passive (–ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é, standby)

–ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞:
Client ‚Üí US-East
   ‚Üì
Async replication ‚Üí US-West

[US-East FAILED!]
   ‚Üì
Failover ‚Üí US-West —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è Active
   ‚Üì
Clients ‚Üí US-West
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞
- ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (–æ–¥–∏–Ω active)

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå Passive —Ä–µ–≥–∏–æ–Ω –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (waste of resources)
- ‚ùå Failover –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –º–∏–Ω—É—Ç—ã
- ‚ùå –í–æ–∑–º–æ–∂–Ω–∞ –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö (async replication)

**2. Active-Active (Multi-Master)**

–í—Å–µ —Ä–µ–≥–∏–æ–Ω—ã –∞–∫—Ç–∏–≤–Ω—ã, –ø—Ä–∏–Ω–∏–º–∞—é—Ç writes:
```
[US-East] ‚Üê Active
   ‚Üï (replication)
[EU-Central] ‚Üê Active
   ‚Üï (replication)
[Asia-Pacific] ‚Üê Active

Client –≤ US ‚Üí US-East
Client –≤ EU ‚Üí EU-Central
Client –≤ Asia ‚Üí Asia-Pacific

‚Üí –í—Å–µ writes —Ä–µ–ø–ª–∏—Ü–∏—Ä—É—é—Ç—Å—è –¥—Ä—É–≥ –¥—Ä—É–≥—É
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ù–∏–∑–∫–∞—è latency (–ø–∏—à–µ–º –≤ –±–ª–∏–∂–∞–π—à–∏–π —Ä–µ–≥–∏–æ–Ω)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å–µ —Ä–µ–≥–∏–æ–Ω—ã

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã! (–¥–≤–∞ —Ä–µ–≥–∏–æ–Ω–∞ –∏–∑–º–µ–Ω–∏–ª–∏ –æ–¥–Ω–∏ –¥–∞–Ω–Ω—ã–µ)
- ‚ùå Eventual consistency
- ‚ùå –°–ª–æ–∂–Ω–∞—è conflict resolution

**3. Geo-Distributed Consensus (Spanner-style)**

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è distributed consensus (Paxos/Raft) –º–µ–∂–¥—É —Ä–µ–≥–∏–æ–Ω–∞–º–∏:
```
[US-East] ‚Üê Leader
   ‚Üì
Writes ‚Üí Replicate to Followers ‚Üí Wait for quorum
   ‚Üì
[US-West]
[EU-Central]

Quorum: 2 –∏–∑ 3
‚Üí Strong consistency –º–µ–∂–¥—É —Ä–µ–≥–∏–æ–Ω–∞–º–∏!
```

**–ü–ª—é—Å—ã:**
- ‚úÖ Strong consistency
- ‚úÖ Linearizability

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è latency (–∂–¥—ë–º cross-region quorum)
- ‚ùå –°–ª–æ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

### –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏

**AWS RDS Multi-Region:**

**Async replication:**
```
Primary DB –≤ us-east-1
   ‚Üì
Read Replica –≤ eu-west-1 (async)

[Primary FAILED]
‚Üí Promote Replica to Primary (manual or automatic)
‚Üí –ú–æ–∂–µ—Ç –±—ã—Ç—å replication lag (–ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö)
```

**AWS Aurora Global Database:**
```
Primary Region: us-east-1
Secondary Region: eu-west-1

Replication lag: < 1 second

Failover: < 1 minute
```

**Google Cloud Spanner:**

Spanner –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Paxos –¥–ª—è strong consistency –º–µ–∂–¥—É —Ä–µ–≥–∏–æ–Ω–∞–º–∏:
```sql
-- Write –≤ Spanner
INSERT INTO users VALUES (1, 'Alice');

-- Spanner:
1. –í—ã–±–∏—Ä–∞–µ—Ç Paxos leader
2. Replicates –Ω–∞ majority –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö
3. Waits for quorum ACK
4. Returns SUCCESS

‚Üí Linearizable, –Ω–æ latency 50-500ms
```

**Cassandra Multi-DC:**

```
DC1 (US-East): 3 –Ω–æ–¥—ã
DC2 (EU-West): 3 –Ω–æ–¥—ã

Replication Strategy:
NetworkTopologyStrategy {
  DC1: 3,  // 3 —Ä–µ–ø–ª–∏–∫–∏ –≤ US
  DC2: 3   // 3 —Ä–µ–ø–ª–∏–∫–∏ –≤ EU
}

Write:
LOCAL_QUORUM –≤ DC1 (2 –∏–∑ 3)
Async replication ‚Üí DC2

Read:
LOCAL_QUORUM –≤ DC1 (—á–∏—Ç–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ)
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ù–∏–∑–∫–∞—è latency (–ø–∏—à–µ–º –ª–æ–∫–∞–ª—å–Ω–æ)
- ‚úÖ Disaster recovery (–¥—Ä—É–≥–æ–π DC –∂–∏–≤–æ–π)

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå Eventual consistency –º–µ–∂–¥—É DC
- ‚ùå –í–æ–∑–º–æ–∂–Ω–∞ –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ DC (async)

**MongoDB Global Clusters:**

```
Primary –≤ US-East
Secondaries –≤ US-West, EU-Central

Write Concern: {w: "majority", wtimeout: 5000}

‚Üí –ñ–¥—ë—Ç majority (2 –∏–∑ 3)
‚Üí –ú–æ–∂–µ—Ç –±—ã—Ç—å cross-region latency
```

**Kafka Multi-Datacenter:**

**MirrorMaker (async replication):**
```
DC1: Kafka Cluster 1
   ‚Üì
MirrorMaker (consumer + producer)
   ‚Üì
DC2: Kafka Cluster 2

‚Üí Async, eventual consistency
‚Üí Latency –∑–∞–≤–∏—Å–∏—Ç –æ—Ç network
```

**Confluent Replicator (better):**
- –ú–µ–Ω—å—à–µ lag
- Offset translation
- Topic mapping

### CAP Theorem –∏ Geo-Replication

**CAP Theorem:**
```
C: Consistency (–≤—Å–µ –≤–∏–¥—è—Ç –æ–¥–Ω–∏ –¥–∞–Ω–Ω—ã–µ)
A: Availability (—Å–∏—Å—Ç–µ–º–∞ –≤—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–µ—Ç)
P: Partition Tolerance (—Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ network split)

‚Üí –ú–æ–∂–µ—à—å –≤—ã–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ 2 –∏–∑ 3!
```

**–í geo-replication context:**

**CP (Consistency + Partition Tolerance):**
```
Spanner, etcd, ZooKeeper

[Network partition –º–µ–∂–¥—É —Ä–µ–≥–∏–æ–Ω–∞–º–∏]
‚Üí –°–∏—Å—Ç–µ–º–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç writes (—Ç—Ä–µ–±—É–µ—Ç quorum)
‚Üí Consistency —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è ‚úÖ
‚Üí Availability —Å—Ç—Ä–∞–¥–∞–µ—Ç ‚ùå
```

**AP (Availability + Partition Tolerance):**
```
Cassandra (eventual consistency), DynamoDB

[Network partition –º–µ–∂–¥—É —Ä–µ–≥–∏–æ–Ω–∞–º–∏]
‚Üí –ö–∞–∂–¥—ã–π —Ä–µ–≥–∏–æ–Ω –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
‚Üí Availability —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è ‚úÖ
‚Üí Consistency —Å—Ç—Ä–∞–¥–∞–µ—Ç (stale reads) ‚ùå
‚Üí –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —Ä–µ–∑–æ–ª–≤–∏—Ç—å
```

**–í—ã–±–æ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π:**
- –ë–∞–Ω–∫: CP (consistency –≤–∞–∂–Ω–µ–µ)
- –°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Ç—å: AP (availability –≤–∞–∂–Ω–µ–µ)

### –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤ Active-Active

**–ü—Ä–æ–±–ª–µ–º–∞: –î–≤–∞ —Ä–µ–≥–∏–æ–Ω–∞ –∏–∑–º–µ–Ω–∏–ª–∏ –æ–¥–Ω–∏ –¥–∞–Ω–Ω—ã–µ**

```
User balance = $100

US-East:  Withdraw $50  ‚Üí balance = $50
EU-West:  Withdraw $60  ‚Üí balance = $40

[Replication sync]

–ö–∞–∫–æ–π balance –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π? üò±
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è:**

**1. Last-Write-Wins (LWW):**
```
–ò—Å–ø–æ–ª—å–∑—É–µ–º timestamp:
US-East:  10:00:00.000 ‚Üí balance = $50
EU-West:  10:00:00.100 ‚Üí balance = $40

‚Üí EU-West –ø–æ–∑–∂–µ ‚Üí wins
‚Üí Final: $40

–ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Ç–µ—Ä—è–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—é –≤ US-East! ‚ùå
```

**2. Version Vectors / Vector Clocks:**
```
–ö–∞–∂–¥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –∏–º–µ–µ—Ç –≤–µ—Ä—Å–∏—é:
US-East:  [US:1, EU:0] ‚Üí balance = $50
EU-West:  [US:0, EU:1] ‚Üí balance = $40

‚Üí Conflict detected (–Ω–µ clear winner)
‚Üí –ù—É–∂–Ω–∞ manual resolution –∏–ª–∏ merge logic
```

**3. CRDTs (Conflict-Free Replicated Data Types):**
```
–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ merge:

–ü—Ä–∏–º–µ—Ä: Grow-Only Counter
US-East:  Increment ‚Üí count = 1
EU-West:  Increment ‚Üí count = 1

Merge: sum = 2 ‚úÖ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)
```

**4. Operational Transform:**
```
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Google Docs, collaborative editing

–û–ø–µ—Ä–∞—Ü–∏–∏:
US: "Insert 'A' at position 0"
EU: "Insert 'B' at position 0"

Transform ‚Üí Merge:
Final: "AB" –∏–ª–∏ "BA" (consistent ordering)
```

### –¢–∏–ø–∏—á–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 1: AWS US-East-1 Outage (2017)**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
–ö—Ä—É–ø–Ω—ã–π outage –≤ US-East-1. –ú–Ω–æ–≥–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–µ–≥–ª–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤—Å—ë –±—ã–ª–æ –≤ –æ–¥–Ω–æ–º —Ä–µ–≥–∏–æ–Ω–µ.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –î–∞–∂–µ –∫–æ–º–ø–∞–Ω–∏–∏ —Å "HA" –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –ª–µ–≥–ª–∏
- –ü–æ—Ç–æ–º—É —á—Ç–æ –≤—Å—ë –±—ã–ª–æ –≤ US-East-1

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- –ù–µ –±—ã–ª–æ geo-replication
- Single region = single point of failure

**–†–µ—à–µ–Ω–∏–µ:**
- Multi-region deployments
- Active-passive –∏–ª–∏ active-active

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 2: –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤ multi-master**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
E-commerce –∫–æ–º–ø–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ active-active –±–∞–∑—É (Cassandra) –≤ US –∏ EU. –î–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö –∫—É–ø–∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ç–æ–≤–∞—Ä.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –û–±–∞ —Ä–µ–≥–∏–æ–Ω–∞ –ø—Ä–æ–¥–∞–ª–∏ —Ç–æ–≤–∞—Ä (LWW)
- Oversold (–ø—Ä–æ–¥–∞–ª–∏ –±–æ–ª—å—à–µ, —á–µ–º –±—ã–ª–æ)

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- Eventual consistency
- Last-Write-Wins –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è inventory

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CP —Å–∏—Å—Ç–µ–º—É –¥–ª—è inventory (strong consistency)
- –ò–ª–∏ sharding –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º (US —Ç–æ–≤–∞—Ä—ã –≤ US, EU –≤ EU)

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 3: –î–æ–ª–≥–∏–π failover**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
–ö–æ–º–ø–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ active-passive —Å manual failover. Primary —Ä–µ–≥–∏–æ–Ω —É–ø–∞–ª.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- Failover –∑–∞–Ω—è–ª 2 —á–∞—Å–∞ (manual process)
- Downtime 2 —á–∞—Å–∞

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- Manual failover
- –ù–µ –±—ã–ª–æ automation

**–†–µ—à–µ–Ω–∏–µ:**
- Automated failover
- –†–µ–≥—É–ª—è—Ä–Ω—ã–µ DR drills (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å failover!)

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 4: Replication lag**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
–ö–æ–º–ø–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ async geo-replication. Primary —Ä–µ–≥–∏–æ–Ω —É–ø–∞–ª. Secondary –±—ã–ª 30 –º–∏–Ω—É—Ç behind.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–æ—Å–ª–µ failover –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥–µ–ª–∏ old data
- –ü–æ—Ç–µ—Ä—è–Ω—ã 30 –º–∏–Ω—É—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–†–µ—à–µ–Ω–∏–µ:**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å replication lag
- –ê–ª–µ—Ä—Ç—ã, –µ—Å–ª–∏ lag > threshold
- Semi-sync —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–ª—è critical –¥–∞–Ω–Ω—ã—Ö

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å geo-replication

**‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è:**
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã (—Ñ–∏–Ω–∞–Ω—Å—ã, healthcare)
- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É)
- Disaster Recovery requirements

**‚öñÔ∏è Trade-off:**
- Consistency vs Latency
- Cost vs Reliability

**‚ùå –ú–æ–∂–µ—Ç –Ω–µ –Ω—É–∂–Ω–∞ –¥–ª—è:**
- –õ–æ–∫–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –≥–æ—Ä–æ–¥/—Å—Ç—Ä–∞–Ω–∞)
- –ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –°—Ç–∞—Ä—Ç–∞–ø—ã (–ø–æ–∫–∞ –Ω–µ –Ω—É–∂–Ω–æ)

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ geo-replication:**
Geo-replication ‚Äî —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –¥–ª—è enterprise —Å–∏—Å—Ç–µ–º, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏—è CAP theorem –∏ trade-offs. –ù–µ –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º.

---

## 8. Acknowledgement Durability Semantics ‚Äî –°–µ–º–∞–Ω—Ç–∏–∫–∞ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π

### –ß—Ç–æ —ç—Ç–æ?

**Acknowledgement (ACK) durability semantics** ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, **–∫–æ–≥–¥–∞** —Å–∏—Å—Ç–µ–º–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É, –∏ **—á—Ç–æ —ç—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç**.

**–ö–ª—é—á–µ–≤–æ–π –≤–æ–ø—Ä–æ—Å:**
```
–°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª "OK" ‚Üí —á—Ç–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç?
- –î–∞–Ω–Ω—ã–µ –≤ RAM?
- –î–∞–Ω–Ω—ã–µ –Ω–∞ –¥–∏—Å–∫–µ?
- –î–∞–Ω–Ω—ã–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö?
- –î–∞–Ω–Ω—ã–µ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö?
```

–û—Ç —ç—Ç–æ–≥–æ –∑–∞–≤–∏—Å–∏—Ç, –º–æ–∂–µ—à—å –ª–∏ —Ç—ã –ø–æ—Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è ACK.

**–û—Å–Ω–æ–≤–Ω–æ–π trade-off:**
```
–†–∞–Ω–Ω–∏–π ACK = –ë—ã—Å—Ç—Ä–æ, –Ω–æ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ
–ü–æ–∑–¥–Ω–∏–π ACK = –ú–µ–¥–ª–µ–Ω–Ω–æ, –Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ
```

### –£—Ä–æ–≤–Ω–∏ ACK

**1. ACK after Memory Write (—Å–∞–º—ã–π —Å–ª–∞–±—ã–π)**

```
Client ‚Üí Server
Server: –ó–∞–ø–∏—Å–∞–ª –≤ RAM
Server ‚Üí ACK ‚úÖ

[CRASH]
‚Üí –î–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã! ‚ùå
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- Redis –±–µ–∑ persistence
- Memcached

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –¢–æ–ª—å–∫–æ –¥–ª—è –∫–µ—à–µ–π, –≥–¥–µ –ø–æ—Ç–µ—Ä—è –ø—Ä–∏–µ–º–ª–µ–º–∞.

**2. ACK after Local Disk Write (without fsync)**

```
Client ‚Üí Server
Server: –ó–∞–ø–∏—Å–∞–ª –≤ OS buffer (–Ω–µ fsync!)
Server ‚Üí ACK ‚úÖ

[POWER FAILURE]
‚Üí OS buffer –ø–æ—Ç–µ—Ä—è–Ω ‚Üí –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã! ‚ùå
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- Postgres —Å `fsync=off`
- MongoDB —Å `{j: false}`

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ù–∏–∫–æ–≥–¥–∞ –≤ production!

**3. ACK after Fsync (–ª–æ–∫–∞–ª—å–Ω–∞—è durability)**

```
Client ‚Üí Server
Server: –ó–∞–ø–∏—Å–∞–ª –Ω–∞ –¥–∏—Å–∫ + fsync
Server ‚Üí ACK ‚úÖ

[POWER FAILURE]
‚Üí –î–∞–Ω–Ω—ã–µ –Ω–∞ –¥–∏—Å–∫–µ ‚úÖ

[DISK FAILURE]
‚Üí –î–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã ‚ùå
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- SQLite —Å fsync
- Postgres —Å `fsync=on` (single instance)
- Redis AOF —Å `appendfsync always`

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** Development, –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã —Å backups.

**4. ACK after Local Replication Quorum**

```
Client ‚Üí Server
Server: –ó–∞–ø–∏—Å–∞–ª –ª–æ–∫–∞–ª—å–Ω–æ + —Ä–µ–ø–ª–∏–∫–∏ –≤ —Ç–æ–º –∂–µ DC
Replicas: ACK (quorum)
Server ‚Üí ACK ‚úÖ

[PRIMARY FAILED]
‚Üí Failover –Ω–∞ —Ä–µ–ø–ª–∏–∫—É ‚Üí –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ—Ç–µ—Ä—è–Ω—ã ‚úÖ

[DATACENTER FAILED]
‚Üí –í–µ—Å—å DC –ø–æ—Ç–µ—Ä—è–Ω ‚Üí –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã ‚ùå
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- MongoDB —Å `{w: "majority"}`
- Postgres synchronous replication
- Kafka —Å `acks=all`, `min.insync.replicas=2`

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** Production systems –≤ single region.

**5. ACK after Geo-Replication Quorum (—Å–∏–ª—å–Ω–µ–π—à–∏–π)**

```
Client ‚Üí Server
Server: –ó–∞–ø–∏—Å–∞–ª –≤ primary DC + —É–¥–∞–ª—ë–Ω–Ω—ã–µ DC
Remote DCs: ACK (quorum)
Server ‚Üí ACK ‚úÖ

[PRIMARY DC FAILED]
‚Üí Failover –Ω–∞ –¥—Ä—É–≥–æ–π DC ‚Üí –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ—Ç–µ—Ä—è–Ω—ã ‚úÖ

[MULTIPLE DCs FAILED]
‚Üí –ï—Å–ª–∏ quorum –ø–æ—Ç–µ—Ä—è–Ω ‚Üí –ø—Ä–æ–±–ª–µ–º—ã ‚ùå
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- Google Spanner
- CockroachDB
- AWS Aurora Global Database

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** Mission-critical systems, –≥–¥–µ durability –≤–∞–∂–Ω–µ–µ latency.

### –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

**Kafka Producer ACK Levels:**

```java
// acks=0: Fire-and-forget
// ACK –Ω–µ –∂–¥—ë–º –≤–æ–æ–±—â–µ! Producer –Ω–µ –∑–Ω–∞–µ—Ç, –∑–∞–ø–∏—Å–∞–ª–æ—Å—å –ª–∏.
props.put("acks", "0");
```
**–ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:** –ù–∏—á–µ–≥–æ! –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±—ã—Å—Ç—Ä–æ, –Ω–æ –º–æ–∂–µ—à—å –ø–æ—Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ.

```java
// acks=1: Leader ACK
// ACK –æ—Ç leader broker (–∑–∞–ø–∏—Å–∞–ª –≤ —Å–≤–æ–π –ª–æ–≥)
props.put("acks", "1");
```
**–ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:** –î–∞–Ω–Ω—ã–µ –Ω–∞ leader. –ï—Å–ª–∏ leader —É–ø–∞–¥—ë—Ç –¥–æ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ ‚Üí –ø–æ—Ç–µ—Ä—è.

```java
// acks=all: Quorum ACK
// ACK –æ—Ç –≤—Å–µ—Ö in-sync replicas
props.put("acks", "all");
props.put("min.insync.replicas", "2");
```
**–ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:** –î–∞–Ω–Ω—ã–µ –Ω–∞ leader + –º–∏–Ω–∏–º—É–º 1 —Ä–µ–ø–ª–∏–∫–µ. Durability! ‚úÖ

**MongoDB Write Concern:**

```js
// w: 0 - Unacknowledged
db.collection.insertOne({...}, {writeConcern: {w: 0}})
// ACK –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–µ –∂–¥—ë–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
```

```js
// w: 1 - Acknowledged (default)
db.collection.insertOne({...}, {writeConcern: {w: 1}})
// ACK –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ primary (–Ω–æ –Ω–µ –Ω–∞ secondaries)
```

```js
// w: "majority" - Majority ACK
db.collection.insertOne({...}, {writeConcern: {w: "majority"}})
// ACK –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ä–µ–ø–ª–∏–∫
```

```js
// j: true - Journaled
db.collection.insertOne({...}, {writeConcern: {w: 1, j: true}})
// ACK –ø–æ—Å–ª–µ fsync journal (durability!)
```

**–ö–æ–º–±–∏–Ω–∞—Ü–∏—è:**
```js
db.collection.insertOne({...}, {
  writeConcern: {
    w: "majority",  // –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ä–µ–ø–ª–∏–∫
    j: true,        // –° fsync journal
    wtimeout: 5000  // Timeout 5 —Å–µ–∫—É–Ω–¥
  }
})
```
**–°–∞–º–∞—è —Å–∏–ª—å–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è!** –ù–æ –º–µ–¥–ª–µ–Ω–Ω–æ.

**Postgres Synchronous Replication:**

```sql
-- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è (default)
-- Primary ACK'–∞–µ—Ç —Å—Ä–∞–∑—É
-- –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –≤ —Ñ–æ–Ω–µ

-- –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è
ALTER SYSTEM SET synchronous_commit = 'on';
ALTER SYSTEM SET synchronous_standby_names = 'standby1';

-- –¢–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π COMMIT –∂–¥—ë—Ç ACK –æ—Ç standby1!
```

**–£—Ä–æ–≤–Ω–∏ `synchronous_commit`:**
- `off`: –ù–µ –∂–¥—ë–º –¥–∞–∂–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ fsync (–æ–ø–∞—Å–Ω–æ!)
- `local`: –ñ–¥—ë–º –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ fsync
- `remote_write`: –ñ–¥—ë–º, –ø–æ–∫–∞ standby –ø–æ–ª—É—á–∏–ª (–Ω–æ –Ω–µ fsync)
- `on`: –ñ–¥—ë–º, –ø–æ–∫–∞ standby –ø–æ–ª—É—á–∏–ª –∏ fsync'–Ω—É–ª (–±–µ–∑–æ–ø–∞—Å–Ω–æ!)
- `remote_apply`: –ñ–¥—ë–º, –ø–æ–∫–∞ standby –ø—Ä–∏–º–µ–Ω–∏–ª (—Å–∞–º–æ–µ –º–µ–¥–ª–µ–Ω–Ω–æ–µ)

**RabbitMQ Message Durability:**

```python
# Declare durable queue
channel.queue_declare(queue='tasks', durable=True)

# Publish message —Å persistence
channel.basic_publish(
    exchange='',
    routing_key='tasks',
    body='Hello',
    properties=pika.BasicProperties(
        delivery_mode=2,  # 2 = persistent
    )
)
```

**–ù–æ!** –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é RabbitMQ –Ω–µ fsync'–∏—Ç –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–±–∞—Ç—á–∏—Ç).

**–î–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–π:**
```python
# –ò—Å–ø–æ–ª—å–∑—É–π publisher confirms
channel.confirm_delivery()
channel.basic_publish(...)

# –ë–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ ACK –æ—Ç broker (—Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫–µ)
```

### Visibility vs Durability ACK

**–í–∞–∂–Ω–æ–µ —Ä–∞–∑–ª–∏—á–∏–µ:**

**Visibility ACK:** "–î—Ä—É–≥–∏–µ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å –¥–∞–Ω–Ω—ã–µ"
**Durability ACK:** "–î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ—Ç–µ—Ä—è—é—Ç—Å—è"

–≠—Ç–æ –ù–ï –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ!

**–ü—Ä–∏–º–µ—Ä:**

```
Postgres:
1. BEGIN
2. INSERT data
3. COMMIT ‚Üê ACK (durability!)
   ‚Üì
   –î–∞–Ω–Ω—ã–µ –Ω–∞ –¥–∏—Å–∫–µ, –Ω–æ –¥—Ä—É–≥–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏—Ö –≤–∏–¥—è—Ç?
   ‚Üí –ó–∞–≤–∏—Å–∏—Ç –æ—Ç isolation level!
```

**Kafka:**
```
Producer –ø–∏—à–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
   ‚Üì
ACK (durability - –Ω–∞ –¥–∏—Å–∫–µ/—Ä–µ–ø–ª–∏–∫–∞—Ö)
   ‚Üì
–ù–æ Consumer –≤–∏–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ?
   ‚Üí –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ commit offset!
```

–ù–µ –ø—É—Ç–∞–π durability (–Ω–µ –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è) —Å visibility (–º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å).

### –¢–∏–ø–∏—á–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 1: "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ" —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—Ç–µ—Ä—è–Ω—ã**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
–ö–æ–º–ø–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ Kafka —Å `acks=1`. Producer –ø–æ–ª—É—á–∞–ª ACK. Leader broker —É–ø–∞–ª –¥–æ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—É—á–∏–ª–∏ ACK, –ø–æ—Ç–µ—Ä—è–Ω—ã
- Producer –¥—É–º–∞–ª, —á—Ç–æ –≤—Å—ë –∑–∞–ø–∏—Å–∞–ª–æ—Å—å

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- `acks=1` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ leader
- –ù–µ—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –¥–æ ACK

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `acks=all` —Å `min.insync.replicas >= 2`

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 2: MongoDB –±–µ–∑ majority write concern**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–∏—Å–∞–ª–æ –≤ MongoDB —Å default write concern (`w:1`). Primary —É–ø–∞–ª –¥–æ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –û–ø–µ—Ä–∞—Ü–∏–∏, –ø–æ–ª—É—á–∏–≤—à–∏–µ ACK, –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å –Ω–∞ secondaries
- –ü–æ—Å–ª–µ failover –¥–∞–Ω–Ω—ã–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `w: "majority"` –¥–ª—è critical writes

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 3: RabbitMQ publisher –±–µ–∑ confirms**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
Producer –æ—Ç–ø—Ä–∞–≤–ª—è–ª —Å–æ–æ–±—â–µ–Ω–∏—è –≤ RabbitMQ –±–µ–∑ publisher confirms. –°–µ—Ç—å –±—ã–ª–∞ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –¥–æ—à–ª–∏
- Producer –Ω–µ –∑–Ω–∞–ª –æ–± —ç—Ç–æ–º (–¥—É–º–∞–ª, —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–ª)

**–†–µ—à–µ–Ω–∏–µ:**
- –í–∫–ª—é—á–∏—Ç—å publisher confirms
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å nack/timeout

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 4: Async —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è —Å –∫–æ—Ä–æ—Ç–∫–∏–º timeout**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ sync —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é —Å timeout 1 —Å–µ–∫—É–Ω–¥–∞. –ü—Ä–∏ network lag timeout —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª, —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏–ª–∞ –≤ async mode.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í–æ –≤—Ä–µ–º—è –ø—Ä–æ–±–ª–µ–º —Å —Å–µ—Ç—å—é —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Ä—è–ª–∞ durability guarantees
- –ü–æ—Å–ª–µ failover –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö

**–†–µ—à–µ–Ω–∏–µ:**
- –ê–¥–µ–∫–≤–∞—Ç–Ω—ã–π timeout (5-10 —Å–µ–∫—É–Ω–¥)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å replication lag
- –ê–ª–µ—Ä—Ç—ã, –µ—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ fallback to async

### –ú–∞—Ç—Ä–∏—Ü–∞ Durability vs Latency

| ACK Level | Durability | Latency | Use Case |
|-----------|------------|---------|----------|
| Memory —Ç–æ–ª—å–∫–æ | –ù–∏–∑–∫–∞—è | <1ms | –ö–µ—à–∏, temporary data |
| Local fsync | –°—Ä–µ–¥–Ω—è—è | 1-10ms | Single-node systems, dev |
| Local quorum | –•–æ—Ä–æ—à–∞—è | 5-20ms | Production single-region |
| Geo-quorum | –û—Ç–ª–∏—á–Ω–∞—è | 50-500ms | Mission-critical multi-region |

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–±–æ—Ä—É ACK level

**–ó–∞–¥–∞–π —Å–µ–±–µ –≤–æ–ø—Ä–æ—Å—ã:**

1. **–ú–æ–∂–µ—à—å –ª–∏ —Ç—ã –ø–æ–∑–≤–æ–ª–∏—Ç—å —Å–µ–±–µ –ø–æ—Ç–µ—Ä—è—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ?**
   - –ù–µ—Ç ‚Üí –ù—É–∂–Ω–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è (quorum ACK)
   - –î–∞ ‚Üí –ú–æ–∂–Ω–æ local –∏–ª–∏ –¥–∞–∂–µ memory

2. **–°–∫–æ–ª—å–∫–æ –Ω–æ–¥ –º–æ–≥—É—Ç —É–ø–∞—Å—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?**
   - 0-1 ‚Üí Local replication quorum (N=3, W=2)
   - 2+ ‚Üí Geo-replication quorum (N=5+, W=3+)

3. **–ö–∞–∫–∞—è latency –ø—Ä–∏–µ–º–ª–µ–º–∞?**
   - <10ms ‚Üí Local replication
   - <100ms ‚Üí –ú–æ–∂–µ—Ç –±—ã—Ç—å geo-replication
   - >100ms ‚Üí –¢–æ—á–Ω–æ geo-replication

4. **–ù—É–∂–Ω–∞ –ª–∏ strong consistency?**
   - –î–∞ ‚Üí Synchronous ACK (wait for quorum)
   - –ù–µ—Ç ‚Üí –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è (eventual consistency)

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ ACK:**
```
"–¢—ã –º–æ–∂–µ—à—å –ø–æ—Ç–µ—Ä—è—Ç—å –ª—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö —Ç—ã ACK'–Ω—É–ª —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ"
```

–ï—Å–ª–∏ ACK –æ–∑–Ω–∞—á–∞–µ—Ç "–≤ –ø–∞–º—è—Ç–∏" ‚Äî –ø–æ—Ç–µ—Ä—è–µ—à—å –ø—Ä–∏ —Å–±–æ–µ.
–ï—Å–ª–∏ ACK –æ–∑–Ω–∞—á–∞–µ—Ç "–Ω–∞ –¥–∏—Å–∫–µ" ‚Äî –ø–æ—Ç–µ—Ä—è–µ—à—å –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ –¥–∏—Å–∫–∞.
–ï—Å–ª–∏ ACK –æ–∑–Ω–∞—á–∞–µ—Ç "–Ω–∞ quorum —Å–µ—Ä–≤–µ—Ä–æ–≤" ‚Äî –Ω–µ –ø–æ—Ç–µ—Ä—è–µ—à—å –ø—Ä–∏ failover.

---

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ Durability Levels

| Durability Level | –ß—Ç–æ –ø–µ—Ä–µ–∂–∏–≤—ë—Ç | –ß–µ–≥–æ –ù–ï –ø–µ—Ä–µ–∂–∏–≤—ë—Ç | Latency | –°—Ç–æ–∏–º–æ—Å—Ç—å | Use Case |
|------------------|---------------|-------------------|---------|-----------|----------|
| In-memory | –ù–∏—á–µ–≥–æ | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ | <1ms | –ú–∏–Ω–∏–º—É–º | –ö–µ—à–∏ |
| Local disk | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ | –û—Ç–∫–∞–∑ –¥–∏—Å–∫–∞ | 1-10ms | –ù–∏–∑–∫–∞—è | Dev, –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ |
| WAL | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫, power failure | –û—Ç–∫–∞–∑ –¥–∏—Å–∫–∞ | 1-10ms | –ù–∏–∑–∫–∞—è | –ë–∞–∑–∏—Å –ª—é–±–æ–π DB |
| Fsync | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫, power failure | –û—Ç–∫–∞–∑ –¥–∏—Å–∫–∞ | 1-10ms | –ù–∏–∑–∫–∞—è | Single-node prod |
| Replicated | –û—Ç–∫–∞–∑ —Å–µ—Ä–≤–µ—Ä–∞/–¥–∏—Å–∫–∞ | –û—Ç–∫–∞–∑ DC | 10-50ms | –°—Ä–µ–¥–Ω—è—è | Production |
| Quorum | –û—Ç–∫–∞–∑ N/2 —Å–µ—Ä–≤–µ—Ä–æ–≤ | –û—Ç–∫–∞–∑ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ | 10-50ms | –°—Ä–µ–¥–Ω—è—è | Critical services |
| Geo-replicated | –û—Ç–∫–∞–∑ —Ü–µ–ª–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞ | –û—Ç–∫–∞–∑ –≤—Å–µ—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤ | 50-500ms | –í—ã—Å–æ–∫–∞—è | Mission-critical |

---

## –û–±—â–∏–µ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –ü–æ–Ω–∏–º–∞–π —Å–≤–æ–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

–ó–∞–¥–∞–π —Å–µ–±–µ –≤–æ–ø—Ä–æ—Å—ã:
- **–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç, –µ—Å–ª–∏ –º—ã –ø–æ—Ç–µ—Ä—è–µ–º —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ?**
  - –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏ ‚Üí –í—ã—Å–æ–∫–∞—è durability
  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ä–∞–∑–ª–æ–≥–∏–Ω—è—Ç—Å—è ‚Üí –°—Ä–µ–¥–Ω—è—è durability
  - –ü–æ—Ç–µ—Ä—è –º–µ—Ç—Ä–∏–∫–∏ ‚Üí –ù–∏–∑–∫–∞—è durability

- **–°–∫–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–µ–º –ø–æ—Ç–µ—Ä—è—Ç—å?**
  - –ù–∏ –±–∞–π—Ç–∞ ‚Üí Sync replication + quorum
  - –ù–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ ‚Üí Async replication
  - –ù–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç ‚Üí Periodic snapshots

- **–ö–∞–∫–∞—è latency –ø—Ä–∏–µ–º–ª–µ–º–∞?**
  - <10ms ‚Üí Local —Ç–æ–ª—å–∫–æ
  - <100ms ‚Üí Cross-AZ
  - <500ms ‚Üí Cross-region

### 2. –ò—Å–ø–æ–ª—å–∑—É–π –∑–∞—â–∏—Ç—É –≤ –≥–ª—É–±–∏–Ω—É (Defense in Depth)

–ù–µ –ø–æ–ª–∞–≥–∞–π—Å—è –Ω–∞ –æ–¥–∏–Ω —É—Ä–æ–≤–µ–Ω—å:
```
In-memory buffer
   ‚Üì
+ WAL –Ω–∞ –¥–∏—Å–∫–µ
   ‚Üì
+ Fsync
   ‚Üì
+ –†–µ–ø–ª–∏–∫–∞—Ü–∏—è
   ‚Üì
+ Backups
```

–ö–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–±–æ–µ–≤.

### 3. –¢–µ—Å—Ç–∏—Ä—É–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ!

**Chaos Engineering:**
- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–±–∏–≤–∞–π –ø—Ä–æ—Ü–µ—Å—Å—ã
- –°–∏–º—É–ª–∏—Ä—É–π –æ—Ç–∫–∞–∑—ã –¥–∏—Å–∫–æ–≤
- –ü—Ä–æ–≤–æ–¥–∏ fire drills (–æ—Ç–∫–ª—é—á–∞–π –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä)

–ï—Å–ª–∏ –Ω–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª failover ‚Äî –æ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

–û—Ç—Å–ª–µ–∂–∏–≤–∞–π:
- Replication lag
- Disk health (SMART)
- Backup success/failure
- Checkpoint frequency
- ACK latency

–ï—Å–ª–∏ –Ω–µ –º–æ–Ω–∏—Ç–æ—Ä–∏—à—å ‚Äî –Ω–µ –∑–Ω–∞–µ—à—å, —á—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å.

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π –≥–∞—Ä–∞–Ω—Ç–∏–∏

–î–ª—è –∫–∞–∂–¥–æ–π —Å–∏—Å—Ç–µ–º—ã –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π:
- –ö–∞–∫–æ–π —É—Ä–æ–≤–µ–Ω—å durability
- –ß—Ç–æ –º–æ–∂–µ—à—å –ø–æ—Ç–µ—Ä—è—Ç—å –ø—Ä–∏ –∫–∞–∫–æ–º —Å–±–æ–µ
- RPO (Recovery Point Objective) - —Å–∫–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–µ—à—å –ø–æ—Ç–µ—Ä—è—Ç—å
- RTO (Recovery Time Objective) - –∫–∞–∫ –±—ã—Å—Ç—Ä–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è

---

## –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ú–∏—Ñ—ã

### –ú–∏—Ñ 1: "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö = –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ durable"

**–†–µ–∞–ª—å–Ω–æ—Å—Ç—å:** –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫!
- Postgres —Å `fsync=off` ‚Üí –Ω–µ durable
- MongoDB —Å `w:0` ‚Üí –Ω–µ durable
- Redis –±–µ–∑ AOF/RDB ‚Üí –Ω–µ durable

### –ú–∏—Ñ 2: "RAID –∑–∞—â–∏—Ç–∏—Ç –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö"

**–†–µ–∞–ª—å–Ω–æ—Å—Ç—å:** RAID –∑–∞—â–∏—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ—Ç –æ—Ç–∫–∞–∑–∞ –¥–∏—Å–∫–∞.
- RAID –Ω–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç logical corruption
- RAID –Ω–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
- RAID –Ω–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –æ—Ç–∫–∞–∑–∞ —Å–µ—Ä–≤–µ—Ä–∞

### –ú–∏—Ñ 3: "–†–µ–ø–ª–∏–∫–∞—Ü–∏—è = backup"

**–†–µ–∞–ª—å–Ω–æ—Å—Ç—å:** –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –ù–ï –∑–∞–º–µ–Ω—è–µ—Ç backup!
- –ë–∏—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É—é—Ç—Å—è —Ç–æ–∂–µ
- –°–ª—É—á–∞–π–Ω—ã–π DROP TABLE —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- –ù—É–∂–Ω—ã point-in-time backups

### –ú–∏—Ñ 4: "SSD –Ω–µ –ª–æ–º–∞—é—Ç—Å—è"

**–†–µ–∞–ª—å–Ω–æ—Å—Ç—å:** SSD —Ç–æ–∂–µ –æ—Ç–∫–∞–∑—ã–≤–∞—é—Ç!
- SSD –∏–º–µ—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
- SSD –º–æ–≥—É—Ç –≤–Ω–µ–∑–∞–ø–Ω–æ –æ—Ç–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é
- SSD –¥–æ—Ä–æ–∂–µ —á–µ–º HDD

### –ú–∏—Ñ 5: "Geo-replication —Ä–µ—à–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã"

**–†–µ–∞–ª—å–Ω–æ—Å—Ç—å:** Geo-replication –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å.
- High latency
- Eventual consistency (–æ–±—ã—á–Ω–æ)
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤ multi-master
- –î–æ—Ä–æ–≥–æ

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**Durability semantics** ‚Äî —ç—Ç–æ –æ–¥–Ω–∞ –∏–∑ —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö —Ç–µ–º –≤ distributed systems. –û—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –∑–∞–≤–∏—Å–∏—Ç, –ø–æ—Ç–µ—Ä—è–µ—à—å –ª–∏ —Ç—ã –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤.

**–ö–ª—é—á–µ–≤—ã–µ takeaways:**

1. **–ù–µ—Ç —Å–µ—Ä–µ–±—Ä—è–Ω–æ–π –ø—É–ª–∏** ‚Äî –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å durability –∏–º–µ–µ—Ç trade-offs
2. **–ü–æ–Ω–∏–º–∞–π, —á—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ç–≤–æ—è —Å–∏—Å—Ç–µ–º–∞** ‚Äî –∫–æ–≥–¥–∞ ACK –æ–∑–Ω–∞—á–∞–µ—Ç "durable"?
3. **–¢–µ—Å—Ç–∏—Ä—É–π failure scenarios** ‚Äî chaos engineering –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫—Ä–∏—Ç–∏—á–µ–Ω** ‚Äî —Ç—ã –Ω–µ –∑–Ω–∞–µ—à—å, —á—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å, –ø–æ–∫–∞ –Ω–µ –º–æ–Ω–∏—Ç–æ—Ä–∏—à—å
5. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π –≥–∞—Ä–∞–Ω—Ç–∏–∏** ‚Äî —Ç–≤–æ—è –∫–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–Ω–∏–º–∞—Ç—å RPO/RTO

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ durability:**
```
"–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–Ω—ã ‚Äî –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö,
 –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –≤ —Ä–∞–∑–Ω—ã—Ö –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö"
```

–£–¥–∞—á–∏ –≤ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –Ω–∞–¥—ë–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º! üöÄ
