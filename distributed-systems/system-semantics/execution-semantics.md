# Execution Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∏ –í—ã–ø–æ–ª–Ω–µ–Ω–∏—è)

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [Synchronous Execution (–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)](#1-synchronous-execution-—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)
3. [Asynchronous Execution (–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)](#2-asynchronous-execution-–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)
4. [Blocking Semantics (–ë–ª–æ–∫–∏—Ä—É—é—â–∞—è –°–µ–º–∞–Ω—Ç–∏–∫–∞)](#3-blocking-semantics-–±–ª–æ–∫–∏—Ä—É—é—â–∞—è-—Å–µ–º–∞–Ω—Ç–∏–∫–∞)
5. [Non-Blocking Semantics (–ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –°–µ–º–∞–Ω—Ç–∏–∫–∞)](#4-non-blocking-semantics-–Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è-—Å–µ–º–∞–Ω—Ç–∏–∫–∞)
6. [Speculative Execution (–°–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)](#5-speculative-execution-—Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)
7. [Exactly-Once Execution (–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –†–æ–≤–Ω–æ –û–¥–∏–Ω –†–∞–∑)](#6-exactly-once-execution-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ-—Ä–æ–≤–Ω–æ-–æ–¥–∏–Ω-—Ä–∞–∑)
8. [Deferred Execution (–û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)](#7-deferred-execution-–æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)
9. [–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞](#—Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è-—Ç–∞–±–ª–∏—Ü–∞)
10. [–ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å–µ–º–∞–Ω—Ç–∏–∫](#–∫–æ–º–±–∏–Ω–∞—Ü–∏–∏-—Å–µ–º–∞–Ω—Ç–∏–∫)
11. [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)
12. [–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∫–∞–∫ –∏—Ö –∏–∑–±–µ–∂–∞—Ç—å](#—Ç–∏–ø–∏—á–Ω—ã–µ-–æ—à–∏–±–∫–∏-–∏-–∫–∞–∫-–∏—Ö-–∏–∑–±–µ–∂–∞—Ç—å)
13. [–ó–∞–∫–ª—é—á–µ–Ω–∏–µ](#–∑–∞–∫–ª—é—á–µ–Ω–∏–µ)

---

## –í–≤–µ–¥–µ–Ω–∏–µ

**Execution Semantics** (—Å–µ–º–∞–Ω—Ç–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è) –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç, –ö–ê–ö –∏ –ö–û–ì–î–ê –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ. –≠—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤–ª–∏—è—é—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã.

–ü—Ä–µ–¥—Å—Ç–∞–≤—å —Ä–µ—Å—Ç–æ—Ä–∞–Ω. –ö–æ–≥–¥–∞ —Ç—ã –¥–µ–ª–∞–µ—à—å –∑–∞–∫–∞–∑:
- **–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**: –æ—Ñ–∏—Ü–∏–∞–Ω—Ç —Å—Ç–æ–∏—Ç —É —Å—Ç–æ–ª–∞ –∏ –∂–¥—ë—Ç, –ø–æ–∫–∞ –ø–æ–≤–∞—Ä –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç –±–ª—é–¥–æ, —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –∏–¥—ë—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å—Ç–æ–ª—É
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**: –æ—Ñ–∏—Ü–∏–∞–Ω—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∑–∞–∫–∞–∑, –æ—Ç–¥–∞—ë—Ç –Ω–∞ –∫—É—Ö–Ω—é –∏ –∏–¥—ë—Ç –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Å—Ç–æ–ª—ã
- **–ë–ª–æ–∫–∏—Ä—É—é—â–µ–µ**: —Ç—ã —Å–∏–¥–∏—à—å –∏ –∂–¥—ë—à—å —Å–≤–æ—ë –±–ª—é–¥–æ, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—è
- **–ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–µ**: —Ç—ã –º–æ–∂–µ—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º, –ø–æ–∫–∞ –≥–æ—Ç–æ–≤–∏—Ç—Å—è –µ–¥–∞
- **–°–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ**: –ø–æ–≤–∞—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç –≥–æ—Ç–æ–≤–∏—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –±–ª—é–¥–∞ –∑–∞—Ä–∞–Ω–µ–µ, –¥–æ –∑–∞–∫–∞–∑–∞
- **Exactly-once**: —Ç–≤–æ–π –∑–∞–∫–∞–∑ –ø—Ä–∏–≥–æ—Ç–æ–≤—è—Ç —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑, –¥–∞–∂–µ –µ—Å–ª–∏ —Ç—ã —Å–ª—É—á–∞–π–Ω–æ –ø—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞–ª –µ–≥–æ
- **–û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ**: –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è —Å–µ–π—á–∞—Å, –Ω–æ –≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —á–∞—Å

–í —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –≤—ã–±–æ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–µ–º–∞–Ω—Ç–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ–Ω. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:
- üêå –î–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (—Ç—ã—Å—è—á–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤)
- üí• –ö–∞—Å–∫–∞–¥–Ω—ã–º —Å–±–æ—è–º (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã —Å —Ç–∞–π–º–∞—É—Ç–∞–º–∏)
- üí∏ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é –æ–ø–µ—Ä–∞—Ü–∏–π (–¥–≤–æ–π–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –¥–µ–Ω–µ–≥)
- üî• –ò—Å—á–µ—Ä–ø–∞–Ω–∏—é —Ä–µ—Å—É—Ä—Å–æ–≤ (—Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–±–∏—Ä–∞—é—Ç –≤—Å—ë CPU)
- üêõ –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—é (race conditions –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–¥–µ)

---

## 1. Synchronous Execution (–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Synchronous Execution** ‚Äî —ç—Ç–æ –º–æ–¥–µ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –æ–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ: –≤—ã–∑—ã–≤–∞—é—â–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ **–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –≤ –æ–∂–∏–¥–∞–Ω–∏–∏** —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞. –°–ª–µ–¥—É—é—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞—á–Ω—ë—Ç—Å—è, –ø–æ–∫–∞ —Ç–µ–∫—É—â–∞—è –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é.

```
–ö–ª–∏–µ–Ω—Ç                     –°–µ—Ä–≤–µ—Ä
  |                           |
  |------ –ó–∞–ø—Ä–æ—Å ----------->|
  |                           |
  |   (–∂–¥—ë—Ç, –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)      | (–≤—ã–ø–æ–ª–Ω—è–µ—Ç)
  |                           |
  |<----- –†–µ–∑—É–ª—å—Ç–∞—Ç ----------|
  |                           |
  | (–ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É)       |
```

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å—Ç—Ä–æ–≥–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å**: –≤—ã–∑—ã–≤–∞—é—â–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ —Å—Ä–∞–∑—É —É–∑–Ω–∞—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç (—É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞)
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –ø–æ–Ω–∏–º–∞–Ω–∏—è**: –∫–æ–¥ —á–∏—Ç–∞–µ—Ç—Å—è —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑, –∫–∞–∫ –∫–Ω–∏–≥–∞
- **–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –æ—à–∏–±–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –≤ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã—Ö –º–µ—Å—Ç–∞—Ö
- **Consistency-friendly**: –ª–µ–≥–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –∫–∞–∂–¥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –∂–¥—ë—Ç –ø—Ä–µ–¥—ã–¥—É—â—É—é
- **–ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç deadlock**: –≤–∑–∞–∏–º–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã –º–æ–≥—É—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å –Ω–∞–≤–µ—á–Ω–æ
- **–ù–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ I/O**: —Ç—ã—Å—è—á–∏ –ø–æ—Ç–æ–∫–æ–≤, –æ–∂–∏–¥–∞—é—â–∏—Ö —Å–µ—Ç–µ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ù–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç fault isolation**: –µ—Å–ª–∏ –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å –º–µ–¥–ª–µ–Ω–Ω—ã–π, –≤—Å–µ –≤—ã–∑—ã–≤–∞—é—â–∏–µ –µ–≥–æ —Ç–æ—Ä–º–æ–∑—è—Ç

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**PostgreSQL: –æ–±—ã—á–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã**
–ö–æ–≥–¥–∞ —Ç—ã –≤—ã–ø–æ–ª–Ω—è–µ—à—å `SELECT * FROM users WHERE id = 1`, –∫–ª–∏–µ–Ω—Ç –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –∏ –∂–¥—ë—Ç –æ—Ç–≤–µ—Ç–∞. –¢–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ Postgres –≤–µ—Ä–Ω—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —Ç–≤–æ—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É. –≠—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:
- –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å
- Postgres –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å (—á–∏—Ç–∞–µ—Ç —Å –¥–∏—Å–∫–∞, —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ)
- –ö–ª–∏–µ–Ω—Ç –ñ–î–Å–¢ (–Ω–µ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –Ω–∏—á–µ–≥–æ –¥—Ä—É–≥–æ–≥–æ)
- Postgres –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É

**Redis: –∫–æ–º–∞–Ω–¥—ã GET/SET**
–ö–æ–≥–¥–∞ —Ç—ã –¥–µ–ª–∞–µ—à—å `GET key`, Redis-–∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –∏ –∂–¥—ë—Ç –æ—Ç–≤–µ—Ç–∞. –ü–æ–∫–∞ Redis –Ω–µ –≤–µ—Ä–Ω—ë—Ç –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç–≤–æ–π –∫–æ–¥ "–∑–∞–º–æ—Ä–æ–∂–µ–Ω" –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–µ.

```
–¢–≤–æ–π –∫–æ–¥:
1. value = redis.get("user:123")  ‚Üê –ó–¥–µ—Å—å –∫–æ–¥ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
2. print(value)                   ‚Üê –≠—Ç–∞ —Å—Ç—Ä–æ–∫–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
```

**HTTP REST API: —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã**
–¢–∏–ø–∏—á–Ω—ã–π –≤–µ–±-—Å–µ—Ä–≤–∏—Å –Ω–∞ Nginx + –±—ç–∫–µ–Ω–¥:
- –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `POST /orders`
- Nginx –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ –±—ç–∫–µ–Ω–¥
- –ë—ç–∫–µ–Ω–¥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–∫–∞–∑ (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–∫–ª–∞–¥, —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä, —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î)
- Nginx –∂–¥—ë—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –±—ç–∫–µ–Ω–¥–∞
- –ö–ª–∏–µ–Ω—Ç –∂–¥—ë—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç Nginx
- –í—Å–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã, –ø–æ–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è

**RabbitMQ: RPC pattern**
RabbitMQ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ RPC (Remote Procedure Call):
- –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤
- –ö–ª–∏–µ–Ω—Ç –∂–¥—ë—Ç –æ—Ç–≤–µ—Ç–∞ –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏ –æ—Ç–≤–µ—Ç–æ–≤
- –°–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
- –°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç
- –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

–≠—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (RabbitMQ), –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Å–µ–º–∞–Ω—Ç–∏–∫–∏.

### ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞ 1: –ö–∞—Å–∫–∞–¥–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã**

–°—Ü–µ–Ω–∞—Ä–∏–π: –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- API Gateway ‚Üí Service A (—Ç–∞–π–º–∞—É—Ç 5 —Å–µ–∫—É–Ω–¥)
- Service A ‚Üí Service B (—Ç–∞–π–º–∞—É—Ç 5 —Å–µ–∫—É–Ω–¥)
- Service B ‚Üí Database (—Ç–∞–π–º–∞—É—Ç 5 —Å–µ–∫—É–Ω–¥)

–ï—Å–ª–∏ Database –Ω–∞—á–∏–Ω–∞–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ (4.5 —Å–µ–∫—É–Ω–¥—ã):
- Service B —Ç—Ä–∞—Ç–∏—Ç 4.5 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –∑–∞–ø—Ä–æ—Å –∫ –ë–î
- Service A –∂–¥—ë—Ç 4.5 —Å–µ–∫—É–Ω–¥—ã –æ—Ç Service B
- API Gateway –∂–¥—ë—Ç 4.5 —Å–µ–∫—É–Ω–¥—ã –æ—Ç Service A
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–¥—ë—Ç 4.5 —Å–µ–∫—É–Ω–¥—ã

–ï—Å–ª–∏ Database –Ω–∞—á–∏–Ω–∞–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –∑–∞ 6 —Å–µ–∫—É–Ω–¥:
- Service B —Ç–∞–π–º–∞—É—Ç–∏—Ç—Å—è –ø–æ—Å–ª–µ 5 —Å–µ–∫—É–Ω–¥
- Service B –ø—Ä–æ–±—É–µ—Ç retry ‚Üí –µ—â—ë 6 —Å–µ–∫—É–Ω–¥
- Service A —Ç–∞–π–º–∞—É—Ç–∏—Ç—Å—è –ø–æ—Å–ª–µ 5 —Å–µ–∫—É–Ω–¥, –Ω–µ –¥–æ–∂–¥–∞–≤—à–∏—Å—å Service B
- API Gateway —Ç–∞–π–º–∞—É—Ç–∏—Ç—Å—è –ø–æ—Å–ª–µ 5 —Å–µ–∫—É–Ω–¥
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —É–ø–∞–ª–∏ –ø–æ —Ç–∞–π–º–∞—É—Ç—É, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª –æ—à–∏–±–∫—É

**–ü—Ä–æ–±–ª–µ–º–∞ 2: Thread pool exhaustion**

–ü—Ä–µ–¥—Å—Ç–∞–≤—å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä —Å –ø—É–ª–æ–º –∏–∑ 200 –ø–æ—Ç–æ–∫–æ–≤. –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ–¥–Ω–∏–º –ø–æ—Ç–æ–∫–æ–º.

–ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:
- –ó–∞–ø—Ä–æ—Å –∑–∞–Ω–∏–º–∞–µ—Ç 50–º—Å
- –°–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 200 / 0.05 = 4000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É

–í–Ω–µ–∑–∞–ø–Ω–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞—á–∞–ª–∞ —Ç–æ—Ä–º–æ–∑–∏—Ç—å (–∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å 10 —Å–µ–∫—É–Ω–¥ –≤–º–µ—Å—Ç–æ 50–º—Å):
- –ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 10 —Å–µ–∫—É–Ω–¥
- –ó–∞ 10 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏—Ö–æ–¥–∏—Ç 40,000 –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–æ —É —Ç–µ–±—è —Ç–æ–ª—å–∫–æ 200 –ø–æ—Ç–æ–∫–æ–≤
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ 200 –ø–æ—Ç–æ–∫–æ–≤ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã, –∂–¥—É—Ç –ë–î. –ù–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤—Å—Ç–∞—é—Ç –≤ –æ—á–µ—Ä–µ–¥—å –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è

–≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **thread starvation** (–≥–æ–ª–æ–¥–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤).

**–ü—Ä–æ–±–ª–µ–º–∞ 3: Deadlock –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ**

Service A –∏ Service B –≤—ã–∑—ã–≤–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ:
- –ó–∞–ø—Ä–æ—Å 1: User ‚Üí Service A ‚Üí Service B
- –ó–∞–ø—Ä–æ—Å 2: Admin ‚Üí Service B ‚Üí Service A

–ï—Å–ª–∏ Service A –∏ Service B –æ–±–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∏ –∏–º–µ—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø—É–ª—ã –ø–æ—Ç–æ–∫–æ–≤:
1. –í—Å–µ –ø–æ—Ç–æ–∫–∏ Service A –∑–∞–Ω—è—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∂–¥—É—Ç Service B
2. –í—Å–µ –ø–æ—Ç–æ–∫–∏ Service B –∑–∞–Ω—è—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∂–¥—É—Ç Service A
3. Deadlock: —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–∏—Å–ª–∞

–†–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: –∫–æ–º–ø–∞–Ω–∏—è —Å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏, –≥–¥–µ Service A –≤—ã–∑—ã–≤–∞–ª Service B, –∞ Service B –∏–Ω–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–ª Service A –¥–ª—è validation. –í —á–∞—Å—ã –ø–∏–∫ –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞ –∏—Å—á–µ—Ä–ø–∞–ª–∏ –ø—É–ª—ã –ø–æ—Ç–æ–∫–æ–≤ –∏ –∑–∞–≤–∏—Å–ª–∏, –æ–∂–∏–¥–∞—è –¥—Ä—É–≥ –¥—Ä—É–≥–∞.

**–ü—Ä–æ–±–ª–µ–º–∞ 4: –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å—É–º–º–∏—Ä—É–µ—Ç—Å—è**

–ü—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–∞—Ö –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è:
- Service A ‚Üí Service B: 50–º—Å
- Service A ‚Üí Service C: 80–º—Å
- Service A ‚Üí Service D: 30–º—Å

–ï—Å–ª–∏ –≤—ã–∑–æ–≤—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ):
```
Total = 50 + 80 + 30 = 160–º—Å
```

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–¥—ë—Ç 160–º—Å. –ï—Å–ª–∏ –≤—ã–∑–æ–≤–æ–≤ –±–æ–ª—å—à–µ, –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Ä–∞—Å—Ç—ë—Ç –ª–∏–Ω–µ–π–Ω–æ.

### üèóÔ∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É

**–ò—Å–ø–æ–ª—å–∑—É–π —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –∫–æ–≥–¥–∞:**

1. **–ù—É–∂–Ω–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –æ—à–∏–±–∫—É**
   - –ü–ª–∞—Ç—ë–∂–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: —Ç—ã –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å –°–ï–ô–ß–ê–°, –ø—Ä–æ—à—ë–ª –ø–ª–∞—Ç—ë–∂ –∏–ª–∏ –Ω–µ—Ç
   - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: –Ω–µ–ª—å–∑—è –ø—É—Å—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–∞–ª—å—à–µ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤

2. **–û–ø–µ—Ä–∞—Ü–∏—è –±—ã—Å—Ç—Ä–∞—è –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è**
   - –ß—Ç–µ–Ω–∏–µ –∏–∑ Redis (—Å—É–±–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã)
   - –ü—Ä–æ—Å—Ç—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è

3. **–í–∞–∂–Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - –û–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞: —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí —Å–æ–∑–¥–∞—Ç—å –µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—å ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å email
   - –ï—Å–ª–∏ –æ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è —É–ø–∞–ª–∞, —Å–ª–µ–¥—É—é—â–∏–µ –Ω–µ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è

**–ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–æ–±–ª–µ–º:**

**1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π —Ä–∞–∑—É–º–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã**
```
Gateway: 3 —Å–µ–∫—É–Ω–¥—ã
Service A: 2 —Å–µ–∫—É–Ω–¥—ã (–º–µ–Ω—å—à–µ, —á–µ–º —É Gateway)
Service B: 1 —Å–µ–∫—É–Ω–¥–∞ (–º–µ–Ω—å—à–µ, —á–µ–º —É Service A)
Database: 500–º—Å (–º–µ–Ω—å—à–µ, —á–µ–º —É Service B)
```

–ü—Ä–∏–Ω—Ü–∏–ø: –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ç–∞–π–º–∞—É—Ç –º–µ–Ω—å—à–µ, —á–µ–º –≤—ã–∑—ã–≤–∞—é—â–∏–π –µ–≥–æ —É—Ä–æ–≤–µ–Ω—å, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∞–ª–æ—Å—å –≤—Ä–µ–º—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–∫–∏.

**2. –ò—Å–ø–æ–ª—å–∑—É–π circuit breakers**

Circuit Breaker ‚Äî —ç—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∫ –ø–∞–¥–∞—é—â–µ–º—É —Å–µ—Ä–≤–∏—Å—É:
- –ï—Å–ª–∏ Service B —É–ø–∞–ª –∏ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç, –Ω–µ –Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å —Ç–∞–π–º–∞—É—Ç–∞ –∫–∞–∂–¥—ã–π —Ä–∞–∑
- Circuit Breaker –ø–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–µ—É–¥–∞—á "—Ä–∞–∑–º—ã–∫–∞–µ—Ç —Ü–µ–ø—å": –∑–∞–ø—Ä–æ—Å—ã –∫ Service B —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ—à–∏–±–∫—É
- –≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç thread pool exhaustion

**3. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π –ø—É–ª—ã –ø–æ—Ç–æ–∫–æ–≤**

–ù–µ –≤—ã–¥–µ–ª—è–π –≤—Å–µ –ø–æ—Ç–æ–∫–∏ –Ω–∞ –æ–¥–∏–Ω —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–π:
- 50 –ø–æ—Ç–æ–∫–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–ø–ª–∞—Ç–µ–∂–∏)
- 100 –ø–æ—Ç–æ–∫–æ–≤ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ç–∞–ª–æ–≥–∞)
- 50 –ø–æ—Ç–æ–∫–æ–≤ –¥–ª—è –Ω–∏–∑–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)

–ï—Å–ª–∏ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–±—å—é—Ç –≤—Å–µ –ø–æ—Ç–æ–∫–∏, –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ —Å–º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è.

**4. –ú–æ–Ω–∏—Ç–æ—Ä—å latency –∏ thread pool utilization**

–ê–ª–µ—Ä—Ç–∏—Ä—É–π, –µ—Å–ª–∏:
- P95 –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤—ã—Ä–æ—Å–ª–∞ –≤ 2 —Ä–∞–∑–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ thread pool > 80%
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–π–º–∞—É—Ç–æ–≤ > 1% –æ—Ç –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**5. –ò–∑–±–µ–≥–∞–π —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**

Service A –ù–ï –¥–æ–ª–∂–µ–Ω —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å Service B, –µ—Å–ª–∏ Service B —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç Service A. –≠—Ç–æ —Ä–µ—Ü–µ–ø—Ç deadlock.

–ï—Å–ª–∏ –±–µ–∑ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –≤—ã–∑–æ–≤–æ–≤ –Ω–µ –æ–±–æ–π—Ç–∏—Å—å:
- –°–¥–µ–ª–∞–π —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤—ã–∑–æ–≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º
- –ò–ª–∏ –∫–µ—à–∏—Ä—É–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤

---

## 2. Asynchronous Execution (–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Asynchronous Execution** ‚Äî —ç—Ç–æ –º–æ–¥–µ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –æ–ø–µ—Ä–∞—Ü–∏—è –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç—Å—è, –Ω–æ **–≤—ã–∑—ã–≤–∞—é—â–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –ù–ï –∂–¥—ë—Ç** –µ—ë –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è. –û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è "–≤ —Ñ–æ–Ω–µ", –∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –ø–æ–ª—É—á–µ–Ω –ø–æ–∑–∂–µ —á–µ—Ä–µ–∑ callback, future, promise, —Å–æ–±—ã—Ç–∏–µ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ.

```
–ö–ª–∏–µ–Ω—Ç                     –°–µ—Ä–≤–µ—Ä
  |                           |
  |------ –ó–∞–ø—Ä–æ—Å ----------->|
  |                           |
  |<----- OK (–ø—Ä–∏–Ω—è—Ç–æ) -------|
  |                           |
  | (–ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É)       | (–≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤ —Ñ–æ–Ω–µ)
  |                           |
  |   ... –¥–µ–ª–∞–µ—Ç –¥—Ä—É–≥–∏–µ –¥–µ–ª–∞  |
  |                           |
  |<----- –†–µ–∑—É–ª—å—Ç–∞—Ç ----------| (–∫–æ–≥–¥–∞ –≥–æ—Ç–æ–≤–æ)
```

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**: –≤—ã–∑—ã–≤–∞—é—â–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
- **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º**: –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç—ã—Å—è—á–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **Fault isolation**: –º–µ–¥–ª–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥—Ä—É–≥–∏–µ
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤**: –ø–æ—Ç–æ–∫–∏ –Ω–µ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—Ç –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ I/O

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–æ–≥—É—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –≤ –ª—é–±–æ–º –ø–æ—Ä—è–¥–∫–µ
- **–ù–µ –¥–∞—ë—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏**: –æ—à–∏–±–∫–∞ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç "–≥–¥–µ-—Ç–æ –ø–æ—Ç–æ–º"
- **–ù–µ —É–ø—Ä–æ—â–∞–µ—Ç –∫–æ–¥**: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ —Å–ª–æ–∂–Ω–µ–µ —á–∏—Ç–∞—Ç—å –∏ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å
- **–ù–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏**: –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –±–æ–ª—å—à–µ, —á–µ–º —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å, –æ—á–µ—Ä–µ–¥–∏ –±—É–¥—É—Ç —Ä–∞—Å—Ç–∏

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**Kafka: –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π**

–ö–æ–≥–¥–∞ —Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—à—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Kafka:
```
producer.send("topic", message)  ‚Üê –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ù–ï–ú–ï–î–õ–ï–ù–ù–û
print("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ")    ‚Üê –≠—Ç–æ –Ω–∞–ø–µ—á–∞—Ç–∞–µ—Ç—Å—è –î–û —Ç–æ–≥–æ, –∫–∞–∫ Kafka —Ä–µ–∞–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
```

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
1. `send()` –∫–ª–∞–¥—ë—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±—É—Ñ–µ—Ä –∏ —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è
2. Kafka producer –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ –±–∞—Ç—á–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
3. Kafka producer –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç batch –≤ Kafka broker
4. Kafka broker –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞ –¥–∏—Å–∫
5. Kafka broker –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç acknowledgment (ACK)
6. –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, —Ç—ã —É–∑–Ω–∞–µ—à—å –æ–± —ç—Ç–æ–º —á–µ—Ä–µ–∑ callback –∏–ª–∏ future

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ: —Ç–≤–æ—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç—ã—Å—è—á–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É, –Ω–µ –æ–∂–∏–¥–∞—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ.

**RabbitMQ: fire-and-forget**

–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ RabbitMQ –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è confirmation:
```
channel.basic_publish(exchange='', routing_key='task_queue', body='Task data')
print("–ó–∞–¥–∞—á–∞ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å")
```

–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –æ—á–µ—Ä–µ–¥—å, –Ω–æ:
- –¢—ã –Ω–µ –∑–Ω–∞–µ—à—å, –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –ª–∏ –æ–Ω–æ
- –¢—ã –Ω–µ –∑–Ω–∞–µ—à—å, –∫–æ–≥–¥–∞ –æ–Ω–æ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
- –¢—ã –Ω–µ –∑–Ω–∞–µ—à—å, —É—Å–ø–µ—à–Ω–æ –ª–∏ –æ–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ

–≠—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ (consumer) –≤—ã–ø–æ–ª–Ω–∏—Ç –∑–∞–¥–∞—á—É –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –ø–æ—Ç–æ–º.

**MongoDB: asynchronous writes (–ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö)**

MongoDB –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏:
```
db.users.insertOne({name: "Alice"}, {writeConcern: {w: 0}})
```

`writeConcern: {w: 0}` –æ–∑–Ω–∞—á–∞–µ—Ç "–Ω–µ –∂–¥–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏":
- MongoDB driver –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –∏ —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è
- –†–µ–∞–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –Ω–∞ –¥–∏—Å–∫ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –ø–æ–∑–∂–µ
- –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –æ—à–∏–±–∫–∞, —Ç—ã –æ–± —ç—Ç–æ–º –Ω–µ —É–∑–Ω–∞–µ—à—å

–≠—Ç–æ –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ, –Ω–æ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ: –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –ø–æ—Ç–µ—Ä—è—Ç—å—Å—è.

**Nginx: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤**

Nginx –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –Ω–∞ –æ—Å–Ω–æ–≤–µ event loop:
- –û–¥–∏–Ω worker process (–æ–±—ã—á–Ω–æ –æ–¥–∏–Ω –Ω–∞ CPU core)
- Worker –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç—ã—Å—è—á–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ö–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –∑–∞–ø—Ä–æ—Å, Nginx –Ω–∞—á–∏–Ω–∞–µ—Ç –µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∫—É
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞, Nginx –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è: –æ–Ω –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç I/O –æ–ø–µ—Ä–∞—Ü–∏—é –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥—Ä—É–≥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –ö–æ–≥–¥–∞ I/O –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è, Nginx –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ø–µ—Ä–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É

–ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É Nginx –º–æ–∂–µ—Ç –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å 10,000+ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –æ–¥–Ω–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º.

**ClickHouse: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ inserts**

ClickHouse –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤—Å—Ç–∞–≤–∫–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ:
```
INSERT INTO events (timestamp, user_id, event_type) VALUES (...)
```

–ü—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ `async_insert=1`:
- –î–∞–Ω–Ω—ã–µ –∫–ª–∞–¥—É—Ç—Å—è –≤ –±—É—Ñ–µ—Ä
- –ó–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
- ClickHouse –±–∞—Ç—á–∏—Ç –≤—Å—Ç–∞–≤–∫–∏ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Ö –Ω–∞ –¥–∏—Å–∫ –ø–∞–∫–µ—Ç–∞–º–∏
- –≠—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç throughput, –Ω–æ –ø—Ä–∏ –∫—Ä—ç—à–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±—É—Ñ–µ—Ä–∞ –º–æ–≥—É—Ç –ø–æ—Ç–µ—Ä—è—Ç—å—Å—è

### ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞ 1: –ü–æ—Ç–µ—Ä—è –æ—à–∏–±–æ–∫**

–¢—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—à—å 1000 —Å–æ–±—ã—Ç–∏–π –≤ Kafka –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ:
```
for event in events:
    producer.send("topic", event)
```

–ï—Å–ª–∏ Kafka –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:
- `send()` –±—ã—Å—Ç—Ä–æ –≤–µ—Ä–Ω—ë—Ç—Å—è (–ø–æ–ª–æ–∂–∏—Ç –≤ –±—É—Ñ–µ—Ä)
- –¢–≤–æ–π –∫–æ–¥ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è
- –ù–æ —Ä–µ–∞–ª—å–Ω–æ –Ω–∏ –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –ø–æ–ø–∞–¥—ë—Ç –≤ Kafka
- –¢—ã –æ–± —ç—Ç–æ–º –Ω–µ —É–∑–Ω–∞–µ—à—å, –ø–æ–∫–∞ –Ω–µ –ø—Ä–æ–≤–µ—Ä–∏—à—å –ª–æ–≥–∏ –∏–ª–∏ –º–µ—Ç—Ä–∏–∫–∏

–†–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞ —Å–æ–±—ã—Ç–∏—è –≤ Kafka. Kafka –∫–ª–∞—Å—Ç–µ—Ä —É–ø–∞–ª –Ω–∞ 2 —á–∞—Å–∞. –ö–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫, –Ω–æ –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –∑–∞ —ç—Ç–∏ 2 —á–∞—Å–∞ –±—ã–ª–∏ –ø–æ—Ç–µ—Ä—è–Ω—ã, –ø–æ—Ç–æ–º—É —á—Ç–æ –±—É—Ñ–µ—Ä –ø–µ—Ä–µ–ø–æ–ª–Ω–∏–ª—Å—è –∏ –Ω–∞—á–∞–ª –æ—Ç–±—Ä–∞—Å—ã–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –º–æ–ª—á–∞.

**–ü—Ä–æ–±–ª–µ–º–∞ 2: Race conditions**

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ race conditions, –µ—Å–ª–∏ –Ω–µ —Å–æ–±–ª—é–¥–∞—Ç—å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å:

–°—Ü–µ–Ω–∞—Ä–∏–π: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞
```
1. –ß–∏—Ç–∞–µ–º counter = 10
2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º: counter + 1
3. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º counter = 11
```

–ï—Å–ª–∏ –¥–≤–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:
```
–ó–∞–ø—Ä–æ—Å A: —á–∏—Ç–∞–µ—Ç 10 ‚Üí –≤—ã—á–∏—Å–ª—è–µ—Ç 11 ‚Üí –ø–∏—à–µ—Ç 11
–ó–∞–ø—Ä–æ—Å B: —á–∏—Ç–∞–µ—Ç 10 ‚Üí –≤—ã—á–∏—Å–ª—è–µ—Ç 11 ‚Üí –ø–∏—à–µ—Ç 11
```

–†–µ–∑—É–ª—å—Ç–∞—Ç: —Å—á—ë—Ç—á–∏–∫ = 11, –∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 12. –û–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è "–ø–æ—Ç–µ—Ä—è–ª–∞—Å—å".

–†–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä: —Å–∏—Å—Ç–µ–º–∞ –ª–∞–π–∫–æ–≤ –≤ —Å–æ—Ü—Å–µ—Ç–∏. –î–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ª–∞–π–∫–∞—é—Ç –ø–æ—Å—Ç. –ò–∑-–∑–∞ race condition –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–¥–µ —Å—á—ë—Ç—á–∏–∫ –ª–∞–π–∫–æ–≤ —É–≤–µ–ª–∏—á–∏–ª—Å—è –Ω–∞ 1 –≤–º–µ—Å—Ç–æ 2.

**–ü—Ä–æ–±–ª–µ–º–∞ 3: –ù–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π —Ä–æ—Å—Ç –æ—á–µ—Ä–µ–¥–µ–π**

–¢—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—à—å –∑–∞–¥–∞—á–∏ –≤ RabbitMQ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –Ω–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–µ —É—Å–ø–µ–≤–∞—é—Ç:
- –í —Å–µ–∫—É–Ω–¥—É –ø—Ä–∏—Ö–æ–¥–∏—Ç 1000 –∑–∞–¥–∞—á
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–≥—É—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å 500 –∑–∞–¥–∞—á –≤ —Å–µ–∫—É–Ω–¥—É
- –û—á–µ—Ä–µ–¥—å —Ä–∞—Å—Ç—ë—Ç –Ω–∞ 500 –∑–∞–¥–∞—á –≤ —Å–µ–∫—É–Ω–¥—É

–ß–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç –≤ –æ—á–µ—Ä–µ–¥–∏ 300,000 –∑–∞–¥–∞—á:
- –ù–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –±—É–¥—É—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç
- RabbitMQ –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å —Ç–æ—Ä–º–æ–∑–∏—Ç—å –∏–∑-–∑–∞ –±–æ–ª—å—à–æ–π –æ—á–µ—Ä–µ–¥–∏
- –í —Ö—É–¥—à–µ–º —Å–ª—É—á–∞–µ RabbitMQ —É–ø–∞–¥—ë—Ç –∏–∑-–∑–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –ø–∞–º—è—Ç–∏

–†–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: e-commerce —Å–∞–π—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–ª email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å. –í –ß—ë—Ä–Ω—É—é –ü—è—Ç–Ω–∏—Ü—É –Ω–∞–≥—Ä—É–∑–∫–∞ –≤—ã—Ä–æ—Å–ª–∞ –≤ 10 —Ä–∞–∑. –û—á–µ—Ä–µ–¥—å —Ä–∞–∑—Ä–æ—Å–ª–∞—Å—å –¥–æ 5 –º–∏–ª–ª–∏–æ–Ω–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–∫–∞–∑–∞—Ö —á–µ—Ä–µ–∑ 2 –¥–Ω—è.

**–ü—Ä–æ–±–ª–µ–º–∞ 4: –°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏**

–í —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–¥–µ —Ç—ã –≤–∏–¥–∏—à—å stack trace:
```
Error in function C
  called by function B
  called by function A
```

–í –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–¥–µ:
```
Error in function C
  (callback from event loop)
```

–ù–µ–ø–æ–Ω—è—Ç–Ω–æ, –∫—Ç–æ –≤—ã–∑–≤–∞–ª C, –ø–æ—á–µ–º—É –∏ –≤ –∫–∞–∫–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ. –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ nightmare.

**–ü—Ä–æ–±–ª–µ–º–∞ 5: Memory leaks –≤ callbacks**

–¢—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—à—å callback –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏:
```
operation = start_async_operation(data)
operation.on_complete(lambda result: process(result, data))
```

–ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è (–∑–∞–≤–∏—Å–ª–∞), callback –≤–∏—Å–∏—Ç –≤ –ø–∞–º—è—Ç–∏ –≤–µ—á–Ω–æ, –¥–µ—Ä–∂–∞ —Å—Å—ã–ª–∫—É –Ω–∞ `data`. –≠—Ç–æ memory leak.

### üèóÔ∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É

**–ò—Å–ø–æ–ª—å–∑—É–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –∫–æ–≥–¥–∞:**

1. **–û–ø–µ—Ä–∞—Ü–∏—è –¥–æ–ª–≥–∞—è –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞**
   - –û—Ç–ø—Ä–∞–≤–∫–∞ email: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–µ –Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å, –ø–æ–∫–∞ email —Ä–µ–∞–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞: –ø—Ä–æ—Ü–µ—Å—Å –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –º–∏–Ω—É—Ç—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–¥–∞—à—å —á–µ—Ä–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ: –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å —á–∞—Å—ã

2. **–í—ã—Å–æ–∫–∏–π throughput –≤–∞–∂–Ω–µ–µ –Ω–∏–∑–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏**
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: –≤–∞–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã –ª–æ–≥–æ–≤ –±—ã—Å—Ç—Ä–æ, –∞ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∏—Ö –º–æ–∂–Ω–æ –ø–æ—Ç–æ–º
   - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: —Å–æ–±—Ä–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã —Å–æ–±—ã—Ç–∏–π –∑–∞ —Å–µ–∫—É–Ω–¥—É

3. **–ù—É–∂–Ω–∞ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥–∏**
   - –ï—Å–ª–∏ consumer —É–ø–∞–ª, —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏ –ø–æ–¥–æ–∂–¥—É—Ç
   - –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ consumers –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–æ–±–ª–µ–º:**

**1. –í—Å–µ–≥–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –æ—à–∏–±–∫–∏**

Kafka producer:
```
future = producer.send("topic", message)
future.add_callback(on_success)
future.add_errback(on_error)

def on_error(exception):
    log.error(f"Failed to send message: {exception}")
    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ fallback storage
    # –ò–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ dead letter queue
    # –ò–ª–∏ –∞–ª–µ—Ä—Ç–∞–Ω—É—Ç—å
```

**2. –ò—Å–ø–æ–ª—å–∑—É–π backpressure**

–ï—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å —Ä–∞—Å—Ç—ë—Ç, –ù–ï –ø—Ä–∏–Ω–∏–º–∞–π –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
- HTTP 503 Service Unavailable
- –ò–ª–∏ –±–ª–æ–∫–∏—Ä—É–π –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è, –ø–æ–∫–∞ –æ—á–µ—Ä–µ–¥—å –Ω–µ —É–º–µ–Ω—å—à–∏—Ç—Å—è

RabbitMQ flow control: –∫–æ–≥–¥–∞ –ø–∞–º—è—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∞, RabbitMQ –±–ª–æ–∫–∏—Ä—É–µ—Ç publishers.

Kafka producer: –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ `buffer.memory` –∏ `max.block.ms` ‚Äî –µ—Å–ª–∏ –±—É—Ñ–µ—Ä –ø–æ–ª–æ–Ω, `send()` –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è.

**3. –ú–æ–Ω–∏—Ç–æ—Ä—å —Ä–∞–∑–º–µ—Ä—ã –æ—á–µ—Ä–µ–¥–µ–π**

–ê–ª–µ—Ä—Ç–∏—Ä—É–π, –µ—Å–ª–∏:
- –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ –≤ RabbitMQ > 10,000 —Å–æ–æ–±—â–µ–Ω–∏–π
- Kafka consumer lag > 100,000 —Å–æ–æ–±—â–µ–Ω–∏–π
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á–∏ > 10 –º–∏–Ω—É—Ç

**4. –ò—Å–ø–æ–ª—å–∑—É–π idempotent –æ–ø–µ—Ä–∞—Ü–∏–∏**

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã —á–∞—Å—Ç–æ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é (—Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏, retries):
- –°–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–≤–∞–∂–¥—ã
- –û–ø–µ—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ–π: –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –≤—Ä–µ–¥–∏—Ç—å

–ü—Ä–∏–º–µ—Ä: "—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å = 100" (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ) vs "—É–º–µ–Ω—å—à–∏—Ç—å –±–∞–ª–∞–Ω—Å –Ω–∞ 100" (–Ω–µ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ).

**5. –î–æ–±–∞–≤—å correlation ID**

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –¥–æ–±–∞–≤–ª—è–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∫ –∫–∞–∂–¥–æ–º—É –∑–∞–ø—Ä–æ—Å—É:
```
correlation_id = generate_uuid()
producer.send("topic", message, headers={"correlation_id": correlation_id})
```

–õ–æ–≥–∏:
```
[correlation_id=abc123] Message sent to Kafka
[correlation_id=abc123] Consumer received message
[correlation_id=abc123] Processing completed
```

–¢–∞–∫ —Ç—ã –º–æ–∂–µ—à—å –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø—É—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –≤—Å—é —Å–∏—Å—Ç–µ–º—É.

**6. –ò—Å–ø–æ–ª—å–∑—É–π dead letter queues (DLQ)**

–ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ø—ã—Ç–æ–∫, –Ω–µ —Ç–µ—Ä—è–π –µ–≥–æ:
- –û—Ç–ø—Ä–∞–≤—å –≤ DLQ (–æ—á–µ—Ä–µ–¥—å –¥–ª—è "–º—ë—Ä—Ç–≤—ã—Ö" —Å–æ–æ–±—â–µ–Ω–∏–π)
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π DLQ
- –ü—ã—Ç–∞–π—Å—è –ø–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—è —Ç—É–¥–∞ –ø–æ–ø–∞–ª–∏
- –ò—Å–ø—Ä–∞–≤–ª—è–π –∫–æ–¥ –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏ reprocess

**7. Timeout –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**

–î–∞–∂–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å timeout:
- Kafka producer: `request.timeout.ms`
- HTTP –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã: –∑–∞–¥–∞–≤–∞–π timeout –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é

–ò–Ω–∞—á–µ –æ–ø–µ—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –≤–∏—Å–µ—Ç—å –≤–µ—á–Ω–æ, —É—Ç–µ–∫–∞—è –ø–∞–º—è—Ç—å.

---

## 3. Blocking Semantics (–ë–ª–æ–∫–∏—Ä—É—é—â–∞—è –°–µ–º–∞–Ω—Ç–∏–∫–∞)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Blocking Semantics** ‚Äî —ç—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –æ–ø–µ—Ä–∞—Ü–∏—è **–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ –∫–æ–¥–∞ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è. Caller "–∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç—Å—è" –∏ –Ω–∏—á–µ–≥–æ –Ω–µ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å, –ø–æ–∫–∞ –Ω–µ –ø–æ–ª—É—á–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

–ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å:
- **I/O blocking**: –æ–∂–∏–¥–∞–Ω–∏–µ —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ –Ω–∞ –¥–∏—Å–∫, —Å–µ—Ç—å
- **Lock blocking**: –æ–∂–∏–¥–∞–Ω–∏–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è mutex, —Å–µ–º–∞—Ñ–æ—Ä–∞, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ë–î
- **Compute blocking**: –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

```
Thread 1                     Thread 2
  |                             |
  |--- –ó–∞—Ö–≤–∞—Ç–∏—Ç—å lock A ------->|
  |    (—É—Å–ø–µ—à–Ω–æ)                |
  |                             |
  |                             |--- –ó–∞—Ö–≤–∞—Ç–∏—Ç—å lock A
  |                             |    (–ë–õ–û–ö–ò–†–û–í–ê–ù, –∂–¥—ë—Ç)
  |                             |         ‚è∏Ô∏è
  | ... —Ä–∞–±–æ—Ç–∞–µ—Ç ...            |         ‚è∏Ô∏è
  |                             |         ‚è∏Ô∏è
  |--- –û—Å–≤–æ–±–æ–¥–∏—Ç—å lock A ------>|         ‚è∏Ô∏è
  |                             |    (—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!)
  |                             |    –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É
```

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ò—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø**: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç, —á—Ç–æ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫/–ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–µ—Å—É—Ä—Å–æ–º
- **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å**: –æ–ø–µ—Ä–∞—Ü–∏—è —Ç–æ—á–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è (–∏–ª–∏ –∑–∞–≤–∏—Å–Ω–µ—Ç ‚Äî —ç—Ç–æ —Ç–æ–∂–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ)
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –Ω–µ –Ω—É–∂–Ω–æ –¥—É–º–∞—Ç—å –æ callback'–∞—Ö, futures, promises
- **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∑–∞—â–∏—â–∞—é—Ç –æ—Ç race conditions

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ç–æ–∫/–ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ—Å—Ç–∞–∏–≤–∞–µ—Ç
- **–ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç deadlock**: –≤–∑–∞–∏–º–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –∑–∞–≤–∏—Å–∞–Ω–∏—é
- **–ù–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è**: —Ç—ã—Å—è—á–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ = —Ç—ã—Å—è—á–∏ –º–µ–≥–∞–±–∞–π—Ç –ø–∞–º—è—Ç–∏ –∏ context switches
- **–ù–µ –¥–∞—ë—Ç —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏**: –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É 1000 —Ä–∞–∑ –ø–æ–¥—Ä—è–¥, –∞ –¥—Ä—É–≥–æ–π –±—É–¥–µ—Ç –∂–¥–∞—Ç—å

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**PostgreSQL: row-level locks**

–ö–æ–≥–¥–∞ —Ç—ã –¥–µ–ª–∞–µ—à—å:
```
BEGIN;
SELECT * FROM accounts WHERE id = 123 FOR UPDATE;
-- –≠—Ç–∞ —Å—Ç—Ä–æ–∫–∞ —Ç–µ–ø–µ—Ä—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞
```

–ï—Å–ª–∏ –¥—Ä—É–≥–æ–π –∫–ª–∏–µ–Ω—Ç –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç—É –∂–µ —Å—Ç—Ä–æ–∫—É:
```
BEGIN;
SELECT * FROM accounts WHERE id = 123 FOR UPDATE;
-- –≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –ë–õ–û–ö–ò–†–£–ï–¢–°–Ø –∏ –∂–¥—ë—Ç
```

–í—Ç–æ—Ä–æ–π –∫–ª–∏–µ–Ω—Ç –∑–∞–º–æ—Ä–æ–∂–µ–Ω. –û–Ω –Ω–µ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –Ω–∏—á–µ–≥–æ, –ø–æ–∫–∞ –ø–µ—Ä–≤—ã–π –∫–ª–∏–µ–Ω—Ç –Ω–µ —Å–¥–µ–ª–∞–µ—Ç `COMMIT` –∏–ª–∏ `ROLLBACK`.

–†–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: —Å–∏—Å—Ç–µ–º–∞ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤
- –ö–ª–∏–µ–Ω—Ç A –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –¥–µ–Ω—å–≥–∏ —Å–æ —Å—á—ë—Ç–∞ 123 –Ω–∞ —Å—á—ë—Ç 456
- –ö–ª–∏–µ–Ω—Ç B –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –¥–µ–Ω—å–≥–∏ —Å–æ —Å—á—ë—Ç–∞ 123 –Ω–∞ —Å—á—ë—Ç 789
- –û–±–∞ –Ω–∞—á–∏–Ω–∞—é—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –∏ –±–ª–æ–∫–∏—Ä—É—é—Ç —Å—á—ë—Ç 123
- –û–¥–∏–Ω –∏–∑ –Ω–∏—Ö –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –∏ –∂–¥—ë—Ç

–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ: –∑–∞—â–∏—Ç–∞ –æ—Ç race conditions. –ù–æ –µ—Å–ª–∏ –ø–µ—Ä–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–æ–ª–≥–∞—è (10 —Å–µ–∫—É–Ω–¥), –≤—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –∂–¥–∞—Ç—å 10 —Å–µ–∫—É–Ω–¥.

**Redis: BLPOP (blocking pop)**

Redis –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–ª–æ–∫–∏—Ä—É—é—â—É—é –æ–ø–µ—Ä–∞—Ü–∏—é —á—Ç–µ–Ω–∏—è –∏–∑ —Å–ø–∏—Å–∫–∞:
```
BLPOP myqueue 10
```

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç: "–ó–∞–±–µ—Ä–∏ —ç–ª–µ–º–µ–Ω—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ myqueue. –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç, –ñ–î–ò –¥–æ 10 —Å–µ–∫—É–Ω–¥, –ø–æ–∫–∞ –∫—Ç–æ-–Ω–∏–±—É–¥—å –Ω–µ –ø–æ–ª–æ–∂–∏—Ç —ç–ª–µ–º–µ–Ω—Ç".

–ö–ª–∏–µ–Ω—Ç –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è:
- –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç, –∫–æ–º–∞–Ω–¥–∞ –Ω–µ –≤–µ—Ä–Ω—ë—Ç—Å—è —Å—Ä–∞–∑—É
- –ö–ª–∏–µ–Ω—Ç –±—É–¥–µ—Ç –∂–¥–∞—Ç—å –¥–æ 10 —Å–µ–∫—É–Ω–¥
- –ï—Å–ª–∏ –∑–∞ —ç—Ç–æ –≤—Ä–µ–º—è –∫—Ç–æ-—Ç–æ –ø–æ–ª–æ–∂–∏—Ç —ç–ª–µ–º–µ–Ω—Ç, –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏—Ç –µ–≥–æ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
- –ï—Å–ª–∏ 10 —Å–µ–∫—É–Ω–¥ –ø—Ä–æ—à–ª–æ, –∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–µ—Ç, –≤–µ—Ä–Ω—ë—Ç—Å—è NULL

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ: —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á –Ω–∞ Redis.

**PostgreSQL: advisory locks**

Postgres –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:
```
SELECT pg_advisory_lock(42);
-- –ó–∞—Ö–≤–∞—Ç–∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —Å ID 42
```

–ï—Å–ª–∏ –¥—Ä—É–≥–æ–π –∫–ª–∏–µ–Ω—Ç –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è:
```
SELECT pg_advisory_lock(42);
-- –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –∂–¥—ë—Ç
```

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ: –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤–æ—Ä–∫–µ—Ä–∞–º–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –≤–æ—Ä–∫–µ—Ä –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—É—é –∑–∞–¥–∞—á—É.

**MongoDB: waiting for write concern**

–ö–æ–≥–¥–∞ —Ç—ã –¥–µ–ª–∞–µ—à—å –∑–∞–ø–∏—Å—å —Å `writeConcern: {w: "majority"}`:
```
db.users.insertOne({name: "Alice"}, {writeConcern: {w: "majority"}})
```

–ö–ª–∏–µ–Ω—Ç –ë–õ–û–ö–ò–†–£–ï–¢–°–Ø, –ø–æ–∫–∞:
- –î–∞–Ω–Ω—ã–µ –Ω–µ –±—É–¥—É—Ç –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ –¥–∏—Å–∫ –Ω–∞ primary
- –î–∞–Ω–Ω—ã–µ –Ω–µ –±—É–¥—É—Ç —Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ replica set —á–ª–µ–Ω–æ–≤
- Replica set —á–ª–µ–Ω—ã –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–¥—è—Ç –∑–∞–ø–∏—Å—å

–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –æ—Ç –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥ –¥–æ —Å–µ–∫—É–Ω–¥ (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç latency –º–µ–∂–¥—É –Ω–æ–¥–∞–º–∏).

**Nginx + PostgreSQL: –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

–ü—Ä–µ–¥—Å—Ç–∞–≤—å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```
User ‚Üí Nginx ‚Üí App Server ‚Üí PostgreSQL
```

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å "–∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å":
- Nginx –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
- Nginx –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –≤ App Server
- App Server –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ—Ç–æ–∫/–ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- App Server –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ PostgreSQL: `UPDATE users SET password = ...`
- –ï—Å–ª–∏ –¥—Ä—É–≥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞ —ç—Ç—É —Å—Ç—Ä–æ–∫—É, App Server –ë–õ–û–ö–ò–†–£–ï–¢–°–Ø
- –ü–æ—Ç–æ–∫ App Server –∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç—Å—è
- Nginx –∂–¥—ë—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç App Server
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–¥—ë—Ç

–í–µ—Å—å —Å—Ç–µ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏–∑-–∑–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤ PostgreSQL.

### ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞ 1: Deadlock**

–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä deadlock:
```
Transaction A:
  1. –ó–∞—Ö–≤–∞—Ç–∏—Ç—å lock –Ω–∞ row 1
  2. –ó–∞—Ö–≤–∞—Ç–∏—Ç—å lock –Ω–∞ row 2

Transaction B:
  1. –ó–∞—Ö–≤–∞—Ç–∏—Ç—å lock –Ω–∞ row 2
  2. –ó–∞—Ö–≤–∞—Ç–∏—Ç—å lock –Ω–∞ row 1
```

–ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:
- Transaction A –∑–∞—Ö–≤–∞—Ç–∏–ª row 1, –∂–¥—ë—Ç row 2
- Transaction B –∑–∞—Ö–≤–∞—Ç–∏–ª row 2, –∂–¥—ë—Ç row 1
- –í–∑–∞–∏–º–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞: –æ–±–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞–≤–∏—Å–ª–∏ –Ω–∞–≤–µ—á–Ω–æ

PostgreSQL –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç deadlock –∏ —É–±–∏–≤–∞–µ—Ç –æ–¥–Ω—É –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (deadlock detection), –Ω–æ —ç—Ç–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—à–∏–±–∫–∞–º –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

–†–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: –ø–ª–∞—Ç—ë–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –≥–¥–µ –¥–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–ª—è–ª–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤ —Ä–∞–∑–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ. Deadlock –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª 10-20 —Ä–∞–∑ –≤ —á–∞—Å, –≤—ã–∑—ã–≤–∞—è –æ—à–∏–±–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–ü—Ä–æ–±–ª–µ–º–∞ 2: Lock convoy (—Ç–æ–ª–ø–∞ —É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)**

–ï—Å—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —Ä–µ—Å—É—Ä—Å, –∑–∞—â–∏—â—ë–Ω–Ω—ã–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫—ç—à –≤ –ø–∞–º—è—Ç–∏):
- –ü–æ—Ç–æ–∫ 1 –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É, —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (10–º—Å)
- –ü–æ—Ç–æ–∫–∏ 2-100 –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è, –∂–¥—É—Ç
- –ü–æ—Ç–æ–∫ 1 –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
- –ü–æ—Ç–æ–∫ 2 –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É, —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (10–º—Å)
- –ü–æ—Ç–æ–∫–∏ 3-100 –≤—Å—ë –µ—â—ë –∂–¥—É—Ç
- ...

–ü–æ—Ç–æ–∫ 100 –±—É–¥–µ—Ç –∂–¥–∞—Ç—å 100 * 10–º—Å = 1 —Å–µ–∫—É–Ω–¥–∞.

–≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **lock convoy**: –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ –∑–∞—Å—Ç—Ä–µ–≤–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥–∏ –∫ –æ–¥–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ.

–†–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ in-memory –∫—ç—à—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –í —á–∞—Å—ã –ø–∏–∫ –≤—Å–µ –ø–æ—Ç–æ–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏—Å—å, –ø—ã—Ç–∞—è—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥. P99 –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤—ã—Ä–æ—Å–ª–∞ —Å 50–º—Å –¥–æ 5 —Å–µ–∫—É–Ω–¥.

**–ü—Ä–æ–±–ª–µ–º–∞ 3: Blocking I/O + –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π thread pool**

–£ —Ç–µ–±—è 100 –ø–æ—Ç–æ–∫–æ–≤ –≤ –ø—É–ª–µ. –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –¥–µ–ª–∞–µ—Ç –±–ª–æ–∫–∏—Ä—É—é—â–∏–π SQL –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–Ω–∏–º–∞–µ—Ç 5 —Å–µ–∫—É–Ω–¥ (–º–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç—á—ë—Ç).

–ï—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:
- –í—Å–µ 100 –ø–æ—Ç–æ–∫–æ–≤ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –Ω–∞ 5 —Å–µ–∫—É–Ω–¥
- –ù–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã (–Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –æ—à–∏–±–∫–∏ –∏–ª–∏ —Ç–∞–π–º–∞—É—Ç—ã

–†–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å Gunicorn (50 workers). –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∑–∞–ø—É—Å—Ç–∏–ª –º–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç—á—ë—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–ª—Å—è 30 —Å–µ–∫—É–Ω–¥. –ó–∞–ø—Ä–æ—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –æ–¥–∏–Ω worker. –ü–æ—Ç–æ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–¥—É–º–∞–ª, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –∑–∞–≤–∏—Å, –∏ –∑–∞–ø—É—Å—Ç–∏–ª –µ—â—ë 10 —Ä–∞–∑. –í—Å–µ 50 workers –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏—Å—å –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö. –°–∞–π—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–ø–∞–ª –Ω–∞ 30 —Å–µ–∫—É–Ω–¥.

**–ü—Ä–æ–±–ª–µ–º–∞ 4: Long-held locks (–¥–æ–ª–≥–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)**

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞—Ö–≤–∞—Ç–∏–ª–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –∏ –¥–µ—Ä–∂–∏—Ç –µ—ë –¥–æ–ª–≥–æ:
```
BEGIN;
SELECT * FROM important_table FOR UPDATE;
-- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞—Ö–≤–∞—á–µ–Ω–∞
... –¥–µ–ª–∞–µ–º –º–µ–¥–ª–µ–Ω–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è 10 –º–∏–Ω—É—Ç ...
UPDATE important_table SET ...;
COMMIT;
```

–í—Å–µ –¥—Ä—É–≥–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—ã—Ç–∞—é—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å `important_table`, –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –Ω–∞ 10 –º–∏–Ω—É—Ç.

–†–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: –≤ production –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Å–ª—É—á–∞–π–Ω–æ –∑–∞–ø—É—Å—Ç–∏–ª —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –∑–∞—Ö–≤–∞—Ç–∏–ª –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –∏ –Ω–∞—á–∞–ª –¥–æ–ª–≥–∏–π update. –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —ç—Ç–æ–π —Ç–∞–±–ª–∏—Ü–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏—Å—å. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ 5000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ—á–µ—Ä–µ–¥–∏ –∂–¥—É—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.

### üèóÔ∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É

**–ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:**

**1. –î–µ—Ä–∂–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–∞–∫ –º–æ–∂–Ω–æ –∫–æ—Ä–æ—á–µ**
```
BAD:
BEGIN;
SELECT * FROM accounts WHERE id = 1 FOR UPDATE;
-- –∑–∞—Ö–≤–∞—Ç–∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
... –≤—ã–∑—ã–≤–∞–µ–º –≤–Ω–µ—à–Ω–∏–π API (10 —Å–µ–∫—É–Ω–¥) ...
UPDATE accounts SET balance = ...;
COMMIT;

GOOD:
-- —Å–Ω–∞—á–∞–ª–∞ –¥–µ–ª–∞–µ–º –≤—Å—é —Ä–∞–±–æ—Ç—É –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
result = call_external_api()
-- —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
BEGIN;
SELECT * FROM accounts WHERE id = 1 FOR UPDATE;
UPDATE accounts SET balance = ...;
COMMIT;
```

**2. –í—Å–µ–≥–¥–∞ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º –ø–æ—Ä—è–¥–∫–µ**

–ï—Å–ª–∏ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫, –≤—Å–µ–≥–¥–∞ –±–ª–æ–∫–∏—Ä—É–π –∏—Ö –≤ –æ–¥–Ω–æ–º –∏ —Ç–æ–º –∂–µ –ø–æ—Ä—è–¥–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ ID):
```
GOOD:
SELECT * FROM accounts WHERE id IN (1, 5, 10) ORDER BY id FOR UPDATE;
-- –ë–ª–æ–∫–∏—Ä—É–µ—Ç –≤ –ø–æ—Ä—è–¥–∫–µ: 1, 5, 10

BAD:
SELECT * FROM accounts WHERE id = 5 FOR UPDATE;
SELECT * FROM accounts WHERE id = 1 FOR UPDATE;
SELECT * FROM accounts WHERE id = 10 FOR UPDATE;
-- –ü–æ—Ä—è–¥–æ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º ‚Üí —Ä–∏—Å–∫ deadlock
```

**3. –ò—Å–ø–æ–ª—å–∑—É–π timeout –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫**

PostgreSQL:
```
SET lock_timeout = '5s';
```

–ï—Å–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞—Ö–≤–∞—á–µ–Ω–∞ –∑–∞ 5 —Å–µ–∫—É–Ω–¥, –∑–∞–ø—Ä–æ—Å —É–ø–∞–¥—ë—Ç —Å –æ—à–∏–±–∫–æ–π. –≠—Ç–æ –ª—É—á—à–µ, —á–µ–º –∂–¥–∞—Ç—å –≤–µ—á–Ω–æ.

Redis:
```
BLPOP myqueue 10  -- –¢–∞–π–º–∞—É—Ç 10 —Å–µ–∫—É–Ω–¥
```

**4. –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–π optimistic concurrency control –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º**

–í–º–µ—Å—Ç–æ:
```
BEGIN;
SELECT balance FROM accounts WHERE id = 1 FOR UPDATE;
-- –∑–∞—Ö–≤–∞—Ç–∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
balance = balance - 100
UPDATE accounts SET balance = balance WHERE id = 1;
COMMIT;
```

–ò—Å–ø–æ–ª—å–∑—É–π version –∏–ª–∏ CAS (compare-and-swap):
```
-- –ß–∏—Ç–∞–µ–º –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
SELECT balance, version FROM accounts WHERE id = 1;
balance = 1000, version = 5

-- –ü—ã—Ç–∞–µ–º—Å—è –æ–±–Ω–æ–≤–∏—Ç—å
UPDATE accounts SET balance = 900, version = 6
WHERE id = 1 AND version = 5;

-- –ï—Å–ª–∏ version –∏–∑–º–µ–Ω–∏–ª—Å—è (–∫—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–π –æ–±–Ω–æ–≤–∏–ª —Ä–∞–Ω—å—à–µ), UPDATE –≤–µ—Ä–Ω—ë—Ç 0 —Å—Ç—Ä–æ–∫
-- –¢–æ–≥–¥–∞ retry
```

–ù–∏–∫–∞–∫–∏—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫, –Ω–æ –∑–∞—â–∏—Ç–∞ –æ—Ç race conditions.

**5. –ò—Å–ø–æ–ª—å–∑—É–π connection pooling –ø—Ä–∞–≤–∏–ª—å–Ω–æ**

–ï—Å–ª–∏ —É —Ç–µ–±—è –ø—É–ª –∏–∑ 20 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∫ PostgreSQL, –∞ –≤ —Å–∏—Å—Ç–µ–º–µ 100 –ø–æ—Ç–æ–∫–æ–≤:
- –ú–∞–∫—Å–∏–º—É–º 20 –ø–æ—Ç–æ–∫–æ–≤ –º–æ–≥—É—Ç –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –û—Å—Ç–∞–ª—å–Ω—ã–µ 80 –±—É–¥—É—Ç –ë–õ–û–ö–ò–†–û–í–ê–ù–´, –æ–∂–∏–¥–∞—è —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

–†–µ—à–µ–Ω–∏–µ:
- –£–≤–µ–ª–∏—á—å —Ä–∞–∑–º–µ—Ä –ø—É–ª–∞ (–Ω–æ –Ω–µ —Å–ª–∏—à–∫–æ–º: PostgreSQL –ø–ª–æ—Ö–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å 1000 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)
- –ò—Å–ø–æ–ª—å–∑—É–π pgBouncer (connection pooler)
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, —á—Ç–æ–±—ã –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –º–æ–≥ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏

**6. –ú–æ–Ω–∏—Ç–æ—Ä—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**

PostgreSQL:
```sql
SELECT
  blocked.pid AS blocked_pid,
  blocked.query AS blocked_query,
  blocking.pid AS blocking_pid,
  blocking.query AS blocking_query
FROM pg_stat_activity AS blocked
JOIN pg_stat_activity AS blocking
  ON blocking.pid = ANY(pg_blocking_pids(blocked.pid))
WHERE NOT blocked.granted;
```

–≠—Ç–æ –ø–æ–∫–∞–∂–µ—Ç, –∫–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –∏ –∫–µ–º.

–ê–ª–µ—Ä—Ç–∏—Ä—É–π, –µ—Å–ª–∏:
- –ó–∞–ø—Ä–æ—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω > 10 —Å–µ–∫—É–Ω–¥
- –ë–æ–ª–µ–µ 50 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

---

## 4. Non-Blocking Semantics (–ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –°–µ–º–∞–Ω—Ç–∏–∫–∞)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Non-Blocking Semantics** ‚Äî —ç—Ç–æ –º–æ–¥–µ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –æ–ø–µ—Ä–∞—Ü–∏—è **–Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç** –≤—ã–∑—ã–≤–∞—é—â–∏–π –∫–æ–¥. –ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ, –æ–Ω–∞ –ª–∏–±–æ –≤–µ—Ä–Ω—ë—Ç –æ—à–∏–±–∫—É, –ª–∏–±–æ –≤–µ—Ä–Ω—ë—Ç "—á–∞—Å—Ç–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç" (–Ω–∞–ø—Ä–∏–º–µ—Ä, future/promise), –Ω–æ –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç caller.

–¢—Ä–∏ —É—Ä–æ–≤–Ω—è non-blocking:
1. **Wait-free**: –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ —à–∞–≥–æ–≤, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –¥–µ–π—Å—Ç–≤–∏–π –¥—Ä—É–≥–∏—Ö –ø–æ—Ç–æ–∫–æ–≤
2. **Lock-free**: –∫–∞–∫ –º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—Ä—É–µ—Ç –∑–∞ –∫–æ–Ω–µ—á–Ω–æ–µ –≤—Ä–µ–º—è
3. **Obstruction-free**: –ø–æ—Ç–æ–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—Ä—É–µ—Ç, –µ—Å–ª–∏ –µ–º—É –Ω–µ –º–µ—à–∞—é—Ç –¥—Ä—É–≥–∏–µ –ø–æ—Ç–æ–∫–∏

```
Thread 1                     Shared Resource
  |                             |
  |--- –ü–æ–ø—ã—Ç–∫–∞ –∑–∞—Ö–≤–∞—Ç–∏—Ç—å ------->|
  |    (—Ä–µ—Å—É—Ä—Å –∑–∞–Ω—è—Ç)           |
  |<-- EAGAIN (–ø–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ)--|
  |                             |
  | (–ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É)         |
  |                             |
  |--- –ü–æ–ø—ã—Ç–∫–∞ –∑–∞—Ö–≤–∞—Ç–∏—Ç—å ------->|
  |    (—Ä–µ—Å—É—Ä—Å —Å–≤–æ–±–æ–¥–µ–Ω)        |
  |<-- –£—Å–ø–µ—à–Ω–æ ------------------|
```

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫**: caller –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ "–∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç—Å—è"
- **–í—ã—Å–æ–∫–∞—è –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å**: —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ —É–¥–∞—é—Ç—Å—è
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –æ–ø—Ä–æ—Å–∏—Ç—å —Ç—ã—Å—è—á–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ù–µ—Ç deadlock**: –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ω–µ—Ç –∏ deadlock

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —É—Å–ø–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–∏**: –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å "—Ä–µ—Å—É—Ä—Å –∑–∞–Ω—è—Ç, –ø–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ"
- **–ù–µ —É–ø—Ä–æ—â–∞–µ—Ç –∫–æ–¥**: –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å "–ø–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ", retry –ª–æ–≥–∏–∫–∞, polling
- **–ù–µ –¥–∞—ë—Ç —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏**: –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å, –∞ –¥—Ä—É–≥–æ–π ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–æ–ª—É—á–∞—Ç—å "–∑–∞–Ω—è—Ç–æ"
- **–ù–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É contention**: –µ—Å–ª–∏ –º–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–æ–≤ –ø—ã—Ç–∞—é—Ç—Å—è –∑–∞—Ö–≤–∞—Ç–∏—Ç—å —Ä–µ—Å—É—Ä—Å, –≤—Å–µ –ø–æ–ª—É—á–∞—Ç "–∑–∞–Ω—è—Ç–æ"

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**Redis: SETNX (Set if Not eXists)**

`SETNX` ‚Äî –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:
```
SETNX mylock "token123"
```

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- `1` ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞—Ö–≤–∞—á–µ–Ω–∞ (–∫–ª—é—á –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª)
- `0` ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —É–∂–µ –∑–∞–Ω—è—Ç–∞ (–∫–ª—é—á —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)

–ö–ª–∏–µ–Ω—Ç –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –µ—Å–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–Ω—è—Ç–∞. –û–Ω –ø–æ–ª—É—á–∞–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç "0" –∏ –º–æ–∂–µ—Ç:
- –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–∑–∂–µ (retry)
- –°–¥–µ–ª–∞—Ç—å —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ
- –í–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (distributed lock).

**PostgreSQL: SKIP LOCKED**

–û–±—ã—á–Ω—ã–π `SELECT FOR UPDATE` –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –µ—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –∑–∞–Ω—è—Ç–∞. `SKIP LOCKED` –º–µ–Ω—è–µ—Ç —ç—Ç–æ:
```
SELECT * FROM tasks
WHERE status = 'pending'
ORDER BY created_at
LIMIT 1
FOR UPDATE SKIP LOCKED;
```

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç: "–í–µ—Ä–Ω–∏ –º–Ω–µ –ø–µ—Ä–≤—É—é –Ω–µ–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É. –ï—Å–ª–∏ –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã, –≤–µ—Ä–Ω–∏ 0 —Å—Ç—Ä–æ–∫, –Ω–æ –ù–ï –±–ª–æ–∫–∏—Ä—É–π—Å—è."

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ: –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á –≤ PostgreSQL.

–ü—Ä–∏–º–µ—Ä:
- 100 –∑–∞–¥–∞—á –≤ —Ç–∞–±–ª–∏—Ü–µ
- 10 –≤–æ—Ä–∫–µ—Ä–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –±–µ—Ä—É—Ç –∑–∞–¥–∞—á–∏
- –ö–∞–∂–¥—ã–π –≤–æ—Ä–∫–µ—Ä –¥–µ–ª–∞–µ—Ç `SELECT ... FOR UPDATE SKIP LOCKED`
- –í–æ—Ä–∫–µ—Ä—ã –ù–ï –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–µ: –∫–∞–∂–¥—ã–π –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ—é –Ω–µ–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∑–∞–¥–∞—á—É

**Nginx: non-blocking I/O —Å epoll**

Nginx –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π I/O:
- –ö–æ–≥–¥–∞ Nginx —á–∏—Ç–∞–µ—Ç –∏–∑ —Å–æ–∫–µ—Ç–∞, –æ–Ω –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ Nginx —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Å–æ–∫–µ—Ç –≤ epoll (event notification –º–µ—Ö–∞–Ω–∏–∑–º Linux)
- Nginx –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –∑–∞–ø—Ä–æ—Å—ã
- –ö–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç, epoll —É–≤–µ–¥–æ–º–ª—è–µ—Ç Nginx
- Nginx –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ —ç—Ç–æ–º—É —Å–æ–∫–µ—Ç—É –∏ —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

–ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É –æ–¥–∏–Ω Nginx worker –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å 10,000+ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.

**MongoDB: non-blocking reads (–ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ)**

MongoDB –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ —á—Ç–µ–Ω–∏—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `readConcern: "available"`:
```
db.users.find({}).readConcern("available")
```

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç: "–≤–µ—Ä–Ω–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã –∏–ª–∏ –Ω–µ —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã".

–ß—Ç–µ–Ω–∏–µ –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ locks –∏–ª–∏ –æ–∂–∏–¥–∞–Ω–∏–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.

**ClickHouse: non-blocking inserts –≤ –±—É—Ñ–µ—Ä**

ClickHouse —Å `async_insert=1`:
- –î–∞–Ω–Ω—ã–µ –ø–∏—à—É—Ç—Å—è –≤ –±—É—Ñ–µ—Ä –≤ –ø–∞–º—è—Ç–∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
- –ó–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ù–ï –±–ª–æ–∫–∏—Ä—É—è—Å—å –Ω–∞ –∑–∞–ø–∏—Å–∏ –Ω–∞ –¥–∏—Å–∫
- –í —Ñ–æ–Ω–µ ClickHouse –±–∞—Ç—á–∏—Ç –∏ –ø–∏—à–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ –¥–∏—Å–∫

**RabbitMQ: basicGet (polling –≤–º–µ—Å—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è)**

–í–º–µ—Å—Ç–æ –±–ª–æ–∫–∏—Ä—É—é—â–µ–≥–æ `basicConsume`, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `basicGet`:
```
message = channel.basicGet("queue_name", auto_ack=True)
if message is None:
    print("–û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞")
else:
    process(message)
```

`basicGet` –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è. –ï—Å–ª–∏ –æ—á–µ—Ä–µ–¥–∏ –ø—É—Å—Ç–∞, —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None`.

### ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞ 1: Busy-waiting (–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ)**

–¢—ã —Ö–æ—á–µ—à—å –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É, –∏—Å–ø–æ–ª—å–∑—É—è –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π `SETNX`:
```
while True:
    result = redis.setnx("mylock", "token")
    if result == 1:
        break  # –ó–∞—Ö–≤–∞—Ç–∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
    # –ù–µ –∑–∞—Ö–≤–∞—Ç–∏–ª–∏, –ø–æ–ø—Ä–æ–±—É–µ–º –µ—â—ë —Ä–∞–∑
```

–ü—Ä–æ–±–ª–µ–º–∞: —ç—Ç–æ—Ç —Ü–∏–∫–ª —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 100% CPU, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –æ–ø—Ä–∞—à–∏–≤–∞—è Redis. –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è busy-waiting (–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ).

–†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤—å sleep –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏:
```
while True:
    result = redis.setnx("mylock", "token")
    if result == 1:
        break
    time.sleep(0.1)  # –ü–æ–¥–æ–∂–¥–∏ 100–º—Å –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–æ–π
```

–ù–æ —ç—Ç–æ –≤–≤–æ–¥–∏—Ç –∑–∞–¥–µ—Ä–∂–∫—É: –µ—Å–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ—Å–≤–æ–±–æ–¥–∏–ª–∞—Å—å —á–µ—Ä–µ–∑ 10–º—Å –ø–æ—Å–ª–µ —Ç–≤–æ–µ–≥–æ sleep, —Ç—ã —É–∑–Ω–∞–µ—à—å –æ–± —ç—Ç–æ–º —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ 100–º—Å.

**–ü—Ä–æ–±–ª–µ–º–∞ 2: Starvation (–≥–æ–ª–æ–¥–∞–Ω–∏–µ)**

10 –ø–æ—Ç–æ–∫–æ–≤ –ø—ã—Ç–∞—é—Ç—Å—è –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —á–µ—Ä–µ–∑ `SETNX`:
- –ü–æ—Ç–æ–∫ 1 –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç, –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —á–µ—Ä–µ–∑ 10–º—Å
- –ü–æ—Ç–æ–∫ 2 —É—Å–ø–µ–≤–∞–µ—Ç –∑–∞—Ö–≤–∞—Ç–∏—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è
- –ü–æ—Ç–æ–∫ 2 –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —á–µ—Ä–µ–∑ 10–º—Å
- –ü–æ—Ç–æ–∫ 1 —Å–Ω–æ–≤–∞ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç
- ...

–ü–æ—Ç–æ–∫–∏ 3-10 –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–æ–ª—É—á–∞—é—Ç "–∑–∞–Ω—è—Ç–æ" –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É. –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è starvation.

–ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã (mutex, —Å–µ–º–∞—Ñ–æ—Ä—ã) –æ–±—ã—á–Ω–æ –∏–º–µ—é—Ç –æ—á–µ—Ä–µ–¥—å (FIFO), –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç starvation. –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã —Ç–∞–∫–æ–π –≥–∞—Ä–∞–Ω—Ç–∏–∏ –Ω–µ –¥–∞—é—Ç.

**–ü—Ä–æ–±–ª–µ–º–∞ 3: ABA problem**

–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –≤ lock-free –∞–ª–≥–æ—Ä–∏—Ç–º–∞—Ö:

1. –ü–æ—Ç–æ–∫ 1 —á–∏—Ç–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ: `A`
2. –ü–æ—Ç–æ–∫ 1 —Ö–æ—á–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å: `A ‚Üí B` (–∏—Å–ø–æ–ª—å–∑—É—è compare-and-swap)
3. –ü–æ—Ç–æ–∫ 2 –º–µ–Ω—è–µ—Ç: `A ‚Üí C`
4. –ü–æ—Ç–æ–∫ 2 –º–µ–Ω—è–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ: `C ‚Üí A`
5. –ü–æ—Ç–æ–∫ 1 –¥–µ–ª–∞–µ—Ç CAS (compare-and-swap): "–µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ == A, –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞ B"
6. CAS —É—Å–ø–µ—à–µ–Ω! –ó–Ω–∞—á–µ–Ω–∏–µ –±—ã–ª–æ `A` (—Ö–æ—Ç—è –≤ –ø—Ä–æ–º–µ–∂—É—Ç–∫–µ –æ–Ω–æ –±—ã–ª–æ `C`)

–ü–æ—Ç–æ–∫ 1 –¥—É–º–∞–µ—Ç, —á—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å, –Ω–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–±—ã–≤–∞–ª–æ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `C`.

–í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–∞–≥–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ `A` ‚Äî —ç—Ç–æ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª —É–¥–∞–ª—ë–Ω –∏ –∑–∞–Ω–æ–≤–æ —Å–æ–∑–¥–∞–Ω –ø–æ —Ç–æ–º—É –∂–µ –∞–¥—Ä–µ—Å—É).

–†–µ—à–µ–Ω–∏–µ: –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ. –•—Ä–∞–Ω–∏ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ, –∞ `(–∑–Ω–∞—á–µ–Ω–∏–µ, –≤–µ—Ä—Å–∏—è)`. –ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤–µ—Ä—Å–∏—é.

**–ü—Ä–æ–±–ª–µ–º–∞ 4: –°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏**

–ë–∞–≥–∏ –≤ lock-free –∫–æ–¥–µ –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏:
- –û–Ω–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ç–∞–π–º–∏–Ω–≥–∞ –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏
- –ú–æ–≥—É—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å —Ä–∞–∑ –≤ –º–∏–ª–ª–∏–æ–Ω –æ–ø–µ—Ä–∞—Ü–∏–π
- –ù–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç—Å—è –≤ –æ—Ç–ª–∞–¥—á–∏–∫–µ (–æ—Ç–ª–∞–¥—á–∏–∫ –º–µ–Ω—è–µ—Ç —Ç–∞–π–º–∏–Ω–≥)

–†–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: –≤ –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª crash –∏–∑-–∑–∞ race condition –≤ lock-free —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö. –ë–∞–≥ –±—ã–ª –æ–±–Ω–∞—Ä—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ core dump.

**–ü—Ä–æ–±–ª–µ–º–∞ 5: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–æ–∂–µ—Ç –±—ã—Ç—å —Ö—É–∂–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫**

Lock-free –∞–ª–≥–æ—Ä–∏—Ç–º—ã —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç CAS (compare-and-swap) –≤ —Ü–∏–∫–ª–µ:
```
while True:
    old_value = read()
    new_value = old_value + 1
    if compare_and_swap(old_value, new_value):
        break  # –£—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–∏–ª–∏
    # –ï—Å–ª–∏ CAS —É–ø–∞–ª (–∫—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–π –æ–±–Ω–æ–≤–∏–ª), –ø–æ–ø—Ä–æ–±—É–µ–º –µ—â—ë —Ä–∞–∑
```

–ü—Ä–∏ –≤—ã—Å–æ–∫–æ–º contention (–º–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–æ–≤ –ø—ã—Ç–∞—é—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ):
- CAS –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–∞–¥–∞–µ—Ç
- –ü–æ—Ç–æ–∫–∏ –∫—Ä—É—Ç—è—Ç—Å—è –≤ —Ü–∏–∫–ª–µ, —Ç—Ä–∞—Ç—è CPU
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–æ–∂–µ—Ç –±—ã—Ç—å —Ö—É–∂–µ –æ–±—ã—á–Ω–æ–≥–æ mutex

### üèóÔ∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É

**–ò—Å–ø–æ–ª—å–∑—É–π non-blocking, –∫–æ–≥–¥–∞:**

1. **–í—ã—Å–æ–∫–∏–π –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º –∏ –Ω–∏–∑–∫–∞—è –∫–æ–Ω—Ç–µ–Ω—à–Ω**
   - –ï—Å–ª–∏ —Ä–µ–¥–∫–æ –±—ã–≤–∞–µ—Ç, —á—Ç–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ —Ä–µ—Å—É—Ä—Å—É

2. **–ö—Ä–∏—Ç–∏—á–Ω–∞ –Ω–∏–∑–∫–∞—è latency**
   - –ù–µ–ª—å–∑—è –ø–æ–∑–≤–æ–ª–∏—Ç—å –ø–æ—Ç–æ–∫—É –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–∞–∂–µ –Ω–∞ –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—É

3. **Event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
   - Nginx, Node.js, async Python: –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç—ã—Å—è—á–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

**–ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–æ–±–ª–µ–º:**

**1. Exponential backoff –¥–ª—è retry**

–ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –≤–µ—Ä–Ω—É–ª–∞ "–ø–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ", –Ω–µ –ø—ã—Ç–∞–π—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ:
```
delay = 1–º—Å
while True:
    result = try_nonblocking_operation()
    if result.success:
        break
    sleep(delay)
    delay = min(delay * 2, 1000–º—Å)  # Exponential backoff –¥–æ –º–∞–∫—Å–∏–º—É–º 1 —Å–µ–∫—É–Ω–¥—ã
```

–≠—Ç–æ —É–º–µ–Ω—å—à–∞–µ—Ç contention –∏ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–∏—Å—Ç–µ–º—É.

**2. –ò—Å–ø–æ–ª—å–∑—É–π –≥–æ—Ç–æ–≤—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏**

–ù–µ –ø–∏—à–∏ lock-free –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å –Ω—É–ª—è. –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:
- Java: `java.util.concurrent` (ConcurrentHashMap, AtomicInteger, etc.)
- C++: `std::atomic`, lock-free –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –æ—Ç Intel TBB
- Rust: –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Ç–∏–ø–∞ `crossbeam`

Lock-free –∫–æ–¥ –û–ß–ï–ù–¨ —Å–ª–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ. –î–∞–∂–µ —ç–∫—Å–ø–µ—Ä—Ç—ã –¥–æ–ø—É—Å–∫–∞—é—Ç –æ—à–∏–±–∫–∏.

**3. –î–æ–±–∞–≤—å fallback –Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**

–ï—Å–ª–∏ after N –ø–æ–ø—ã—Ç–æ–∫ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å, –ø–µ—Ä–µ–∫–ª—é—á–∞–π—Å—è –Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—â—É—é:
```
for i in range(10):
    result = redis.setnx("mylock", "token")
    if result == 1:
        break
    time.sleep(0.01)
else:
    # –ü–æ—Å–ª–µ 10 –ø–æ–ø—ã—Ç–æ–∫ –Ω–µ —É–¥–∞–ª–æ—Å—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–ª–æ–∫–∏—Ä—É—é—â–∏–π –º–µ—Ö–∞–Ω–∏–∑–º
    use_blocking_lock()
```

**4. –ú–æ–Ω–∏—Ç–æ—Ä—å contention**

–°—á–∏—Ç–∞–π –º–µ—Ç—Ä–∏–∫–∏:
- –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –≤–µ—Ä–Ω—É–ª–∞ "–ø–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ"
- –°–∫–æ–ª—å–∫–æ –ø–æ–ø—ã—Ç–æ–∫ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤ —Å—Ä–µ–¥–Ω–µ–º –¥–ª—è —É—Å–ø–µ—Ö–∞

–ï—Å–ª–∏ contention –≤—ã—Å–æ–∫–∞—è, –≤–æ–∑–º–æ–∂–Ω–æ, –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –±—É–¥—É—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ.

**5. –ò—Å–ø–æ–ª—å–∑—É–π SKIP LOCKED –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π –∑–∞–¥–∞—á –≤ PostgreSQL**

–í–º–µ—Å—Ç–æ –≤–Ω–µ—à–Ω–µ–π –æ—á–µ—Ä–µ–¥–∏ (RabbitMQ, Redis), –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PostgreSQL –∫–∞–∫ –æ—á–µ—Ä–µ–¥—å:
```sql
CREATE TABLE tasks (
  id SERIAL PRIMARY KEY,
  status TEXT,
  payload JSONB,
  created_at TIMESTAMP
);

-- –í–æ—Ä–∫–µ—Ä –±–µ—Ä—ë—Ç –∑–∞–¥–∞—á—É:
BEGIN;
SELECT * FROM tasks
WHERE status = 'pending'
ORDER BY created_at
LIMIT 1
FOR UPDATE SKIP LOCKED;

-- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç...

UPDATE tasks SET status = 'completed' WHERE id = ...;
COMMIT;
```

–ü–ª—é—Å—ã:
- –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–µ: –≤–æ—Ä–∫–µ—Ä—ã –Ω–µ –∂–¥—É—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–µ: –µ—Å–ª–∏ –≤–æ—Ä–∫–µ—Ä —É–ø–∞–ª, –∑–∞–¥–∞—á–∞ –≤–µ—Ä–Ω—ë—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å (–æ—Ç–∫–∞—Ç–∏—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è)
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ: –∑–∞–¥–∞—á–∏ –Ω–µ –ø–æ—Ç–µ—Ä—è—é—Ç—Å—è

---

## 5. Speculative Execution (–°–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Speculative Execution** ‚Äî —ç—Ç–æ —Ç–µ—Ö–Ω–∏–∫–∞, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π —Å–∏—Å—Ç–µ–º–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ **–∑–∞—Ä–∞–Ω–µ–µ**, –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—è, —á—Ç–æ –æ–Ω–∏ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –≤ –±—É–¥—É—â–µ–º, –¥–∞–∂–µ –µ—Å–ª–∏ –µ—â—ë –Ω–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏. –ï—Å–ª–∏ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–∫–∞–∑–∞–ª–æ—Å—å –≤–µ—Ä–Ω—ã–º, —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–∂–µ –≥–æ—Ç–æ–≤. –ï—Å–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–º ‚Äî —Ä–∞–±–æ—Ç–∞ –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è.

```
Time ‚Üí

–û–±—ã—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:
  |--- –ó–∞–ø—Ä–æ—Å ---||--- –û–±—Ä–∞–±–æ—Ç–∫–∞ ---||--- –†–µ–∑—É–ª—å—Ç–∞—Ç ---|

–°–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:
  |--- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (—Å–ø–µ–∫—É–ª—è—Ü–∏—è) ---|
                              |--- –ó–∞–ø—Ä–æ—Å ---||--- –†–µ–∑—É–ª—å—Ç–∞—Ç ---|
                                               ‚Üë
                                          –†–µ–∑—É–ª—å—Ç–∞—Ç —É–∂–µ –≥–æ—Ç–æ–≤!
```

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–£–º–µ–Ω—å—à–µ–Ω–∏–µ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏**: –µ—Å–ª–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –≤–µ—Ä–Ω–æ–µ, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≥–æ—Ç–æ–≤ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- **–ü–æ–≤—ã—à–µ–Ω–∏–µ throughput**: –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ—è**: CPU/–¥–∏—Å–∫ –Ω–µ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—Ç, –≤—ã–ø–æ–ª–Ω—è—è —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω—É—é —Ä–∞–±–æ—Ç—É

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —ç–∫–æ–Ω–æ–º–∏—é —Ä–µ—Å—É—Ä—Å–æ–≤**: –µ—Å–ª–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –Ω–µ–≤–µ—Ä–Ω–æ–µ, —Ä–µ—Å—É—Ä—Å—ã –ø–æ—Ç—Ä–∞—á–µ–Ω—ã –≤–ø—É—Å—Ç—É—é
- **–ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç side effects**: –µ—Å–ª–∏ —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –∏–º–µ–µ—Ç side effects, –∏—Ö –ø—Ä–∏–¥—ë—Ç—Å—è –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å
- **–ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–æ—Ä–æ–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**: –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –¥–æ—Ä–æ–≥–∞—è (—Å–ø–∏—Å–∞–Ω–∏–µ –¥–µ–Ω–µ–≥), —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–∞—Å–Ω–æ
- **–ú–æ–∂–µ—Ç —É—Ö—É–¥—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –µ—Å–ª–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —á–∞—Å—Ç–æ –Ω–µ–≤–µ—Ä–Ω—ã, —Å–∏—Å—Ç–µ–º–∞ —Ç—Ä–∞—Ç–∏—Ç –±–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**ClickHouse: speculative query execution**

ClickHouse –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–µ–ø–ª–∏–∫–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:
- –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ replica 1, replica 2, replica 3 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ü–µ—Ä–≤–∞—è replica, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–≤–µ—Ç–∏–ª–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç–º–µ–Ω—è—é—Ç—Å—è

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ: —É–º–µ–Ω—å—à–µ–Ω–∏–µ P99 –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏. –ï—Å–ª–∏ –æ–¥–Ω–∞ replica —Ç–æ—Ä–º–æ–∑–∏—Ç (–º–µ–¥–ª–µ–Ω–Ω—ã–π –¥–∏—Å–∫, GC pause), –¥—Ä—É–≥–∏–µ –æ—Ç–≤–µ—Ç—è—Ç –±—ã—Å—Ç—Ä–µ–µ.

–ù–∞—Å—Ç—Ä–æ–π–∫–∞: `max_parallel_replicas` –∏ `parallel_replicas_count`.

–¶–µ–Ω–∞: —Ä–µ—Å—É—Ä—Å—ã —Ä–∞—Å—Ö–æ–¥—É—é—Ç—Å—è –Ω–∞ –≤—Å–µ —Ä–µ–ø–ª–∏–∫–∏, –¥–∞–∂–µ –µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –æ—Ç –æ–¥–Ω–æ–π.

**Redis: –ø—Ä–∏–º–µ—Ä —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è**

–ü—Ä–µ–¥—Å—Ç–∞–≤—å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
- –ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ –≤ 9:00 –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤—Å–ø–ª–µ—Å–∫ —Ç—Ä–∞—Ñ–∏–∫–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç email)
- –°–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ –ø—Ä–æ–≥—Ä–µ—Ç—å –∫—ç—à –ø–µ—Ä–µ–¥ 9:00

–ê–ª–≥–æ—Ä–∏—Ç–º:
- –í 8:50 —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –î–∞–Ω–Ω—ã–µ –∫–ª–∞–¥—É—Ç—Å—è –≤ Redis –∫—ç—à
- –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ 9:00, –¥–∞–Ω–Ω—ã–µ —É–∂–µ –≤ –∫—ç—à–µ

–≠—Ç–æ —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: –º—ã –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞–ø—Ä–æ—Å—è—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ.

**PostgreSQL: speculative inserts –≤ unique –∏–Ω–¥–µ–∫—Å–∞—Ö**

–ö–æ–≥–¥–∞ —Ç—ã –¥–µ–ª–∞–µ—à—å `INSERT` –≤ —Ç–∞–±–ª–∏—Ü—É —Å unique –∏–Ω–¥–µ–∫—Å–æ–º:
- PostgreSQL —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ –≤—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç unique constraint
- –ï—Å–ª–∏ constraint –Ω–∞—Ä—É—à–µ–Ω, –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –≤—Å—Ç–∞–≤–∫—É –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫: –≤–º–µ—Å—Ç–æ –∑–∞—Ö–≤–∞—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π, PostgreSQL –ø—Ä–æ–±—É–µ—Ç –≤—Å—Ç–∞–≤–∏—Ç—å —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ.

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —ç—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **speculative insertion** (ON CONFLICT –º–µ—Ö–∞–Ω–∏–∑–º).

**MongoDB: —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —Å secondary**

MongoDB –º–æ–∂–µ—Ç —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ —á–∏—Ç–∞—Ç—å —Å secondary –Ω–æ–¥:
- –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ primary
- –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ secondary
- –ü–µ—Ä–≤—ã–π –æ—Ç–≤–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É

–ï—Å–ª–∏ secondary –±—ã—Å—Ç—Ä–µ–µ –æ—Ç–≤–µ—Ç–∏–ª, –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è.

–ù–∞—Å—Ç—Ä–æ–π–∫–∞: `readPreference: "nearest"` —Å —Ö–µ–¥–∂–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

**Nginx: –ø—Ä–∏–º–µ—Ä —Å prefetching**

Nginx –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ prefetching (–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞):
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `/page1.html`
- Nginx –æ—Ç–¥–∞—ë—Ç `/page1.html`
- Nginx —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç `/page1.css`, `/page1.js` –≤ –∫—ç—à (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—è, —á—Ç–æ –±—Ä–∞—É–∑–µ—Ä –∏—Ö –∑–∞–ø—Ä–æ—Å–∏—Ç)
- –ö–æ–≥–¥–∞ –±—Ä–∞—É–∑–µ—Ä –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `/page1.css`, –æ–Ω–æ —É–∂–µ –≤ –∫—ç—à–µ

–≠—Ç–æ –Ω–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è Nginx, –Ω–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –º–æ–¥—É–ª–∏ –∏–ª–∏ –ª–æ–≥–∏–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**Kafka: —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ —á—Ç–µ–Ω–∏–µ**

Kafka consumer –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ:
- Consumer –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ 10 –ø–∞—Ä—Ç–∏—Ü–∏–π
- Consumer –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Å–µ—Ö 10 –ø–∞—Ä—Ç–∏—Ü–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø–æ—Ä—è–¥–∫–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è

–≠—Ç–æ –Ω–µ –≤—Å–µ–≥–¥–∞ —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ —á–∏—Å—Ç–æ–º –≤–∏–¥–µ, –Ω–æ –∏–¥–µ—è —Ç–∞ –∂–µ: –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –±–æ–ª—å—à–µ, —á–µ–º –Ω—É–∂–Ω–æ —Å–µ–π—á–∞—Å, —á—Ç–æ–±—ã –±—ã—Ç—å –≥–æ—Ç–æ–≤—ã–º –∫ –±—É–¥—É—â–∏–º –∑–∞–ø—Ä–æ—Å–∞–º.

### ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞ 1: Wasted resources (–ø–æ—Ç—Ä–∞—á–µ–Ω–Ω—ã–µ –≤–ø—É—Å—Ç—É—é —Ä–µ—Å—É—Ä—Å—ã)**

ClickHouse –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ 3 —Ä–µ–ø–ª–∏–∫–∞—Ö —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ:
- Replica 1 –æ—Ç–≤–µ—Ç–∏–ª–∞ –∑–∞ 100–º—Å
- Replica 2 –æ—Ç–≤–µ—Ç–∏–ª–∞ –∑–∞ 500–º—Å (—Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–±—Ä–æ—à–µ–Ω)
- Replica 3 –æ—Ç–≤–µ—Ç–∏–ª–∞ –∑–∞ 800–º—Å (—Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–±—Ä–æ—à–µ–Ω)

–†–µ—Å—É—Ä—Å—ã (CPU, I/O) —Ä–µ–ø–ª–∏–∫ 2 –∏ 3 –ø–æ—Ç—Ä–∞—á–µ–Ω—ã –≤–ø—É—Å—Ç—É—é.

–ï—Å–ª–∏ 50% –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, —Ä–µ—Å—É—Ä—Å—ã –∫–ª–∞—Å—Ç–µ—Ä–∞ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç—Å—è –≤ 1.5-2 —Ä–∞–∑–∞.

–†–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: –∫–æ–º–ø–∞–Ω–∏—è –≤–∫–ª—é—á–∏–ª–∞ —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ ClickHouse –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. CPU —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è –≤—ã—Ä–æ—Å–ª–∞ –Ω–∞ 80%, –ø–æ—Ç–æ–º—É —á—Ç–æ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤—ã–ø–æ–ª–Ω—è–ª–æ—Å—å –Ω–∞ 2-3 —Ä–µ–ø–ª–∏–∫–∞—Ö –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–π. –ü—Ä–∏—à–ª–æ—Å—å –¥–æ–±–∞–≤–ª—è—Ç—å –±–æ–ª—å—à–µ —Å–µ—Ä–≤–µ—Ä–æ–≤.

**–ü—Ä–æ–±–ª–µ–º–∞ 2: Side effects –Ω–µ–ª—å–∑—è –æ—Ç–∫–∞—Ç–∏—Ç—å**

–¢—ã –¥–µ–ª–∞–µ—à—å —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ –≤–Ω–µ—à–Ω–µ–º—É API:
- –°–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ –≤—ã–∑—ã–≤–∞–µ—à—å `send_email(user, "Welcome!")`
- –û–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è (—Å–ø–µ–∫—É–ª—è—Ü–∏—è –±—ã–ª–∞ –Ω–µ–≤–µ—Ä–Ω–æ–π)
- –ù–æ email —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –û—Ç–∫–∞—Ç–∏—Ç—å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ

Side effects (–æ—Ç–ø—Ä–∞–≤–∫–∞ email, —Å–ø–∏—Å–∞–Ω–∏–µ –¥–µ–Ω–µ–≥, —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö) –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏, –µ—Å–ª–∏ –Ω–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –æ—Ç–∫–∞—Ç–∞.

**–ü—Ä–æ–±–ª–µ–º–∞ 3: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ latency –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ**

–ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–æ–∂–µ—Ç —É—Ö—É–¥—à–∏—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é:
- –°–∏—Å—Ç–µ–º–∞ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –Ω–∞ 80% CPU
- –°–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç –µ—â—ë 50% –Ω–∞–≥—Ä—É–∑–∫–∏
- CPU —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è ‚Üí 100%
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã (–≤–∫–ª—é—á–∞—è –æ—Å–Ω–æ–≤–Ω—ã–µ) –Ω–∞—á–∏–Ω–∞—é—Ç —Ç–æ—Ä–º–æ–∑–∏—Ç—å

–°–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, –∫–æ–≥–¥–∞ –µ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã. –ü—Ä–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ –æ–Ω–æ –≤—Ä–µ–¥–∏—Ç.

**–ü—Ä–æ–±–ª–µ–º–∞ 4: False positives –≤ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è—Ö**

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–æ—Å–∏—Ç –¥–∞–Ω–Ω—ã–µ X, –∏ —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ –∏—Ö –∑–∞–≥—Ä—É–∂–∞–µ—Ç. –ù–æ:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ Y
- –î–∞–Ω–Ω—ã–µ X –≤ –∫—ç—à–µ, –Ω–æ –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã
- –î–∞–Ω–Ω—ã–µ Y –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∑–∞–Ω–æ–≤–æ

–ï—Å–ª–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –Ω–µ—Ç–æ—á–Ω—ã (50% –∏ –Ω–∏–∂–µ), —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞—Ç–∏—Ç –±–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤, —á–µ–º —ç–∫–æ–Ω–æ–º–∏—Ç.

### üèóÔ∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É

**–ò—Å–ø–æ–ª—å–∑—É–π —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –∫–æ–≥–¥–∞:**

1. **–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —Ç–æ—á–Ω—ã (> 70%)**
   - –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –¥–∞–Ω–Ω—ã—Ö (–º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
   - –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã

2. **–û–ø–µ—Ä–∞—Ü–∏–∏ –¥–µ—à—ë–≤—ã–µ –∏ –±–µ–∑ side effects**
   - –ß—Ç–µ–Ω–∏–µ –∏–∑ –∫—ç—à–∞ (–¥–µ—à—ë–≤–æ–µ)
   - –í—ã—á–∏—Å–ª–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å

3. **–ï—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã**
   - CPU —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è < 50%
   - –°–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ—Å—Ç–æ–π

4. **–ö—Ä–∏—Ç–∏—á–Ω–∞ –Ω–∏–∑–∫–∞—è latency**
   - –°–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —É–º–µ–Ω—å—à–∞–µ—Ç P99 latency (–≤—ã–±—Ä–æ—Å—ã)

**–ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–æ–±–ª–µ–º:**

**1. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ**

–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–π/–≤—ã–∫–ª—é—á–∞–π —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:
```
if cpu_utilization < 60%:
    enable_speculative_execution()
else:
    disable_speculative_execution()
```

–≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫—É —Å–∏—Å—Ç–µ–º—ã.

**2. –ò—Å–ø–æ–ª—å–∑—É–π budget (–±—é–¥–∂–µ—Ç —Ä–µ—Å—É—Ä—Å–æ–≤)**

–í—ã–¥–µ–ª—è–π –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –±—é–¥–∂–µ—Ç –Ω–∞ —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:
- –ú–∞–∫—Å–∏–º—É–º 20% CPU –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Å–ø–µ–∫—É–ª—è—Ü–∏–π
- –ï—Å–ª–∏ –±—é–¥–∂–µ—Ç –∏—Å—á–µ—Ä–ø–∞–Ω, —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

**3. –ú–æ–Ω–∏—Ç–æ—Ä—å hit rate –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π**

–°—á–∏—Ç–∞–π –º–µ—Ç—Ä–∏–∫–∏:
- –°–∫–æ–ª—å–∫–æ —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –±—ã–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã (hit)
- –°–∫–æ–ª—å–∫–æ –±—ã–ª–∏ –æ—Ç–±—Ä–æ—à–µ–Ω—ã (miss)
- Hit rate = hits / (hits + misses)

–ï—Å–ª–∏ hit rate < 50%, —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ –æ–∫—É–ø–∞–µ—Ç—Å—è.

**4. –ò—Å–ø–æ–ª—å–∑—É–π tiered speculation (—É—Ä–æ–≤–Ω–∏ —Å–ø–µ–∫—É–ª—è—Ü–∏–∏)**

–ù–µ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ –¥–æ—Ä–æ–≥–∏. –ò—Å–ø–æ–ª—å–∑—É–π —Å–ø–µ–∫—É–ª—è—Ü–∏—é –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ –¥–ª—è –¥–µ—à—ë–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ –¥–ª—è –¥–æ—Ä–æ–≥–∏—Ö:
- –î–µ—à—ë–≤—ã–µ (—á—Ç–µ–Ω–∏–µ –∏–∑ Redis): —Å–ø–µ–∫—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ–≥–¥–∞
- –°—Ä–µ–¥–Ω–∏–µ (SELECT –∏–∑ PostgreSQL): —Å–ø–µ–∫—É–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –Ω–∏–∑–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
- –î–æ—Ä–æ–≥–∏–µ (JOIN –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö): –Ω–µ —Å–ø–µ–∫—É–ª–∏—Ä–æ–≤–∞—Ç—å

**5. –ò–∑–±–µ–≥–∞–π side effects –≤ —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö**

–°–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
- Read-only (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ)
- –ò–ª–∏ –∏–º–µ—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–∫–∞—Ç–∞

–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–µ–ª–∞–π —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ:
- –°–ø–∏—Å–∞–Ω–∏—è –¥–µ–Ω–µ–≥
- –û—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π/emails
- –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- –í—ã–∑–æ–≤—ã –≤–Ω–µ—à–Ω–∏—Ö API —Å side effects

---

## 6. Exactly-Once Execution (–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –†–æ–≤–Ω–æ –û–¥–∏–Ω –†–∞–∑)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Exactly-Once Execution** ‚Äî —ç—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—è, —á—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ **—Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑**, –¥–∞–∂–µ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å–±–æ–µ–≤, retries, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤. –≠—Ç–æ –ª–æ–≥–∏—á–µ—Å–∫–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è: —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑, –Ω–æ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —ç—Ñ—Ñ–µ–∫—Ç –±—É–¥–µ—Ç —Ç–∞–∫–æ–π, –∫–∞–∫ –µ—Å–ª–∏ –±—ã –æ–Ω–∞ –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å –æ–¥–∏–Ω —Ä–∞–∑.

**–í–∞–∂–Ω–æ:** –í —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö "exactly-once" —á–∞—Å—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç "effectively-once" ‚Äî —ç—Ñ—Ñ–µ–∫—Ç –∫–∞–∫ –æ—Ç –æ–¥–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Ö–æ—Ç—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –º–æ–≥–ª–æ –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ø—ã—Ç–æ–∫.

```
–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å                 –°–∏—Å—Ç–µ–º–∞               –û–±—Ä–∞–±–æ—Ç—á–∏–∫
    |                          |                       |
    |---- –ó–∞–ø—Ä–æ—Å (ID=123) ---->|                       |
    |                          |---- –ó–∞–ø—Ä–æ—Å --------->|
    |                          |                       | (–æ–±—Ä–∞–±–æ—Ç–∫–∞)
    |  (—Ç–∞–π–º–∞—É—Ç, retry)        |                       |
    |---- –ó–∞–ø—Ä–æ—Å (ID=123) ---->|                       |
    |                          |  (–¥—É–±–ª–∏–∫–∞—Ç, –∏–≥–Ω–æ—Ä)    |
    |<--- –†–µ–∑—É–ª—å—Ç–∞—Ç -----------|                       |

    –†–µ–∑—É–ª—å—Ç–∞—Ç: –æ–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –†–û–í–ù–û –û–î–ò–ù –†–ê–ó
```

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ –º–µ–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**: –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è –¥–≤–∞–∂–¥—ã (–Ω–µ—Ç –¥–≤–æ–π–Ω–æ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è)
- **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å**: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–Ω–∞–µ—Ç, —á—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑
- **–ó–∞—â–∏—Ç–∞ –æ—Ç retries**: retry –Ω–µ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞ —Ç–æ–≤ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤/–±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- **–ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –≤—Å–µ—Ö –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫**: –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è —Å–∞–º–∞ –ø–æ —Å–µ–±–µ –Ω–µ–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞, exactly-once –Ω–µ –ø–æ–º–æ–∂–µ—Ç
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ—Å—Ç—å**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ç—Ä–µ–±—É—é—Ç –≤—Ä–µ–º–µ–Ω–∏

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**Kafka: exactly-once semantics (EOS)**

Kafka –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç exactly-once —Å–µ–º–∞–Ω—Ç–∏–∫—É –¥–ª—è producer ‚Üí broker ‚Üí consumer:

**Producer ‚Üí Broker (idempotent producer):**
```
properties.put("enable.idempotence", "true");
```

Kafka producer:
- –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –∫–∞–∂–¥–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é —É–Ω–∏–∫–∞–ª—å–Ω—ã–π sequence number
- –ü—Ä–∏ retry (–µ—Å–ª–∏ ACK –Ω–µ –ø–æ–ª—É—á–µ–Ω), producer –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–µ–º –∂–µ sequence number
- Kafka broker –ø—Ä–æ–≤–µ—Ä—è–µ—Ç sequence number –∏ –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã

–†–µ–∑—É–ª—å—Ç–∞—Ç: –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ Kafka —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑, –¥–∞–∂–µ –ø—Ä–∏ retries.

**Consumer ‚Üí Processing ‚Üí Producer (transactions):**
```
properties.put("transactional.id", "my-transactional-id");
```

Kafka transactional producer –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ:
- –ü—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ —Ç–æ–ø–∏–∫–∞ A
- –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –µ–≥–æ
- –ó–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ç–æ–ø–∏–∫ B
- –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å offset –≤ —Ç–æ–ø–∏–∫–µ A

–í—Å—ë —ç—Ç–æ –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –ï—Å–ª–∏ consumer —É–ø–∞–ª, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—Ç–∏—Ç—Å—è, –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞–Ω–æ–≤–æ (–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –±—É–¥–µ—Ç –ø—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω).

**PostgreSQL: idempotent operations —Å UPSERT**

–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞: —Ç—ã —Ö–æ—á–µ—à—å –≤—Å—Ç–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å, –Ω–æ –ø—Ä–∏ retry –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å—Å—è –¥—É–±–ª–∏–∫–∞—Ç.

–ù–µ–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ:
```sql
INSERT INTO orders (id, user_id, amount) VALUES (123, 456, 100);
```

–ï—Å–ª–∏ —ç—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –¥–≤–∞–∂–¥—ã (retry), –±—É–¥–µ—Ç –¥–≤–∞ –∑–∞–∫–∞–∑–∞.

–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ:
```sql
INSERT INTO orders (id, user_id, amount) VALUES (123, 456, 100)
ON CONFLICT (id) DO NOTHING;
```

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ retry:
- –ü–µ—Ä–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: –≤—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å
- –í—Ç–æ—Ä–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (retry): conflict –Ω–∞ `id`, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç

–†–µ–∑—É–ª—å—Ç–∞—Ç: –∑–∞–ø–∏—Å—å –≤—Å—Ç–∞–≤–ª–µ–Ω–∞ —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑.

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Å UPDATE:
```sql
INSERT INTO orders (id, user_id, amount) VALUES (123, 456, 100)
ON CONFLICT (id) DO UPDATE SET amount = EXCLUDED.amount;
```

–≠—Ç–æ UPSERT (insert or update).

**Redis: –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ Redis –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã –ø–æ —Å–≤–æ–µ–π –ø—Ä–∏—Ä–æ–¥–µ:
```
SET key "value"  ‚Üê –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ: –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞—ë—Ç —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```

–ù–æ:
```
INCR counter  ‚Üê –ù–ï –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ: –∫–∞–∂–¥–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫
```

–î–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è exactly-once —Å `INCR`, –∏—Å–ø–æ–ª—å–∑—É–π:
1. **Deduplicate –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞**: –ø–µ—Ä–µ–¥ `INCR` –ø—Ä–æ–≤–µ—Ä—å, –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å –ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è —Å —ç—Ç–∏–º ID
2. **Lua —Å–∫—Ä–∏–ø—Ç** –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
```lua
if redis.call("EXISTS", "processed:" .. request_id) == 0 then
  redis.call("INCR", "counter")
  redis.call("SET", "processed:" .. request_id, "1")
  return 1
else
  return 0
end
```

**MongoDB: idempotent updates**

–ù–µ–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ:
```javascript
db.accounts.updateOne(
  {id: 123},
  {$inc: {balance: -100}}  // –£–º–µ–Ω—å—à–∏—Ç—å –±–∞–ª–∞–Ω—Å –Ω–∞ 100
)
```

–ü—Ä–∏ retry –±–∞–ª–∞–Ω—Å —É–º–µ–Ω—å—à–∏—Ç—Å—è –¥–≤–∞–∂–¥—ã.

–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º transaction ID):
```javascript
session.startTransaction();
// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏ –ª–∏ –º—ã —ç—Ç—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Ä–∞–Ω—å—à–µ
if (db.processed_transactions.findOne({txn_id: "txn123"}) == null) {
  db.accounts.updateOne({id: 123}, {$inc: {balance: -100}});
  db.processed_transactions.insertOne({txn_id: "txn123", timestamp: new Date()});
}
session.commitTransaction();
```

**RabbitMQ: exactly-once —á–µ—Ä–µ–∑ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é**

RabbitMQ —Å–∞–º –ø–æ —Å–µ–±–µ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç exactly-once (—Ç–æ–ª—å–∫–æ at-least-once).

–î–ª—è exactly-once:
1. **–£–Ω–∏–∫–∞–ª—å–Ω—ã–π message ID**: –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
2. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –Ω–∞ consumer**: –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –ø—Ä–æ–≤–µ—Ä—å, –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —ç—Ç–∏–º ID —Ä–∞–Ω—å—à–µ

```
message_id = message.properties.message_id

if not redis.exists(f"processed:{message_id}"):
    process(message)
    redis.set(f"processed:{message_id}", "1", ex=86400)  # –•—Ä–∞–Ω–∏–º 24 —á–∞—Å–∞
else:
    # –î—É–±–ª–∏–∫–∞—Ç, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
    pass
```

**–ü–ª–∞—Ç—ë–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã: idempotency keys**

Stripe API (–ø–ª–∞—Ç—ë–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç idempotency keys:
```
POST /v1/charges
Idempotency-Key: unique-key-123
{
  "amount": 1000,
  "currency": "usd",
  "source": "tok_visa"
}
```

–ï—Å–ª–∏ —Ç—ã –ø–æ–≤—Ç–æ—Ä–∏—à—å —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å —Å —Ç–µ–º –∂–µ `Idempotency-Key`:
- Stripe –ø—Ä–æ–≤–µ—Ä–∏—Ç, –≤—ã–ø–æ–ª–Ω—è–ª—Å—è –ª–∏ –∑–∞–ø—Ä–æ—Å —Å —ç—Ç–∏–º –∫–ª—é—á–æ–º
- –ï—Å–ª–∏ –¥–∞, –≤–µ—Ä–Ω—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è)
- –ï—Å–ª–∏ –Ω–µ—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏—é

–†–µ–∑—É–ª—å—Ç–∞—Ç: –ø–ª–∞—Ç—ë–∂ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑, –¥–∞–∂–µ –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å 10 —Ä–∞–∑ (–∏–∑-–∑–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤, retries, etc.).

### ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞ 1: Storage –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏**

–î–ª—è exactly-once –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º, –∫–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã:
- –í –ø–∞–º—è—Ç–∏: –±—ã—Å—Ç—Ä–æ, –Ω–æ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ —Ç–µ—Ä—è–µ—Ç—Å—è
- –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: –Ω–∞–¥—ë–∂–Ω–æ, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ
- –í Redis: –±—ã—Å—Ç—Ä–æ –∏ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω persistence)

–ù–æ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã:
- **–†–∞–∑–º–µ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Ä–∞—Å—Ç—ë—Ç**: –µ—Å–ª–∏ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID, —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞—Å—Ç—ë—Ç
- **–ù—É–∂–µ–Ω TTL**: —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –Ω—É–∂–Ω–æ —É–¥–∞–ª—è—Ç—å (–Ω–æ –∫–∞–∫–æ–π TTL –≤—ã–±—Ä–∞—Ç—å?)
- **Race conditions**: –¥–≤–∞ worker'–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é

–†–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–∏–ª–∞ –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ message ID –≤ PostgreSQL –±–µ–∑ TTL. –ó–∞ –≥–æ–¥ —Ç–∞–±–ª–∏—Ü–∞ –≤—ã—Ä–æ—Å–ª–∞ –¥–æ 500 –º–ª–Ω —Å—Ç—Ä–æ–∫, –∑–∞–ø—Ä–æ—Å—ã –Ω–∞—á–∞–ª–∏ —Ç–æ—Ä–º–æ–∑–∏—Ç—å. –ü—Ä–∏—à–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π.

**–ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä ID –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏**

–¢—ã –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—à—å —Å–ª—É—á–∞–π–Ω—ã–π UUID –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:
```
request_id = generate_uuid()
send_request(request_id)
```

–ü—Ä–æ–±–ª–µ–º–∞: –ø—Ä–∏ retry —Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—à—å **–Ω–æ–≤—ã–π** UUID. –°–∏—Å—Ç–µ–º–∞ –¥—É–º–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å, –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –µ–≥–æ —Å–Ω–æ–≤–∞.

–ü—Ä–∞–≤–∏–ª—å–Ω–æ: ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º (–∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞) –∏–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è:
```
request_id = hash(user_id + operation_type + timestamp)
```

–ò–ª–∏:
```
request_id = generate_uuid_once()  # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
for attempt in range(3):
    send_request(request_id)  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –¢–û–¢ –ñ–ï ID –¥–ª—è –≤—Å–µ—Ö retries
```

**–ü—Ä–æ–±–ª–µ–º–∞ 3: Partial failures (—á–∞—Å—Ç–∏—á–Ω—ã–µ —Å–±–æ–∏)**

–û–ø–µ—Ä–∞—Ü–∏—è —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —à–∞–≥–æ–≤:
1. –°–ø–∏—Å–∞—Ç—å –¥–µ–Ω—å–≥–∏ —Å–æ —Å—á—ë—Ç–∞ A
2. –ó–∞—á–∏—Å–ª–∏—Ç—å –¥–µ–Ω—å–≥–∏ –Ω–∞ —Å—á—ë—Ç B
3. –ó–∞–ø–∏—Å–∞—Ç—å –≤ –ª–æ–≥

–ü—Ä–∏ —Å–±–æ–µ –ø–æ—Å–ª–µ —à–∞–≥–∞ 1:
- –î–µ–Ω—å–≥–∏ —Å–ø–∏—Å–∞–Ω—ã
- –ù–æ –Ω–µ –∑–∞—á–∏—Å–ª–µ–Ω—ã
- –ü—Ä–∏ retry –Ω—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –≥–¥–µ –º—ã –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å

–ï—Å–ª–∏ —Ç—ã –ø—Ä–æ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä–∏—à—å –≤—Å—é –æ–ø–µ—Ä–∞—Ü–∏—é, –¥–µ–Ω—å–≥–∏ —Å–ø–∏—à—É—Ç—Å—è –¥–≤–∞–∂–¥—ã.

–†–µ—à–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–ª–∏ sagas (distributed transactions).

**–ü—Ä–æ–±–ª–µ–º–∞ 4: –°—Ç–æ–∏–º–æ—Å—Ç—å exactly-once**

Exactly-once —Ç—Ä–µ–±—É–µ—Ç:
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
- –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è processed IDs
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (—á—Ç–æ–±—ã –¥–≤–∞ worker'–∞ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)

–≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

–î–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–∏—Å—Ç–µ–º at-least-once —Å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –ø—Ä–æ—â–µ –∏ –¥–µ—à–µ–≤–ª–µ, —á–µ–º exactly-once.

### üèóÔ∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è exactly-once:**

**1. Idempotent operations (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)**

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±: —Å–¥–µ–ª–∞–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º–∏.

–ü—Ä–∏–º–µ—Ä—ã:
- `SET key value` –≤–º–µ—Å—Ç–æ `INCR key`
- `UPDATE ... SET balance = 100` –≤–º–µ—Å—Ç–æ `UPDATE ... SET balance = balance - 100`
- `INSERT ... ON CONFLICT DO NOTHING` –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ `INSERT`

–ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞, –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ.

**2. Deduplication —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö ID**

–ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID:
- –ü–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –ø—Ä–æ–≤–µ—Ä—è–π, –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –ª–∏ –∑–∞–ø—Ä–æ—Å —Å —ç—Ç–∏–º ID
- –ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–π –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –ï—Å–ª–∏ –Ω–µ—Ç, –æ–±—Ä–∞–±–æ—Ç–∞–π –∏ —Å–æ—Ö—Ä–∞–Ω–∏ ID –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

–•—Ä–∞–Ω–∏–ª–∏—â–µ:
- Redis: –±—ã—Å—Ç—Ä–æ, –Ω–æ –Ω—É–∂–µ–Ω persistence
- PostgreSQL: –Ω–∞–¥—ë–∂–Ω–æ, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ
- In-memory cache: –±—ã—Å—Ç—Ä–æ, –Ω–æ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Ç–µ—Ä—è–µ—Ç—Å—è

TTL –¥–ª—è ID:
- –•—Ä–∞–Ω–∏ ID –≤ —Ç–µ—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏, –±–æ–ª—å—à–µ–≥–æ, —á–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ retry
- –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è retry ‚Äî 1 —á–∞—Å, —Ö—Ä–∞–Ω–∏ ID 24 —á–∞—Å–∞

**3. Distributed transactions**

–ò—Å–ø–æ–ª—å–∑—É–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏:
- PostgreSQL: BEGIN/COMMIT
- MongoDB: multi-document transactions
- Kafka: exactly-once transactions

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ª–∏–±–æ –≤—Å–µ —à–∞–≥–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è, –ª–∏–±–æ –Ω–∏ –æ–¥–∏–Ω.

**4. Two-Phase Commit (2PC)**

–î–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏:
- Coordinator —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤—Å–µ —Å–∏—Å—Ç–µ–º—ã: "–≥–æ—Ç–æ–≤—ã –ª–∏ –≤—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é?"
- –ï—Å–ª–∏ –≤—Å–µ –æ—Ç–≤–µ—Ç–∏–ª–∏ "–¥–∞", coordinator –≥–æ–≤–æ—Ä–∏—Ç "—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ"
- –ï—Å–ª–∏ —Ö–æ—Ç—å –æ–¥–Ω–∞ –æ—Ç–≤–µ—Ç–∏–ª–∞ "–Ω–µ—Ç", coordinator –≥–æ–≤–æ—Ä–∏—Ç "–æ—Ç–∫–∞—Ç—ã–≤–∞–π—Ç–µ"

–ü—Ä–æ–±–ª–µ–º—ã 2PC:
- –ú–µ–¥–ª–µ–Ω–Ω–æ
- –ë–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ –≤—Ä–µ–º—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
- –£—è–∑–≤–∏–º–æ –∫ —Å–±–æ—è–º coordinator

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Saga pattern (—Å–µ—Ä–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–µ–π –ø—Ä–∏ —Å–±–æ–µ).

**5. Versioning (–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)**

–ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å –∏–º–µ–µ—Ç –≤–µ—Ä—Å–∏—é:
```sql
UPDATE accounts
SET balance = 100, version = version + 1
WHERE id = 123 AND version = 5;
```

–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –≤–µ—Ä–Ω—É–ª "0 —Å—Ç—Ä–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–æ", –∑–Ω–∞—á–∏—Ç, –≤–µ—Ä—Å–∏—è –∏–∑–º–µ–Ω–∏–ª–∞—Å—å (–∫—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–π –æ–±–Ω–æ–≤–∏–ª) –∏–ª–∏ –∑–∞–ø–∏—Å—å —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞.

–≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç race conditions –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç exactly-once.

**6. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**

–î–∞–∂–µ —Å exactly-once –≥–∞—Ä–∞–Ω—Ç–∏–µ–π, –º–æ–Ω–∏—Ç–æ—Ä—å:
- –°–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –±—ã–ª–æ –¥–µ–¥—É–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ
- –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª `ON CONFLICT DO NOTHING`
- –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤–µ—Ä–Ω—É–ª—Å—è "already processed"

–ï—Å–ª–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –º–Ω–æ–≥–æ (> 5% –æ—Ç –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤), —ç—Ç–æ —Å–∏–≥–Ω–∞–ª –ø—Ä–æ–±–ª–µ–º—ã:
- –í–æ–∑–º–æ–∂–Ω–æ, –∫–ª–∏–µ–Ω—Ç—ã —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ –¥–µ–ª–∞—é—Ç retry
- –í–æ–∑–º–æ–∂–Ω–æ, —Å–µ—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞
- –í–æ–∑–º–æ–∂–Ω–æ, —Ç–∞–π–º–∞—É—Ç—ã —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ

---

## 7. Deferred Execution (–û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Deferred Execution** (—Ç–∞–∫–∂–µ –∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–∞–∫ lazy execution) ‚Äî —ç—Ç–æ –º–æ–¥–µ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –æ–ø–µ—Ä–∞—Ü–∏—è **–Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ**, –∞ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –¥–æ –º–æ–º–µ–Ω—Ç–∞, –∫–æ–≥–¥–∞ –µ—ë —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è, –∏–ª–∏ –¥–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è/–≤—Ä–µ–º–µ–Ω–∏.

```
–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:
  |--- –û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–∑–≤–∞–Ω–∞ ---||--- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ---||--- –†–µ–∑—É–ª—å—Ç–∞—Ç ---|

–û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:
  |--- –û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–∑–≤–∞–Ω–∞ ---|
                            (–æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞)
                            ...
                            |--- –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω—É–∂–µ–Ω ---||--- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ---||--- –†–µ–∑—É–ª—å—Ç–∞—Ç ---|
```

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤**: —Ä–∞–±–æ—Ç–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –Ω—É–∂–µ–Ω
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –º–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –æ–¥–Ω—É
- **–ì–∏–±–∫–æ—Å—Ç—å**: –º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å –æ—Ç–ª–æ–∂–µ–Ω–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é –¥–æ –µ—ë –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **Batching**: –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è batch –æ–±—Ä–∞–±–æ—Ç–∫–∏

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –º–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å –¥–æ–ª–≥–æ
- **–ù–µ —É–ø—Ä–æ—â–∞–µ—Ç –æ—Ç–ª–∞–¥–∫—É**: –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, –∫–æ–≥–¥–∞ –∏–º–µ–Ω–Ω–æ –æ–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è
- **–ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –∑–∞–±—ã–≤—á–∏–≤–æ—Å—Ç–∏**: –µ—Å–ª–∏ –∑–∞–±—ã–ª trigger execution, –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –Ω–∏–∫–æ–≥–¥–∞
- **–ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**: –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –°–ï–ô–ß–ê–°, –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**PostgreSQL: deferred constraints**

PostgreSQL –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ª–æ–∂–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É constraints –¥–æ –∫–æ–Ω—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
```sql
CREATE TABLE orders (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id) DEFERRABLE INITIALLY DEFERRED
);
```

`DEFERRABLE INITIALLY DEFERRED` –æ–∑–Ω–∞—á–∞–µ—Ç: –ø—Ä–æ–≤–µ—Ä–∫–∞ foreign key –±—É–¥–µ—Ç –æ—Ç–ª–æ–∂–µ–Ω–∞ –¥–æ `COMMIT`.

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:
```sql
BEGIN;
-- –°–æ–∑–¥–∞—ë–º –∑–∞–∫–∞–∑, —Å—Å—ã–ª–∞—é—â–∏–π—Å—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 123
INSERT INTO orders (id, user_id) VALUES (1, 123);
-- –ù–∞ —ç—Ç–æ–º –º–æ–º–µ–Ω—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 123 –µ—â—ë –Ω–µ—Ç (foreign key constraint –Ω–∞—Ä—É—à–µ–Ω!)
-- –ù–æ PostgreSQL –ù–ï –≤—ã–¥–∞—ë—Ç –æ—à–∏–±–∫—É, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ª–æ–∂–µ–Ω–∞

-- –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
INSERT INTO users (id, name) VALUES (123, 'Alice');

COMMIT;
-- –ü—Ä–∏ COMMIT PostgreSQL –ø—Ä–æ–≤–µ—Ä—è–µ—Ç constraint, –≤—Å—ë OK
```

–ë–µ–∑ –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏—à–ª–æ—Å—å –±—ã —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ—Ç–æ–º –∑–∞–∫–∞–∑.

**RabbitMQ: delayed message exchange**

RabbitMQ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ plugin `rabbitmq_delayed_message_exchange`:
```
channel.basic_publish(
    exchange='my-delayed-exchange',
    routing_key='queue_name',
    body='Task data',
    properties=pika.BasicProperties(
        headers={'x-delay': 60000}  # –ó–∞–¥–µ—Ä–∂–∫–∞ 60 —Å–µ–∫—É–Ω–¥ (60000 –º—Å)
    )
)
```

–°–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ consumer'—É **—á–µ—Ä–µ–∑ 60 —Å–µ–∫—É–Ω–¥**, –∞ –Ω–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ.

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ 1 —á–∞—Å –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç
- Cooldown periods: –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Ç–µ—á–µ–Ω–∏–µ 10 –º–∏–Ω—É—Ç

**Redis: delayed job queues —Å Sorted Sets**

Redis –Ω–µ –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á, –Ω–æ —ç—Ç–æ –ª–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —Å Sorted Sets:
```
ZADD delayed_jobs <timestamp> <job_data>
```

`<timestamp>` ‚Äî –≤—Ä–µ–º—è, –∫–æ–≥–¥–∞ –∑–∞–¥–∞—á–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ (Unix timestamp).

Worker –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å:
```
-- –ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö timestamp <= —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
ZRANGEBYSCORE delayed_jobs -inf <current_time> LIMIT 0 10
-- –£–¥–∞–ª–∏—Ç—å –∏—Ö –∏–∑ –æ—á–µ—Ä–µ–¥–∏
ZREM delayed_jobs <job_data>
-- –í—ã–ø–æ–ª–Ω–∏—Ç—å
```

–≠—Ç–æ deferred execution: –∑–∞–¥–∞—á–∏ –æ—Ç–ª–æ–∂–µ–Ω—ã –¥–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

**Kafka: delayed message (—á–µ—Ä–µ–∑ timestamp)**

Kafka –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é, –Ω–æ –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ timestamp:
- Producer –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å timestamp –≤ –±—É–¥—É—â–µ–º
- Consumer —á–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ, —É –∫–æ—Ç–æ—Ä—ã—Ö timestamp <= —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç (rewind offset –∏–ª–∏ –ø–∏—à–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ç–æ–ø–∏–∫)

**ClickHouse: deferred inserts —Å buffering**

ClickHouse —Å `async_insert=1`:
- –î–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –±—É—Ñ–µ—Ä
- –†–µ–∞–ª—å–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü—É **–æ—Ç–ª–æ–∂–µ–Ω–∞** –¥–æ:
  - –ù–∞–∫–æ–ø–ª–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫ (`async_insert_max_data_size`)
  - –ò—Å—Ç–µ—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ (`async_insert_busy_timeout_ms`)
  - –Ø–≤–Ω–æ–≥–æ flush

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ: batching. –í–º–µ—Å—Ç–æ 1000 –º–µ–ª–∫–∏—Ö –≤—Å—Ç–∞–≤–æ–∫ –¥–µ–ª–∞–µ—Ç—Å—è –æ–¥–Ω–∞ –±–æ–ª—å—à–∞—è.

**MongoDB: lazy evaluation –≤ aggregation pipeline**

MongoDB aggregation pipeline –∏—Å–ø–æ–ª—å–∑—É–µ—Ç lazy evaluation:
```javascript
db.users
  .aggregate([
    {$match: {age: {$gt: 18}}},
    {$sort: {name: 1}},
    {$limit: 10}
  ])
```

MongoDB –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤–µ—Å—å pipeline —Å—Ä–∞–∑—É:
- –û–Ω –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç pipeline
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–µ—Ç –ø–µ—Ä–µ–¥–≤–∏–Ω—É—Ç—å `$limit` —Ä–∞–Ω—å—à–µ `$sort`)
- –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **query optimization —á–µ—Ä–µ–∑ deferred execution**.

**Nginx: deferred accept**

Nginx –∏–º–µ–µ—Ç –æ–ø—Ü–∏—é `deferred` –¥–ª—è `listen`:
```
listen 80 deferred;
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç: —è–¥—Ä–æ Linux –Ω–µ –±—É–¥–µ—Ç –±—É–¥–∏—Ç—å Nginx, –ø–æ–∫–∞ –∫–ª–∏–µ–Ω—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç –¥–∞–Ω–Ω—ã–µ.

–û–±—ã—á–Ω–æ:
1. –ö–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è (TCP handshake)
2. –Ø–¥—Ä–æ –±—É–¥–∏—Ç Nginx
3. Nginx –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
4. Nginx –∂–¥—ë—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞

–° `deferred`:
1. –ö–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è (TCP handshake)
2. –Ø–¥—Ä–æ –ù–ï –±—É–¥–∏—Ç Nginx
3. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
4. –Ø–¥—Ä–æ –±—É–¥–∏—Ç Nginx
5. Nginx –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

–≠—Ç–æ —É–º–µ–Ω—å—à–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–π Nginx (—ç–∫–æ–Ω–æ–º–∏—è CPU).

**PostgreSQL: COPY with deferred flush**

–ö–æ–≥–¥–∞ —Ç—ã –¥–µ–ª–∞–µ—à—å `COPY` (bulk insert) –≤ PostgreSQL:
- –î–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –±—É—Ñ–µ—Ä
- –ó–∞–ø–∏—Å—å –Ω–∞ –¥–∏—Å–∫ **–æ—Ç–ª–æ–∂–µ–Ω–∞** –¥–æ:
  - –ó–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±—É—Ñ–µ—Ä–∞
  - –Ø–≤–Ω–æ–≥–æ `FLUSH`
  - –ö–æ–Ω—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

–≠—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç throughput: –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –º–µ–ª–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π –Ω–∞ –¥–∏—Å–∫ –¥–µ–ª–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–æ–ª—å—à–∏—Ö.

### ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞ 1: –ó–∞–±—ã–ª–∏ trigger (–∑–∞–±—ã–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å)**

–¢—ã –Ω–∞–ø–∏—Å–∞–ª –∫–æ–¥ —Å –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º:
```python
query = db.users.filter(age > 18)  # –õ–µ–Ω–∏–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –∑–∞–ø—Ä–æ—Å –ù–ï –≤—ã–ø–æ–ª–Ω–µ–Ω
# ... –º–Ω–æ–≥–æ –∫–æ–¥–∞ ...
# –ó–∞–±—ã–ª–∏ –≤—ã–∑–≤–∞—Ç—å .execute() –∏–ª–∏ .toList()
```

–ó–∞–ø—Ä–æ—Å –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è. –≠—Ç–æ —á–∞—Å—Ç–∞—è –æ—à–∏–±–∫–∞ –≤ ORM —Å lazy evaluation.

–†–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–ø–∏—Å–∞–ª —Å–∫—Ä–∏–ø—Ç –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö. –°–∫—Ä–∏–ø—Ç "–≤—ã–ø–æ–ª–Ω—è–ª—Å—è" 1 —Å–µ–∫—É–Ω–¥—É –∏ –∑–∞–≤–µ—Ä—à–∞–ª—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫. –ù–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å. –û–∫–∞–∑–∞–ª–æ—Å—å, –∑–∞–ø—Ä–æ—Å –±—ã–ª –ª–µ–Ω–∏–≤—ã–º, –∏ –Ω–∏–∫—Ç–æ –Ω–µ –≤—ã–∑–≤–∞–ª `.execute()`. –°–∫—Ä–∏–ø—Ç –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ–∏–ª –∑–∞–ø—Ä–æ—Å, –Ω–æ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª –µ–≥–æ.

**–ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –±–æ–ª—å—à–æ–≥–æ –æ–±—ä—ë–º–∞ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**

ClickHouse —Å `async_insert`:
- –î–∞–Ω–Ω—ã–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –≤ –±—É—Ñ–µ—Ä–µ
- –ë—É—Ñ–µ—Ä –Ω–µ flush–∏—Ç—Å—è (–Ω–∞–≥—Ä—É–∑–∫–∞ —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∞—è, –ø–æ—Ä–æ–≥ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç)
- –ü—Ä–æ—Ü–µ—Å—Å —É–±–∏–≤–∞—é—Ç (kill -9)
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±—É—Ñ–µ—Ä–∞ —Ç–µ—Ä—è—é—Ç—Å—è

–†–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∏—Å–∞–ª–∞ –≤ ClickHouse —Å async_insert. –†–∞–∑ –≤ —á–∞—Å —Å–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–ª—Å—è (deployment). –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Ç–µ—Ä—è–ª–∏—Å—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –±—É—Ñ–µ—Ä–∞ (–¥–æ 1 –º–∏–Ω—É—Ç—ã –ª–æ–≥–æ–≤).

**–ü—Ä–æ–±–ª–µ–º–∞ 3: Unpredictable timing (–Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)**

–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è "–∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å":
- –ú–æ–∂–µ—Ç —á–µ—Ä–µ–∑ 1–º—Å
- –ú–æ–∂–µ—Ç —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
- –ú–æ–∂–µ—Ç –≤–æ–æ–±—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è (–µ—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å —É–ø–∞–ª)

–≠—Ç–æ –∑–∞—Ç—Ä—É–¥–Ω—è–µ—Ç –æ—Ç–ª–∞–¥–∫—É:
- –¢—ã —Å—Ç–∞–≤–∏—à—å breakpoint, –Ω–æ –æ–ø–µ—Ä–∞—Ü–∏—è –µ—â—ë –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å
- –¢—ã —Å–º–æ—Ç—Ä–∏—à—å –≤ –±–∞–∑—É, –∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç (–æ–Ω–∏ –≤ –±—É—Ñ–µ—Ä–µ)
- –¢—ã –¥–µ–ª–∞–µ—à—å SELECT, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ (query –±—ã–ª –æ—Ç–ª–æ–∂–µ–Ω –∏ –≤—Å—Ç–∞–ª –≤ –æ—á–µ—Ä–µ–¥—å)

**–ü—Ä–æ–±–ª–µ–º–∞ 4: –£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ –∏–∑-–∑–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è**

–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏:
```python
deferred_operations = []
for i in range(1000000):
    deferred_operations.append(create_task(i))
# –ï—Å–ª–∏ –∑–∞–±—ã–ª –≤—ã–∑–≤–∞—Ç—å execute(), 1 –º–∏–ª–ª–∏–æ–Ω –æ–ø–µ—Ä–∞—Ü–∏–π –≤–∏—Å–∏—Ç –≤ –ø–∞–º—è—Ç–∏
```

–†–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ lazy evaluation –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤. –í –æ–¥–Ω–æ–º endpoint —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Å–ª—É—á–∞–π–Ω–æ —Å–æ–∑–¥–∞–ª –ª–µ–Ω–∏–≤—ã–π –∑–∞–ø—Ä–æ—Å –≤ —Ü–∏–∫–ª–µ (10,000 –∏—Ç–µ—Ä–∞—Ü–∏–π), –Ω–æ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª –µ–≥–æ. –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–∑–¥–∞–≤–∞–ª 10,000 –æ–±—ä–µ–∫—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –ø–∞–º—è—Ç–∏. Memory leak –ø—Ä–∏–≤—ë–ª –∫ OOM (Out of Memory) —á–µ—Ä–µ–∑ 1 —á–∞—Å —Ä–∞–±–æ—Ç—ã.

**–ü—Ä–æ–±–ª–µ–º–∞ 5: Deferred execution + transaction boundaries**

PostgreSQL —Å deferred constraints:
```sql
BEGIN;
-- –ù–∞—Ä—É—à–∞–µ–º constraint (–Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ª–æ–∂–µ–Ω–∞)
INSERT INTO orders (user_id) VALUES (999);  -- user 999 –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
-- –î–µ–ª–∞–µ–º –µ—â—ë 100 –æ–ø–µ—Ä–∞—Ü–∏–π...
COMMIT;  -- –¢–æ–ª—å–∫–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ constraint ‚Üí ERROR!
```

–í—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è. –í—Å–µ 100 –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ—Ç–µ—Ä—è–Ω—ã.

–ï—Å–ª–∏ –±—ã constraint –ø—Ä–æ–≤–µ—Ä—è–ª—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ, –æ—à–∏–±–∫–∞ –±—ã–ª–∞ –±—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Ä–∞–Ω—å—à–µ.

### üèóÔ∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É

**–ò—Å–ø–æ–ª—å–∑—É–π deferred execution, –∫–æ–≥–¥–∞:**

1. **–ú–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ batch**
   - –ú–∞—Å—Å–æ–≤–∞—è –≤—Å—Ç–∞–≤–∫–∞ –≤ –ë–î: –Ω–∞–∫–æ–ø–∏—Ç—å 1000 —Å—Ç—Ä–æ–∫, –≤—Å—Ç–∞–≤–∏—Ç—å –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
   - –û—Ç–ø—Ä–∞–≤–∫–∞ email: –Ω–∞–∫–æ–ø–∏—Ç—å 100 email'–æ–≤, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–¥–Ω–∏–º batch API call

2. **–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –Ω—É–∂–µ–Ω –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ**
   - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –ø–æ—è–≤–∏—Ç—å—Å—è –≤ –æ—Ç—á—ë—Ç–∞—Ö —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: –ª–æ–≥–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ –¥–∏—Å–∫ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π

3. **–ú–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**
   - Lazy evaluation –≤ query engines: –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —á–∞—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞
   - Deferred I/O: –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –Ω–∞ –¥–∏—Å–∫ –≤ –æ–¥–Ω—É

**–ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–æ–±–ª–µ–º:**

**1. –Ø–≤–Ω—ã–µ trigger points (—Ç–æ—á–∫–∏ –∑–∞–ø—É—Å–∫–∞)**

–í—Å–µ–≥–¥–∞ –∏–º–µ–π —è–≤–Ω–æ–µ –º–µ—Å—Ç–æ, –≥–¥–µ –æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è:
```python
# BAD:
query = db.users.filter(age > 18)  # –ö–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è? –ù–µ–ø–æ–Ω—è—Ç–Ω–æ

# GOOD:
query = db.users.filter(age > 18)
results = query.execute()  # –Ø–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
```

**2. Auto-flush –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤**

–ï—Å–ª–∏ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—à—å –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ flush–∏ –ø—Ä–∏:
- –î–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –ø–∞–º—è—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10MB –Ω–∞–∫–æ–ø–ª–µ–Ω–æ)
- –î–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1000 –æ–ø–µ—Ä–∞—Ü–∏–π)
- –ò—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10 —Å–µ–∫—É–Ω–¥ –ø—Ä–æ—à–ª–æ —Å –ø–µ—Ä–≤–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏)

ClickHouse –¥–µ–ª–∞–µ—Ç —ç—Ç–æ —Å `async_insert_max_data_size` –∏ `async_insert_busy_timeout_ms`.

**3. Graceful shutdown —Å flush**

–ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–æ—Ü–µ—Å—Å–∞, –≤—ã–ø–æ–ª–Ω—è–π –≤—Å–µ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
```python
def shutdown():
    flush_all_deferred_operations()
    close_connections()
```

–≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç –ø–æ—Ç–µ—Ä—é –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ.

**4. –ú–æ–Ω–∏—Ç–æ—Ä—å —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–µ–π –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**

–ê–ª–µ—Ä—Ç–∏—Ä—É–π, –µ—Å–ª–∏:
- –†–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π > 1000
- –í–æ–∑—Ä–∞—Å—Ç —Å–∞–º–æ–π —Å—Ç–∞—Ä–æ–π –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ > 1 –º–∏–Ω—É—Ç–∞
- –ó–∞–¥–µ—Ä–∂–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è > –æ–∂–∏–¥–∞–µ–º–æ–π

**5. –ò—Å–ø–æ–ª—å–∑—É–π deferred constraints –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ**

PostgreSQL deferred constraints –ø–æ–ª–µ–∑–Ω—ã, –Ω–æ –æ–ø–∞—Å–Ω—ã:
- –û—à–∏–±–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è –ø–æ–∑–¥–Ω–æ (–ø—Ä–∏ COMMIT)
- –û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è

–ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:
- –î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–∞ circular dependency (–∑–∞–∫–∞–∑ ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –∑–∞–∫–∞–∑)
- –ò–ª–∏ –Ω—É–∂–Ω–æ –Ω–∞—Ä—É—à–∏—Ç—å constraint –≤—Ä–µ–º–µ–Ω–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö)

–í –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–π –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É.

**6. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π timing**

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å deferred execution, –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π:
- –ö–æ–≥–¥–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ (–ø—Ä–∏ –∫–∞–∫–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö)
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
- –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –ø—Ä–∏ —Å–±–æ–µ –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

–ü—Ä–∏–º–µ—Ä:
```
/**
 * –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π.
 * –ó–∞–¥–µ—Ä–∂–∫–∞: –¥–æ 60 —Å–µ–∫—É–Ω–¥ –∏–ª–∏ –ø–æ–∫–∞ –Ω–µ –Ω–∞–∫–æ–ø–∏—Ç—Å—è 100 email'–æ–≤.
 * –ü—Ä–∏ —Å–±–æ–µ: email'—ã –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ batch —Ç–µ—Ä—è—é—Ç—Å—è (acceptable –¥–ª—è notification).
 */
void sendEmailDeferred(email) { ... }
```

---

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –°–µ–º–∞–Ω—Ç–∏–∫–∞ | –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å | Throughput | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã | –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã |
|-----------|-------------|------------|-----------|---------------------|-------------------|
| **Synchronous** | –í—ã—Å–æ–∫–∞—è (—Å—É–º–º–∏—Ä—É–µ—Ç—Å—è) | –ù–∏–∑–∫–∏–π | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∏–µ (–ø–æ—Ç–æ–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã) | Cascading failures, thread exhaustion |
| **Asynchronous** | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∏–π | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∏–µ (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ) | Lost errors, race conditions, debugging |
| **Blocking** | –í—ã—Å–æ–∫–∞—è (–æ–∂–∏–¥–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏) | –ù–∏–∑–∫–∏–π | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∏–µ (–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–∏) | Deadlock, lock convoy, long-held locks |
| **Non-Blocking** | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∏–π | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∏–µ | Busy-waiting, starvation, ABA problem |
| **Speculative** | –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è (–ø—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏) | –í—ã—Å–æ–∫–∏–π | –°—Ä–µ–¥–Ω—è—è | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–µ (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã) | Wasted resources, false positives |
| **Exactly-Once** | –°—Ä–µ–¥–Ω—è—è (–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤) | –°—Ä–µ–¥–Ω–∏–π | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω–∏–µ (—Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏) | Storage growth, partial failures, cost |
| **Deferred** | –í—ã—Å–æ–∫–∞—è (–æ—Ç–ª–æ–∂–µ–Ω–æ) | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π (batching) | –°—Ä–µ–¥–Ω—è—è | –ù–∏–∑–∫–∏–µ (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∑–∂–µ/batch) | –ó–∞–±—ã–ª–∏ trigger, data loss, unpredictable timing |

---

## –ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å–µ–º–∞–Ω—Ç–∏–∫

–í —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö —Å–µ–º–∞–Ω—Ç–∏–∫–∏ —á–∞—Å—Ç–æ –∫–æ–º–±–∏–Ω–∏—Ä—É—é—Ç—Å—è:

### Asynchronous + Non-Blocking
**–ü—Ä–∏–º–µ—Ä:** Nginx

Nginx –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–º I/O:
- –û–¥–∏–Ω worker process
- Event loop —Å epoll (–Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—ã—Å—è—á —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ù–∏–∑–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

–°–ª–æ–∂–Ω–æ—Å—Ç—å:
- Callback hell (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å async/await)
- –°–ª–æ–∂–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞

### Asynchronous + Exactly-Once
**–ü—Ä–∏–º–µ—Ä:** Kafka transactions

Kafka producer –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–æ —Å exactly-once –≥–∞—Ä–∞–Ω—Ç–∏–µ–π:
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è throughput
- Exactly-once —á–µ—Ä–µ–∑ idempotent producer –∏ transactions

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ: –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ñ–∏–Ω–∞–Ω—Å—ã, –∑–∞–∫–∞–∑—ã) —Å –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π.

### Blocking + Exactly-Once
**–ü—Ä–∏–º–µ—Ä:** PostgreSQL transactions —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ constraints

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫–∏ –∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç exactly-once (—á–µ—Ä–µ–∑ unique constraints):
```sql
BEGIN;
SELECT * FROM accounts WHERE id = 1 FOR UPDATE;  -- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞
UPDATE accounts SET balance = balance - 100 WHERE id = 1;
INSERT INTO transactions (id, amount) VALUES (123, -100)
  ON CONFLICT (id) DO NOTHING;  -- Exactly-once
COMMIT;
```

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å
- –ü—Ä–æ—Å—Ç–æ—Ç–∞

–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
- –ù–∏–∑–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –†–∏—Å–∫ deadlock

### Speculative + Non-Blocking
**–ü—Ä–∏–º–µ—Ä:** ClickHouse speculative query execution

ClickHouse –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–ø–ª–∏–∫ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ (—Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ):
- –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ 3 —Ä–µ–ø–ª–∏–∫–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ö–ª–∏–µ–Ω—Ç –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)
- –ü–µ—Ä–≤—ã–π –æ—Ç–≤–µ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ: –Ω–∏–∑–∫–∞—è P99 latency –≤ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.

### Deferred + Exactly-Once
**–ü—Ä–∏–º–µ—Ä:** RabbitMQ delayed messages + deduplication

–û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å exactly-once –æ–±—Ä–∞–±–æ—Ç–∫–æ–π:
- –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (deferred)
- Consumer –¥–µ–¥—É–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –ø–æ message ID (exactly-once)

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ: –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è.

---

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –í—ã–±–æ—Ä —Å–µ–º–∞–Ω—Ç–∏–∫–∏: Decision Tree

```
–ù—É–∂–µ–Ω –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–æ—à–∏–±–∫–∞/—É—Å–ø–µ—Ö)?
‚îÇ
‚îú‚îÄ –î–ê ‚Üí –ù—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å?
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ –î–ê ‚Üí –ò—Å–ø–æ–ª—å–∑—É–π Non-Blocking
‚îÇ       ‚îÇ       (Redis SETNX, PostgreSQL SKIP LOCKED, async I/O)
‚îÇ       ‚îÇ
‚îÇ       ‚îî‚îÄ –ù–ï–¢ ‚Üí –ò—Å–ø–æ–ª—å–∑—É–π Synchronous + Blocking
‚îÇ               (REST API, SQL —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
‚îÇ
‚îî‚îÄ –ù–ï–¢ ‚Üí –ú–æ–∂–Ω–æ –ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –ø–æ–∑–∂–µ?
        ‚îÇ
        ‚îú‚îÄ –î–ê ‚Üí –ù—É–∂–Ω—ã –ª–∏ –≥–∞—Ä–∞–Ω—Ç–∏–∏ exactly-once?
        ‚îÇ       ‚îÇ
        ‚îÇ       ‚îú‚îÄ –î–ê ‚Üí Asynchronous + Exactly-Once
        ‚îÇ       ‚îÇ       (Kafka EOS, idempotent APIs)
        ‚îÇ       ‚îÇ
        ‚îÇ       ‚îî‚îÄ –ù–ï–¢ ‚Üí –ù—É–∂–Ω–æ –ª–∏ –æ—Ç–ª–æ–∂–∏—Ç—å –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –≤—Ä–µ–º—è?
        ‚îÇ               ‚îÇ
        ‚îÇ               ‚îú‚îÄ –î–ê ‚Üí Deferred Execution
        ‚îÇ               ‚îÇ       (RabbitMQ delayed, Redis sorted sets)
        ‚îÇ               ‚îÇ
        ‚îÇ               ‚îî‚îÄ –ù–ï–¢ ‚Üí Asynchronous
        ‚îÇ                       (Kafka, RabbitMQ, async tasks)
        ‚îÇ
        ‚îî‚îÄ –ù–ï–¢ ‚Üí –ö—Ä–∏—Ç–∏—á–Ω–∞ –ª–∏ –Ω–∏–∑–∫–∞—è P99 latency?
                ‚îÇ
                ‚îú‚îÄ –î–ê ‚Üí Speculative Execution
                ‚îÇ       (ClickHouse multi-replica queries)
                ‚îÇ
                ‚îî‚îÄ –ù–ï–¢ ‚Üí –ò—Å–ø–æ–ª—å–∑—É–π Synchronous
                        (–æ–±—ã—á–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã)
```

### –ü—Ä–∞–≤–∏–ª–æ 1: –ù–∞—á–Ω–∏ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ

**–ù–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ.**

–ù–∞—á–Ω–∏ —Å:
- Synchronous execution (–ø—Ä–æ—Å—Ç–æ—Ç–∞, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å)
- Blocking semantics (–∑–∞—â–∏—Ç–∞ –æ—Ç race conditions)

–ü–µ—Ä–µ—Ö–æ–¥–∏ –∫ —Å–ª–æ–∂–Ω—ã–º —Å–µ–º–∞–Ω—Ç–∏–∫–∞–º (asynchronous, non-blocking, speculative), —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞:
- –î–æ–∫–∞–∑–∞–Ω–æ —É–∑–∫–æ–µ –º–µ—Å—Ç–æ (profiling, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- –ü—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –Ω–∞–≥—Ä—É–∑–∫–æ–π

**–ü—Ä–∏–º–µ—Ä:** –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—à—å 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É. –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ—â–µ –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—ã—Å—Ç—Ä–æ.

### –ü—Ä–∞–≤–∏–ª–æ 2: –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

| –ó–∞–¥–∞—á–∞ | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –°–µ–º–∞–Ω—Ç–∏–∫–∞ |
|--------|------------|-----------|
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á | RabbitMQ, Kafka | Asynchronous |
| –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ | Redis (SETNX + expire), PostgreSQL advisory locks | Blocking (—Å timeout) |
| –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å I/O | Nginx, async frameworks (Tokio, async Python) | Asynchronous + Non-Blocking |
| –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | PostgreSQL transactions | Synchronous + Blocking + Exactly-Once |
| –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å –Ω–∏–∑–∫–æ–π P99 latency | ClickHouse speculative queries | Speculative |
| –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ | RabbitMQ delayed exchange, Redis sorted sets | Deferred |

### –ü—Ä–∞–≤–∏–ª–æ 3: –ú–æ–Ω–∏—Ç–æ—Ä—å –∏ –∞–ª–µ—Ä—Ç–∏—Ä—É–π

–î–ª—è –∫–∞–∂–¥–æ–π —Å–µ–º–∞–Ω—Ç–∏–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:

**Synchronous:**
- P95/P99 latency
- Timeout rate
- Thread pool utilization

**Asynchronous:**
- Queue size (RabbitMQ, Kafka lag)
- Error rate (—á–∞—Å—Ç–æ errors —Ç–µ—Ä—è—é—Ç—Å—è)
- Time to process (–æ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏)

**Blocking:**
- Lock wait time
- Deadlock count
- Blocked queries count

**Non-Blocking:**
- CAS failure rate (–¥–ª—è lock-free)
- Retry count
- Starvation events

**Speculative:**
- Hit rate (—Å–∫–æ–ª—å–∫–æ —Å–ø–µ–∫—É–ª—è—Ü–∏–π –±—ã–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã)
- Wasted resource percentage

**Exactly-Once:**
- Deduplication rate (—Å–∫–æ–ª—å–∫–æ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –±—ã–ª–æ –æ—Ç–±—Ä–æ—à–µ–Ω–æ)
- Storage growth (deduplication storage)

**Deferred:**
- Queue/buffer size
- Age of oldest deferred operation
- Flush rate

### –ü—Ä–∞–≤–∏–ª–æ 4: –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π —Å–µ–º–∞–Ω—Ç–∏–∫—É

–î–ª—è –∫–∞–∂–¥–æ–≥–æ API/–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π:
- –ö–∞–∫—É—é —Å–µ–º–∞–Ω—Ç–∏–∫—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
- –ö–∞–∫–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–∞—ë—Ç (exactly-once, at-least-once, etc.)
- –ö–∞–∫–∏–µ —Ç–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å
- –ö–∞–∫–∏–µ SLA (latency, throughput)

**–ü—Ä–∏–º–µ—Ä:**
```
POST /api/orders
–°–µ–º–∞–Ω—Ç–∏–∫–∞: Synchronous + Exactly-Once
–ì–∞—Ä–∞–Ω—Ç–∏–∏:
  - –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç (success/error) –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
  - –ó–∞–∫–∞–∑ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑, –¥–∞–∂–µ –ø—Ä–∏ retry
  - Latency: P95 < 500–º—Å, P99 < 1—Å–µ–∫
–ü—Ä–æ–±–ª–µ–º—ã:
  - –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ –º–æ–∂–µ—Ç —Ç–∞–π–º–∞—É—Ç–∏—Ç—å—Å—è (–∏—Å–ø–æ–ª—å–∑—É–π retry —Å exponential backoff)
  - –ù–µ –≤—ã–∑—ã–≤–∞–π –∏–∑ –¥—Ä—É–≥–æ–≥–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ endpoint (—Ä–∏—Å–∫ –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —Ç–∞–π–º–∞—É—Ç–∞)
```

### –ü—Ä–∞–≤–∏–ª–æ 5: –¢–µ—Å—Ç–∏—Ä—É–π failure scenarios

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ç–µ—Å—Ç–∏—Ä—É–π:
- Retries (–ø—Ä–æ–≤–µ—Ä—å exactly-once)
- –¢–∞–π–º–∞—É—Ç—ã (–ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Ä–µ—Å—É—Ä—Å—ã –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è)
- Deadlocks (–ø–æ–ø—ã—Ç–∞–π—Å—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏)
- –í—ã—Å–æ–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É (load testing)
- –°–±–æ–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ (chaos engineering)

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- Chaos Monkey (—Å–ª—É—á–∞–π–Ω—ã–µ —Å–±–æ–∏)
- Toxiproxy (—Å–∏–º—É–ª—è—Ü–∏—è —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º: latency, packet loss)
- Load testing: Gatling, Locust, k6

---

## –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∫–∞–∫ –∏—Ö –∏–∑–±–µ–∂–∞—Ç—å

### –û—à–∏–±–∫–∞ 1: –°–º–µ—à–∏–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –±–µ–∑ –ø–æ–Ω–∏–º–∞–Ω–∏—è

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
–¢—ã –≤—ã–∑—ã–≤–∞–µ—à—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞, –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:
```python
def sync_handler():
    async_send_email(user)  # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
    return "OK"  # –í–µ—Ä–Ω—É–ª–∏—Å—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ, email –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
```

Email –º–æ–∂–µ—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è (–µ—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Ä–∞–Ω—å—à–µ).

**–†–µ—à–µ–Ω–∏–µ:**
- –õ–∏–±–æ –∂–¥–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: `await async_send_email(user)`
- –õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑—É–π –Ω–∞—Å—Ç–æ—è—â—É—é –æ—á–µ—Ä–µ–¥—å (RabbitMQ, Kafka) –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á

### –û—à–∏–±–∫–∞ 2: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –±–µ–∑ —Ç–∞–π–º–∞—É—Ç–∞

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
–¢—ã –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—à—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –±–µ–∑ —Ç–∞–π–º–∞—É—Ç–∞:
```sql
SELECT * FROM accounts WHERE id = 1 FOR UPDATE;
-- –ï—Å–ª–∏ –¥—Ä—É–≥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–µ—Ä–∂–∏—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É, –∂–¥—ë–º –≤–µ—á–Ω–æ
```

**–†–µ—à–µ–Ω–∏–µ:**
–í—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π timeout:
```sql
SET lock_timeout = '5s';
SELECT * FROM accounts WHERE id = 1 FOR UPDATE;
```

–ï—Å–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞—Ö–≤–∞—á–µ–Ω–∞ –∑–∞ 5 —Å–µ–∫—É–Ω–¥, —É–ø–∞–¥–∏ —Å –æ—à–∏–±–∫–æ–π (–∏ –æ–±—Ä–∞–±–æ—Ç–∞–π –µ—ë).

### –û—à–∏–±–∫–∞ 3: –ó–∞–±—ã–ª –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫–∏ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–¥–µ

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è —É–ø–∞–ª–∞, –Ω–æ —Ç—ã –Ω–µ —É–∑–Ω–∞–ª:
```python
producer.send("topic", message)  # –ï—Å–ª–∏ —É–ø–∞–ª–æ, –Ω–∏–∫—Ç–æ –Ω–µ —É–∑–Ω–∞–µ—Ç
```

**–†–µ—à–µ–Ω–∏–µ:**
–í—Å–µ–≥–¥–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π callback –¥–ª—è –æ—à–∏–±–æ–∫:
```python
future = producer.send("topic", message)
future.add_errback(lambda e: log.error(f"Failed: {e}"))
```

### –û—à–∏–±–∫–∞ 4: –°–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å side effects

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
–¢—ã —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ —Å–ø–∏—Å—ã–≤–∞–µ—à—å –¥–µ–Ω—å–≥–∏:
```
speculative_execute(charge_customer(100))
```

–ï—Å–ª–∏ —Å–ø–µ–∫—É–ª—è—Ü–∏—è –±—ã–ª–∞ –Ω–µ–≤–µ—Ä–Ω–æ–π, –¥–µ–Ω—å–≥–∏ —É–∂–µ —Å–ø–∏—Å–∞–Ω—ã, –æ—Ç–∫–∞—Ç–∏—Ç—å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑—É–π —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¢–û–õ–¨–ö–û –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –±–µ–∑ side effects (—á—Ç–µ–Ω–∏–µ, –≤—ã—á–∏—Å–ª–µ–Ω–∏—è).

### –û—à–∏–±–∫–∞ 5: Exactly-Once –±–µ–∑ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
–¢—ã –ø—ã—Ç–∞–µ—à—å—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å exactly-once, –Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—à—å –Ω–æ–≤—ã–π ID –ø—Ä–∏ –∫–∞–∂–¥–æ–º retry:
```python
for attempt in range(3):
    request_id = generate_uuid()  # –ö–∞–∂–¥—ã–π —Ä–∞–∑ –ù–û–í–´–ô ID!
    send_request(request_id)
```

–°–∏—Å—Ç–µ–º–∞ –¥—É–º–∞–µ—Ç, —á—Ç–æ –∫–∞–∂–¥—ã–π retry ‚Äî —ç—Ç–æ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å.

**–†–µ—à–µ–Ω–∏–µ:**
–ì–µ–Ω–µ—Ä–∏—Ä—É–π ID –æ–¥–∏–Ω —Ä–∞–∑:
```python
request_id = generate_uuid()
for attempt in range(3):
    send_request(request_id)  # –¢–æ—Ç –∂–µ ID –¥–ª—è –≤—Å–µ—Ö retries
```

### –û—à–∏–±–∫–∞ 6: Deferred execution + –∑–∞–±—ã–ª flush

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
–¢—ã –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—à—å –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –Ω–æ –∑–∞–±—ã–≤–∞–µ—à—å –∏—Ö –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
```python
for item in items:
    deferred_insert(item)
# –ó–∞–±—ã–ª –≤—ã–∑–≤–∞—Ç—å flush() ‚Üí –¥–∞–Ω–Ω—ã–µ –≤ –±—É—Ñ–µ—Ä–µ, –Ω–µ –≤ –ë–î
```

**–†–µ—à–µ–Ω–∏–µ:**
–í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π flush –≤ –∫–æ–Ω—Ü–µ:
```python
for item in items:
    deferred_insert(item)
flush()  # –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π context manager:
```python
with deferred_batch():
    for item in items:
        deferred_insert(item)
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π flush –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**Execution Semantics** –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç, –ö–ê–ö –∏ –ö–û–ì–î–ê –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ. –í—ã–±–æ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–µ–º–∞–Ω—Ç–∏–∫–∏ ‚Äî —ç—Ç–æ trade-off –º–µ–∂–¥—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é, –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å—é –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é.

### –ö—Ä–∞—Ç–∫–∏–µ –≤—ã–≤–æ–¥—ã

1. **Synchronous Execution**: –ø—Ä–æ—Å—Ç–∞ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞, –Ω–æ –Ω–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è. –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π, —Ç—Ä–µ–±—É—é—â–∏—Ö –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏.

2. **Asynchronous Execution**: –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å, –Ω–æ —Å–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫. –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.

3. **Blocking Semantics**: –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç race conditions, –Ω–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ deadlock –∏ thread exhaustion. –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π —Ç–∞–π–º–∞—É—Ç—ã.

4. **Non-Blocking Semantics**: –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –Ω–∏–∑–∫–æ–π –∫–æ–Ω—Ç–µ–Ω—à–Ω, –Ω–æ —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –Ω–µ –ø–∏—à–∏ lock-free –∫–æ–¥ —Å –Ω—É–ª—è.

5. **Speculative Execution**: —É–º–µ–Ω—å—à–∞–µ—Ç P99 latency, –Ω–æ —Ç—Ä–∞—Ç–∏—Ç —Ä–µ—Å—É—Ä—Å—ã. –ò—Å–ø–æ–ª—å–∑—É–π, –∫–æ–≥–¥–∞ –µ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –∏ –∫—Ä–∏—Ç–∏—á–Ω–∞ –Ω–∏–∑–∫–∞—è latency.

6. **Exactly-Once Execution**: –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (—Ñ–∏–Ω–∞–Ω—Å—ã, –∑–∞–∫–∞–∑—ã). –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–π –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.

7. **Deferred Execution**: —ç–∫–æ–Ω–æ–º–∏—Ç —Ä–µ—Å—É—Ä—Å—ã —á–µ—Ä–µ–∑ batching, –Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç latency. –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ª–æ–≥–∏, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞). –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π flush –ø—Ä–∏ shutdown.

### –ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ

**–ù–∞—á–∏–Ω–∞–π —Å –ø—Ä–æ—Å—Ç–æ–≥–æ (synchronous + blocking), —É—Å–ª–æ–∂–Ω—è–π —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –≤—Å–µ–≥–¥–∞ –º–æ–Ω–∏—Ç–æ—Ä—å –∏ —Ç–µ—Å—Ç–∏—Ä—É–π.**

–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ "–ø–æ—Ç–æ–º—É —á—Ç–æ –º–æ–¥–Ω–æ". –ò—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑–∞–ª–æ —É–∑–∫–æ–µ –º–µ—Å—Ç–æ, –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å —Ä–µ—à–∞–µ—Ç —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É.

### –î–∞–ª—å–Ω–µ–π—à–µ–µ –∏–∑—É—á–µ–Ω–∏–µ

–î–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è execution semantics —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –∏–∑—É—á–∏—Ç—å:
- **Event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**: Nginx, Node.js, async frameworks
- **Message queues**: Kafka, RabbitMQ (at-least-once vs exactly-once)
- **Distributed transactions**: 2PC, Saga pattern, TCC
- **Lock-free programming**: CAS, ABA problem, memory models
- **Query optimization**: Lazy evaluation, speculative execution –≤ –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö

Execution semantics ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–æ–≥–æ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã. –û–≤–ª–∞–¥–µ–≤ —ç—Ç–∏–º–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º–∏, —Ç—ã —Å–º–æ–∂–µ—à—å –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–¥—ë–∂–Ω—ã–µ, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–µ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ —Å–∏—Å—Ç–µ–º—ã.

–£–¥–∞—á–∏! üöÄ
