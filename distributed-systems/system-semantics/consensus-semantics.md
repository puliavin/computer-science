# Consensus Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∏ –ö–æ–Ω—Å–µ–Ω—Å—É—Å–∞)

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [Leader Election Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –í—ã–±–æ—Ä–æ–≤ –õ–∏–¥–µ—Ä–∞)](#1-leader-election-semantics-—Å–µ–º–∞–Ω—Ç–∏–∫–∞-–≤—ã–±–æ—Ä–æ–≤-–ª–∏–¥–µ—Ä–∞)
3. [Log Replication Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –†–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –õ–æ–≥–æ–≤)](#2-log-replication-semantics-—Å–µ–º–∞–Ω—Ç–∏–∫–∞-—Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏-–ª–æ–≥–æ–≤)
4. [Commit Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –ö–æ–º–º–∏—Ç–æ–≤)](#3-commit-semantics-—Å–µ–º–∞–Ω—Ç–∏–∫–∞-–∫–æ–º–º–∏—Ç–æ–≤)
5. [Majority Agreement Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –ú–∞–∂–æ—Ä–∏—Ç–∞—Ä–Ω–æ–≥–æ –°–æ–≥–ª–∞—Å–∏—è)](#4-majority-agreement-semantics-—Å–µ–º–∞–Ω—Ç–∏–∫–∞-–º–∞–∂–æ—Ä–∏—Ç–∞—Ä–Ω–æ–≥–æ-—Å–æ–≥–ª–∞—Å–∏—è)
6. [Safety Guarantees (–ì–∞—Ä–∞–Ω—Ç–∏–∏ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)](#5-safety-guarantees-–≥–∞—Ä–∞–Ω—Ç–∏–∏-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
7. [Liveness Guarantees (–ì–∞—Ä–∞–Ω—Ç–∏–∏ –ñ–∏–≤—É—á–µ—Å—Ç–∏)](#6-liveness-guarantees-–≥–∞—Ä–∞–Ω—Ç–∏–∏-–∂–∏–≤—É—á–µ—Å—Ç–∏)
8. [–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞](#—Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è-—Ç–∞–±–ª–∏—Ü–∞)
9. [–¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã](#—Ç–∏–ø–∏—á–Ω—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã-–∏-–∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã)
10. [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)
11. [–ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å–µ–º–∞–Ω—Ç–∏–∫](#–∫–æ–º–±–∏–Ω–∞—Ü–∏–∏-—Å–µ–º–∞–Ω—Ç–∏–∫)
12. [–ó–∞–∫–ª—é—á–µ–Ω–∏–µ](#–∑–∞–∫–ª—é—á–µ–Ω–∏–µ)

---

## –í–≤–µ–¥–µ–Ω–∏–µ

**Consensus Semantics** (—Å–µ–º–∞–Ω—Ç–∏–∫–∏ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞) –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç, –ö–ê–ö –≥—Ä—É–ø–ø–∞ —É–∑–ª–æ–≤ –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç —Å–æ–≥–ª–∞—Å–∏—è –ø–æ –ø–æ–≤–æ–¥—É –æ–±—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –¥–∞–∂–µ –∫–æ–≥–¥–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —É–∑–ª—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –∏–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ.

–ü—Ä–µ–¥—Å—Ç–∞–≤—å —Å–æ–≤–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏ –∏–∑ 5 —á–µ–ª–æ–≤–µ–∫:
- **Leader election (–≤—ã–±–æ—Ä—ã –ª–∏–¥–µ—Ä–∞)**: –∫–∞–∫ –æ–Ω–∏ –≤—ã–±–∏—Ä–∞—é—Ç –ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—è —Å–æ–≤–µ—Ç–∞
- **Log replication (—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –ª–æ–≥–æ–≤)**: –∫–∞–∫ –ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—å —Ä–∞—Å—Å—ã–ª–∞–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –∑–∞—Å–µ–¥–∞–Ω–∏–π –≤—Å–µ–º —á–ª–µ–Ω–∞–º
- **Commit (–∫–æ–º–º–∏—Ç)**: –∫–æ–≥–¥–∞ —Ä–µ—à–µ–Ω–∏–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø—Ä–∏–Ω—è—Ç—ã–º –∏ –Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã–º
- **Majority agreement (–º–∞–∂–æ—Ä–∏—Ç–∞—Ä–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ)**: —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –∑–∞ –Ω–µ–≥–æ 3 –∏–∑ 5 –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤
- **Safety (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)**: –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—É–¥–µ—Ç –¥–≤–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—â–∏—Ö –¥—Ä—É–≥ –¥—Ä—É–≥—É —Ä–µ—à–µ–Ω–∏—è
- **Liveness (–∂–∏–≤—É—á–µ—Å—Ç—å)**: –µ—Å–ª–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã, —Å–æ–≤–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

–í —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –∫–æ–Ω—Å–µ–Ω—Å—É—Å ‚Äî —ç—Ç–æ **—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞**, –∫–æ—Ç–æ—Ä–∞—è —Ä–µ—à–∞–µ—Ç:
- üéØ –ö—Ç–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ (–ª–∏–¥–µ—Ä)
- üìù –ö–∞–∫ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –≤—Å–µ —É–∑–ª—ã –≤–∏–¥—è—Ç –æ–¥–Ω—É –∏ —Ç—É –∂–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –ö–æ–≥–¥–∞ –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π
- üõ°Ô∏è –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å split-brain (—Ä–∞–∑–¥–≤–æ–µ–Ω–∏—è –º–æ–∑–≥–∞)
- üîÑ –ö–∞–∫ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–∏ —á–∞—Å—Ç–∏—á–Ω—ã—Ö —Å–±–æ—è—Ö

–ë–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞ –ø–æ–ª—É—á–∞–µ—à—å:
- üíÄ **Split-brain**: –¥–≤–∞ —É–∑–ª–∞ –¥—É–º–∞—é—Ç, —á—Ç–æ –æ–Ω–∏ –ª–∏–¥–µ—Ä—ã, –∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è
- üî• **Data loss**: –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–µ –Ω–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö, –ª–∏–¥–µ—Ä —É–ø–∞–ª, –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã
- üêå **–ó–∞–≤–∏—Å–∞–Ω–∏—è**: —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ –∂–¥—ë—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ —É–∑–ª—ã
- üí∏ **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**: –æ–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –æ–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –¥–≤–∞–∂–¥—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É–∑–ª–∞—Ö
- üé≠ **Inconsistency**: —É–∑–ª—ã –≤–∏–¥—è—Ç —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –¥–∞–Ω–Ω—ã—Ö

---

## 1. Leader Election Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –í—ã–±–æ—Ä–æ–≤ –õ–∏–¥–µ—Ä–∞)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Leader Election Semantics** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –≥—Ä—É–ø–ø–∞ —É–∑–ª–æ–≤ –≤—ã–±–∏—Ä–∞–µ—Ç **–æ–¥–Ω–æ–≥–æ –ª–∏–¥–µ—Ä–∞** (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞), –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è –æ—Ç –∏–º–µ–Ω–∏ –≤—Å–µ–π –≥—Ä—É–ø–ø—ã. –õ–∏–¥–µ—Ä –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã, —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —Ñ–æ–ª–ª–æ–≤–µ—Ä–æ–≤.

```
–î–æ –≤—ã–±–æ—Ä–æ–≤ (–Ω–µ—Ç –ª–∏–¥–µ—Ä–∞):
Node A: "–Ø –∫–∞–Ω–¥–∏–¥–∞—Ç!"
Node B: "–Ø –∫–∞–Ω–¥–∏–¥–∞—Ç!"
Node C: "–Ø –∫–∞–Ω–¥–∏–¥–∞—Ç!"
Node D: "–Ø –∫–∞–Ω–¥–∏–¥–∞—Ç!"
Node E: "–Ø –∫–∞–Ω–¥–∏–¥–∞—Ç!"

–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–æ–≤ (–µ—Å—Ç—å –ª–∏–¥–µ—Ä):
Node A: [LEADER] üëë        ‚Üê –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã –∏–¥—É—Ç —Å—é–¥–∞
Node B: [FOLLOWER]         ‚Üê –†–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –æ—Ç A
Node C: [FOLLOWER]         ‚Üê –†–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –æ—Ç A
Node D: [FOLLOWER]         ‚Üê –†–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –æ—Ç A
Node E: [FOLLOWER]         ‚Üê –†–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –æ—Ç A
```

–ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø: **–í –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –û–î–ò–ù –ª–∏–¥–µ—Ä –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ term/epoch**.

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ª–∏–¥–µ—Ä–∞**: –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –º–∞–∫—Å–∏–º—É–º –æ–¥–∏–Ω –ø—Ä–∏–∑–Ω–∞–Ω–Ω—ã–π –ª–∏–¥–µ—Ä
- **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤—ã–±–æ—Ä—ã**: –ø—Ä–∏ –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ —É—Å–ª–æ–≤–∏—è—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–±–æ—Ä–æ–≤ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: –µ—Å–ª–∏ –ª–∏–¥–µ—Ä —É–ø–∞–ª, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π
- **–ó–∞—â–∏—Ç–∞ –æ—Ç split-brain**: –º–µ—Ö–∞–Ω–∏–∑–º term/epoch –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–∏—Ç—É–∞—Ü–∏—é –¥–≤—É—Ö –ª–∏–¥–µ—Ä–æ–≤
- **–ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∫–≤–æ—Ä—É–º–∞**: –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É–∑–ª–æ–≤, –≤—ã–±–æ—Ä—ã –∑–∞–≤–µ—Ä—à–∞—Ç—Å—è
- **–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –ª–∏–¥–µ—Ä–æ–≤**: —Å—Ç–∞—Ä—ã–π –ª–∏–¥–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –∫–æ–º–∞–Ω–¥–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∏–∑–±—Ä–∞–Ω–∏—è

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –≤—ã–±–æ—Ä—ã**: –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–∏–æ–¥ –±–µ–∑ –ª–∏–¥–µ—Ä–∞ (election timeout)
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤—ã–±–æ—Ä—ã –ø—Ä–∏ network partition**: –µ—Å–ª–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –Ω–µ—Ç, –≤—ã–±–æ—Ä–æ–≤ –Ω–µ –±—É–¥–µ—Ç
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤—ã–±–æ—Ä "–ª—É—á—à–µ–≥–æ" —É–∑–ª–∞**: –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç–∏–≥—à–∏–π –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –≥–æ–ª–æ—Å–æ–≤
- **–ù–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —á–∞—Å—Ç—ã–µ –ø–µ—Ä–µ–≤—ã–±–æ—Ä—ã**: –ø—Ä–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Å–µ—Ç–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –≤—ã–±–æ—Ä—ã
- **–ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –ª–∏–¥–µ—Ä–∞**: –±—ã—Å—Ç—Ä—ã–µ —Ñ–æ–ª–ª–æ–≤–µ—Ä—ã –Ω–µ –º–æ–≥—É—Ç —Å–º–µ–Ω–∏—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –ª–∏–¥–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**Kafka Controller Election**

–í Kafka –æ–¥–∏–Ω –±—Ä–æ–∫–µ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞:
- –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ª–∏–¥–µ—Ä–æ–≤ –ø–∞—Ä—Ç–∏—Ü–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ZooKeeper (—Ä–∞–Ω—å—à–µ) –∏–ª–∏ KRaft (—Ç–µ–ø–µ—Ä—å) –¥–ª—è –≤—ã–±–æ—Ä–æ–≤
- –ö–∞–∂–¥—ã–π –±—Ä–æ–∫–µ—Ä —Å–ª–µ–¥–∏—Ç –∑–∞ `/controller` —É–∑–ª–æ–º –≤ ZK
- –ü–µ—Ä–≤—ã–π –∑–∞–ø–∏—Å–∞–≤—à–∏–π —Å–≤–æ—ë ID –≤ —ç—Ç–æ—Ç —ç—Ñ–µ–º–µ—Ä–Ω—ã–π —É–∑–µ–ª —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º
- –ï—Å–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø–∞–¥–∞–µ—Ç, —ç—Ñ–µ–º–µ—Ä–Ω—ã–π —É–∑–µ–ª —É–¥–∞–ª—è–µ—Ç—Å—è, –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ –≤—ã–±–æ—Ä—ã

–ü—Ä–∏–º–µ—Ä:
```
Kafka Cluster (5 brokers):
Broker-1: [CONTROLLER] üëë  ‚Üê –£–ø—Ä–∞–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
Broker-2: [BROKER]         ‚Üê –û–±—Å–ª—É–∂–∏–≤–∞–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏
Broker-3: [BROKER]
Broker-4: [BROKER]
Broker-5: [BROKER]

Broker-1 –ø–∞–¥–∞–µ—Ç ‚Üí
Broker-2 –ø–µ—Ä–≤—ã–º –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ /controller ‚Üí
Broker-2: [CONTROLLER] üëë  ‚Üê –ù–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
```

–ü—Ä–æ–±–ª–µ–º–∞: –µ—Å–ª–∏ ZK –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤—Ä–µ–º–µ–Ω–Ω–æ, –∫–ª–∞—Å—Ç–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∏–∑–±—Ä–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞.

**MongoDB Replica Set Election**

MongoDB –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Raft-like –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –≤—ã–±–æ—Ä–æ–≤ Primary —É–∑–ª–∞:
- Replica set –∏–∑ N —É–∑–ª–æ–≤ (–æ–±—ã—á–Ω–æ 3, 5 –∏–ª–∏ 7)
- –¢–æ–ª—å–∫–æ Primary –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø–∏—Å–∏
- –í—ã–±–æ—Ä—ã –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è, –µ—Å–ª–∏ Primary –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω > electionTimeoutMillis (–æ–±—ã—á–Ω–æ 10 —Å–µ–∫—É–Ω–¥)
- –£–∑–ª—ã –≥–æ–ª–æ—Å—É—é—Ç –∑–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ —Å —Å–∞–º—ã–º–∏ —Å–≤–µ–∂–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –î–ª—è –ø–æ–±–µ–¥—ã –Ω—É–∂–Ω–æ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É–∑–ª–∞ (priority) –≤–ª–∏—è–µ—Ç –Ω–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç—å Primary

–ü—Ä–∏–º–µ—Ä:
```
Replica Set:
mongo-1 (priority=2): [PRIMARY] üëë
mongo-2 (priority=1): [SECONDARY]
mongo-3 (priority=1): [SECONDARY]

mongo-1 —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí
–¢–∞–π–º–∞—É—Ç 10 —Å–µ–∫—É–Ω–¥ ‚Üí
mongo-2 –∏ mongo-3 –Ω–∞—á–∏–Ω–∞—é—Ç –≤—ã–±–æ—Ä—ã ‚Üí
mongo-2 –∏–º–µ–µ—Ç –±–æ–ª–µ–µ —Å–≤–µ–∂–∏–π oplog ‚Üí
mongo-2 –ø–æ–ª—É—á–∞–µ—Ç 2 –≥–æ–ª–æ—Å–∞ (—Å–≤–æ–π + –æ—Ç mongo-3) ‚Üí
mongo-2: [PRIMARY] üëë
```

**PostgreSQL + Patroni**

PostgreSQL —Å–∞–º –ø–æ —Å–µ–±–µ –Ω–µ –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π leader election. Patroni –¥–æ–±–∞–≤–ª—è–µ—Ç —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é —á–µ—Ä–µ–∑ DCS (Distributed Configuration Store) ‚Äî –æ–±—ã—á–Ω–æ etcd, Consul –∏–ª–∏ ZooKeeper:
- Patroni –Ω–∞ –∫–∞–∂–¥–æ–π –Ω–æ–¥–µ –∫–æ–Ω–∫—É—Ä–∏—Ä—É–µ—Ç –∑–∞ –ª–∏–¥–µ—Ä—Å—Ç–≤–æ —á–µ—Ä–µ–∑ DCS
- –õ–∏–¥–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç "lease" (–∞—Ä–µ–Ω–¥—É) –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –≤—Ä–µ–º—è (–æ–±—ã—á–Ω–æ 30 —Å–µ–∫—É–Ω–¥)
- –õ–∏–¥–µ—Ä –¥–æ–ª–∂–µ–Ω –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å lease, –∏–Ω–∞—á–µ —Ç–µ—Ä—è–µ—Ç –ª–∏–¥–µ—Ä—Å—Ç–≤–æ
- –î—Ä—É–≥–∏–µ –Ω–æ–¥—ã —Å–ª–µ–¥—è—Ç –∑–∞ –ª–∏–¥–µ—Ä–æ–º –∏ –≥–æ—Ç–æ–≤—ã –≤–∑—è—Ç—å –ª–∏–¥–µ—Ä—Å—Ç–≤–æ –ø—Ä–∏ –µ–≥–æ –ø–∞–¥–µ–Ω–∏–∏
- Patroni –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–≤–∏–≥–∞–µ—Ç —Ä–µ–ø–ª–∏–∫—É –≤ –º–∞—Å—Ç–µ—Ä

–ü—Ä–∏–º–µ—Ä:
```
PG Cluster:
pg-1 + patroni: [LEADER] üëë  ‚Üê Lease –≤ etcd –¥–æ 12:00:30
pg-2 + patroni: [REPLICA]    ‚Üê –°–ª–µ–¥–∏—Ç –∑–∞ lease
pg-3 + patroni: [REPLICA]    ‚Üê –°–ª–µ–¥–∏—Ç –∑–∞ lease

12:00:30 –Ω–∞—Å—Ç—É–ø–∏–ª–æ, pg-1 –Ω–µ –æ–±–Ω–æ–≤–∏–ª lease (—Å–µ—Ç—å —É–ø–∞–ª–∞) ‚Üí
pg-2 –ø–µ—Ä–≤—ã–º —É—Å–ø–µ–≤–∞–µ—Ç –∑–∞—Ö–≤–∞—Ç–∏—Ç—å lease ‚Üí
patroni –Ω–∞ pg-2 –ø—Ä–æ–¥–≤–∏–≥–∞–µ—Ç pg-2 –≤ –º–∞—Å—Ç–µ—Ä ‚Üí
pg-2: [LEADER] üëë
```

**ClickHouse + ClickHouse Keeper**

ClickHouse –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ClickHouse Keeper (–∞–Ω–∞–ª–æ–≥ ZooKeeper) –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –≤ ReplicatedMergeTree:
- Keeper —Å–∞–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Raft –¥–ª—è –≤—ã–±–æ—Ä–æ–≤ –ª–∏–¥–µ—Ä–∞ —Å—Ä–µ–¥–∏ keeper-—É–∑–ª–æ–≤
- Leader keeper-—É–∑–µ–ª –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–æ–Ω–Ω—ã–π –ª–æ–≥
- ClickHouse-—Ç–∞–±–ª–∏—Ü—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç keeper –¥–ª—è –≤—ã–±–æ—Ä–æ–≤ –ª–∏–¥–µ—Ä–∞ —Å—Ä–µ–¥–∏ —Ä–µ–ø–ª–∏–∫ —Ç–∞–±–ª–∏—Ü—ã
- –õ–∏–¥–µ—Ä —Ä–µ–ø–ª–∏–∫–∏ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –º–µ—Ä–∂–∏ –∏ –º—É—Ç–∞—Ü–∏–∏

### üö® –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞ 1: Split-brain –ø—Ä–∏ network partition**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
–ö–ª–∞—Å—Ç–µ—Ä –∏–∑ 5 —É–∑–ª–æ–≤ —Ä–∞–∑–¥–µ–ª—ë–Ω —Å–µ—Ç–µ–≤—ã–º —Å–±–æ–µ–º –Ω–∞ –¥–≤–µ —á–∞—Å—Ç–∏:

–°–µ–≥–º–µ–Ω—Ç A (3 —É–∑–ª–∞):          –°–µ–≥–º–µ–Ω—Ç B (2 —É–∑–ª–∞):
Node-1 [LEADER old]          Node-4 [FOLLOWER]
Node-2 [FOLLOWER]            Node-5 [FOLLOWER]
Node-3 [FOLLOWER]

–°–µ–≥–º–µ–Ω—Ç A –∏–º–µ–µ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ (3 –∏–∑ 5) ‚Üí –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ª–∏–¥–µ—Ä–∞
–°–µ–≥–º–µ–Ω—Ç B –Ω–µ –∏–º–µ–µ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ ‚Üí –ù–ï –ú–û–ñ–ï–¢ –≤—ã–±—Ä–∞—Ç—å –ª–∏–¥–µ—Ä–∞

–ï—Å–ª–∏ Node-1 –±—ã–ª —Å—Ç–∞—Ä—ã–º –ª–∏–¥–µ—Ä–æ–º:
- Node-1 –º–æ–∂–µ—Ç –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –±—ã—Ç—å –ª–∏–¥–µ—Ä–æ–º
- –ù–æ –µ–≥–æ term —É—Å—Ç–∞—Ä–µ–ª
- –°–µ–≥–º–µ–Ω—Ç A –≤—ã–±–∏—Ä–∞–µ—Ç Node-2 –ª–∏–¥–µ—Ä–æ–º —Å –Ω–æ–≤—ã–º term
- Node-1 –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–ø–∏—Å–∏ (–µ–≥–æ term –º–µ–Ω—å—à–µ)
```

–ö–∞–∫ —Å–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—â–∞–µ—Ç—Å—è:
- Term/epoch –º–µ—Ö–∞–Ω–∏–∑–º: –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –ª–∏–¥–µ—Ä –∏–º–µ–µ—Ç –±–æ–ª—å—à–∏–π term
- –°—Ç–∞—Ä—ã–π –ª–∏–¥–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –∫–æ–º–º–∏—Ç–∏—Ç—å –∑–∞–ø–∏—Å–∏ –±–µ–∑ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π
- –ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Ç–∏ Node-1 —É–∑–Ω–∞—ë—Ç –æ –Ω–æ–≤–æ–º term –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ follower

**–ü—Ä–æ–±–ª–µ–º–∞ 2: –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –ø–µ—Ä–µ–≤—ã–±–æ—Ä—ã (election storm)**

–°—Ü–µ–Ω–∞—Ä–∏–π: –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Å–µ—Ç—å –≤—ã–∑—ã–≤–∞–µ—Ç —á–∞—Å—Ç—ã–µ —Ç–∞–π–º–∞—É—Ç—ã, —É–∑–ª—ã –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∏–∑–±–∏—Ä–∞—é—Ç –ª–∏–¥–µ—Ä–∞

```
12:00:00 - Node-A —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ª–∏–¥–µ—Ä–æ–º (term=5)
12:00:05 - –°–µ—Ç–µ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, Node-B –Ω–µ –≤–∏–¥–∏—Ç heartbeat –æ—Ç A
12:00:10 - Node-B –Ω–∞—á–∏–Ω–∞–µ—Ç –≤—ã–±–æ—Ä—ã (term=6)
12:00:11 - Node-B —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ª–∏–¥–µ—Ä–æ–º (term=6)
12:00:16 - –°–µ—Ç–µ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, Node-C –Ω–µ –≤–∏–¥–∏—Ç heartbeat –æ—Ç B
12:00:21 - Node-C –Ω–∞—á–∏–Ω–∞–µ—Ç –≤—ã–±–æ—Ä—ã (term=7)
...–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª...
```

–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:
- –°–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø–∏—Å–∏ (–ª–∏–¥–µ—Ä –º–µ–Ω—è–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ)
- –ö–ª–∏–µ–Ω—Ç—ã –≤–∏–¥—è—Ç –æ—à–∏–±–∫–∏ "NOT_LEADER"
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞–¥–∞–µ—Ç –¥–æ –Ω—É–ª—è

–†–µ—à–µ–Ω–∏—è:
- –£–≤–µ–ª–∏—á–∏—Ç—å election timeout (–Ω–æ —ç—Ç–æ –∑–∞–º–µ–¥–ª–∏—Ç failover)
- –°—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å randomized election timeout (—Ä–∞–∑–Ω—ã–µ —É–∑–ª—ã –∂–¥—É—Ç —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è)
- –í–∫–ª—é—á–∏—Ç—å pre-vote —Ñ–∞–∑—É (Raft extension) ‚Äî —É–∑–µ–ª —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç, –µ—Å—Ç—å –ª–∏ —Å–º—ã—Å–ª –Ω–∞—á–∏–Ω–∞—Ç—å –≤—ã–±–æ—Ä—ã

**–ü—Ä–æ–±–ª–µ–º–∞ 3: –ú–µ–¥–ª–µ–Ω–Ω—ã–π –ª–∏–¥–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–º–µ–Ω—ë–Ω**

–°—Ü–µ–Ω–∞—Ä–∏–π: –ª–∏–¥–µ—Ä –∂–∏–≤, –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ heartbeat, –Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω CPU –∏–ª–∏ –¥–∏—Å–∫)

```
Leader Node-A:
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç heartbeat –∫–∞–∂–¥—ã–µ 1 —Å–µ–∫—É–Ω–¥—É ‚úÖ
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø–∏—Å—å –∑–∞ 30 —Å–µ–∫—É–Ω–¥ üêå

Followers:
- –í–∏–¥—è—Ç heartbeat ‚Üí –¥—É–º–∞—é—Ç, —á—Ç–æ –ª–∏–¥–µ—Ä –∑–¥–æ—Ä–æ–≤
- –ù–æ –∑–∞–ø–∏—Å–∏ –Ω–µ –∫–æ–º–º–∏—Ç—è—Ç—Å—è (–ª–∏–¥–µ—Ä –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç —Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞—Ç—å)
- –ö–ª–∏–µ–Ω—Ç—ã –≤–∏–¥—è—Ç —Ç–∞–π–º–∞—É—Ç—ã
```

–ü—Ä–æ–±–ª–µ–º–∞: –ø—Ä–æ—Ç–æ–∫–æ–ª –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞ –Ω–µ –ø—Ä–µ–¥—É—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç "–≤—ã–±–æ—Ä—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏". –õ–∏–¥–µ—Ä –º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

–†–µ—à–µ–Ω–∏—è:
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ latency –Ω–∞ –ª–∏–¥–µ—Ä–µ –∏ —Ä—É—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ
- "Step-down" –º–µ—Ö–∞–Ω–∏–∑–º: –ª–∏–¥–µ—Ä —Å–∞–º —É—Ö–æ–¥–∏—Ç –≤ –æ—Ç—Å—Ç–∞–≤–∫—É, –µ—Å–ª–∏ –≤–∏–¥–∏—Ç –ø—Ä–æ–±–ª–µ–º—ã
- –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏: –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –æ–¥–∏–Ω —É–∑–µ–ª

### üõ†Ô∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—ã

**1. –í—ã–±–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É–∑–ª–æ–≤**

–§–æ—Ä–º—É–ª–∞ –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏: `N = 2F + 1`, –≥–¥–µ F ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –æ—Ç–∫–∞–∑–æ–≤.

```
3 —É–∑–ª–∞ ‚Üí –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∂–∏—Ç—å 1 –æ—Ç–∫–∞–∑ (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ = 2)
5 —É–∑–ª–æ–≤ ‚Üí –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∂–∏—Ç—å 2 –æ—Ç–∫–∞–∑–∞ (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ = 3)
7 —É–∑–ª–æ–≤ ‚Üí –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∂–∏—Ç—å 3 –æ—Ç–∫–∞–∑–∞ (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ = 4)
```

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- **3 —É–∑–ª–∞** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º (–±–∞–ª–∞–Ω—Å –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
- **5 —É–∑–ª–æ–≤** ‚Äî –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
- **7+ —É–∑–ª–æ–≤** ‚Äî —Ä–µ–¥–∫–æ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª (–±–æ–ª—å—à–µ —É–∑–ª–æ–≤ = –º–µ–¥–ª–µ–Ω–Ω–µ–µ –∫–æ–Ω—Å–µ–Ω—Å—É—Å)

**2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤**

```
Election Timeout: 10-20 —Å–µ–∫—É–Ω–¥
- –°–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π ‚Üí —á–∞—Å—Ç—ã–µ –ª–æ–∂–Ω—ã–µ –ø–µ—Ä–µ–≤—ã–±–æ—Ä—ã
- –°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π ‚Üí –º–µ–¥–ª–µ–Ω–Ω—ã–π failover

Heartbeat Interval: 1-2 —Å–µ–∫—É–Ω–¥—ã
- –û–±—ã—á–Ω–æ –≤ 10 —Ä–∞–∑ –º–µ–Ω—å—à–µ election timeout
- –õ–∏–¥–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç heartbeat –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
```

**3. –†–∞–∑–º–µ—â–µ–Ω–∏–µ —É–∑–ª–æ–≤**

–ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω:
```
–í—Å–µ 3 —É–∑–ª–∞ –≤ –æ–¥–Ω–æ–º –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–µ
‚Üí –î–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä –ø–∞–¥–∞–µ—Ç ‚Üí –∫–ª–∞—Å—Ç–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```

–ü—Ä–∞–≤–∏–ª—å–Ω–æ:
```
3 availability zones (AZ):
AZ-1: Node-1
AZ-2: Node-2
AZ-3: Node-3

–û–¥–Ω–∞ AZ –ø–∞–¥–∞–µ—Ç ‚Üí –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ (2 –∏–∑ 3) –≤—Å—ë –µ—â—ë –¥–æ—Å—Ç—É–ø–Ω–æ
```

–î–ª—è geo-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:
```
5 —É–∑–ª–æ–≤ –≤ 3 —Ä–µ–≥–∏–æ–Ω–∞—Ö:
Region-1: Node-1, Node-2 (2 —É–∑–ª–∞)
Region-2: Node-3, Node-4 (2 —É–∑–ª–∞)
Region-5: Node-5 (1 —É–∑–µ–ª - tie-breaker)

–û–¥–∏–Ω —Ä–µ–≥–∏–æ–Ω –ø–∞–¥–∞–µ—Ç ‚Üí –≤—Å—ë –µ—â—ë –µ—Å—Ç—å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ (3 –∏–∑ 5)
```

**4. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –≤—ã–±–æ—Ä—ã**

MongoDB: priority –≤–ª–∏—è–µ—Ç –Ω–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç—å Primary
```
mongo-1 (priority=2, SSD, 32GB RAM)  ‚Üê –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π Primary
mongo-2 (priority=1, HDD, 16GB RAM)  ‚Üê Secondary
mongo-3 (priority=0, HDD, 8GB RAM)   ‚Üê –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å—Ç–∞–Ω–µ—Ç Primary (arbiter-like)
```

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:
- priority=0 –¥–ª—è —É–∑–ª–æ–≤ –≤ –¥–∞–ª—ë–∫–æ–º —Ä–µ–≥–∏–æ–Ω–µ (–¥–ª—è disaster recovery, –Ω–æ –Ω–µ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã)
- –í—ã—Å–æ–∫–∏–π priority –¥–ª—è –º–æ—â–Ω—ã—Ö —É–∑–ª–æ–≤

---

## 2. Log Replication Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –†–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –õ–æ–≥–æ–≤)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Log Replication Semantics** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –ö–ê–ö –ª–∏–¥–µ—Ä –ø–µ—Ä–µ–¥–∞—ë—Ç —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π (–ª–æ–≥) —Ñ–æ–ª–ª–æ–≤–µ—Ä–∞–º, –∏ –∫–∞–∫ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è, —á—Ç–æ –≤—Å–µ —É–∑–ª—ã –≤ –∏—Ç–æ–≥–µ –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–µ–π.

```
Leader Node:
Log: [op1] [op2] [op3] [op4] [op5] ...
       ‚Üì     ‚Üì     ‚Üì
Follower Node-A:
Log: [op1] [op2] [op3] [op4] ...  ‚Üê –û—Ç—Å—Ç–∞—ë—Ç –Ω–∞ 1 –∑–∞–ø–∏—Å—å

Follower Node-B:
Log: [op1] [op2] [op3] ...        ‚Üê –û—Ç—Å—Ç–∞—ë—Ç –Ω–∞ 2 –∑–∞–ø–∏—Å–∏
```

–ö–ª—é—á–µ–≤–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è: **Log Matching Property** ‚Äî –µ—Å–ª–∏ –¥–≤–∞ –ª–æ–≥–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç –∑–∞–ø–∏—Å—å —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –∏–Ω–¥–µ–∫—Å–æ–º –∏ term, —Ç–æ –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –æ–±–æ–∏—Ö –ª–æ–≥–∞—Ö –∏–¥–µ–Ω—Ç–∏—á–Ω—ã.

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–£–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ—Å—Ç—å**: –≤—Å–µ —É–∑–ª—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º –ø–æ—Ä—è–¥–∫–µ
- **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**: –Ω–µ–ª—å–∑—è –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –ª–æ–≥–∞
- **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ –ª–æ–≥–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
- **–ú–æ–Ω–æ—Ç–æ–Ω–Ω–æ—Å—Ç—å**: –ª–æ–≥ —Ç–æ–ª—å–∫–æ —Ä–∞—Å—Ç—ë—Ç, –∑–∞–ø–∏—Å–∏ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è/–∏–∑–º–µ–Ω—è—é—Ç—Å—è
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏**: —Ñ–æ–ª–ª–æ–≤–µ—Ä –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –∑–∞–ø–∏—Å–∏, –µ—Å–ª–∏ –≤–∏–¥–∏—Ç –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π recovery**: —Ñ–æ–ª–ª–æ–≤–µ—Ä –¥–æ–≥–æ–Ω—è–µ—Ç –ª–∏–¥–µ—Ä–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –æ—Ç—Å—Ç–∞–ª —Å–∏–ª—å–Ω–æ

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é**: —Ñ–æ–ª–ª–æ–≤–µ—Ä –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç –æ—Ç—Å—Ç–∞–≤–∞—Ç—å
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏**: —Ä–∞–∑–Ω—ã–µ —Ñ–æ–ª–ª–æ–≤–µ—Ä—ã –æ—Ç—Å—Ç–∞—é—Ç –ø–æ-—Ä–∞–∑–Ω–æ–º—É
- **–ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Ñ–æ–ª–ª–æ–≤–µ—Ä–æ–≤**: –æ–¥–∏–Ω –º–µ–¥–ª–µ–Ω–Ω—ã–π —Ñ–æ–ª–ª–æ–≤–µ—Ä –∑–∞–º–µ–¥–ª—è–µ—Ç –≤–µ—Å—å –∫–ª–∞—Å—Ç–µ—Ä (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –µ–≥–æ ACK)
- **–ù–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å –ª–æ–≥–∞**: –ª–æ–≥ —Ä–∞—Å—Ç—ë—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –±–µ–∑ —Å–Ω–∞–ø—à–æ—Ç–æ–≤/–∫–æ–º–ø–∞–∫—à–µ–Ω–∞
- **–ù–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—é**: –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö —Å–±–æ—è—Ö –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –ª–æ–≥–∞

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**Kafka Partition Replication**

Kafka —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –∫–∞–∂–¥—É—é –ø–∞—Ä—Ç–∏—Ü–∏—é –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –±—Ä–æ–∫–µ—Ä–æ–≤:
- **Leader replica**: –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –æ—Ç –ø—Ä–æ–¥—é—Å–µ—Ä–æ–≤
- **Follower replicas**: –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ —á–∏—Ç–∞—é—Ç (fetch) –¥–∞–Ω–Ω—ã–µ –æ—Ç –ª–∏–¥–µ—Ä–∞
- –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–º–µ–µ—Ç offset (–∏–Ω–¥–µ–∫—Å –≤ –ª–æ–≥–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏)
- ISR (In-Sync Replica set): —Ñ–æ–ª–ª–æ–≤–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ "–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–ª–∏–∑–∫–æ" –∫ –ª–∏–¥–µ—Ä—É

–ü—Ä–∏–º–µ—Ä:
```
–¢–æ–ø–∏–∫ "orders", –ø–∞—Ä—Ç–∏—Ü–∏—è 0, replication-factor=3:

Leader (broker-1):
Offset: 0    1    2    3    4    5
        [M1] [M2] [M3] [M4] [M5] [M6]

Follower-1 (broker-2):  ISR ‚úÖ
Offset: 0    1    2    3    4    5
        [M1] [M2] [M3] [M4] [M5] [M6]  ‚Üê –°–∏–Ω—Ö—Ä–æ–Ω–µ–Ω —Å –ª–∏–¥–µ—Ä–æ–º

Follower-2 (broker-3):  ISR ‚ùå (–æ—Ç—Å—Ç–∞–ª)
Offset: 0    1    2    3
        [M1] [M2] [M3] [M4]  ‚Üê –û—Ç—Å—Ç–∞–ª –Ω–∞ 2 —Å–æ–æ–±—â–µ–Ω–∏—è
```

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- `replica.lag.time.max.ms=10000` ‚Äî –µ—Å–ª–∏ —Ñ–æ–ª–ª–æ–≤–µ—Ä –Ω–µ fetch'–∏—Ç –±–æ–ª–µ–µ 10 —Å–µ–∫—É–Ω–¥, –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è –∏–∑ ISR
- `min.insync.replicas=2` ‚Äî –ø—Ä–æ–¥—é—Å–µ—Ä —Ç—Ä–µ–±—É–µ—Ç ACK –æ—Ç –º–∏–Ω–∏–º—É–º 2 —Ä–µ–ø–ª–∏–∫
- `acks=all` ‚Äî –ø—Ä–æ–¥—é—Å–µ—Ä –∂–¥—ë—Ç ACK –æ—Ç –≤—Å–µ—Ö ISR

**MongoDB Oplog Replication**

MongoDB —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç —á–µ—Ä–µ–∑ oplog (operations log) ‚Äî capped collection –≤ –ë–î `local`:
- Primary –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∫–∞–∂–¥—É—é –æ–ø–µ—Ä–∞—Ü–∏—é (insert/update/delete) –≤ oplog
- Secondaries –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ —á–∏—Ç–∞—é—Ç oplog Primary (—á–µ—Ä–µ–∑ tailable cursor)
- –ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å –≤ oplog –∏–º–µ–µ—Ç timestamp –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID

–ü—Ä–∏–º–µ—Ä oplog:
```
Oplog –Ω–∞ Primary:
{ ts: Timestamp(1672531200, 1), op: "i", ns: "shop.orders", o: {_id: 1, item: "apple"} }
{ ts: Timestamp(1672531200, 2), op: "u", ns: "shop.orders", o: {$set: {status: "paid"}}, o2: {_id: 1} }
{ ts: Timestamp(1672531200, 3), op: "d", ns: "shop.orders", o: {_id: 1} }

Secondary —á–∏—Ç–∞–µ—Ç oplog:
- –ù–∞—á–∏–Ω–∞–µ—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –∏–∑–≤–µ—Å—Ç–Ω–æ–π ts
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ç–æ–º –∂–µ –ø–æ—Ä—è–¥–∫–µ
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–≤–æ—é –ø–æ–∑–∏—Ü–∏—é –≤ oplog
```

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- Oplog ‚Äî capped collection, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –ø–æ —Ä–∞–∑–º–µ—Ä—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10GB)
- –ï—Å–ª–∏ Secondary –æ—Ç—Å—Ç–∞–ª –Ω–∞—Å—Ç–æ–ª—å–∫–æ, —á—Ç–æ –µ–≥–æ –ø–æ–∑–∏—Ü–∏—è —É–∂–µ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ oplog, –Ω—É–∂–µ–Ω **initial sync** (–ø–æ–ª–Ω–∞—è –∫–æ–ø–∏—è –¥–∞–Ω–Ω—ã—Ö)

**PostgreSQL Streaming Replication**

PostgreSQL —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç —á–µ—Ä–µ–∑ WAL (Write-Ahead Log):
- Primary –ø–∏—à–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ WAL segments (—Ñ–∞–π–ª—ã –ø–æ 16MB)
- Standby –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç WAL —á–µ—Ä–µ–∑ streaming connection
- Standby –ø—Ä–∏–º–µ–Ω—è–µ—Ç WAL records –≤ —Ç–æ–º –∂–µ –ø–æ—Ä—è–¥–∫–µ

–ü—Ä–∏–º–µ—Ä:
```
Primary:
WAL: 00000001000000000000001A (—Ç–µ–∫—É—â–∏–π —Å–µ–≥–º–µ–Ω—Ç)
LSN: 0/1A0000F8  ‚Üê Log Sequence Number (–ø–æ–∑–∏—Ü–∏—è –≤ WAL)

Standby:
WAL: 00000001000000000000001A (–ø–æ–ª—É—á–µ–Ω –∏ –ø—Ä–∏–º–µ–Ω—ë–Ω)
LSN: 0/1A0000F8  ‚Üê –î–æ–≥–Ω–∞–ª Primary

–û—Ç—Å—Ç–∞—é—â–∏–π Standby:
WAL: 000000010000000000000019 (–ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å–µ–≥–º–µ–Ω—Ç)
LSN: 0/190000A0  ‚Üê –û—Ç—Å—Ç–∞—ë—Ç –Ω–∞ ~1MB
```

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- `synchronous_commit=on` + `synchronous_standby_names='standby1'` ‚Äî Primary –∂–¥—ë—Ç ACK –æ—Ç standby1 –ø–µ—Ä–µ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç—É
- `wal_keep_size=1GB` ‚Äî —Ö—Ä–∞–Ω–∏—Ç—å –º–∏–Ω–∏–º—É–º 1GB —Å—Ç–∞—Ä—ã—Ö WAL —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –¥–ª—è –æ—Ç—Å—Ç–∞—é—â–∏—Ö standby
- `max_wal_senders=10` ‚Äî –º–∞–∫—Å–∏–º—É–º 10 standby –º–æ–≥—É—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è

### üö® –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞ 1: –ú–µ–¥–ª–µ–Ω–Ω—ã–π —Ñ–æ–ª–ª–æ–≤–µ—Ä –∑–∞–º–µ–¥–ª—è–µ—Ç –≤—Å—é —Å–∏—Å—Ç–µ–º—É**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
Kafka, min.insync.replicas=2, acks=all

Leader (SSD, fast network):     –ë—ã—Å—Ç—Ä–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç
Follower-1 (SSD, fast network): –ë—ã—Å—Ç—Ä–æ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç ‚úÖ
Follower-2 (HDD, slow network): –ú–µ–¥–ª–µ–Ω–Ω–æ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç üêå

–ü—Ä–æ–¥—é—Å–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí
Leader –ø–∏—à–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ ‚Üí ‚úÖ –ë—ã—Å—Ç—Ä–æ
Leader –∂–¥—ë—Ç ACK –æ—Ç Follower-1 ‚Üí ‚úÖ –ë—ã—Å—Ç—Ä–æ
Leader –∂–¥—ë—Ç ACK –æ—Ç Follower-2 ‚Üí ‚è±Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–æ (5 —Å–µ–∫—É–Ω–¥)
–ü—Ä–æ–¥—é—Å–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç ACK —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
```

–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:
- Latency –∑–∞–ø–∏—Å–∏ = —Å–∫–æ—Ä–æ—Å—Ç—å —Å–∞–º–æ–≥–æ –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ ISR —Ñ–æ–ª–ª–æ–≤–µ—Ä–∞
- Throughput –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –º–µ–¥–ª–µ–Ω–Ω—ã–º —Ñ–æ–ª–ª–æ–≤–µ—Ä–æ–º

–†–µ—à–µ–Ω–∏—è:
- –ò—Å–∫–ª—é—á–∏—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–π —Ñ–æ–ª–ª–æ–≤–µ—Ä –∏–∑ ISR (–æ–Ω –≤—ã–ø–∞–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ replica.lag.time.max.ms)
- –£–º–µ–Ω—å—à–∏—Ç—å min.insync.replicas (–Ω–æ —ç—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `acks=1` –≤–º–µ—Å—Ç–æ `acks=all` (–Ω–æ —Ç–æ–≥–¥–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö)
- –ê–ø–≥—Ä–µ–π–¥–∏—Ç—å –∂–µ–ª–µ–∑–æ –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Ñ–æ–ª–ª–æ–≤–µ—Ä–∞

**–ü—Ä–æ–±–ª–µ–º–∞ 2: –§–æ–ª–ª–æ–≤–µ—Ä –æ—Ç—Å—Ç–∞–ª –Ω–∞—Å—Ç–æ–ª—å–∫–æ, —á—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –¥–æ–≥–Ω–∞—Ç—å (MongoDB)**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
MongoDB Replica Set:
Primary: –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –∑–∞–ø–∏—Å–∏ (1000 –æ–ø–µ—Ä–∞—Ü–∏–π/—Å–µ–∫)
Secondary: –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ 2 —á–∞—Å–∞ –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è

Oplog size: 10GB
–°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏: 10GB –æ–ø–æ–≥–∞ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –∑–∞ 3 —á–∞—Å–∞

Secondary –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞ ‚Üí
–ï–≥–æ –ø–æ—Å–ª–µ–¥–Ω—è—è –∏–∑–≤–µ—Å—Ç–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è: 2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥
–≠—Ç–∞ –ø–æ–∑–∏—Ü–∏—è —É–∂–µ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ capped collection (oplog –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω)

Secondary –Ω–µ –º–æ–∂–µ—Ç –¥–æ–≥–Ω–∞—Ç—å ‚Üí —Ç—Ä–µ–±—É–µ—Ç—Å—è initial sync (–ø–æ–ª–Ω–∞—è –∫–æ–ø–∏—è –¥–∞–Ω–Ω—ã—Ö)
```

–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:
- Initial sync –∑–∞–Ω–∏–º–∞–µ—Ç —á–∞—Å—ã/–¥–Ω–∏ (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ë–î)
- –í–æ –≤—Ä–µ–º—è initial sync Secondary –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —á—Ç–µ–Ω–∏—è
- –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ Primary (–Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ)

–†–µ—à–µ–Ω–∏—è:
- –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä oplog (oplogSizeMB)
- –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å Secondary –Ω–∞–¥–æ–ª–≥–æ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ Secondary, —á—Ç–æ–±—ã –æ–¥–∏–Ω –º–æ–≥ –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–ü—Ä–æ–±–ª–µ–º–∞ 3: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ª–æ–≥–æ–≤ –ø–æ—Å–ª–µ split-brain (—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
–ö–ª–∞—Å—Ç–µ—Ä —Ä–∞–∑–¥–µ–ª—ë–Ω –Ω–∞ –¥–≤–µ —á–∞—Å—Ç–∏:

–°–µ–≥–º–µ–Ω—Ç A (—Å—Ç–∞—Ä—ã–π –ª–∏–¥–µ—Ä Node-1):
Log: [op1] [op2] [op3] [op-A4] [op-A5]  ‚Üê –∑–∞–ø–∏—Å–∏ –ø—Ä–∏–Ω—è—Ç—ã, –Ω–æ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º

–°–µ–≥–º–µ–Ω—Ç B (–Ω–æ–≤—ã–π –ª–∏–¥–µ—Ä Node-2):
Log: [op1] [op2] [op3] [op-B4] [op-B5]  ‚Üê –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –æ—Ç –Ω–æ–≤–æ–≥–æ –ª–∏–¥–µ—Ä–∞

–°–µ—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ ‚Üí
Node-1 —É–∑–Ω–∞—ë—Ç, —á—Ç–æ Node-2 ‚Äî –Ω–æ–≤—ã–π –ª–∏–¥–µ—Ä ‚Üí
Node-1 –¥–æ–ª–∂–µ–Ω –æ—Ç–∫–∞—Ç–∏—Ç—å [op-A4] [op-A5] –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å [op-B4] [op-B5]
```

–ö–∞–∫ Raft —Ä–∞–∑—Ä–µ—à–∞–µ—Ç:
- –õ–∏–¥–µ—Ä Node-2 –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–æ–≥ Node-1
- –í–∏–¥–∏—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –Ω–∞ –∏–Ω–¥–µ–∫—Å–µ 4
- –ó–∞—Å—Ç–∞–≤–ª—è–µ—Ç Node-1 –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –¥–æ –∏–Ω–¥–µ–∫—Å–∞ 3 (–ø–æ—Å–ª–µ–¥–Ω—è—è –æ–±—â–∞—è –∑–∞–ø–∏—Å—å)
- Node-1 —É–¥–∞–ª—è–µ—Ç [op-A4] [op-A5]
- Node-1 –ø—Ä–∏–º–µ–Ω—è–µ—Ç [op-B4] [op-B5] –æ—Ç Node-2

–ü—Ä–æ–±–ª–µ–º–∞: **–Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ —Ç–µ—Ä—è—é—Ç—Å—è!**

–ü–æ—á–µ–º—É —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ:
- [op-A4] [op-A5] –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—ã–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º ‚Üí –∫–ª–∏–µ–Ω—Ç –Ω–µ –ø–æ–ª—É—á–∏–ª ACK ‚Üí –∫–ª–∏–µ–Ω—Ç —Å—á–∏—Ç–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –Ω–µ—É–¥–∞—á–Ω–æ–π ‚Üí –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å

–ü—Ä–æ–±–ª–µ–º–∞: –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —É—Å–ø–µ–ª –ø—Ä–æ—á–∏—Ç–∞—Ç—å [op-A4] –æ—Ç Node-1 –¥–æ –æ—Ç–∫–∞—Ç–∞, –æ–Ω —É–≤–∏–¥–µ–ª –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Ç–æ–º –∏—Å—á–µ–∑–ª–∏ (–Ω–∞—Ä—É—à–µ–Ω–∏–µ –ª–∏–Ω–µ–π–Ω–æ–π –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è —á—Ç–µ–Ω–∏—è).

–†–µ—à–µ–Ω–∏–µ: —á–∏—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ committed –∑–∞–ø–∏—Å–∏.

### üõ†Ô∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—ã

**1. –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –º–µ–∂–¥—É –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å—é –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é**

```
                   –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å ‚Üë  –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Üì
                          ‚îÇ
acks=all + min.insync=3   ‚îú‚îÄ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å, –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏
acks=all + min.insync=2   ‚îú‚îÄ –ë–∞–ª–∞–Ω—Å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
acks=1 (—Ç–æ–ª—å–∫–æ leader)    ‚îú‚îÄ –ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø–∏—Å–∏, —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –ª–∏–¥–µ—Ä–∞
acks=0 (fire-and-forget)  ‚îú‚îÄ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å, –Ω–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π
                          ‚îÇ
```

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**: acks=all, min.insync=2, sync_standby –≤ PostgreSQL
- **–õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π**: acks=1 –∏–ª–∏ –¥–∞–∂–µ acks=0 (–ø–æ—Ç–µ—Ä—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ª–æ–≥–æ–≤ –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω–∞)
- **–ú–µ—Ç—Ä–∏–∫–∏**: acks=0 (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ)

**2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏—è (replication lag)**

–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
```
Kafka:
- Replica lag (records): —Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç—Å—Ç–∞–ª —Ñ–æ–ª–ª–æ–≤–µ—Ä
- Replica lag (time): —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–∑–∞–¥ —Ñ–æ–ª–ª–æ–≤–µ—Ä fetch'–∏–ª

MongoDB:
- replicationLag: –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö –º–µ–∂–¥—É Primary –∏ Secondary

PostgreSQL:
- pg_stat_replication.write_lag: –∑–∞–¥–µ—Ä–∂–∫–∞ –∑–∞–ø–∏—Å–∏ WAL
- pg_stat_replication.flush_lag: –∑–∞–¥–µ—Ä–∂–∫–∞ flush WAL –Ω–∞ –¥–∏—Å–∫
- pg_stat_replication.replay_lag: –∑–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è WAL
```

–ê–ª–µ—Ä—Ç—ã:
```
Kafka: Replica lag > 1000 records –∏–ª–∏ > 10 —Å–µ–∫—É–Ω–¥
MongoDB: replicationLag > 10 —Å–µ–∫—É–Ω–¥
PostgreSQL: replay_lag > 1 —Å–µ–∫—É–Ω–¥–∞
```

**3. –†–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–æ–≤ –∏ –±–∞—Ç—á–∏–Ω–≥**

Kafka batching:
```
Producer:
batch.size=16KB     ‚Üê –ù–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –¥–æ 16KB –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
linger.ms=10        ‚Üê –ñ–¥–∞—Ç—å –¥–æ 10ms –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è batch

Follower:
fetch.min.bytes=1   ‚Üê –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä fetch
fetch.max.wait.ms=500 ‚Üê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
```

MongoDB:
```
Oplog size: 5-10% –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ä–∞–±–æ—á–µ–≥–æ –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
–ú–∏–Ω–∏–º—É–º: 1GB
–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 10-50GB –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
```

PostgreSQL:
```
wal_buffers=16MB           ‚Üê –ë—É—Ñ–µ—Ä –¥–ª—è WAL –≤ –ø–∞–º—è—Ç–∏
synchronous_commit=on      ‚Üê –ñ–¥–∞—Ç—å fsync WAL (–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å)
synchronous_commit=off     ‚Üê –ù–µ –∂–¥–∞—Ç—å fsync (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ä–∏—Å–∫)
```

---

## 3. Commit Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –ö–æ–º–º–∏—Ç–æ–≤)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Commit Semantics** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –∑–∞–ø–∏—Å—å –≤ –ª–æ–≥ —Å—á–∏—Ç–∞–µ—Ç—Å—è **–ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–æ–π** (committed) –∏ **–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–º–µ–Ω–µ–Ω–∞**. Committed –∑–∞–ø–∏—Å–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø–µ—Ä–µ–∂–∏–≤—É—Ç –ª—é–±—ã–µ —Å–±–æ–∏ (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∫–≤–æ—Ä—É–º–∞ –∂–∏–≤—ã—Ö —É–∑–ª–æ–≤).

```
Leader Log:
Index:     1       2       3       4       5       6
Entry:  [op1]   [op2]   [op3]   [op4]   [op5]   [op6]
          ‚úÖ      ‚úÖ      ‚úÖ      ‚è≥      ‚è≥      ‚è≥
       committed committed committed  uncommitted

Follower-A: [op1] [op2] [op3] [op4] [op5]  ‚úÖ ACK
Follower-B: [op1] [op2] [op3] [op4]        ‚úÖ ACK
Follower-C: [op1] [op2] [op3]              ‚ùå –ù–µ—Ç ACK

–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ (3 –∏–∑ 5) –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏ –¥–æ op4 –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ ‚Üí
Commit Index = 4
```

–ö–ª—é—á–µ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ: –∑–∞–ø–∏—Å—å committed, –∫–æ–≥–¥–∞ –æ–Ω–∞ **—Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É–∑–ª–æ–≤**.

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–î–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å (Durability)**: committed –∑–∞–ø–∏—Å—å –Ω–µ –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –º–µ–Ω—å—à–∏–Ω—Å—Ç–≤–∞ —É–∑–ª–æ–≤
- **–ù–µ–æ–±—Ä–∞—Ç–∏–º–æ—Å—Ç—å**: committed –∑–∞–ø–∏—Å—å –Ω–µ –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–µ–Ω–∞/–∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∏–∫–æ–≥–¥–∞
- **–í–∏–¥–∏–º–æ—Å—Ç—å**: committed –∑–∞–ø–∏—Å–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω—ã –∫–ª–∏–µ–Ω—Ç–∞–º–∏ (read committed)
- **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å N committed, –≤—Å–µ –∑–∞–ø–∏—Å–∏ < N —Ç–∞–∫–∂–µ committed
- **–ì–∞—Ä–∞–Ω—Ç–∏—è ACK –∫–ª–∏–µ–Ω—Ç—É**: –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ commit
- **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å**: –≤—Å–µ —É–∑–ª—ã –∫–æ–º–º–∏—Ç—è—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –∑–∞–ø–∏—Å–∏ –≤ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º –ø–æ—Ä—è–¥–∫–µ

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π commit**: –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è ACK –æ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π commit –Ω–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö**: —Ñ–æ–ª–ª–æ–≤–µ—Ä—ã —É–∑–Ω–∞—é—Ç –æ commit —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
- **–ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø–æ—Ç–µ—Ä–∏ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞**: –µ—Å–ª–∏ —É–ø–∞–ª–æ > N/2 —É–∑–ª–æ–≤, –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
- **–ù–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç rollback uncommitted –∑–∞–ø–∏—Å–µ–π**: –∑–∞–ø–∏—Å–∏, –Ω–µ –¥–æ—Å—Ç–∏–≥—à–∏–µ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞, –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Ç–º–µ–Ω–µ–Ω—ã
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç commit –±–µ–∑ –∫–≤–æ—Ä—É–º–∞**: –ø—Ä–∏ network partition –º–µ–Ω—å—à–∏–Ω—Å—Ç–≤–æ –Ω–µ –º–æ–∂–µ—Ç –∫–æ–º–º–∏—Ç–∏—Ç—å

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**Kafka Committed Offset**

–í Kafka committed ‚Äî —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏—è, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º ISR —Ä–µ–ø–ª–∏–∫:

–ü—Ä–∏–º–µ—Ä:
```
Producer –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å acks=all:

1. Leader broker –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
2. Leader –ø–∏—à–µ—Ç –≤ —Å–≤–æ–π –ª–æ–≥ (offset=100)
3. Leader –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ follower'–∞–º –≤ ISR
4. Follower-1 –ø–æ–ª—É—á–∞–µ—Ç, –ø–∏—à–µ—Ç –≤ —Å–≤–æ–π –ª–æ–≥, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ACK
5. Follower-2 –ø–æ–ª—É—á–∞–µ—Ç, –ø–∏—à–µ—Ç –≤ —Å–≤–æ–π –ª–æ–≥, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ACK
6. Leader –ø–æ–ª—É—á–∏–ª ACK –æ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ (min.insync.replicas=2)
7. Leader —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç High Watermark –¥–æ offset=100
8. Leader –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ACK –ø—Ä–æ–¥—é—Å–µ—Ä—É

High Watermark (HW) = –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π committed offset
```

–í–∞–∂–Ω–æ:
- –ö–æ–Ω—Å—é–º–µ—Ä—ã –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è <= HW (committed)
- –°–æ–æ–±—â–µ–Ω–∏—è > HW –µ—â—ë –Ω–µ committed, –∫–æ–Ω—Å—é–º–µ—Ä—ã –∏—Ö –Ω–µ –≤–∏–¥—è—Ç

–ü—Ä–∏–º–µ—Ä —á—Ç–µ–Ω–∏—è:
```
Leader Log:
Offset:    98   99   100  101  102
          [M1] [M2] [M3] [M4] [M5]
                         ‚Üë
                    HW = 100 (committed)

Consumer —á–∏—Ç–∞–µ—Ç:
- –ú–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å M1, M2, M3 ‚úÖ (offset <= HW)
- –ù–µ –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å M4, M5 ‚ùå (offset > HW, uncommitted)
```

**MongoDB Write Concern**

MongoDB –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å, —Å–∫–æ–ª—å–∫–æ —É–∑–ª–æ–≤ –¥–æ–ª–∂–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–ø–∏—Å—å:

```javascript
// Write Concern: –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ
db.orders.insertOne(
  { item: "apple" },
  { writeConcern: { w: "majority", wtimeout: 5000 } }
)
```

–í–∞—Ä–∏–∞–Ω—Ç—ã:
```
w: 1 (default)
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –æ—Ç Primary
- –ë—ã—Å—Ç—Ä–æ, –Ω–æ —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ Primary

w: "majority"
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —É–∑–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2 –∏–∑ 3)
- –ì–∞—Ä–∞–Ω—Ç–∏—è –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç–∏

w: 3
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç 3 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —É–∑–ª–æ–≤
- –ú–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ –≤—ã—à–µ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å

j: true (journal)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ journal –Ω–∞ –¥–∏—Å–∫
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –ø—Ä–∏ –≤–Ω–µ–∑–∞–ø–Ω–æ–º –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –ø–∏—Ç–∞–Ω–∏—è
```

–ü—Ä–∏–º–µ—Ä:
```
Replica Set (3 —É–∑–ª–∞):
Primary:     –ó–∞–ø–∏—Å—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞, –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ journal ‚úÖ
Secondary-1: –ó–∞–ø–∏—Å—å —Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ ‚úÖ
Secondary-2: –ï—â—ë –Ω–µ –ø–æ–ª—É—á–∏–ª –∑–∞–ø–∏—Å—å ‚ùå

w: "majority" –¥–æ—Å—Ç–∏–≥–Ω—É—Ç (2 –∏–∑ 3) ‚Üí –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç OK
w: 3 –ù–ï –¥–æ—Å—Ç–∏–≥–Ω—É—Ç ‚Üí –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç timeout error
```

**PostgreSQL Synchronous Replication**

PostgreSQL –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é:

```
# postgresql.conf
synchronous_commit = on
synchronous_standby_names = 'standby1, standby2'
```

–í–∞—Ä–∏–∞–Ω—Ç—ã synchronous_commit:
```
off
- –ù–µ –∂–¥–∞—Ç—å flush WAL –Ω–∞ –¥–∏—Å–∫ –¥–∞–∂–µ –Ω–∞ Primary
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å, —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ ~–ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø—Ä–∏ —Å–±–æ–µ

local (default)
- –ñ–¥–∞—Ç—å flush WAL –Ω–∞ –¥–∏—Å–∫ –Ω–∞ Primary
- –ù–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è standby

remote_write
- –ñ–¥–∞—Ç—å, –ø–æ–∫–∞ standby –ø–æ–ª—É—á–∏–ª WAL (–Ω–æ –Ω–µ flush –Ω–∞ –¥–∏—Å–∫)
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ Primary

on
- –ñ–¥–∞—Ç—å flush WAL –Ω–∞ –¥–∏—Å–∫ –Ω–∞ Primary –∏ –Ω–∞ standby
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å, –º–µ–¥–ª–µ–Ω–Ω–µ–µ

remote_apply
- –ñ–¥–∞—Ç—å, –ø–æ–∫–∞ standby –ø—Ä–∏–º–µ–Ω–∏–ª –∏–∑–º–µ–Ω–µ–Ω–∏—è (–≤–∏–¥–∏–º—ã –¥–ª—è —á—Ç–µ–Ω–∏—è)
- –ì–∞—Ä–∞–Ω—Ç–∏—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è —Å–æ standby
```

–ü—Ä–∏–º–µ—Ä:
```
synchronous_commit=on, synchronous_standby_names='standby1'

Client: BEGIN; INSERT ...; COMMIT;

1. Primary –ø–∏—à–µ—Ç WAL –Ω–∞ –¥–∏—Å–∫ ‚úÖ
2. Primary –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç WAL –≤ standby1
3. standby1 –ø–æ–ª—É—á–∞–µ—Ç WAL, –ø–∏—à–µ—Ç –Ω–∞ –¥–∏—Å–∫, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ACK
4. Primary –ø–æ–ª—É—á–∞–µ—Ç ACK –æ—Ç standby1 ‚úÖ
5. Primary –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç OK –∫–ª–∏–µ–Ω—Ç—É

–ï—Å–ª–∏ standby1 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí
COMMIT –≤–∏—Å–∏—Ç, –∂–¥—ë—Ç standby1 ‚Üí
–ö–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç —Ç–∞–π–º–∞—É—Ç –∏–ª–∏ –¥–æ–ª–≥–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ
```

**ClickHouse Quorum Inserts**

ClickHouse (ReplicatedMergeTree) –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –∫–≤–æ—Ä—É–º –¥–ª—è INSERT:

```sql
INSERT INTO replicated_table
SETTINGS insert_quorum=3, insert_quorum_timeout=60000
VALUES (...)
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
```
insert_quorum=3
- INSERT —É—Å–ø–µ—à–µ–Ω, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ 3 —Ä–µ–ø–ª–∏–∫–∏
- –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –¥–ª—è 5 —Ä–µ–ø–ª–∏–∫

insert_quorum_timeout=60000
- –ñ–¥–∞—Ç—å –¥–æ 60 —Å–µ–∫—É–Ω–¥
- –ï—Å–ª–∏ timeout, INSERT –æ—à–∏–±–∫–∞ (–Ω–æ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–∞ —á–∞—Å—Ç–∏ —Ä–µ–ø–ª–∏–∫)

insert_quorum_parallel=0
- –ï—Å–ª–∏ 1, —Ä–∞–∑—Ä–µ—à–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ quorum inserts –≤ –æ–¥–Ω—É —Ç–∞–±–ª–∏—Ü—É
- –ï—Å–ª–∏ 0, quorum inserts –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã (–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ)
```

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å ClickHouse:
- ClickHouse –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Raft/Paxos –¥–ª—è –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Keeper)
- Quorum inserts ‚Äî —ç—Ç–æ "–ª—ë–≥–∫–∏–π" –∫–æ–Ω—Å–µ–Ω—Å—É—Å –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –í–æ–∑–º–æ–∂–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö quorum inserts ‚Üí –Ω—É–∂–µ–Ω `insert_quorum_parallel=0`

### üö® –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞ 1: Uncommitted –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–Ω—ã –∫–ª–∏–µ–Ω—Ç–∞–º (dirty read)**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
Kafka, Consumer —á–∏—Ç–∞–µ—Ç —Å –æ–±—ã—á–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:

Leader Log:
Offset:    100  101  102
          [M1] [M2] [M3]
                    ‚Üë
              HW = 101 (committed —Ç–æ–ª—å–∫–æ –¥–æ 101)

–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Consumer:
- –ß–∏—Ç–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é —Å Leader
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç isolation.level=read_uncommitted (default)
- –í–∏–¥–∏—Ç M3, —Ö–æ—Ç—è M3 –µ—â—ë –Ω–µ committed

Leader –ø–∞–¥–∞–µ—Ç –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ M3 committed ‚Üí
–ù–æ–≤—ã–π Leader –Ω–µ –∏–º–µ–µ—Ç M3 ‚Üí
Consumer —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª M3 ‚Üí –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è Consumer
```

–†–µ—à–µ–Ω–∏–µ:
```
isolation.level=read_committed
- Consumer –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è <= HW
- –ó–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–µ–Ω–∏—è (+10-100ms), –Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—è –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç–∏
```

**–ü—Ä–æ–±–ª–µ–º–∞ 2: –ó–∞–≤–∏—Å–∞–Ω–∏–µ –∫–æ–º–º–∏—Ç–æ–≤ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ standby (PostgreSQL)**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
PostgreSQL:
synchronous_commit=on
synchronous_standby_names='standby1'

standby1 —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (—Å–µ—Ç—å, —Å–±–æ–π) ‚Üí
Primary –∂–¥—ë—Ç ACK –æ—Ç standby1 ‚Üí
–í—Å–µ COMMIT –≤–∏—Å—è—Ç, —Ç–∞–π–º–∞—É—Ç ‚Üí
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
```

–†–µ—à–µ–Ω–∏–µ 1: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ standby
```
synchronous_standby_names='ANY 1 (standby1, standby2, standby3)'
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ACK –æ—Ç –ª—é–±–æ–≥–æ –æ–¥–Ω–æ–≥–æ –∏–∑ —Ç—Ä—ë—Ö
- –ï—Å–ª–∏ standby1 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è standby2 –∏–ª–∏ standby3
```

–†–µ—à–µ–Ω–∏–µ 2: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π failover —Å Patroni
- Patroni –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å standby
- –û–±–Ω–æ–≤–ª—è–µ—Ç synchronous_standby_names, –∏—Å–∫–ª—é—á–∞—è —É–ø–∞–≤—à–∏–π standby
- Primary –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É

–†–µ—à–µ–Ω–∏–µ 3: –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è
```
synchronous_commit=local
- –í—Ä–µ–º–µ–Ω–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π commit (–±–µ–∑ standby)
- –ú–µ–Ω—å—à–µ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏, –Ω–æ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è standby –≤–µ—Ä–Ω—É—Ç—å synchronous_commit=on
```

**–ü—Ä–æ–±–ª–µ–º–∞ 3: Rollback uncommitted –∑–∞–ø–∏—Å–µ–π –ø—Ä–∏ —Å–º–µ–Ω–µ –ª–∏–¥–µ—Ä–∞**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
Raft –∫–ª–∞—Å—Ç–µ—Ä:

Leader Node-A:
Log: [1] [2] [3] [4] [5]  ‚Üê [4], [5] –µ—â—ë –Ω–µ replicated –Ω–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ

Follower Node-B:
Log: [1] [2] [3]

Follower Node-C:
Log: [1] [2] [3]

Node-A –ø–∞–¥–∞–µ—Ç –¥–æ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ [4], [5] ‚Üí
Node-B —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–æ–≤—ã–º –ª–∏–¥–µ—Ä–æ–º (–∏–º–µ–µ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ: —Å–≤–æ–π –≥–æ–ª–æ—Å + Node-C) ‚Üí

Node-A –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è ‚Üí
–ù–æ–≤—ã–π –ª–∏–¥–µ—Ä Node-B –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç Node-A –æ—Ç–∫–∞—Ç–∏—Ç—å [4], [5] ‚Üí
Node-A log: [1] [2] [3]  ‚Üê [4], [5] —É–¥–∞–ª–µ–Ω—ã
```

–ü—Ä–æ–±–ª–µ–º–∞: –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —É—Å–ø–µ–ª –ø—Ä–æ—á–∏—Ç–∞—Ç—å [4] –æ—Ç Node-A –¥–æ –µ–≥–æ –ø–∞–¥–µ–Ω–∏—è, –∫–ª–∏–µ–Ω—Ç —É–≤–∏–¥–µ–ª "–ø—Ä–∏–∑—Ä–∞—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ".

–†–µ—à–µ–Ω–∏–µ:
```
1. Read Committed Only:
   - –ö–ª–∏–µ–Ω—Ç—ã —á–∏—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ committed –∑–∞–ø–∏—Å–∏
   - –í Raft: –∑–∞–ø–∏—Å–∏ —Å –∏–Ω–¥–µ–∫—Å–æ–º <= commitIndex

2. Linearizable Reads:
   - –õ–∏–¥–µ—Ä, –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º –Ω–∞ —á—Ç–µ–Ω–∏–µ, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –æ–Ω –≤—Å—ë –µ—â—ë –ª–∏–¥–µ—Ä
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç heartbeat —Ñ–æ–ª–ª–æ–≤–µ—Ä–∞–º
   - –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª ACK –æ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ ‚Üí –æ–Ω –≤—Å—ë –µ—â—ë –ª–∏–¥–µ—Ä ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
   - –ò–Ω–∞—á–µ ‚Üí –æ—Ç–∫–ª–æ–Ω—è–µ—Ç —á—Ç–µ–Ω–∏–µ

3. Read Index:
   - –ö–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π commitIndex —É –ª–∏–¥–µ—Ä–∞
   - –ñ–¥—ë—Ç, –ø–æ–∫–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞ –¥–æ–≥–æ–Ω–∏—Ç —ç—Ç–æ—Ç commitIndex
   - –ß–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
```

**–ü—Ä–æ–±–ª–µ–º–∞ 4: Partial commit –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
Client –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ Kafka ‚Üí
Kafka Leader –ø–æ–ª—É—á–∞–µ—Ç, —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –Ω–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ, –∫–æ–º–º–∏—Ç–∏—Ç ‚Üí
Kafka –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ACK –∫–ª–∏–µ–Ω—Ç—É ‚Üí
–°–µ—Ç—å –ø–∞–¥–∞–µ—Ç –º–µ–∂–¥—É Kafka –∏ Client ‚Üí
Client –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç ACK, –¥—É–º–∞–µ—Ç, —á—Ç–æ –∑–∞–ø–∏—Å—å –Ω–µ –ø—Ä–æ—à–ª–∞ ‚Üí
Client –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –∑–∞–ø–∏—Å—å ‚Üí
–î—É–±–ª–∏–∫–∞—Ç –≤ Kafka
```

–†–µ—à–µ–Ω–∏–µ:
```
Idempotent Producer (Kafka):
enable.idempotence=true
- Kafka –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –∫–∞–∂–¥–æ–º—É –ø—Ä–æ–¥—é—Å–µ—Ä—É —É–Ω–∏–∫–∞–ª—å–Ω—ã–π Producer ID
- –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–º–µ–µ—Ç Sequence Number
- Kafka –¥–µ–¥—É–ø–ª–∏—Ü–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º (Producer ID, Sequence Number)
```

### üõ†Ô∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—ã

**1. –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è commit –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö**

```
–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–ª–∞—Ç–µ–∂–∏, –∑–∞–∫–∞–∑—ã, —é—Ä–∏–¥–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º—ã–µ):
- Kafka: acks=all, min.insync.replicas=2
- MongoDB: writeConcern={ w: "majority", j: true }
- PostgreSQL: synchronous_commit=on, synchronous_standby_names='ANY 1 (...)'

–í–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç):
- Kafka: acks=all, min.insync.replicas=2
- MongoDB: writeConcern={ w: "majority" }
- PostgreSQL: synchronous_commit=local

–ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ª–æ–≥–∏, –º–µ—Ç—Ä–∏–∫–∏, –∫—ç—à–∏):
- Kafka: acks=1 –∏–ª–∏ acks=0
- MongoDB: writeConcern={ w: 1 }
- PostgreSQL: synchronous_commit=off
```

**2. –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ latency vs durability**

–ì—Ä–∞—Ñ–∏–∫:
```
Durability ‚Üí
‚îÇ
‚îÇ sync commit         ‚Üê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å
‚îÇ + all replicas        Latency: 50-200ms
‚îÇ
‚îÇ sync commit         ‚Üê –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –±–∞–ª–∞–Ω—Å
‚îÇ + majority            Latency: 10-50ms
‚îÇ
‚îÇ sync commit         ‚Üê –ü—Ä–∏–µ–º–ª–µ–º–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å
‚îÇ + local only          Latency: 1-10ms
‚îÇ
‚îÇ async commit        ‚Üê –†–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ                       Latency: < 1ms
‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí Latency

```

**3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ commit timeout**

–ü—Å–µ–≤–¥–æ–∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞:
```
try:
    database.insert(data, write_concern="majority", timeout=5s)
except TimeoutError:
    # –ù–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: –∑–∞–ø–∏—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å committed, –º–æ–∂–µ—Ç –Ω–µ—Ç

    # –ù–ï –ü–û–í–¢–û–†–Ø–¢–¨ –°–†–ê–ó–£!
    # (–º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –¥—É–±–ª–∏–∫–∞—Ç—É)

    # –í–∞—Ä–∏–∞–Ω—Ç—ã:
    1) –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∑–∞–ø–∏—Å–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID)
    2) –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (Kafka idempotent producer)
    3) –ó–∞–ø–∏—Å–∞—Ç—å –≤ –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É—é—â–∏–π –ª–æ–≥ –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
    4) –í–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–∑–∂–µ"
```

**4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ commit latency –∏ success rate**

–ú–µ—Ç—Ä–∏–∫–∏:
```
Kafka:
- request-latency-avg: —Å—Ä–µ–¥–Ω—è—è latency produce request
- record-send-rate: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π/—Å–µ–∫
- record-error-rate: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫/—Å–µ–∫

MongoDB:
- writeLatencyMicros (majority): latency –∑–∞–ø–∏—Å–∏ —Å majority write concern
- write operations failed (majority): –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π

PostgreSQL:
- pg_stat_database.xact_commit: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ committed —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- pg_stat_database.xact_rollback: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫–∞—Ç–æ–≤
- commit latency (custom metric): –≤—Ä–µ–º—è –æ—Ç BEGIN –¥–æ COMMIT OK
```

–ê–ª–µ—Ä—Ç—ã:
```
commit_latency_p99 > 1s  ‚Üí –ü—Ä–æ–±–ª–µ–º—ã —Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π –∏–ª–∏ —Å–µ—Ç—å—é
commit_error_rate > 1%   ‚Üí –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–µ–ø–ª–∏–∫ –∏–ª–∏ –∫–≤–æ—Ä—É–º–∞
uncommitted_lag > 10000  ‚Üí –§–æ–ª–ª–æ–≤–µ—Ä—ã —Å–∏–ª—å–Ω–æ –æ—Ç—Å—Ç–∞—é—Ç
```

---

## 4. Majority Agreement Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –ú–∞–∂–æ—Ä–∏—Ç–∞—Ä–Ω–æ–≥–æ –°–æ–≥–ª–∞—Å–∏—è)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Majority Agreement Semantics** (—Å–µ–º–∞–Ω—Ç–∏–∫–∞ –º–∞–∂–æ—Ä–∏—Ç–∞—Ä–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è –∏–ª–∏ –∫–≤–æ—Ä—É–º–∞) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —á—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –µ–≥–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **—Å—Ç—Ä–æ–≥–æ–µ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ** —É–∑–ª–æ–≤ ‚Äî –±–æ–ª–µ–µ –ø–æ–ª–æ–≤–∏–Ω—ã –æ—Ç –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞.

```
–ö–ª–∞—Å—Ç–µ—Ä –∏–∑ 5 —É–∑–ª–æ–≤:

–î–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è –Ω—É–∂–Ω–æ: ‚åà5/2‚åâ + 1 = 3 —É–∑–ª–∞

–°—Ü–µ–Ω–∞—Ä–∏–π 1 (–∫–≤–æ—Ä—É–º –¥–æ—Å—Ç–∏–≥–Ω—É—Ç):
Node-1: ‚úÖ –°–æ–≥–ª–∞—Å–µ–Ω
Node-2: ‚úÖ –°–æ–≥–ª–∞—Å–µ–Ω  } 3 —É–∑–ª–∞ —Å–æ–≥–ª–∞—Å–Ω—ã ‚Üí –†–µ—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ
Node-3: ‚úÖ –°–æ–≥–ª–∞—Å–µ–Ω
Node-4: ‚ùå –ü—Ä–æ—Ç–∏–≤
Node-5: ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω

–°—Ü–µ–Ω–∞—Ä–∏–π 2 (–∫–≤–æ—Ä—É–º–∞ –Ω–µ—Ç):
Node-1: ‚úÖ –°–æ–≥–ª–∞—Å–µ–Ω
Node-2: ‚úÖ –°–æ–≥–ª–∞—Å–µ–Ω  } –¢–æ–ª—å–∫–æ 2 —É–∑–ª–∞ ‚Üí –†–µ—à–µ–Ω–∏–µ –ù–ï –ø—Ä–∏–Ω—è—Ç–æ
Node-3: ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω
Node-4: ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω
Node-5: ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```

–ö–ª—é—á–µ–≤–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞: **Quorum = ‚åäN/2‚åã + 1** (–¥–ª—è N —É–∑–ª–æ–≤)

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏—è**: –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö –∫–≤–æ—Ä—É–º–∞ –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è –º–∏–Ω–∏–º—É–º –≤ –æ–¥–Ω–æ–º —É–∑–ª–µ
- **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å**: –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–∏–Ω—è—Ç—å –¥–≤–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—â–∏—Ö —Ä–µ—à–µ–Ω–∏—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **–¢–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫ –æ—Ç–∫–∞–∑–∞–º**: –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∂–∏—Ç—å –æ—Ç–∫–∞–∑ –º–µ–Ω—å—à–∏–Ω—Å—Ç–≤–∞ —É–∑–ª–æ–≤ (–¥–æ ‚åäN/2‚åã)
- **–ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ**: –µ—Å–ª–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω–æ, —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- **–ó–∞—â–∏—Ç–∞ –æ—Ç split-brain**: –∫–∞–∂–¥–∞—è partition —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞–∫—Å–∏–º—É–º –æ–¥–∏–Ω –∫–≤–æ—Ä—É–º
- **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å**: —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –æ–¥–Ω–æ–∑–Ω–∞—á–µ–Ω –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –≥–æ–ª–æ—Å–∞—Ö

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞**: –µ—Å–ª–∏ —É–ø–∞–ª–æ > N/2, —Å–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –æ–∂–∏–¥–∞–Ω–∏–µ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –º–µ–¥–ª–µ–Ω–Ω–µ–µ, —á–µ–º –æ–¥–Ω–æ–≥–æ —É–∑–ª–∞
- **–ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã—Ö partitions**: —É–∑–µ–ª –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –º–µ–Ω—å—à–µ, —á–µ–º –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ
- **–ù–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —É–∑–ª–æ–≤ –≤ –∫–≤–æ—Ä—É–º–µ**: —Å–∞–º—ã–π –º–µ–¥–ª–µ–Ω–Ω—ã–π —É–∑–µ–ª –≤ –∫–≤–æ—Ä—É–º–µ –∑–∞–º–µ–¥–ª—è–µ—Ç –≤—Å—é —Å–∏—Å—Ç–µ–º—É
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á–µ—Å—Ç–Ω–æ—Å—Ç—å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è**: —É–∑–ª—ã –¥–æ–ª–∂–Ω—ã —Å–ª–µ–¥–æ–≤–∞—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª—É (byzantine fault –≤–Ω–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è)

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**MongoDB Replica Set Voting**

MongoDB replica set –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤—ã–±–æ—Ä–æ–≤ Primary:
- –ö–∞–∂–¥—ã–π —É–∑–µ–ª –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –≥–æ–ª–æ—Å–∞ (votes: 1 –∏–ª–∏ votes: 0)
- –î–ª—è –ø–æ–±–µ–¥—ã –Ω–∞ –≤—ã–±–æ—Ä–∞—Ö –Ω—É–∂–Ω–æ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤
- –ú–∞–∫—Å–∏–º—É–º 7 voting members (–±–æ–ª—å—à–µ –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞)

–ü—Ä–∏–º–µ—Ä:
```
Replica Set –∏–∑ 5 —É–∑–ª–æ–≤:
Node-1 (votes: 1, priority: 2)
Node-2 (votes: 1, priority: 1)
Node-3 (votes: 1, priority: 1)
Node-4 (votes: 1, priority: 0)  ‚Üê –ù–µ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å Primary (priority=0)
Node-5 (votes: 1, priority: 0)  ‚Üê –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ

Primary –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –≤—ã–±–æ—Ä—ã:
- Node-1 –≥–æ–ª–æ—Å—É–µ—Ç –∑–∞ —Å–µ–±—è (1 –≥–æ–ª–æ—Å)
- Node-2 –≤–∏–¥–∏—Ç, —á—Ç–æ Node-1 –∏–º–µ–µ—Ç –±–æ–ª–µ–µ —Å–≤–µ–∂–∏–π oplog ‚Üí –≥–æ–ª–æ—Å—É–µ—Ç –∑–∞ Node-1 (2 –≥–æ–ª–æ—Å–∞)
- Node-3 –≥–æ–ª–æ—Å—É–µ—Ç –∑–∞ Node-1 (3 –≥–æ–ª–æ—Å–∞)
- Node-4 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- Node-5 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

Node-1 –ø–æ–ª—É—á–∏–ª 3 –∏–∑ 5 –≥–æ–ª–æ—Å–æ–≤ (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ) ‚Üí —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è Primary
```

Arbiter (–∞—Ä–±–∏—Ç—Ä):
```
Replica Set –∏–∑ 2 data-bearing nodes + 1 arbiter:
Node-1 (data): votes=1
Node-2 (data): votes=1
Arbiter (no data): votes=1  ‚Üê –ù–µ —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ, —Ç–æ–ª—å–∫–æ –≥–æ–ª–æ—Å—É–µ—Ç

–ó–∞—á–µ–º: —á—Ç–æ–±—ã –¥–æ—Å—Ç–∏—á—å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ (2 –∏–∑ 3) –±–µ–∑ —Ç—Ä–µ—Ç—å–µ–π –ø–æ–ª–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∏
–ú–∏–Ω—É—Å: –µ—Å–ª–∏ Node-1 –∏ Node-2 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã
```

**Kafka ISR –∏ Unclean Leader Election**

Kafka –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ISR (In-Sync Replicas) –∫–∞–∫ "–∫–≤–æ—Ä—É–º":
- –ó–∞–ø–∏—Å—å committed, –∫–æ–≥–¥–∞ –≤—Å–µ ISR –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏
- ISR ‚Äî —ç—Ç–æ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤—Å–µ—Ö —Ä–µ–ø–ª–∏–∫, –∫–æ—Ç–æ—Ä—ã–µ "–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–ª–∏–∑–∫–æ" –∫ –ª–∏–¥–µ—Ä—É
- –ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –ª–∏–¥–µ—Ä–∞ –Ω–æ–≤—ã–π –ª–∏–¥–µ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –∏–∑ ISR

–ù–∞—Å—Ç—Ä–æ–π–∫–∞:
```
unclean.leader.election.enable=false (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- –ù–æ–≤—ã–π –ª–∏–¥–µ—Ä —Ç–æ–ª—å–∫–æ –∏–∑ ISR
- –ï—Å–ª–∏ ISR –ø—É—Å—Ç ‚Üí –ø–∞—Ä—Ç–∏—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏
- –ì–∞—Ä–∞–Ω—Ç–∏—è: –Ω–µ—Ç –ø–æ—Ç–µ—Ä–∏ committed –¥–∞–Ω–Ω—ã—Ö

unclean.leader.election.enable=true (–æ–ø–∞—Å–Ω–æ)
- –ï—Å–ª–∏ ISR –ø—É—Å—Ç, –≤—ã–±—Ä–∞—Ç—å –ª–∏–¥–µ—Ä–∞ –∏–∑ non-ISR —Ä–µ–ø–ª–∏–∫
- –ü–∞—Ä—Ç–∏—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–∞ –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö
- Non-ISR —Ä–µ–ø–ª–∏–∫–∞ –æ—Ç—Å—Ç–∞–ª–∞ ‚Üí –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É HW –∏ –∫–æ–Ω–µ—Ü –ª–æ–≥–∞ –ª–∏–¥–µ—Ä–∞ –ø–æ—Ç–µ—Ä—è–Ω—ã
```

–ü—Ä–∏–º–µ—Ä unclean election:
```
Leader (broker-1):
Offset: 0...998  999  1000 1001 1002
               HW=999 (committed)

ISR Follower (broker-2): –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω
ISR Follower (broker-3): –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω

Non-ISR Follower (broker-4):
Offset: 0...998  999
              ‚Üë –û—Ç—Å—Ç–∞–ª –Ω–∞ 3 —Å–æ–æ–±—â–µ–Ω–∏—è

broker-1 –ø–∞–¥–∞–µ—Ç ‚Üí
ISR –ø—É—Å—Ç ‚Üí
unclean.leader.election.enable=true ‚Üí
broker-4 —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ª–∏–¥–µ—Ä–æ–º ‚Üí
Offsets 1000, 1001, 1002 –ø–æ—Ç–µ—Ä—è–Ω—ã –Ω–∞–≤—Å–µ–≥–¥–∞ (—Ö–æ—Ç—è 1000 –±—ã–ª committed!)
```

**etcd Raft Quorum**

etcd —Ä–µ–∞–ª–∏–∑—É–µ—Ç Raft, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç –∫–≤–æ—Ä—É–º –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:
- Write: —Ç—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –¥–ª—è commit
- Leader election: —Ç—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤
- Configuration change: —Ç—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ

–ü—Ä–∏–º–µ—Ä:
```
etcd cluster (5 nodes):
- –ö–≤–æ—Ä—É–º = 3 —É–∑–ª–∞
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∂–∏—Ç—å –ø–∞–¥–µ–Ω–∏–µ 2 —É–∑–ª–æ–≤

Client –ø–∏—à–µ—Ç –∫–ª—é—á:
1. Leader –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø–∏—Å—å
2. Leader —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –Ω–∞ —Ñ–æ–ª–ª–æ–≤–µ—Ä–æ–≤
3. Leader –∂–¥—ë—Ç ACK –æ—Ç 2 —Ñ–æ–ª–ª–æ–≤–µ—Ä–æ–≤ (–≤—Å–µ–≥–æ 3 —Å —Å–æ–±–æ–π)
4. Leader –∫–æ–º–º–∏—Ç–∏—Ç –∑–∞–ø–∏—Å—å
5. Leader –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç OK –∫–ª–∏–µ–Ω—Ç—É

Network partition:
–°–µ–≥–º–µ–Ω—Ç A (3 —É–∑–ª–∞) ‚Üí –ò–º–µ–µ—Ç –∫–≤–æ—Ä—É–º ‚Üí –†–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
–°–µ–≥–º–µ–Ω—Ç B (2 —É–∑–ª–∞) ‚Üí –ù–µ—Ç –∫–≤–æ—Ä—É–º–∞ ‚Üí –ù–µ –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å ‚ùå
```

**Consul Consensus**

Consul —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Raft –∏ –∫–≤–æ—Ä—É–º:
- –î–ª—è Service Discovery: –∑–∞–ø—Ä–æ—Å—ã –æ–±—Å–ª—É–∂–∏–≤–∞—é—Ç—Å—è –ª—é–±—ã–º —É–∑–ª–æ–º (eventually consistent —á—Ç–µ–Ω–∏–µ)
- –î–ª—è KV store: –∑–∞–ø–∏—Å–∏ —Ç—Ä–µ–±—É—é—Ç –∫–≤–æ—Ä—É–º–∞

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ consistency mode –¥–ª—è —á—Ç–µ–Ω–∏—è:
```
default (eventual consistency)
- –ß–∏—Ç–∞—Ç—å —Å –ª—é–±–æ–≥–æ —É–∑–ª–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω –Ω–µ –ª–∏–¥–µ—Ä
- –ë—ã—Å—Ç—Ä–æ, –Ω–æ –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ

consistent
- –ß–∏—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å –ª–∏–¥–µ—Ä–∞
- –õ–∏–¥–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–≤–æ—Ä—É–º –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º
- –ú–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ

stale
- –ß–∏—Ç–∞—Ç—å —Å –ª—é–±–æ–≥–æ —É–∑–ª–∞, –¥–∞–∂–µ —Å–∏–ª—å–Ω–æ –æ—Ç—Å—Ç–∞–≤—à–µ–≥–æ
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```

**Redis Cluster –∏ Redis Sentinel**

Redis —Å–∞–º –ø–æ —Å–µ–±–µ –Ω–µ –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –∫–≤–æ—Ä—É–º–∞ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, –Ω–æ:

Redis Sentinel (–¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ failover):
- –ù–µ—Å–∫–æ–ª—å–∫–æ Sentinel –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Å–ª–µ–¥—è—Ç –∑–∞ Redis –º–∞—Å—Ç–µ—Ä–æ–º
- –î–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è –º–∞—Å—Ç–µ—Ä–∞ "down" –Ω—É–∂–Ω–æ –∫–≤–æ—Ä—É–º Sentinel'–æ–≤ (quorum)
- –î–ª—è –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∏—è failover –Ω—É–∂–Ω–æ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≤—Å–µ—Ö Sentinel'–æ–≤

–ü—Ä–∏–º–µ—Ä:
```
Redis Master + 2 Replicas
3 Sentinel –ø—Ä–æ—Ü–µ—Å—Å–∞ (quorum=2)

Sentinel-1: –í–∏–¥–∏—Ç, —á—Ç–æ Master –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
Sentinel-2: –í–∏–¥–∏—Ç, —á—Ç–æ Master –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω  } –ö–≤–æ—Ä—É–º –¥–æ—Å—Ç–∏–≥–Ω—É—Ç (2 –∏–∑ 3)
Sentinel-3: –ï—â—ë –Ω–µ –ø—Ä–æ–≤–µ—Ä–∏–ª

Sentinel-1 –∏ Sentinel-2 —Å–æ–≥–ª–∞—Å–Ω—ã ‚Üí Master –æ–±—ä—è–≤–ª–µ–Ω "down"
Sentinel'—ã –≥–æ–ª–æ—Å—É—é—Ç –∑–∞ failover ‚Üí –ù—É–∂–Ω–æ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ (2 –∏–∑ 3) ‚Üí Failover –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è
```

Redis Cluster (sharded):
- –ö–∞–∂–¥—ã–π shard –∏–º–µ–µ—Ç –º–∞—Å—Ç–µ—Ä + —Ä–µ–ø–ª–∏–∫–∏
- –ù–ï–¢ –∫–≤–æ—Ä—É–º–∞ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö (–º–∞—Å—Ç–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –µ–¥–∏–Ω–æ–ª–∏—á–Ω–æ)
- –ï—Å—Ç—å –∫–≤–æ—Ä—É–º –¥–ª—è cluster membership (–≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ —É–∑–ª–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞)

### üö® –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞ 1: –ß—ë—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ (2, 4, 6...)**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
–ö–ª–∞—Å—Ç–µ—Ä –∏–∑ 4 —É–∑–ª–æ–≤:

–ö–≤–æ—Ä—É–º = 3 —É–∑–ª–∞
–¢–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫ –æ—Ç–∫–∞–∑–∞–º = 1 —É–∑–µ–ª (–º–æ–∂–Ω–æ –ø–æ—Ç–µ—Ä—è—Ç—å –º–∞–∫—Å–∏–º—É–º 1)

–°—Ä–∞–≤–Ω–∏–º —Å 3 —É–∑–ª–∞–º–∏:
–ö–≤–æ—Ä—É–º = 2 —É–∑–ª–∞
–¢–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫ –æ—Ç–∫–∞–∑–∞–º = 1 —É–∑–µ–ª (–º–æ–∂–Ω–æ –ø–æ—Ç–µ—Ä—è—Ç—å –º–∞–∫—Å–∏–º—É–º 1)

–í—ã–≤–æ–¥: 4 —É–∑–ª–∞ –¥–æ—Ä–æ–∂–µ (–±–æ–ª—å—à–µ –∂–µ–ª–µ–∑–∞), –Ω–æ —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å —Ç–∞–∫–∞—è –∂–µ, –∫–∞–∫ —É 3!
```

–¢–∞–±–ª–∏—Ü–∞:
```
N —É–∑–ª–æ–≤ | –ö–≤–æ—Ä—É–º | –ú–∞–∫—Å –æ—Ç–∫–∞–∑–æ–≤ | –°—Ç–æ–∏–º–æ—Å—Ç—å
--------|--------|--------------|----------
   1    |   1    |      0       |    1x
   2    |   2    |      0       |    2x  ‚Üê –ë–µ—Å–ø–æ–ª–µ–∑–Ω–æ!
   3    |   2    |      1       |    3x  ‚Üê –û–ø—Ç–∏–º–∞–ª—å–Ω–æ
   4    |   3    |      1       |    4x  ‚Üê –î–æ—Ä–æ–≥–æ –∑–∞ —Ç—É –∂–µ —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å
   5    |   3    |      2       |    5x  ‚Üê –û–ø—Ç–∏–º–∞–ª—å–Ω–æ
   6    |   4    |      2       |    6x  ‚Üê –î–æ—Ä–æ–≥–æ
   7    |   4    |      3       |    7x  ‚Üê –û–ø—Ç–∏–º–∞–ª—å–Ω–æ
```

–í—ã–≤–æ–¥: **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –Ω–µ—á—ë—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ (3, 5, 7)**.

–ò—Å–∫–ª—é—á–µ–Ω–∏–µ: 2 —É–∑–ª–∞ + 1 –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π arbiter (MongoDB) –∏–ª–∏ witness (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–∏—Å—Ç–µ–º—ã).

**–ü—Ä–æ–±–ª–µ–º–∞ 2: Asymmetric Network Partition**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
–ö–ª–∞—Å—Ç–µ—Ä –∏–∑ 5 —É–∑–ª–æ–≤:

Node-1 [LEADER] –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å: Node-2, Node-3 (–≤—Å–µ–≥–æ 3 —É–∑–ª–∞, –µ—Å—Ç—å –∫–≤–æ—Ä—É–º) ‚úÖ
Node-4 –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å: Node-5 (–≤—Å–µ–≥–æ 2 —É–∑–ª–∞, –Ω–µ—Ç –∫–≤–æ—Ä—É–º–∞) ‚ùå
Node-5 –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å: Node-4 (–≤—Å–µ–≥–æ 2 —É–∑–ª–∞, –Ω–µ—Ç –∫–≤–æ—Ä—É–º–∞) ‚ùå

–ê—Å–∏–º–º–µ—Ç—Ä–∏—è:
- Node-4 –Ω–µ –≤–∏–¥–∏—Ç Node-1, –Ω–æ Node-1 –≤–∏–¥–∏—Ç Node-4? –ù–ï–¢

–†–µ–∞–ª—å–Ω–∞—è –∞—Å–∏–º–º–µ—Ç—Ä–∏—è (–±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è):
Node-1 –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ Node-4, –Ω–æ –Ω–µ –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç (–æ–¥–Ω–æ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å–≤—è–∑—å)
```

–ü—Ä–∏–º–µ—Ä —Å AWS:
```
5 —É–∑–ª–æ–≤ –≤ 3 AZ:
AZ-1: Node-1, Node-2
AZ-2: Node-3
AZ-3: Node-4, Node-5

–°–µ—Ç—å –º–µ–∂–¥—É AZ-1 –∏ AZ-3 –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞ (–ø–∞–∫–µ—Ç—ã —Ç–µ—Ä—è—é—Ç—Å—è) ‚Üí
Node-1 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç heartbeat Node-4 ‚Üí
Node-4 –ø–æ–ª—É—á–∞–µ—Ç, –Ω–æ –µ–≥–æ ACK —Ç–µ—Ä—è–µ—Ç—Å—è ‚Üí
Node-1 –¥—É–º–∞–µ—Ç, —á—Ç–æ Node-4 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí
Node-4 –¥—É–º–∞–µ—Ç, —á—Ç–æ –≤—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ

–†–µ–∑—É–ª—å—Ç–∞—Ç:
Node-1 –º–æ–∂–µ—Ç –Ω–µ —Å—á–∏—Ç–∞—Ç—å Node-4 –¥–ª—è –∫–≤–æ—Ä—É–º–∞ ‚Üí
Node-1 –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ Node-1, Node-2, Node-3 (3 —É–∑–ª–∞, –∫–≤–æ—Ä—É–º –µ—Å—Ç—å) ‚úÖ
```

**–ü—Ä–æ–±–ª–µ–º–∞ 3: –ö–≤–æ—Ä—É–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –º–µ–¥–ª–µ–Ω–Ω—ã–º —É–∑–ª–æ–º**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
MongoDB, writeConcern: { w: "majority" }

Replica Set –∏–∑ 5 —É–∑–ª–æ–≤:
Node-1 [PRIMARY]: SSD, 10ms latency
Node-2: SSD, 10ms latency
Node-3: HDD, 500ms latency ‚Üê –ú–µ–¥–ª–µ–Ω–Ω—ã–π –¥–∏—Å–∫ üêå
Node-4: SSD, 10ms latency
Node-5: –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚ùå

–î–ª—è majority –Ω—É–∂–Ω–æ 3 —É–∑–ª–∞ (–≤–∫–ª—é—á–∞—è Primary)
Primary –ø–∏—à–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ (10ms) + –∂–¥—ë—Ç ACK –æ—Ç 2 secondaries

–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞:
- Node-2 (10ms) + Node-4 (10ms) ‚Üí OK —á–µ—Ä–µ–∑ ~20ms ‚úÖ
- Node-2 (10ms) + Node-3 (500ms) ‚Üí OK —á–µ—Ä–µ–∑ ~500ms üêå
- Node-3 (500ms) + Node-4 (10ms) ‚Üí OK —á–µ—Ä–µ–∑ ~500ms üêå

–ï—Å–ª–∏ Node-2 –∏–ª–∏ Node-4 –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã ‚Üí
Primary –≤—ã–Ω—É–∂–¥–µ–Ω –∂–¥–∞—Ç—å Node-3 ‚Üí
Latency –∑–∞–ø–∏—Å–∏ –¥–µ–≥—Ä–∞–¥–∏—Ä—É–µ—Ç –¥–æ 500ms
```

–†–µ—à–µ–Ω–∏–µ:
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ replication lag –ø–æ –∫–∞–∂–¥–æ–º—É —É–∑–ª—É
- –ê–ª–µ—Ä—Ç, –µ—Å–ª–∏ –∫–∞–∫–æ–π-—Ç–æ —É–∑–µ–ª —Å—Ç–∞–±–∏–ª—å–Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
- –ê–ø–≥—Ä–µ–π–¥ –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —É–∑–ª–∞ –∏–ª–∏ –µ–≥–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç=0, votes=0)

**–ü—Ä–æ–±–ª–µ–º–∞ 4: Flapping quorum –ø—Ä–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Å–µ—Ç–∏**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
–ö–ª–∞—Å—Ç–µ—Ä –∏–∑ 3 —É–∑–ª–æ–≤, –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Å–µ—Ç—å –º–µ–∂–¥—É Node-2 –∏ Node-3:

12:00:00 - Node-1 [LEADER], Node-2 [FOLLOWER], Node-3 [FOLLOWER]
           –ö–≤–æ—Ä—É–º: Node-1, Node-2, Node-3 ‚úÖ

12:00:10 - –°–µ—Ç—å –º–µ–∂–¥—É Node-2 –∏ Node-3 –ø–∞–¥–∞–µ—Ç
           Node-1 –≤–∏–¥–∏—Ç: Node-1, Node-2 (–∫–≤–æ—Ä—É–º ‚úÖ)
           Node-1 –≤–∏–¥–∏—Ç: Node-1, Node-3 (–∫–≤–æ—Ä—É–º ‚úÖ)
           –ù–æ Node-2 –∏ Node-3 –Ω–µ –≤–∏–¥—è—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞

12:00:20 - Node-1 –ø–∞–¥–∞–µ—Ç
           Node-2 –≤–∏–¥–∏—Ç: Node-2 (–Ω–µ—Ç –∫–≤–æ—Ä—É–º–∞ ‚ùå)
           Node-3 –≤–∏–¥–∏—Ç: Node-3 (–Ω–µ—Ç –∫–≤–æ—Ä—É–º–∞ ‚ùå)
           –ö–ª–∞—Å—Ç–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!

12:00:30 - –°–µ—Ç—å –º–µ–∂–¥—É Node-2 –∏ Node-3 –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
           Node-2 –≤–∏–¥–∏—Ç: Node-2, Node-3 (–∫–≤–æ—Ä—É–º ‚úÖ)
           –ù–æ–≤—ã–µ –≤—ã–±–æ—Ä—ã ‚Üí Node-2 —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ª–∏–¥–µ—Ä–æ–º

12:00:40 - Node-1 –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
           Node-1 –≤–∏–¥–∏—Ç —Å–≤–æ–π term —É—Å—Ç–∞—Ä–µ–≤—à–∏–π ‚Üí —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è follower
```

–ü—Ä–æ–±–ª–µ–º–∞: –∫–ª–∞—Å—Ç–µ—Ä –±—ã–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω 10 —Å–µ–∫—É–Ω–¥ –∏–∑-–∑–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å–µ—Ç–µ–≤–æ–≥–æ —Å–±–æ—è + –ø–∞–¥–µ–Ω–∏—è —É–∑–ª–∞.

–†–µ—à–µ–Ω–∏–µ:
- –†–∞–∑–º–µ—â–∞—Ç—å —É–∑–ª—ã –≤ —Ä–∞–∑–Ω—ã—Ö AZ –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ–µ–≤
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–µ–≤–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏
- –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ (5 –≤–º–µ—Å—Ç–æ 3) –¥–ª—è –±–æ–ª—å—à–µ–π —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç–∏

### üõ†Ô∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—ã

**1. –†–∞–∑–º–µ—â–µ–Ω–∏–µ —É–∑–ª–æ–≤ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏**

–¶–µ–ª—å: –ª—é–±–∞—è –æ–¥–Ω–∞ failure domain (AZ, –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä, region) –º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å, –Ω–æ –∫–≤–æ—Ä—É–º –æ—Å—Ç–∞—ë—Ç—Å—è.

3 —É–∑–ª–∞:
```
–í–∞—Ä–∏–∞–Ω—Ç 1 (–≤—Å–µ –≤ –æ–¥–Ω–æ–π AZ): ‚ùå
AZ-1: Node-1, Node-2, Node-3
‚Üí AZ-1 –ø–∞–¥–∞–µ—Ç ‚Üí –ø–æ—Ç–µ—Ä—è –≤—Å–µ—Ö —É–∑–ª–æ–≤ ‚Üí –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

–í–∞—Ä–∏–∞–Ω—Ç 2 (3 AZ): ‚úÖ
AZ-1: Node-1
AZ-2: Node-2
AZ-3: Node-3
‚Üí –õ—é–±–∞—è AZ –ø–∞–¥–∞–µ—Ç ‚Üí 2 —É–∑–ª–∞ –¥–æ—Å—Ç—É–ø–Ω—ã ‚Üí –∫–≤–æ—Ä—É–º –µ—Å—Ç—å
```

5 —É–∑–ª–æ–≤:
```
–í–∞—Ä–∏–∞–Ω—Ç 1 (3 AZ, —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ): ‚ùå –ü—Ä–æ–±–ª–µ–º–∞!
AZ-1: Node-1, Node-2 (2 —É–∑–ª–∞)
AZ-2: Node-3 (1 —É–∑–µ–ª)
AZ-3: Node-4, Node-5 (2 —É–∑–ª–∞)
‚Üí AZ-1 –ø–∞–¥–∞–µ—Ç ‚Üí –æ—Å—Ç–∞—ë—Ç—Å—è 3 —É–∑–ª–∞ (–∫–≤–æ—Ä—É–º –µ—Å—Ç—å) ‚úÖ
‚Üí AZ-2 –ø–∞–¥–∞–µ—Ç ‚Üí –æ—Å—Ç–∞—ë—Ç—Å—è 4 —É–∑–ª–∞ (–∫–≤–æ—Ä—É–º –µ—Å—Ç—å) ‚úÖ
‚Üí AZ-3 –ø–∞–¥–∞–µ—Ç ‚Üí –æ—Å—Ç–∞—ë—Ç—Å—è 3 —É–∑–ª–∞ (–∫–≤–æ—Ä—É–º –µ—Å—Ç—å) ‚úÖ
‚Üí –ù–æ! AZ-1 –∏ AZ-2 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–∞–¥–∞—é—Ç ‚Üí –æ—Å—Ç–∞—ë—Ç—Å—è 2 —É–∑–ª–∞ (–Ω–µ—Ç –∫–≤–æ—Ä—É–º–∞) ‚ùå

–í–∞—Ä–∏–∞–Ω—Ç 2 (3 AZ, –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Å tie-breaker): ‚úÖ
AZ-1: Node-1, Node-2 (2 —É–∑–ª–∞)
AZ-2: Node-3, Node-4 (2 —É–∑–ª–∞)
AZ-3: Node-5 (1 —É–∑–µ–ª - tie-breaker)
‚Üí –õ—é–±–∞—è –æ–¥–Ω–∞ AZ –ø–∞–¥–∞–µ—Ç ‚Üí –º–∏–Ω–∏–º—É–º 3 —É–∑–ª–∞ –¥–æ—Å—Ç—É–ø–Ω—ã ‚Üí –∫–≤–æ—Ä—É–º –µ—Å—Ç—å
‚Üí –î–≤–µ AZ –ø–∞–¥–∞—é—Ç ‚Üí –º–∏–Ω–∏–º—É–º 1 —É–∑–µ–ª (–Ω–µ—Ç –∫–≤–æ—Ä—É–º–∞, –Ω–æ —ç—Ç–æ –∫—Ä–∞–π–Ω–µ —Ä–µ–¥–∫–æ)
```

Geo-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (5 —É–∑–ª–æ–≤, 3 —Ä–µ–≥–∏–æ–Ω–∞):
```
Region-US (primary): Node-1, Node-2
Region-EU (secondary): Node-3, Node-4
Region-ASIA (tie-breaker): Node-5

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- Disaster recovery: —Ä–µ–≥–∏–æ–Ω –º–æ–∂–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–ø–∞—Å—Ç—å, –∫–≤–æ—Ä—É–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è
- Latency: –≤ US –∏ EU –µ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ–ø–ª–∏–∫–∏ –¥–ª—è —á—Ç–µ–Ω–∏—è

–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
- Latency –∑–∞–ø–∏—Å–∏: –Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å ACK —á–µ—Ä–µ–∑ –æ–∫–µ–∞–Ω (100-200ms)
- –°—Ç–æ–∏–º–æ—Å—Ç—å: –º–µ–∂—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫ –¥–æ—Ä–æ–≥–æ–π
```

**2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–≤–æ—Ä—É–º–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö consistency/availability –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–æ–≤**

–§–æ—Ä–º—É–ª–∞: **R + W > N** (–¥–ª—è —Å—Ç—Ä–æ–≥–æ–π –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏)

–ì–¥–µ:
- R ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ –¥–ª—è —á—Ç–µ–Ω–∏—è
- W ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ –¥–ª—è –∑–∞–ø–∏—Å–∏
- N ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤

–ü—Ä–∏–º–µ—Ä—ã:
```
N=3, W=2, R=2 (R + W > N: 2 + 2 > 3 ‚úÖ)
- –ó–∞–ø–∏—Å—å: –∂–¥–∞—Ç—å 2 —É–∑–ª–æ–≤
- –ß—Ç–µ–Ω–∏–µ: —á–∏—Ç–∞—Ç—å —Å 2 —É–∑–ª–æ–≤ –∏ –±—Ä–∞—Ç—å —Å–∞–º—É—é —Å–≤–µ–∂—É—é –≤–µ—Ä—Å–∏—é
- –ì–∞—Ä–∞–Ω—Ç–∏—è: —á—Ç–µ–Ω–∏–µ –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–ø–∏—Å—å (—Å—Ç—Ä–æ–≥–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)

N=3, W=3, R=1 (R + W > N: 1 + 3 > 3 ‚úÖ)
- –ó–∞–ø–∏—Å—å: –∂–¥–∞—Ç—å –≤—Å–µ 3 —É–∑–ª–∞ (–º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–æ –Ω–∞–¥—ë–∂–Ω–æ)
- –ß—Ç–µ–Ω–∏–µ: —á–∏—Ç–∞—Ç—å —Å 1 —É–∑–ª–∞ (–±—ã—Å—Ç—Ä–æ)
- Use case: Write-once, read-many (–∞—Ä—Ö–∏–≤—ã, –ª–æ–≥–∏)

N=3, W=1, R=3 (R + W > N: 3 + 1 > 3 ‚úÖ)
- –ó–∞–ø–∏—Å—å: –ø–∏—Å–∞—Ç—å –Ω–∞ 1 —É–∑–µ–ª (–±—ã—Å—Ç—Ä–æ, –Ω–æ –Ω–µ–Ω–∞–¥—ë–∂–Ω–æ)
- –ß—Ç–µ–Ω–∏–µ: —á–∏—Ç–∞—Ç—å —Å–æ –≤—Å–µ—Ö 3 —É–∑–ª–æ–≤ (–º–µ–¥–ª–µ–Ω–Ω–æ)
- Use case: Read-heavy, eventual consistency –¥–æ–ø—É—Å—Ç–∏–º–∞

N=3, W=1, R=1 (R + W > N: 1 + 1 > 3 ‚ùå)
- Eventual consistency
- –ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –∏ —á—Ç–µ–Ω–∏—è
- –ù–æ —á—Ç–µ–Ω–∏–µ –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ
```

Cassandra –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —ç—Ç–æ:
```
Consistency Level –¥–ª—è –∑–∞–ø–∏—Å–∏:
ONE, TWO, THREE, QUORUM, ALL, LOCAL_QUORUM, EACH_QUORUM

Consistency Level –¥–ª—è —á—Ç–µ–Ω–∏—è:
ONE, TWO, THREE, QUORUM, ALL, LOCAL_QUORUM

–ü—Ä–∏–º–µ—Ä:
Write: QUORUM (2 –∏–∑ 3)
Read: QUORUM (2 –∏–∑ 3)
‚Üí –°—Ç—Ä–æ–≥–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, –±–∞–ª–∞–Ω—Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```

**3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–≤–æ—Ä—É–º–∞ –∏ –∞–ª–µ—Ä—Ç—ã**

–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
```
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ live —É–∑–ª–æ–≤:
- Alerting: live_nodes <= quorum (–Ω–∞–ø—Ä–∏–º–µ—Ä, <= 2 –¥–ª—è 3 —É–∑–ª–æ–≤)
- Critical: live_nodes < quorum (–∫–ª–∞—Å—Ç–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)

–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ –≤ ISR (Kafka):
- Warning: ISR < replication_factor (–∫—Ç–æ-—Ç–æ –æ—Ç—Å—Ç–∞–ª)
- Critical: ISR < min.insync.replicas (–Ω–µ–ª—å–∑—è –ø–∏—Å–∞—Ç—å)

Replication lag:
- Warning: lag > 10 —Å–µ–∫—É–Ω–¥ (—É–∑–µ–ª –æ—Ç—Å—Ç–∞—ë—Ç, –º–æ–∂–µ—Ç –≤—ã–ø–∞—Å—Ç—å –∏–∑ –∫–≤–æ—Ä—É–º–∞)
- Critical: lag > 60 —Å–µ–∫—É–Ω–¥ (—É–∑–µ–ª –ø–æ—á—Ç–∏ –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç)

Election frequency:
- Warning: > 1 –≤—ã–±–æ—Ä–æ–≤ –≤ —á–∞—Å (–Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å)
- Critical: > 5 –≤—ã–±–æ—Ä–æ–≤ –≤ —á–∞—Å (—Å–µ—Ä—å—ë–∑–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å–µ—Ç–∏ –∏–ª–∏ —É–∑–ª–æ–≤)
```

–î–∞—à–±–æ—Ä–¥:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Cluster Health                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Total Nodes: 5                      ‚îÇ
‚îÇ Live Nodes:  5 ‚úÖ                   ‚îÇ
‚îÇ Quorum:      3                      ‚îÇ
‚îÇ Status:      HEALTHY ‚úÖ             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Nodes                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Node-1 [LEADER]   lag: 0ms      ‚úÖ ‚îÇ
‚îÇ Node-2 [FOLLOWER] lag: 5ms      ‚úÖ ‚îÇ
‚îÇ Node-3 [FOLLOWER] lag: 8ms      ‚úÖ ‚îÇ
‚îÇ Node-4 [FOLLOWER] lag: 450ms    ‚ö†Ô∏è  ‚îÇ ‚Üê –ú–µ–¥–ª–µ–Ω–Ω—ã–π
‚îÇ Node-5 [FOLLOWER] lag: 12ms     ‚úÖ ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ (Chaos Engineering)**

–°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```
1. –ü—Ä–æ—Å—Ç–æ–π failover:
   - –£–±–∏—Ç—å –ª–∏–¥–µ—Ä–∞ (kill -9)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –Ω–æ–≤—ã–π –ª–∏–¥–µ—Ä –≤—ã–±—Ä–∞–Ω –∑–∞ < election timeout
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –Ω–µ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

2. Network partition:
   - –†–∞–∑–¥–µ–ª–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä –Ω–∞ 2 —Å–µ–≥–º–µ–Ω—Ç–∞ (iptables drop)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: —Ç–æ–ª—å–∫–æ —Å–µ–≥–º–µ–Ω—Ç —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –º–µ–Ω—å—à–∏–π —Å–µ–≥–º–µ–Ω—Ç –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø–∏—Å–∏
   - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ç—å ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–æ—Å—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

3. Slow node:
   - –î–æ–±–∞–≤–∏—Ç—å latency –Ω–∞ –æ–¥–∏–Ω —É–∑–µ–ª (tc qdisc add delay 500ms)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –∫–≤–æ—Ä—É–º –≤—Å—ë –µ—â—ë –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –¥—Ä—É–≥–∏–µ —É–∑–ª—ã
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –º–µ–¥–ª–µ–Ω–Ω—ã–π —É–∑–µ–ª –Ω–µ –∑–∞–º–µ–¥–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º—É –∫—Ä–∏—Ç–∏—á–Ω–æ

4. Rolling restart:
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —É–∑–ª—ã –ø–æ –æ—á–µ—Ä–µ–¥–∏ (–ø–æ –æ–¥–Ω–æ–º—É)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –∫–ª–∞—Å—Ç–µ—Ä –æ—Å—Ç–∞—ë—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º –≤—Å—ë –≤—Ä–µ–º—è
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –Ω–µ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

5. –ü–æ–ª–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞:
   - –£–±–∏—Ç—å –≤—Å–µ —É–∑–ª—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
   - –ü–æ–¥–Ω—è—Ç—å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É–∑–ª–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –∫–ª–∞—Å—Ç–µ—Ä –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –≤—Å–µ committed –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
```

---

## 5. Safety Guarantees (–ì–∞—Ä–∞–Ω—Ç–∏–∏ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Safety Guarantees** (–≥–∞—Ä–∞–Ω—Ç–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏) ‚Äî —ç—Ç–æ —Å–≤–æ–π—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç, —á—Ç–æ **–ø–ª–æ—Ö–æ–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç**. Safety ‚Äî —ç—Ç–æ –ø—Ä–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å: —Å–∏—Å—Ç–µ–º–∞ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–µ—Ä–Ω—ë—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –¥–∞–∂–µ –ø—Ä–∏ —Å–±–æ—è—Ö.

–í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞ Safety –æ–∑–Ω–∞—á–∞–µ—Ç:
- **–ù–∏–∫–æ–≥–¥–∞** –Ω–µ –±—É–¥–µ—Ç –¥–≤—É—Ö —Ä–∞–∑–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π committed –¥–ª—è –æ–¥–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ –ª–æ–≥–∞
- **–ù–∏–∫–æ–≥–¥–∞** –Ω–µ –±—É–¥–µ—Ç –¥–≤—É—Ö –ª–∏–¥–µ—Ä–æ–≤ –≤ –æ–¥–∏–Ω term
- **–ù–∏–∫–æ–≥–¥–∞** committed –¥–∞–Ω–Ω—ã–µ –Ω–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∫–≤–æ—Ä—É–º–∞)
- **–ù–∏–∫–æ–≥–¥–∞** —É–∑–ª—ã –Ω–µ —Ä–∞–∑–æ–π–¥—É—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏ committed –æ–ø–µ—Ä–∞—Ü–∏–π

–ê–Ω–∞–ª–æ–≥–∏—è:
```
–ë–∞–Ω–∫: "–ú—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–ø–∏—à–µ–º –¥–µ–Ω—å–≥–∏ –¥–≤–∞–∂–¥—ã" ‚Üê Safety
–ë–∞–Ω–∫: "–ú—ã –≤—Å–µ–≥–¥–∞ –æ–±—Ä–∞–±–æ—Ç–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é" ‚Üê Liveness (–Ω–µ Safety)
```

Safety –Ω–∞—Ä—É—à–∞–µ—Ç—Å—è —Ä–µ–¥–∫–æ, –Ω–æ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∏:
- üíÄ –î–µ–Ω—å–≥–∏ —Å–ø–∏—Å–∞–Ω—ã –¥–≤–∞–∂–¥—ã
- üî• –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π
- üí∏ –ó–∞–∫–∞–∑ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –¥–≤–∞–∂–¥—ã
- üé≠ –î–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—É—á–∏–ª–∏ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç (–æ—Å–Ω–æ–≤–Ω—ã–µ Safety —Å–≤–æ–π—Å—Ç–≤–∞ Raft/Paxos)

**1. Election Safety**
- –í –æ–¥–∏–Ω term –º–æ–∂–µ—Ç –±—ã—Ç—å –º–∞–∫—Å–∏–º—É–º –æ–¥–∏–Ω –ª–∏–¥–µ—Ä
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ, —á—Ç–æ–±—ã –¥–≤–∞ —É–∑–ª–∞ —Å—á–∏—Ç–∞–ª–∏ —Å–µ–±—è –ª–∏–¥–µ—Ä–∞–º–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º term

**2. Leader Append-Only**
- –õ–∏–¥–µ—Ä –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É–¥–∞–ª—è–µ—Ç –∏ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ —Å–≤–æ—ë–º –ª–æ–≥–µ
- –õ–∏–¥–µ—Ä —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –≤ –∫–æ–Ω–µ—Ü

**3. Log Matching**
- –ï—Å–ª–∏ –¥–≤–∞ –ª–æ–≥–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç –∑–∞–ø–∏—Å—å —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –∏–Ω–¥–µ–∫—Å–æ–º –∏ term, —Ç–æ:
  - –≠—Ç–∏ –∑–∞–ø–∏—Å–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã
  - –í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –æ–±–æ–∏—Ö –ª–æ–≥–∞—Ö –∏–¥–µ–Ω—Ç–∏—á–Ω—ã

**4. Leader Completeness**
- –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å committed –≤ term T, —Ç–æ –æ–Ω–∞ –±—É–¥–µ—Ç –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –ª–æ–≥–µ –∫–∞–∂–¥–æ–≥–æ –ª–∏–¥–µ—Ä–∞ –≤ term > T
- –ù–æ–≤—ã–π –ª–∏–¥–µ—Ä **–≤—Å–µ–≥–¥–∞** —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ committed –∑–∞–ø–∏—Å–∏

**5. State Machine Safety**
- –ï—Å–ª–∏ —É–∑–µ–ª –ø—Ä–∏–º–µ–Ω–∏–ª –∑–∞–ø–∏—Å—å —Å –∏–Ω–¥–µ–∫—Å–æ–º N –∫ —Å–≤–æ–µ–π state machine, –Ω–∏–∫–∞–∫–æ–π –¥—Ä—É–≥–æ–π —É–∑–µ–ª –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏—Ç –¥—Ä—É–≥—É—é –∑–∞–ø–∏—Å—å –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞ N
- –í—Å–µ —É–∑–ª—ã, –ø—Ä–∏–º–µ–Ω—è—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –ª–æ–≥, –ø—Ä–∏—Ö–æ–¥—è—Ç –∫ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å**: safety –Ω–µ –æ–±–µ—â–∞–µ—Ç, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (—ç—Ç–æ liveness)
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: safety –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –º–µ–¥–ª–µ–Ω–Ω–æ
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç –≤–∏–∑–∞–Ω—Ç–∏–π—Å–∫–∏—Ö –æ—Ç–∫–∞–∑–æ–≤**: –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ —É–∑–ª—ã —Å–ª–µ–¥—É—é—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª—É
- **–ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –æ—à–∏–±–æ–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**: –∫–æ–Ω—Å–µ–Ω—Å—É—Å –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω, –Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–∞–≥gy
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞**: safety —Ç—Ä–µ–±—É–µ—Ç –∫–≤–æ—Ä—É–º–∞

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**Kafka Leader Epoch (–∑–∞—â–∏—Ç–∞ –æ—Ç zombie leaders)**

–ü—Ä–æ–±–ª–µ–º–∞:
```
Old Leader (broker-1) –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π partition:
- –°—á–∏—Ç–∞–µ—Ç —Å–µ–±—è –ª–∏–¥–µ—Ä–æ–º
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø–∏—Å—å –æ—Ç –ø—Ä–æ–¥—é—Å–µ—Ä–∞
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ
- –ù–µ –º–æ–∂–µ—Ç –¥–æ—Å—Ç–∏—á—å ISR (–æ–Ω–∏ –≤ –¥—Ä—É–≥–æ–π partition)
- –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ACK –ø—Ä–æ–¥—é—Å–µ—Ä—É (timeout)

New Leader (broker-2) –≤ –±–æ–ª—å—à–µ–π partition:
- –í—ã–±—Ä–∞–Ω –Ω–æ–≤—ã–º –ª–∏–¥–µ—Ä–æ–º
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø–∏—Å–∏
- –î–æ—Å—Ç–∏–≥–∞–µ—Ç ISR, –∫–æ–º–º–∏—Ç–∏—Ç

Partition –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è:
broker-1 –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è ‚Üí
–£ broker-1 –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç —É broker-2 (zombie writes)
–ö–∞–∫ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç—Ç–∏—Ö –∑–∞–ø–∏—Å–µ–π?
```

–†–µ—à–µ–Ω–∏–µ: Leader Epoch
```
Leader Epoch ‚Äî –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ –≤–æ–∑—Ä–∞—Å—Ç–∞—é—â–∏–π —Å—á—ë—Ç—á–∏–∫, —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º –ª–∏–¥–µ—Ä–µ

broker-1 –±—ã–ª –ª–∏–¥–µ—Ä–æ–º –≤ epoch=5
broker-2 —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ª–∏–¥–µ—Ä–æ–º ‚Üí epoch=6

broker-1 –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è:
- –°–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É broker-2: "–ö–∞–∫–æ–π offset –±—ã–ª —É —Ç–µ–±—è –Ω–∞ –∫–æ–Ω–µ—Ü epoch=5?"
- broker-2 –æ—Ç–≤–µ—á–∞–µ—Ç: "offset=999"
- broker-1 –≤–∏–¥–∏—Ç, —á—Ç–æ —É –Ω–µ–≥–æ offset=1002 –≤ epoch=5
- broker-1 –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø–∏—Å–∏ 1000-1002 (–æ–Ω–∏ –Ω–µ committed)
- broker-1 —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å broker-2
```

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **Log Matching Safety**: –ª–æ–≥–∏ –Ω–µ —Ä–∞—Å—Ö–æ–¥—è—Ç—Å—è.

**MongoDB Rollback –ø–æ—Å–ª–µ –ø–∞–¥–µ–Ω–∏—è Primary**

–ü—Ä–æ–±–ª–µ–º–∞:
```
Primary (mongo-1):
oplog: [..., op-98, op-99, op-100, op-101]
                           ‚Üë –ø–æ—Å–ª–µ–¥–Ω–∏–π replicated –Ω–∞ Secondary-1
                                    ‚Üë –Ω–µ replicated (—Ç–æ–ª—å–∫–æ –Ω–∞ Primary)

mongo-1 –ø–∞–¥–∞–µ—Ç –¥–æ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ op-101 ‚Üí
Secondary-1 —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–æ–≤—ã–º Primary (–æ–ø—è—Ç—å –∂–µ, —É–ø—Ä–æ—â–µ–Ω–∏–µ, –Ω–æ –∏–¥–µ—è –ø–æ–Ω—è—Ç–Ω–∞)
–ù–æ–≤—ã–π Primary –ø—Ä–∏–Ω–∏–º–∞–µ—Ç op-102, op-103 ‚Üí

mongo-1 –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è ‚Üí
–£ mongo-1 –µ—Å—Ç—å op-101, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ—Ç —É –Ω–æ–≤–æ–≥–æ Primary
–£ –Ω–æ–≤–æ–≥–æ Primary –µ—Å—Ç—å op-102, op-103, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç —É mongo-1
```

–†–µ—à–µ–Ω–∏–µ: Rollback
```
mongo-1 –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç:
- –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å–≤–æ–π oplog —Å –Ω–æ–≤—ã–º Primary
- –í–∏–¥–∏—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ op-100
- –û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç op-101 (rollback)
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç op-101 –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª rollback/<collection>.bson
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å –Ω–æ–≤—ã–º Primary (–ø—Ä–∏–º–µ–Ω—è–µ—Ç op-102, op-103)

DBA –¥–æ–ª–∂–µ–Ω –≤—Ä—É—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∏—Ç—å rollback —Ñ–∞–π–ª—ã –∏ —Ä–µ—à–∏—Ç—å, —á—Ç–æ –¥–µ–ª–∞—Ç—å:
- –í–æ–∑–º–æ–∂–Ω–æ, op-101 –±—ã–ª –≤–∞–∂–µ–Ω ‚Üí –≤—Ä—É—á–Ω—É—é –ø—Ä–∏–º–µ–Ω–∏—Ç—å
- –í–æ–∑–º–æ–∂–Ω–æ, op-101 –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω ‚Üí –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å
```

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **State Machine Safety**: –Ω–µ –±—É–¥–µ—Ç –¥–≤—É—Ö —Ä–∞–∑–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –º–æ–º–µ–Ω—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏.

**etcd Data Corruption Detection**

etcd —Ö—Ä–∞–Ω–∏—Ç —Ä–µ–≤–∏–∑–∏—é (revision) –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏:
```
Key: /foo
Revision: 1234

–ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—É—é revision:
PUT /foo ‚Üí revision=1234
PUT /bar ‚Üí revision=1235
DEL /foo ‚Üí revision=1236
```

etcd —Ç–∞–∫–∂–µ —Ö—Ä–∞–Ω–∏—Ç hash –≤—Å–µ–≥–æ –¥–µ—Ä–µ–≤–∞ –¥–∞–Ω–Ω—ã—Ö:
```
–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π committed –∑–∞–ø–∏—Å–∏:
- –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
- –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å hash –¥–µ—Ä–µ–≤–∞
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å hash –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ:
- –ü—Ä–æ—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
- –í—ã—á–∏—Å–ª–∏—Ç—å hash
- –°—Ä–∞–≤–Ω–∏—Ç—å —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º hash
- –ï—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Üí PANIC (–¥–∞–Ω–Ω—ã–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω—ã)
```

–ü—Ä–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏:
```
Leader –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ–ª–ª–æ–≤–µ—Ä—É:
- –ó–∞–ø–∏—Å–∏ –ª–æ–≥–∞
- Hash –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö –∑–∞–ø–∏—Å–µ–π

Follower:
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∑–∞–ø–∏—Å–∏
- –í—ã—á–∏—Å–ª—è–µ—Ç —Å–≤–æ–π hash
- –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å hash –æ—Ç –ª–∏–¥–µ—Ä–∞
- –ï—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Üí ERROR, —Ç—Ä–µ–±—É–µ—Ç—Å—è resync
```

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π **State Machine Safety** (corrupted data, bugs –≤ –∫–æ–¥–µ).

**PostgreSQL Checksum Pages**

PostgreSQL (—Å data checksums) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
```
–ü—Ä–∏ –∑–∞–ø–∏—Å–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
- –í—ã—á–∏—Å–ª–∏—Ç—å checksum —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
- –ó–∞–ø–∏—Å–∞—Ç—å checksum –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ó–∞–ø–∏—Å–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞ –¥–∏—Å–∫

–ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
- –ü—Ä–æ—á–∏—Ç–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
- –í—ã—á–∏—Å–ª–∏—Ç—å checksum —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
- –°—Ä–∞–≤–Ω–∏—Ç—å —Å checksum –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
- –ï—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Üí ERROR (data corruption)
```

–≠—Ç–æ –∑–∞—â–∏—Ç–∞ –æ—Ç:
- –ë–∏—Ç–æ–≤—ã—Ö –æ—à–∏–±–æ–∫ –Ω–∞ –¥–∏—Å–∫–µ
- –ë–∞–≥–æ–≤ –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
- –ü—Ä–æ–±–ª–µ–º —Å RAM (–±–µ–∑ ECC)

–ù–æ **–Ω–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è committed –¥–≤–∞–∂–¥—ã –∏–∑-–∑–∞ –±–∞–≥–∞ –≤ –∫–æ–¥–µ).

### üö® –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–Ω–∞—Ä—É—à–µ–Ω–∏—è Safety)

**–ü—Ä–æ–±–ª–µ–º–∞ 1: Split-brain –≤ —Å–∏—Å—Ç–µ–º–µ –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
PostgreSQL –±–µ–∑ Patroni/Repmgr (—Ç–æ–ª—å–∫–æ streaming replication):

Primary: pg-1
Standby: pg-2

–°–µ—Ç—å –º–µ–∂–¥—É pg-1 –∏ pg-2 –ø–∞–¥–∞–µ—Ç ‚Üí

–ë–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ failover:
- pg-1 –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø–∏—Å–∏
- pg-2 –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç (–∂–¥—ë—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è)
- –í—Å—ë –Ω–æ—Ä–º–∞–ª—å–Ω–æ ‚úÖ

–° –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º failover (–Ω–∞–∏–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è):
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–∏–¥–∏—Ç, —á—Ç–æ pg-1 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (—Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è pg-2)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–¥–≤–∏–≥–∞–µ—Ç pg-2 –≤ primary
- pg-2 –Ω–∞—á–∏–Ω–∞–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø–∏—Å–∏
- pg-1 —Ç–æ–∂–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø–∏—Å–∏
- **–î–í–ê PRIMARY** ‚Üí Split-brain üíÄ

–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:
App-1 –ø–∏—à–µ—Ç –≤ pg-1: INSERT order_id=123
App-2 –ø–∏—à–µ—Ç –≤ pg-2: INSERT order_id=123 (–¥—Ä—É–≥–æ–π –∑–∞–∫–∞–∑!)
–°–µ—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è ‚Üí
–ö–∞–∫ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç? –î–∞–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—è—Ç—Å—è!
```

–†–µ—à–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Patroni/Repmgr —Å DCS (etcd/Consul):
```
Patroni –Ω–∞ pg-1:
- –î–µ—Ä–∂–∏—Ç lease –≤ etcd
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç lease (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥)
- –ï—Å–ª–∏ –Ω–µ –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ DEMOTE —Å–µ–±—è –≤ standby

Patroni –Ω–∞ pg-2:
- –í–∏–¥–∏—Ç, —á—Ç–æ lease pg-1 –∏—Å—Ç—ë–∫
- –ë–µ—Ä—ë—Ç lease –≤ etcd
- –ü—Ä–æ–¥–≤–∏–≥–∞–µ—Ç pg-2 –≤ primary

pg-1 –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π partition:
- –ù–µ –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å lease –≤ etcd
- DEMOTE —Å–µ–±—è –≤ standby
- –ü–µ—Ä–µ—Å—Ç–∞—ë—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø–∏—Å–∏ ‚úÖ
```

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—è **Election Safety**: —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω primary –≤ –∫–∞–∂–¥—ã–π –º–æ–º–µ–Ω—Ç.

**–ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è min.insync.replicas (Kafka)**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
Kafka topic:
replication-factor=3
min.insync.replicas=1 ‚Üê –û–ü–ê–°–ù–ê–Ø –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è!

Producer: acks=all

Leader: broker-1
ISR: broker-1, broker-2, broker-3

Producer –ø–∏—à–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí
broker-1 –ø–æ–ª—É—á–∞–µ—Ç ‚Üí
broker-1 –ø–∏—à–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ ‚Üí
min.insync.replicas=1 –¥–æ—Å—Ç–∏–≥–Ω—É—Ç (—Ç–æ–ª—å–∫–æ —Å–∞–º broker-1) ‚Üí
broker-1 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ACK –ø—Ä–æ–¥—é—Å–µ—Ä—É ‚Üê –ü—Ä–æ–¥—é—Å–µ—Ä –¥—É–º–∞–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ safe

broker-1 –ø–∞–¥–∞–µ—Ç –°–†–ê–ó–£ –ø–æ—Å–ª–µ ACK, –¥–æ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞ broker-2/broker-3 ‚Üí
broker-2 –∏–ª–∏ broker-3 —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–æ–≤—ã–º –ª–∏–¥–µ—Ä–æ–º ‚Üí
–£ –Ω–æ–≤–æ–≥–æ –ª–∏–¥–µ—Ä–∞ –ù–ï–¢ —ç—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí
**–î–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã**, —Ö–æ—Ç—è –ø—Ä–æ–¥—é—Å–µ—Ä –ø–æ–ª—É—á–∏–ª ACK üíÄ
```

–ü–æ—á–µ–º—É —ç—Ç–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ Safety:
- –ü—Ä–æ–¥—é—Å–µ—Ä –ø–æ–ª—É—á–∏–ª –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí —Å—á–∏—Ç–∞–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- –ù–æ –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã ‚Üí –Ω–∞—Ä—É—à–µ–Ω–∞ –≥–∞—Ä–∞–Ω—Ç–∏—è –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç–∏

–†–µ—à–µ–Ω–∏–µ:
```
min.insync.replicas=2 (–º–∏–Ω–∏–º—É–º, –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
- –¢—Ä–µ–±—É–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º 2 —Ä–µ–ø–ª–∏–∫–∏ (leader + 1 follower)
- –ï—Å–ª–∏ –æ–¥–∏–Ω broker –ø–∞–¥–∞–µ—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ ACK, –¥–∞–Ω–Ω—ã–µ –≤—Å—ë –µ—â—ë –µ—Å—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–º
```

**–ü—Ä–æ–±–ª–µ–º–∞ 3: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ uncommitted –∑–∞–ø–∏—Å–µ–π (read uncommitted)**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
Raft cluster:

Leader:
Index:  1    2    3    4    5
      [op1][op2][op3][op4][op5]
                     ‚Üë commitIndex=3

Follower-A:
Index:  1    2    3    4
      [op1][op2][op3][op4]  ‚Üê –ü–æ–ª—É—á–∏–ª op4, –Ω–æ op4 –µ—â—ë –Ω–µ committed

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Follower-A:
READ index=4 ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç op4 ‚Üê –û–®–ò–ë–ö–ê! op4 uncommitted

Leader –ø–∞–¥–∞–µ—Ç –¥–æ commit op4 ‚Üí
–ù–æ–≤—ã–π –ª–∏–¥–µ—Ä –Ω–µ –∏–º–µ–µ—Ç op4 ‚Üí
op4 –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è ‚Üí
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ—á–∏—Ç–∞–ª–æ "–ø—Ä–∏–∑—Ä–∞—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ" üíÄ
```

–†–µ—à–µ–Ω–∏–µ:
```
–ß–∏—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ committed –¥–∞–Ω–Ω—ã–µ:
- Follower –∑–Ω–∞–µ—Ç commitIndex –æ—Ç –ª–∏–¥–µ—Ä–∞ (–ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ heartbeat)
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ index <= commitIndex
- op4 –µ—â—ë –Ω–µ committed ‚Üí Follower –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è index=4"
```

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—è **State Machine Safety**: –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ committed —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

**–ü—Ä–æ–±–ª–µ–º–∞ 4: –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫–µ (–±–µ–∑ checksums)**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
PostgreSQL –±–µ–∑ data checksums:

–°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –¥–∏—Å–∫ ‚Üí
–ë–∏—Ç–æ–≤–∞—è –æ—à–∏–±–∫–∞ –Ω–∞ –¥–∏—Å–∫–µ (cosmic ray, firmware bug) ‚Üí
–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞ ‚Üí
PostgreSQL —á–∏—Ç–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Üí
–ù–ï–¢ —Å–ø–æ—Å–æ–±–∞ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ ‚Üí
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é üíÄ

–ï—â—ë —Ö—É–∂–µ:
–ü–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç—Å—è –Ω–∞ standby ‚Üí
Standby –ø—Ä–∏–º–µ–Ω—è–µ—Ç –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí
Corruption —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ –≤—Å–µ–º—É –∫–ª–∞—Å—Ç–µ—Ä—É
```

–†–µ—à–µ–Ω–∏–µ:
```
1. –í–∫–ª—é—á–∏—Ç—å data checksums –ø—Ä–∏ initdb:
   initdb --data-checksums

2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å filesystem checksums (ZFS, Btrfs)

3. –†–µ–≥—É–ª—è—Ä–Ω—ã–µ backup —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞ –≤ –ª–æ–≥–∞—Ö
```

–≠—Ç–æ –∑–∞—â–∏—Ç–∞ **State Machine Safety** –æ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Å–±–æ–µ–≤.

### üõ†Ô∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—ã

**1. –í—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–π, —á—Ç–æ Safety –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∞**

–ü–æ–¥—Ö–æ–¥ Defense in Depth:
```
–£—Ä–æ–≤–µ–Ω—å 1: –ö–æ–Ω—Å–µ–Ω—Å—É—Å –ø—Ä–æ—Ç–æ–∫–æ–ª (Raft/Paxos)
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ–¥–∏–Ω –ª–∏–¥–µ—Ä, –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ª–æ–≥

–£—Ä–æ–≤–µ–Ω—å 2: Checksums/Hashes
- etcd hash tree
- PostgreSQL page checksums
- Kafka CRC32 –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

–£—Ä–æ–≤–µ–Ω—å 3: Application-level validation
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ ID –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π (idempotency keys)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ commit

–£—Ä–æ–≤–µ–Ω—å 4: Monitoring & Alerting
- –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–æ–º–∞–ª–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–≤–∞ –ª–∏–¥–µ—Ä–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç heartbeats)
- –ê–ª–µ—Ä—Ç—ã –Ω–∞ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ä–µ–ø–ª–∏–∫–∞–º–∏

–£—Ä–æ–≤–µ–Ω—å 5: Regular testing
- Chaos engineering
- –†–µ–≥—É–ª—è—Ä–Ω—ã–µ restore –∏–∑ backup
```

**2. –í—ã–±–æ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö**

–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:
```
–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å 1 (—Ñ–∏–Ω–∞–Ω—Å—ã, –∑–∞–∫–∞–∑—ã, —é—Ä–∏–¥–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º—ã–µ):
- Kafka: acks=all, min.insync.replicas=2, idempotent=true
- MongoDB: writeConcern={w:"majority", j:true}
- PostgreSQL: synchronous_commit=on, synchronous_standby_names='ANY 1 (...)'
- etcd: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–≤—Å–µ–≥–¥–∞ –∫–≤–æ—Ä—É–º)

–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å 2 (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è):
- Kafka: acks=all, min.insync.replicas=2
- MongoDB: writeConcern={w:"majority"}
- PostgreSQL: synchronous_commit=local

–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å 3 (–ª–æ–≥–∏, –º–µ—Ç—Ä–∏–∫–∏, –∫—ç—à–∏):
- Kafka: acks=1
- MongoDB: writeConcern={w:1}
- PostgreSQL: synchronous_commit=off
```

**3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Safety —Å–≤–æ–π—Å—Ç–≤**

–§–æ—Ä–º–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
```
1. TLA+ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è (–¥–ª—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤)
   - –§–æ—Ä–º–∞–ª—å–Ω–æ –æ–ø–∏—Å–∞—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞
   - TLC model checker –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
   - –ù–∞—Ö–æ–¥–∏—Ç –Ω–∞—Ä—É—à–µ–Ω–∏—è Safety –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

2. Jepsen testing (–¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º)
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä
   - –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–µ–≤—ã–µ —Å–±–æ–∏, –ø–∞–¥–µ–Ω–∏—è —É–∑–ª–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Safety –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:
     * –ù–µ—Ç –ø–æ—Ç–µ—Ä–∏ acknowledged –∑–∞–ø–∏—Å–µ–π
     * –ù–µ—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –º–µ–∂–¥—É —É–∑–ª–∞–º–∏
     * –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

3. Fuzzing
   - –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
```

–ü—Ä–∏–º–µ—Ä Jepsen-like —Ç–µ—Å—Ç–∞:
```
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å 5-—É–∑–ª–æ–≤–æ–π Raft –∫–ª–∞—Å—Ç–µ—Ä
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤, –ø–∏—à—É—â–∏—Ö —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
3. –°–ª—É—á–∞–π–Ω–æ —É–±–∏–≤–∞—Ç—å —É–∑–ª—ã, –¥–µ–ª–∞—Ç—å network partitions
4. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —É–∑–ª—ã
5. –í –∫–æ–Ω—Ü–µ: –ø—Ä–æ—á–∏—Ç–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ –≤—Å–µ—Ö —É–∑–ª–æ–≤
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
   - –í—Å–µ acknowledged –∑–∞–ø–∏—Å–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
   - –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π, –∫–æ—Ç–æ—Ä—ã—Ö –∫–ª–∏–µ–Ω—Ç –Ω–µ –≤–∏–¥–µ–ª (phantom writes)
   - –í—Å–µ —É–∑–ª—ã –∏–º–µ—é—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ committed –¥–∞–Ω–Ω—ã–µ
```

**4. –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏**

```
1. Backups —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏:
   - –†–µ–≥—É–ª—è—Ä–Ω—ã–µ snapshot'—ã
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (test restore)
   - Checksum verification

2. Immutable infrastructure:
   - –ù–µ –∏–∑–º–µ–Ω—è—Ç—å —É–∑–ª—ã –≤—Ä—É—á–Ω—É—é
   - –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ‚Üí –Ω–æ–≤—ã–π –æ–±—Ä–∞–∑ ‚Üí –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
   - –£–º–µ–Ω—å—à–∞–µ—Ç —Ä–∏—Å–∫ "—Å–Ω–µ–∂–∏–Ω–æ–∫" (snowflake servers)

3. Graceful degradation:
   - –ï—Å–ª–∏ –Ω–µ –º–æ–∂–µ–º –¥–æ—Å—Ç–∏—á—å –∫–≤–æ—Ä—É–º–∞ ‚Üí –æ—Ç–∫–ª–æ–Ω—è—Ç—å –∑–∞–ø–∏—Å–∏ (fail-stop)
   - –ù–ï –ü–´–¢–ê–¢–¨–°–Ø —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

4. Audit logs:
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –º–æ–Ω–æ—Ç–æ–Ω–Ω—ã–º–∏ ID
   - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å (–≤—Å–µ ID –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç, –Ω–µ—Ç –ø—Ä–æ–ø—É—Å–∫–æ–≤)

5. Canary writes:
   - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ —Å –∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
   - –ß–∏—Ç–∞—Ç—å –∏—Ö –æ–±—Ä–∞—Ç–Ω–æ –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
   - –ï—Å–ª–∏ canary write –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞ ‚Üí –∞–ª–µ—Ä—Ç
```

---

## 6. Liveness Guarantees (–ì–∞—Ä–∞–Ω—Ç–∏–∏ –ñ–∏–≤—É—á–µ—Å—Ç–∏)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Liveness Guarantees** (–≥–∞—Ä–∞–Ω—Ç–∏–∏ –∂–∏–≤—É—á–µ—Å—Ç–∏) ‚Äî —ç—Ç–æ —Å–≤–æ–π—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç, —á—Ç–æ **—Ö–æ—Ä–æ—à–µ–µ —Ä–∞–Ω–æ –∏–ª–∏ –ø–æ–∑–¥–Ω–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç**. Liveness ‚Äî —ç—Ç–æ –ø—Ä–æ –ø—Ä–æ–≥—Ä–µ—Å—Å: —Å–∏—Å—Ç–µ–º–∞ –≤ –∫–æ–Ω–µ—á–Ω–æ–º –∏—Ç–æ–≥–µ –¥–∞—Å—Ç –æ—Ç–≤–µ—Ç, –∑–∞–≤–µ—Ä—à–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏—é, –≤—ã–±–µ—Ä–µ—Ç –ª–∏–¥–µ—Ä–∞.

–í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞ Liveness –æ–∑–Ω–∞—á–∞–µ—Ç:
- –ï—Å–ª–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É–∑–ª–æ–≤ –¥–æ—Å—Ç—É–ø–Ω–æ, **–≤ –∫–æ–Ω–µ—á–Ω–æ–º –∏—Ç–æ–≥–µ** –±—É–¥–µ—Ç –≤—ã–±—Ä–∞–Ω –ª–∏–¥–µ—Ä
- –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –∑–∞–ø—Ä–æ—Å, **–≤ –∫–æ–Ω–µ—á–Ω–æ–º –∏—Ç–æ–≥–µ** –ø–æ–ª—É—á–∏—Ç –æ—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö –∏–ª–∏ –æ—à–∏–±–∫–∞)
- –ï—Å–ª–∏ –ª–∏–¥–µ—Ä —É–ø–∞–ª, **–≤ –∫–æ–Ω–µ—á–Ω–æ–º –∏—Ç–æ–≥–µ** —Å–∏—Å—Ç–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–∏—Ç —ç—Ç–æ –∏ –≤—ã–±–µ—Ä–µ—Ç –Ω–æ–≤–æ–≥–æ –ª–∏–¥–µ—Ä–∞
- –°–∏—Å—Ç–µ–º–∞ **–Ω–µ –∑–∞–≤–∏—Å–Ω–µ—Ç** –Ω–∞–≤—Å–µ–≥–¥–∞ –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É–∑–ª–æ–≤

–ê–Ω–∞–ª–æ–≥–∏—è:
```
–ë–∞–Ω–∫: "–ú—ã –≤—Å–µ–≥–¥–∞ –æ–±—Ä–∞–±–æ—Ç–∞–µ–º –≤–∞—à—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é" ‚Üê Liveness
–ë–∞–Ω–∫: "–ú—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–ø–∏—à–µ–º –¥–µ–Ω—å–≥–∏ –¥–≤–∞–∂–¥—ã" ‚Üê Safety (–Ω–µ Liveness)
```

–ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç Safety:
- **Safety**: –ø–ª–æ—Ö–æ–µ –ù–ò–ö–û–ì–î–ê –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç (–∞–±—Å–æ–ª—é—Ç–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è)
- **Liveness**: —Ö–æ—Ä–æ—à–µ–µ –†–ê–ù–û –ò–õ–ò –ü–û–ó–î–ù–û –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç (–≥–∞—Ä–∞–Ω—Ç–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞, –Ω–æ –Ω–µ –≤—Ä–µ–º–µ–Ω–∏)

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **Eventual Leader Election**: –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∫–≤–æ—Ä—É–º–∞ –≤ –∫–æ–Ω–µ—á–Ω–æ–º –∏—Ç–æ–≥–µ –±—É–¥–µ—Ç –≤—ã–±—Ä–∞–Ω –ª–∏–¥–µ—Ä
- **Eventual Response**: –∫–ª–∏–µ–Ω—Ç –≤ –∫–æ–Ω–µ—á–Ω–æ–º –∏—Ç–æ–≥–µ –ø–æ–ª—É—á–∏—Ç –æ—Ç–≤–µ—Ç (–Ω–µ –∑–∞–≤–∏—Å–Ω–µ—Ç –Ω–∞–≤—Å–µ–≥–¥–∞)
- **Progress with Quorum**: –µ—Å–ª–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω–æ, —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã
- **Failure Detection**: —É–ø–∞–≤—à–∏–π —É–∑–µ–ª –≤ –∫–æ–Ω–µ—á–Ω–æ–º –∏—Ç–æ–≥–µ –±—É–¥–µ—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω
- **No Deadlock**: —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –ø–æ–ø–∞–¥—ë—Ç –≤ —Ç—É–ø–∏–∫, –≥–¥–µ –Ω–∏–∫—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ
- **Fairness** (–≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ö): –≤—Å–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞**: –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –±–µ–∑ –∫–≤–æ—Ä—É–º–∞**: –µ—Å–ª–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –Ω–µ—Ç, —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç —Å—Ç–æ—è—Ç—å
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏**: –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –Ω–µ –ø–æ FIFO
- **–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–æ–ª–æ–¥–∞–Ω–∏—è** (starvation): –æ–¥–∏–Ω –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –∂–¥–∞—Ç—å –æ—á–µ–Ω—å –¥–æ–ª–≥–æ
- **–ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö retries**: –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å –∑–∞–ø—Ä–æ—Å –≤–µ—á–Ω–æ

### üåç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**Raft Election Timeout –∏ Liveness**

Raft –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç liveness —á–µ—Ä–µ–∑ randomized election timeouts:

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
```
–ö–∞–∂–¥—ã–π —É–∑–µ–ª –∏–º–µ–µ—Ç election timeout: 150-300ms (—Å–ª—É—á–∞–π–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)

–ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞:
Leader –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç heartbeat –∫–∞–∂–¥—ã–µ 50ms ‚Üí
Followers –ø–æ–ª—É—á–∞—é—Ç heartbeat ‚Üí —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç —Å–≤–æ–π election timer

Leader –ø–∞–¥–∞–µ—Ç:
Followers –Ω–µ –ø–æ–ª—É—á–∞—é—Ç heartbeat ‚Üí
Election timer –∏—Å—Ç–µ–∫–∞–µ—Ç ‚Üí
–ü–µ—Ä–≤—ã–π —Ñ–æ–ª–ª–æ–≤–µ—Ä —Å –∏—Å—Ç—ë–∫—à–∏–º timeout –Ω–∞—á–∏–Ω–∞–µ—Ç –≤—ã–±–æ—Ä—ã (–æ–±—ã—á–Ω–æ —Ä–∞–Ω—å—à–µ –¥—Ä—É–≥–∏—Ö –∏–∑-–∑–∞ randomization)
```

–ü—Ä–æ–±–ª–µ–º–∞ –±–µ–∑ randomization:
```
–ï—Å–ª–∏ –≤—Å–µ —É–∑–ª—ã –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π timeout (–Ω–∞–ø—Ä–∏–º–µ—Ä, 100ms):
Leader –ø–∞–¥–∞–µ—Ç –≤ –º–æ–º–µ–Ω—Ç t=0
–í—Å–µ —É–∑–ª—ã –Ω–∞—á–∏–Ω–∞—é—Ç –≤—ã–±–æ—Ä—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤ t=100ms
–í—Å–µ —É–∑–ª—ã –≥–æ–ª–æ—Å—É—é—Ç –∑–∞ —Å–µ–±—è
–ù–∏–∫—Ç–æ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞
–í—Å–µ —É–∑–ª—ã —Å–Ω–æ–≤–∞ –∂–¥—É—Ç 100ms
–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª ‚Üí –ù–ï–¢ liveness
```

–° randomization:
```
Leader –ø–∞–¥–∞–µ—Ç –≤ t=0
Node-A timeout: 150ms ‚Üí –Ω–∞—á–∏–Ω–∞–µ—Ç –≤—ã–±–æ—Ä—ã –≤ t=150ms
Node-B timeout: 180ms ‚Üí –µ—â—ë –∂–¥—ë—Ç
Node-C timeout: 220ms ‚Üí –µ—â—ë –∂–¥—ë—Ç

Node-A –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ ‚Üí
Node-B –∏ Node-C –≥–æ–ª–æ—Å—É—é—Ç –∑–∞ Node-A (–ø–µ—Ä–≤—ã–π –∫–∞–Ω–¥–∏–¥–∞—Ç) ‚Üí
Node-A —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ª–∏–¥–µ—Ä–æ–º ‚Üí Liveness –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞
```

**Kafka Producer Request Timeout**

Kafka –ø—Ä–æ–¥—é—Å–µ—Ä –∏–º–µ–µ—Ç timeout –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è liveness –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞:

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
```
request.timeout.ms=30000 (30 —Å–µ–∫—É–Ω–¥)
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç –±—Ä–æ–∫–µ—Ä–∞
- –ï—Å–ª–∏ timeout ‚Üí –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç TimeoutException

delivery.timeout.ms=120000 (2 –º–∏–Ω—É—Ç—ã)
- –û–±—â–µ–µ –≤—Ä–µ–º—è –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è (–≤–∫–ª—é—á–∞—è retries)
- –ï—Å–ª–∏ timeout ‚Üí –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—É—é –æ—à–∏–±–∫—É
```

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
Producer –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí
Leader broker –ø–æ–ª—É—á–∞–µ—Ç ‚Üí
Leader —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –Ω–∞ followers ‚Üí
Followers –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞—é—Ç (—Å–µ—Ç–µ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞) ‚Üí
30 —Å–µ–∫—É–Ω–¥ –ø—Ä–æ—à–ª–æ ‚Üí request timeout ‚Üí
Producer –ø–æ–ª—É—á–∞–µ—Ç TimeoutException

Producer –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç (retry) ‚Üí
–ù–∞ —ç—Ç–æ—Ç —Ä–∞–∑ followers –±—ã—Å—Ç—Ä–æ –æ—Ç–≤–µ—á–∞—é—Ç ‚Üí
Producer –ø–æ–ª—É—á–∞–µ—Ç ACK
```

Liveness –≥–∞—Ä–∞–Ω—Ç–∏—è: –∫–ª–∏–µ–Ω—Ç –ù–ï –ó–ê–í–ò–°–ù–ï–¢ –Ω–∞–≤—Å–µ–≥–¥–∞, –æ–Ω –ª–∏–±–æ –ø–æ–ª—É—á–∏—Ç ACK, –ª–∏–±–æ –æ—à–∏–±–∫—É.

**MongoDB Election Timeout**

MongoDB –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `electionTimeoutMillis` –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Primary:

–ü—Ä–∏–º–µ—Ä:
```
Replica Set:
electionTimeoutMillis=10000 (10 —Å–µ–∫—É–Ω–¥)

Primary –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç heartbeat –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
Secondaries —Å–ª–µ–¥—è—Ç –∑–∞ heartbeat

Primary —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:
t=0: Primary —É–ø–∞–ª
t=2s: Secondary –∂–¥—ë—Ç heartbeat (–Ω–µ –ø—Ä–∏—à—ë–ª)
t=4s: Secondary –∂–¥—ë—Ç heartbeat (–Ω–µ –ø—Ä–∏—à—ë–ª)
...
t=10s: Election timeout –∏—Å—Ç—ë–∫ ‚Üí
       Secondaries –Ω–∞—á–∏–Ω–∞—é—Ç –≤—ã–±–æ—Ä—ã ‚Üí
       –ù–æ–≤—ã–π Primary –≤—ã–±—Ä–∞–Ω —á–µ—Ä–µ–∑ ~1-2 —Å–µ–∫—É–Ω–¥—ã ‚Üí
       –ö–ª–∞—Å—Ç–µ—Ä —Å–Ω–æ–≤–∞ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∑–∞–ø–∏—Å–∏

–û–±—â–µ–µ –≤—Ä–µ–º—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏: ~11-12 —Å–µ–∫—É–Ω–¥
```

Liveness –≥–∞—Ä–∞–Ω—Ç–∏—è: –µ—Å–ª–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É–∑–ª–æ–≤ –¥–æ—Å—Ç—É–ø–Ω–æ, –≤ —Ç–µ—á–µ–Ω–∏–µ `electionTimeoutMillis + –≤—Ä–µ–º—è_–≤—ã–±–æ—Ä–æ–≤` –∫–ª–∞—Å—Ç–µ—Ä –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è.

**PostgreSQL + Patroni Lease Timeout**

Patroni –∏—Å–ø–æ–ª—å–∑—É–µ—Ç lease –≤ DCS –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Primary:

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
```
ttl: 30  # Lease time-to-live (—Å–µ–∫—É–Ω–¥—ã)
loop_wait: 10  # –ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è lease (—Å–µ–∫—É–Ω–¥—ã)
retry_timeout: 10  # Timeout –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å DCS
```

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
Primary –¥–µ—Ä–∂–∏—Ç lease –≤ etcd, –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥

Primary —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–Ω–æ –µ—â—ë –Ω–µ —É–ø–∞–ª):
t=0: –ü–æ—Å–ª–µ–¥–Ω–µ–µ —É—Å–ø–µ—à–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ lease
t=10s: Primary –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å, –Ω–æ etcd –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (network partition)
t=20s: Primary –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å, –Ω–µ –º–æ–∂–µ—Ç
t=30s: Lease –∏—Å—Ç–µ–∫–∞–µ—Ç –≤ etcd

Replica –≤–∏–¥–∏—Ç, —á—Ç–æ lease —Å–≤–æ–±–æ–¥–µ–Ω:
t=31s: Replica –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç lease
t=32s: Patroni –Ω–∞ Replica –ø—Ä–æ–¥–≤–∏–≥–∞–µ—Ç –µ—ë –≤ Primary
t=33s: –ù–æ–≤—ã–π Primary –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∑–∞–ø–∏—Å–∏

Primary –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π partition:
t=30s: Primary –Ω–µ —Å–º–æ–≥ –æ–±–Ω–æ–≤–∏—Ç—å lease
       Patroni –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ DEMOTE Primary –≤ Standby
       PostgreSQL –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø–∏—Å–∏
```

Liveness –≥–∞—Ä–∞–Ω—Ç–∏—è: –≤ —Ç–µ—á–µ–Ω–∏–µ `ttl + –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥` –∫–ª–∞—Å—Ç–µ—Ä –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å –Ω–æ–≤—ã–º Primary.

**etcd Request Progress**

etcd –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–∞–≤–∏—Å–∞–Ω–∏–π:

–ú–µ—Ö–∞–Ω–∏–∑–º:
```
Client –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –∑–∞–ø–∏—Å—å:
1. Leader –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
2. Leader —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –Ω–∞ —Ñ–æ–ª–ª–æ–≤–µ—Ä–æ–≤
3. Leader –∂–¥—ë—Ç ACK –æ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞

–ï—Å–ª–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ:
- Leader –ù–ï –ú–û–ñ–ï–¢ –∫–æ–º–º–∏—Ç–∏—Ç—å –∑–∞–ø–∏—Å—å
- Leader –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç—É –æ—à–∏–±–∫—É "no quorum"
- –ö–ª–∏–µ–Ω—Ç –ó–ù–ê–ï–¢, —á—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—à–ª–∞

–ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç:
- –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å –ø–æ–∑–∂–µ
- –í–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
```

–í–∞–∂–Ω–æ: etcd –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç **–æ—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å**, —á–µ–º **–∑–∞–≤–∏—Å–Ω—É—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞**. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç liveness –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (–∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç, —Ö–æ—Ç—å –∏ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–π).

### üö® –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–Ω–∞—Ä—É—à–µ–Ω–∏—è Liveness)

**–ü—Ä–æ–±–ª–µ–º–∞ 1: Split Vote (—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤)**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
Raft –∫–ª–∞—Å—Ç–µ—Ä –∏–∑ 4 —É–∑–ª–æ–≤ (–ü–õ–û–•–ê–Ø –∏–¥–µ—è, –Ω–æ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞):

Leader –ø–∞–¥–∞–µ—Ç ‚Üí
Node-A –∏ Node-B –Ω–∞—á–∏–Ω–∞—é—Ç –≤—ã–±–æ—Ä—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–∏—Ö timeouts –∏—Å—Ç–µ–∫–ª–∏)

–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ:
Node-A –≥–æ–ª–æ—Å—É–µ—Ç –∑–∞ —Å–µ–±—è (1 –≥–æ–ª–æ—Å)
Node-B –≥–æ–ª–æ—Å—É–µ—Ç –∑–∞ —Å–µ–±—è (1 –≥–æ–ª–æ—Å)
Node-C –≥–æ–ª–æ—Å—É–µ—Ç –∑–∞ Node-A (Node-A –ø–æ–ª—É—á–∏–ª 2 –≥–æ–ª–æ—Å–∞)
Node-D –≥–æ–ª–æ—Å—É–µ—Ç –∑–∞ Node-B (Node-B –ø–æ–ª—É—á–∏–ª 2 –≥–æ–ª–æ—Å–∞)

–î–ª—è –ø–æ–±–µ–¥—ã –Ω—É–∂–Ω–æ 3 –≥–æ–ª–æ—Å–∞ (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∏–∑ 4)
–ù–∏–∫—Ç–æ –Ω–µ –ø–æ–ª—É—á–∏–ª –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ ‚Üí
–í—ã–±–æ—Ä—ã failed ‚Üí
–í—Å–µ —É–∑–ª—ã –∂–¥—É—Ç –Ω–æ–≤—ã–π election timeout ‚Üí
–ü–æ–≤—Ç–æ—Ä—è—é—Ç –≤—ã–±–æ—Ä—ã ‚Üí
–°–Ω–æ–≤–∞ split vote ‚Üí
–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª (–Ω–∞—Ä—É—à–µ–Ω–∏–µ liveness)
```

–ü–æ—á–µ–º—É —ç—Ç–æ —Å–ª—É—á–∞–µ—Ç—Å—è:
- –ß—ë—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å split vote
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è randomization election timeout

–†–µ—à–µ–Ω–∏–µ:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—á—ë—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ (3, 5, 7)
- Randomized election timeout —Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º —Ä–∞–∑–±—Ä–æ—Å–æ–º

**–ü—Ä–æ–±–ª–µ–º–∞ 2: –ó–∞–≤–∏—Å–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–≤–æ—Ä—É–º–∞**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
PostgreSQL + synchronous_commit=on + synchronous_standby_names='standby1'

Client: BEGIN; INSERT ...; COMMIT;

Standby1 —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí
Primary –∂–¥—ë—Ç ACK –æ—Ç standby1 ‚Üí
COMMIT –∑–∞–≤–∏—Å–∞–µ—Ç ‚Üí
Client –∂–¥—ë—Ç COMMIT ‚Üí
Client –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞–≤—Å–µ–≥–¥–∞ (–ø–æ–∫–∞ standby1 –Ω–µ –≤–µ—Ä–Ω—ë—Ç—Å—è –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è)
```

–ù–∞—Ä—É—à–µ–Ω–∏–µ liveness: –∫–ª–∏–µ–Ω—Ç –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç–∞ (–Ω–∏ —É—Å–ø–µ—Ö–∞, –Ω–∏ –æ—à–∏–±–∫–∏).

–†–µ—à–µ–Ω–∏–µ:
```
1. Client-side timeout:
   SET statement_timeout = '60s';
   COMMIT; ‚Üí –ï—Å–ª–∏ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –∑–∞ 60 —Å–µ–∫—É–Ω–¥, –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏—Ç –æ—à–∏–±–∫—É

2. Multiple standby:
   synchronous_standby_names='ANY 1 (standby1, standby2, standby3)'
   ‚Üí –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª—é–±–æ–≥–æ –æ–¥–Ω–æ–≥–æ –∏–∑ —Ç—Ä—ë—Ö

3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π failover (Patroni):
   ‚Üí Patroni –æ–±–Ω–∞—Ä—É–∂–∏—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å standby1
   ‚Üí –û–±–Ω–æ–≤–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, –∏—Å–∫–ª—é—á–∏–≤ standby1
   ‚Üí Primary –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É
```

**–ü—Ä–æ–±–ª–µ–º–∞ 3: Livelock –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω–æ—Å—Ç–∏**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
–î–≤–∞ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø—ã—Ç–∞—é—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∫–ª—é—á –≤ etcd:

Client-A: PUT /counter value=1
Client-B: PUT /counter value=2

–û–±–∞ –∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–∏—Ö–æ–¥—è—Ç –∫ Leader –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:
Leader –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å Client-A –∑–∞–ø—Ä–æ—Å ‚Üí
–í —ç—Ç–æ –≤—Ä–µ–º—è –ø—Ä–∏—Ö–æ–¥–∏—Ç –∑–∞–ø—Ä–æ—Å Client-B —Å –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º ‚Üí
Leader –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç Client-A ‚Üí
Client-A timeout ‚Üí retry ‚Üí
Leader –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å Client-B ‚Üí
–í —ç—Ç–æ –≤—Ä–µ–º—è –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–æ–≤—ã–π retry Client-A ‚Üí
...–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª...
```

–≠—Ç–æ –Ω–µ —Ä–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –≤ etcd (–Ω–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤), –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Å–∏—Å—Ç–µ–º–∞—Ö —Å –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–µ–π –∑–∞–ø—Ä–æ—Å–æ–≤.

–†–µ—à–µ–Ω–∏–µ:
- Exponential backoff –¥–ª—è retries
- Jitter (—Å–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞) –º–µ–∂–¥—É retries
- Fair scheduling (FIFO –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤)

**–ü—Ä–æ–±–ª–µ–º–∞ 4: Cascading Failures (–∫–∞—Å–∫–∞–¥–Ω—ã–µ —Å–±–æ–∏)**

–°—Ü–µ–Ω–∞—Ä–∏–π:
```
Kafka cluster (5 brokers):

Broker-1 –ø–∞–¥–∞–µ—Ç ‚Üí
–ü–∞—Ä—Ç–∏—Ü–∏–∏, –≥–¥–µ broker-1 –±—ã–ª –ª–∏–¥–µ—Ä–æ–º, –ø–µ—Ä–µ–∏–∑–±–∏—Ä–∞—é—Ç –ª–∏–¥–µ—Ä–æ–≤ ‚Üí
–ù–æ–≤—ã–µ –ª–∏–¥–µ—Ä—ã (broker-2, broker-3, ...) –ø–æ–ª—É—á–∞—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É ‚Üí
Broker-2 –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω, –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å ‚Üí
Producer requests –∫ broker-2 —Ç–∞–π–º–∞—É—Ç—è—Ç—Å—è ‚Üí
Producer retry, —É–≤–µ–ª–∏—á–∏–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫—É ‚Üí
Broker-2 –ø–∞–¥–∞–µ—Ç –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ ‚Üí
–ï—â—ë –±–æ–ª—å—à–µ –ø–∞—Ä—Ç–∏—Ü–∏–π –ø–µ—Ä–µ–∏–∑–±–∏—Ä–∞—é—Ç –ª–∏–¥–µ—Ä–æ–≤ ‚Üí
Broker-3 –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω ‚Üí
... –∫–∞—Å–∫–∞–¥–Ω—ã–π —Å–±–æ–π –≤—Å–µ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞
```

–ù–∞—Ä—É—à–µ–Ω–∏–µ liveness: –∫–ª–∞—Å—Ç–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–∞–¥–∞–µ—Ç.

–†–µ—à–µ–Ω–∏–µ:
```
1. Rate limiting –Ω–∞ producer —Å—Ç–æ—Ä–æ–Ω–µ:
   - –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ requests/sec
   - Backoff –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

2. Load shedding –Ω–∞ broker —Å—Ç–æ—Ä–æ–Ω–µ:
   - –û—Ç–∫–ª–æ–Ω—è—Ç—å –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –µ—Å–ª–∏ broker –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω
   - –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ—à–∏–±–∫—É "overloaded", –∞ –Ω–µ –∑–∞–≤–∏—Å–∞—Ç—å

3. Capacity planning:
   - Cluster –¥–æ–ª–∂–µ–Ω –≤—ã–¥–µ—Ä–∂–∞—Ç—å –ø–∞–¥–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ broker –±–µ–∑ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏
   - –û–±—ã—á–Ω–æ –ø–ª–∞–Ω–∏—Ä—É—é—Ç –Ω–∞ N-1 capacity

4. Circuit breaker –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞—Ö:
   - –ï—Å–ª–∏ broker –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç, –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ —Å–ª–∞—Ç—å –µ–º—É –∑–∞–ø—Ä–æ—Å—ã
```

### üõ†Ô∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—ã

**1. –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å timeouts**

–ü—Ä–∞–≤–∏–ª–æ: **–ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å timeout**.

–£—Ä–æ–≤–Ω–∏ timeouts:
```
Application Level:
- HTTP request timeout: 30-60 —Å–µ–∫—É–Ω–¥
- Database query timeout: 10-30 —Å–µ–∫—É–Ω–¥
- RPC timeout: 5-10 —Å–µ–∫—É–Ω–¥

Consensus Level:
- Election timeout: 10-20 —Å–µ–∫—É–Ω–¥
- Heartbeat interval: 1-2 —Å–µ–∫—É–Ω–¥—ã
- Request timeout: 5-10 —Å–µ–∫—É–Ω–¥

Infrastructure Level:
- TCP connect timeout: 5 —Å–µ–∫—É–Ω–¥
- TCP socket timeout: 30 —Å–µ–∫—É–Ω–¥
- DNS resolution timeout: 2-5 —Å–µ–∫—É–Ω–¥
```

–ü—Ä–∏–º–µ—Ä (PostgreSQL client):
```sql
-- Statement timeout (–æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å)
SET statement_timeout = '30s';
SELECT ...;

-- Transaction timeout (–≤—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è)
SET transaction_timeout = '60s';
BEGIN;
...
COMMIT;

-- Idle in transaction timeout (–∑–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–±—ã—Ç—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)
SET idle_in_transaction_session_timeout = '5min';
```

**2. Exponential Backoff –∏ Jitter –¥–ª—è retries**

–ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω (fixed retry interval):
```
while True:
    try:
        write_to_kafka(msg)
        break
    except TimeoutError:
        sleep(1)  # –í—Å–µ–≥–¥–∞ 1 —Å–µ–∫—É–Ω–¥–∞
        # –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã retry –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ ‚Üí thundering herd
```

–ü—Ä–∞–≤–∏–ª—å–Ω–æ (exponential backoff + jitter):
```
attempt = 0
max_attempts = 10

while attempt < max_attempts:
    try:
        write_to_kafka(msg)
        break
    except TimeoutError:
        attempt += 1

        # Exponential backoff: 1s, 2s, 4s, 8s, ...
        base_delay = min(2 ** attempt, 60)  # –ú–∞–∫—Å 60 —Å–µ–∫—É–Ω–¥

        # Jitter: –¥–æ–±–∞–≤–∏—Ç—å —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å ¬±50%
        jitter = base_delay * (0.5 + random())

        sleep(jitter)

# –ï—Å–ª–∏ –≤—Å–µ retries failed ‚Üí –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É (–Ω–µ –∑–∞–≤–∏—Å–∞—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞)
```

**3. Circuit Breaker –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤**

–ò–¥–µ—è: –µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–µ —Å–ª–∞—Ç—å –µ–º—É –∑–∞–ø—Ä–æ—Å—ã (—á—Ç–æ–±—ã –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ timeout).

–°–æ—Å—Ç–æ—è–Ω–∏—è:
```
CLOSED (–Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞):
- –ó–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ
- –°—á–∏—Ç–∞–µ–º failures
- –ï—Å–ª–∏ failures > threshold ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ OPEN

OPEN (circuit open, –∑–∞—â–∏—Ç–∞):
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è (–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è)
- –≠–∫–æ–Ω–æ–º–∏–º –≤—Ä–µ–º—è (–Ω–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è timeout)
- –ß–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 30 —Å–µ–∫—É–Ω–¥) ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ HALF_OPEN

HALF_OPEN (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è):
- –†–∞–∑—Ä–µ—à–∞–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1)
- –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ CLOSED
- –ï—Å–ª–∏ failed ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏–º –æ–±—Ä–∞—Ç–Ω–æ –≤ OPEN
```

–ü—Ä–∏–º–µ—Ä:
```
Circuit Breaker –¥–ª—è Kafka:

5 consecutive failures ‚Üí OPEN
Timeout: 30 —Å–µ–∫—É–Ω–¥

t=0: 5 failed writes ‚Üí Circuit OPEN
t=0-30s: –í—Å–µ write_to_kafka() –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ—à–∏–±–∫—É "circuit open"
t=30s: Circuit –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ HALF_OPEN
t=30s: –†–∞–∑—Ä–µ—à–∞–µ–º 1 write ‚Üí –£—Å–ø–µ—Ö ‚Üí Circuit CLOSED
t=31s+: –ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞
```

**4. Graceful Degradation (–ø–ª–∞–≤–Ω–∞—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è)**

–ò–¥–µ—è: –µ—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é, —Ä–∞–±–æ—Ç–∞—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ.

–ü—Ä–∏–º–µ—Ä—ã:
```
MongoDB —Å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º:
‚ùå –ù–ï–¢: –ó–∞–≤–∏—Å–Ω—É—Ç—å, –æ–∂–∏–¥–∞—è –∫–≤–æ—Ä—É–º–∞
‚úÖ –î–ê: –û—Ç–∫–ª–æ–Ω—è—Ç—å –∑–∞–ø–∏—Å–∏, –Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å —á—Ç–µ–Ω–∏—è (stale reads —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º)

Kafka —Å unavailable brokers:
‚ùå –ù–ï–¢: –ó–∞–≤–∏—Å–Ω—É—Ç—å, –ø—ã—Ç–∞—è—Å—å –ø–∏—Å–∞—Ç—å –≤ unavailable –ø–∞—Ä—Ç–∏—Ü–∏–∏
‚úÖ –î–ê: –ü–∏—Å–∞—Ç—å –≤ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏, –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –¥–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö

PostgreSQL Primary –±–µ–∑ Standby:
‚ùå –ù–ï–¢: –ó–∞–≤–∏—Å–Ω—É—Ç—å, –æ–∂–∏–¥–∞—è ACK –æ—Ç standby
‚úÖ –î–ê: –í—Ä–µ–º–µ–Ω–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ synchronous_commit=local, –∞–ª–µ—Ä—Ç–∏—Ç—å
```

**5. Health Checks –∏ Liveness Probes**

Kubernetes-style health checks:
```
Readiness Probe (–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫):
- GET /health/ready
- –ï—Å–ª–∏ —É–∑–µ–ª –Ω–µ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã ‚Üí –≤–µ—Ä–Ω—É—Ç—å 503
- Load Balancer –∏—Å–∫–ª—é—á–∞–µ—Ç —ç—Ç–æ—Ç —É–∑–µ–ª –∏–∑ —Ä–æ—Ç–∞—Ü–∏–∏

Liveness Probe (–∂–∏–≤–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞):
- GET /health/live
- –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–∏—Å ‚Üí –≤–µ—Ä–Ω—É—Ç—å 503 –∏–ª–∏ timeout
- Orchestrator –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
```

–ü—Ä–∏–º–µ—Ä –¥–ª—è Raft —É–∑–ª–∞:
```
GET /health/ready:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: —É–∑–µ–ª –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ –∫–ª–∞—Å—Ç–µ—Ä—É
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: heartbeat –æ—Ç –ª–∏–¥–µ—Ä–∞ –ø–æ–ª—É—á–µ–Ω –Ω–µ–¥–∞–≤–Ω–æ (< election timeout)
- –ï—Å–ª–∏ –ù–ï–¢ ‚Üí return 503 (—É–∑–µ–ª –≤ split partition)

GET /health/live:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –∑–∞–≤–∏—Å
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–µ–Ω–∏–µ –∏–∑ –ø–∞–º—è—Ç–∏)
- Timeout: 5 —Å–µ–∫—É–Ω–¥
- –ï—Å–ª–∏ –ù–ï–¢ –æ—Ç–≤–µ—Ç–∞ ‚Üí Kubernetes kill & restart
```

**6. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Liveness –º–µ—Ç—Ä–∏–∫**

–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
```
Request latency percentiles:
- p50, p95, p99, p999
- –ï—Å–ª–∏ p99 > 5 —Å–µ–∫—É–Ω–¥ ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ liveness (–∑–∞–ø—Ä–æ—Å—ã –º–µ–¥–ª–µ–Ω–Ω—ã–µ)

Request timeout rate:
- % –∑–∞–ø—Ä–æ—Å–æ–≤, –∑–∞–≤–µ—Ä—à–∏–≤—à–∏—Ö—Å—è timeout
- –ï—Å–ª–∏ > 1% ‚Üí —Å–µ—Ä—å—ë–∑–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

Time since last successful election:
- –ï—Å–ª–∏ > 2 * election timeout ‚Üí –∫–ª–∞—Å—Ç–µ—Ä –Ω–µ—Å—Ç–∞–±–∏–ª–µ–Ω

Leader change frequency:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–±–æ—Ä–æ–≤ –ª–∏–¥–µ—Ä–∞ –≤ —á–∞—Å
- –ï—Å–ª–∏ > 5/hour ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ (flapping leader)

Quorum availability:
- % –≤—Ä–µ–º–µ–Ω–∏, –∫–æ–≥–¥–∞ –∫–≤–æ—Ä—É–º –¥–æ—Å—Ç—É–ø–µ–Ω
- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å > 99.9%
```

–ê–ª–µ—Ä—Ç—ã:
```
Critical:
- Quorum unavailable > 1 minute
- Request timeout rate > 10%
- No leader elected > election timeout

Warning:
- p99 latency > 1 second
- Leader changes > 2/hour
- Quorum unavailable > 10 seconds
```

---

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ê—Å–ø–µ–∫—Ç | Leader Election | Log Replication | Commit | Majority Agreement | Safety | Liveness |
|--------|----------------|-----------------|--------|-------------------|--------|----------|
| **–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å** | –í—ã–±—Ä–∞—Ç—å –æ–¥–Ω–æ–≥–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞ | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏ —É–∑–ª–æ–≤ | –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ—á–∫—É –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ—Å—Ç–∏ | –î–æ—Å—Ç–∏—á—å —Å–æ–≥–ª–∞—Å–∏—è –≥—Ä—É–ø–ø—ã | –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ | –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–ø–µ—Ä–∞—Ü–∏–π |
| **–ß–∞—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** | –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏ —Å–±–æ—è—Ö | –ü–æ—Å—Ç–æ—è–Ω–Ω–æ (–∫–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å) | –ü–æ—Å—Ç–æ—è–Ω–Ω–æ (–∫–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å) | –ü—Ä–∏ –≤—ã–±–æ—Ä–∞—Ö –∏ –∫–æ–º–º–∏—Ç–∞—Ö | –í—Å–µ–≥–¥–∞ | –í—Å–µ–≥–¥–∞ |
| **–¢—Ä–µ–±—É–µ—Ç –∫–≤–æ—Ä—É–º–∞** | ‚úÖ –î–∞ (–¥–ª—è –≤—ã–±–æ—Ä–æ–≤) | ‚ùå –ù–µ—Ç (–Ω–æ –±—ã—Å—Ç—Ä–µ–µ —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º) | ‚úÖ –î–∞ (–¥–ª—è commit) | ‚úÖ –î–∞ (–ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é) | ‚úÖ –î–∞ (–¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–π) | ‚ùå –ù–µ—Ç (–Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–≤–æ—Ä—É–º–∞) |
| **–ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏** | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ | üî¥ –í—ã—Å–æ–∫–æ | üî¥ –í—ã—Å–æ–∫–æ | üî¥ –í—ã—Å–æ–∫–æ | üî¥ –í—ã—Å–æ–∫–æ |
| **–ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏** | üî¥ –í—ã—Å–æ–∫–æ | üî¥ –í—ã—Å–æ–∫–æ | üî¥ –í—ã—Å–æ–∫–æ | üî¥ –í—ã—Å–æ–∫–æ | üî¥ –í—ã—Å–æ–∫–æ | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ |
| **–¢–∏–ø–∏—á–Ω—ã–π timeout** | 10-20 —Å–µ–∫ | –ù–µ—Ç (continuous) | 5-30 —Å–µ–∫ | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ | N/A | –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| **–í–ª–∏—è–Ω–∏–µ —Å–±–æ—è** | –í—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å | –û—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ —Ä–µ–ø–ª–∏–∫ | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–ø–∏—Å–µ–π | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ—à–µ–Ω–∏–π | –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö/—Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ | –ó–∞–≤–∏—Å–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã |
| **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏** | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É–∑–ª–æ–≤ | min.insync, sync mode | acks=all, w:majority | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ | Checksums, validation | Timeouts, retries |
| **–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (Kafka)** | controller.election | replica.lag.time | min.insync.replicas | ISR | leader.epoch | request.timeout |
| **–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (MongoDB)** | priority, votes | oplogSizeMB | writeConcern.w | Replica set size | rollback files | electionTimeout |
| **–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (PostgreSQL)** | - (–≤–Ω–µ—à–Ω–∏–π: Patroni) | wal_keep_size | synchronous_commit | - (–≤–Ω–µ—à–Ω–∏–π: Patroni) | data_checksums | statement_timeout |
| **–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (etcd/Raft)** | election-timeout | - (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π) | - (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π) | - (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π) | hash-based check | request-timeout |
| **–ú–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å** | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ) | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç (–Ω–æ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å) |
| **Trade-off —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é** | –ù–∏–∑–∫–∏–π | –°—Ä–µ–¥–Ω–∏–π | –í—ã—Å–æ–∫–∏–π | –°—Ä–µ–¥–Ω–∏–π | –°—Ä–µ–¥–Ω–∏–π | –ù–∏–∑–∫–∏–π |

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞

| –ü—Ä–æ—Ç–æ–∫–æ–ª | Leader Election | Log Replication | Commit Mechanism | Complexity | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ |
|----------|----------------|-----------------|------------------|------------|----------------|
| **Raft** | Randomized timeouts, majority vote | AppendEntries RPC | Majority ACK | –°—Ä–µ–¥–Ω—è—è | etcd, Consul, ClickHouse Keeper |
| **Paxos** | Proposer compete, highest ballot | Accept messages | Majority Accept | –í—ã—Å–æ–∫–∞—è | Google Chubby (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π), –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–∞—Ä—ã–µ —Å–∏—Å—Ç–µ–º—ã |
| **Multi-Paxos** | Stable leader (extension) | Like Paxos | Majority Accept | –í—ã—Å–æ–∫–∞—è | –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è –æ—Å–Ω–æ–≤–∞ –¥–ª—è –º–Ω–æ–≥–∏—Ö —Å–∏—Å—Ç–µ–º |
| **ZAB (ZooKeeper)** | Leader election —á–µ—Ä–µ–∑ voting | Atomic Broadcast | Majority ACK | –°—Ä–µ–¥–Ω—è—è | ZooKeeper |
| **Viewstamped Replication** | View change protocol | Replication protocol | Majority | –°—Ä–µ–¥–Ω—è—è | –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π (–ø—Ä–æ–æ–±—Ä–∞–∑ Raft) |
| **Kafka ISR (–Ω–µ –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Å–µ–Ω—Å—É—Å)** | Controller election (ZK/KRaft) | Continuous fetch | ISR ACK (not strict majority) | –ù–∏–∑–∫–∞—è-–°—Ä–µ–¥–Ω—è—è | Kafka |
| **MongoDB Replica Set** | Raft-like voting | Continuous oplog tailing | Majority write concern | –°—Ä–µ–¥–Ω—è—è | MongoDB |

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ CAP —Ç–µ–æ—Ä–µ–º–µ

| –°–∏—Å—Ç–µ–º–∞ | Partition Tolerance | Consistency (–ø—Ä–∏ partition) | Availability (–ø—Ä–∏ partition) | –í—ã–±–æ—Ä |
|---------|-------------------|---------------------------|----------------------------|-------|
| **etcd/Consul** | ‚úÖ –î–∞ | ‚úÖ –°—Ç—Ä–æ–≥–∞—è (CP) | ‚ùå –ù–µ—Ç (–µ—Å–ª–∏ –Ω–µ—Ç –∫–≤–æ—Ä—É–º–∞) | **CP** |
| **MongoDB (w:majority)** | ‚úÖ –î–∞ | ‚úÖ –°—Ç—Ä–æ–≥–∞—è (CP) | ‚ùå –ù–µ—Ç (–µ—Å–ª–∏ –Ω–µ—Ç –∫–≤–æ—Ä—É–º–∞) | **CP** |
| **PostgreSQL (sync)** | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | ‚úÖ –°—Ç—Ä–æ–≥–∞—è | ‚ùå –ù–µ—Ç (–µ—Å–ª–∏ –Ω–µ—Ç standby) | **CP** |
| **Kafka (acks=all)** | ‚úÖ –î–∞ | ‚úÖ –°—Ç—Ä–æ–≥–∞—è (CP) | ‚ùå –ù–µ—Ç (–µ—Å–ª–∏ –Ω–µ—Ç ISR) | **CP** |
| **Kafka (acks=1)** | ‚úÖ –î–∞ | ‚ùå Eventual | ‚úÖ –î–∞ | **AP** |
| **Cassandra (QUORUM)** | ‚úÖ –î–∞ | ‚úÖ –°—Ç—Ä–æ–≥–∞—è (CP) | ‚ùå –ù–µ—Ç (–µ—Å–ª–∏ –Ω–µ—Ç –∫–≤–æ—Ä—É–º–∞) | **CP** |
| **Cassandra (ONE)** | ‚úÖ –î–∞ | ‚ùå Eventual | ‚úÖ –î–∞ | **AP** |
| **Redis Cluster** | ‚úÖ –î–∞ | ‚ùå Eventual | ‚úÖ –î–∞ (–¥–ª—è shard —Å –º–∞—Å—Ç–µ—Ä–æ–º) | **AP** |
| **DynamoDB** | ‚úÖ –î–∞ | ‚ö†Ô∏è –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è | ‚ö†Ô∏è –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è | **AP** (–æ–±—ã—á–Ω–æ) |

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: CAP —Ç–µ–æ—Ä–µ–º–∞ —á–∞—Å—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç—Å—è. –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã **–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ** –∏ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö.

---

## –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 1: GitHub 2012 - Split-brain –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ failover

**–ß—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å:**
- MySQL master-master —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è (–∞–∫—Ç–∏–≤–Ω—ã–π-–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º)
- Network partition –º–µ–∂–¥—É –¥–≤—É–º—è –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π failover –ø–µ—Ä–µ–≤—ë–ª —Ç—Ä–∞—Ñ–∏–∫ –≤ –æ–±–∞ –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–∞
- –û–±–∞ –º–∞—Å—Ç–µ—Ä–∞ –Ω–∞—á–∞–ª–∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø–∏—Å–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Ç–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
- –î–∞–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥–∏–ª–∏—Å—å, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –ø–æ—Ç–µ—Ä—è–Ω—ã

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- –ù–µ –±—ã–ª–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Å–µ–Ω—Å—É—Å-–ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ª–∏–¥–µ—Ä–∞
- –ù–∞–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (ping) –±–µ–∑ —É—á—ë—Ç–∞ –∫–≤–æ—Ä—É–º–∞
- –ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ fencing (–∏–∑–æ–ª—è—Ü–∏–∏ —Å—Ç–∞—Ä–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞)

**–£—Ä–æ–∫:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—ã —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∫–æ–Ω—Å–µ–Ω—Å—É—Å–æ–º (Raft/Paxos)
- –î–ª—è MySQL –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Orchestrator –∏–ª–∏ ProxySQL —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º failover
- –í—Å–µ–≥–¥–∞ –∏–º–µ—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º fencing (STONITH –≤ –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö)

### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 2: Cloudflare 2020 - Cascading failure –≤ etcd

**–ß—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å:**
- etcd cluster (3 —É–∑–ª–∞) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –û–¥–∏–Ω —É–∑–µ–ª –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω (disk I/O)
- –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —É–∑–ª–∞
- Leader –Ω–µ –º–æ–∂–µ—Ç –¥–æ—Å—Ç–∏—á—å –∫–≤–æ—Ä—É–º–∞ –±—ã—Å—Ç—Ä–æ
- –ß–∞—Å—Ç—ã–µ –ø–µ—Ä–µ–∏–∑–±—Ä–∞–Ω–∏—è –ª–∏–¥–µ—Ä–∞ (election storm)
- etcd –∫–ª–∞—Å—Ç–µ—Ä —Å—Ç–∞–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –í—Å—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Cloudflare –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å (–∑–∞–≤–∏—Å–µ–ª–∞ –æ—Ç etcd)

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π monitoring disk I/O –Ω–∞ etcd —É–∑–ª–∞—Ö
- –°–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ timeouts (–±—ã—Å—Ç—Ä—ã–π election timeout)
- –û–¥–∏–Ω –º–µ–¥–ª–µ–Ω–Ω—ã–π —É–∑–µ–ª –ø–∞—Ä–∞–ª–∏–∑–æ–≤–∞–ª –≤–µ—Å—å –∫–ª–∞—Å—Ç–µ—Ä

**–£—Ä–æ–∫:**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ CPU/RAM, –Ω–æ –∏ disk latency
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å election timeout —Å –∑–∞–ø–∞—Å–æ–º (–ª—É—á—à–µ –º–µ–¥–ª–µ–Ω–Ω—ã–π failover, —á–µ–º election storm)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSD –¥–ª—è etcd (disk-intensive workload)
- –ò–º–µ—Ç—å alerting –Ω–∞ —á–∞—Å—Ç—ã–µ –ø–µ—Ä–µ–∏–∑–±—Ä–∞–Ω–∏—è –ª–∏–¥–µ—Ä–∞

### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 3: MongoDB 2017 - Data loss –ø—Ä–∏ unclean shutdown

**–ß—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å:**
- MongoDB replica set (3 —É–∑–ª–∞)
- Primary –ø–æ–ª—É—á–∏–ª –∑–∞–ø–∏—Å—å —Å writeConcern={w:1} (—Ç–æ–ª—å–∫–æ primary)
- Primary –∑–∞–ø–∏—Å–∞–ª –≤ –ø–∞–º—è—Ç—å, –Ω–æ –Ω–µ –Ω–∞ –¥–∏—Å–∫ (journaling –æ—Ç–∫–ª—é—á—ë–Ω)
- Primary –≤–Ω–µ–∑–∞–ø–Ω–æ –≤—ã–∫–ª—é—á–µ–Ω (power failure)
- Secondary —Å—Ç–∞–ª –Ω–æ–≤—ã–º Primary
- –£ –Ω–æ–≤–æ–≥–æ Primary –Ω–µ—Ç —ç—Ç–æ–π –∑–∞–ø–∏—Å–∏ (–Ω–µ –±—ã–ª–∞ —Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞)
- –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏–ª ACK, –Ω–æ –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- writeConcern={w:1} –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é
- journaling=false –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å
- –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏–ª ACK –¥–æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∑–∞–ø–∏—Å–∏ –Ω–∞ –¥–∏—Å–∫

**–£—Ä–æ–∫:**
- –î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: writeConcern={w:"majority", j:true}
- –í—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞—Ç—å journaling
- –ü–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ ACK –Ω–µ –≤—Å–µ–≥–¥–∞ –∑–Ω–∞—á–∏—Ç "–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –Ω–∞–≤—Å–µ–≥–¥–∞"

### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 4: Kafka 2019 - Unclean leader election –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö

**–ß—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å:**
- Kafka topic —Å replication-factor=3
- unclean.leader.election.enable=true (–û–®–ò–ë–ö–ê!)
- Leader broker —É–ø–∞–ª
- –û–±–∞ ISR follower'–∞ —Ç–∞–∫–∂–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã (network partition)
- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π follower –Ω–µ –≤ ISR (–æ—Ç—Å—Ç–∞–ª –Ω–∞ 1000 —Å–æ–æ–±—â–µ–Ω–∏–π)
- Kafka –≤—ã–±—Ä–∞–ª –µ–≥–æ –ª–∏–¥–µ—Ä–æ–º (unclean election)
- 1000 —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ—Ç–µ—Ä—è–Ω—ã –Ω–∞–≤—Å–µ–≥–¥–∞

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- unclean.leader.election.enable=true –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–ª consistency —Ä–∞–¥–∏ availability
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ISR

**–£—Ä–æ–∫:**
- –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å unclean.leader.election.enable=false –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ç–æ–ø–∏–∫–æ–≤
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å ISR size (if ISR < min.insync.replicas ‚Üí alert)
- –ï—Å–ª–∏ ISR –ø—É—Å—Ç, –ª—É—á—à–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å, —á–µ–º –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö

### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 5: PostgreSQL + Patroni 2021 - DCS –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

**–ß—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å:**
- PostgreSQL cluster —Å Patroni + etcd
- etcd –∫–ª–∞—Å—Ç–µ—Ä —Å—Ç–∞–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (—Å–µ—Ç–µ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞)
- Patroni –Ω–∞ Primary –Ω–µ –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å lease –≤ etcd
- Patroni –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ DEMOTE Primary –≤ Standby
- Patroni –Ω–∞ Standby –Ω–µ –º–æ–∂–µ—Ç –≤–∑—è—Ç—å lease (etcd –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
- –í–°–ï —É–∑–ª—ã –≤ Standby mode
- PostgreSQL –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∑–∞–ø–∏—Å–∏

**–ü–æ—á–µ–º—É –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- Single point of failure: etcd
- Patroni —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å DCS

**–£—Ä–æ–∫:**
- etcd/DCS –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞–¥—ë–∂–Ω–µ–µ, —á–µ–º —Å–∞–º–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∂–∏–º "degraded mode": –µ—Å–ª–∏ DCS –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–æ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ PG —É–∑–ª–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã, –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å —Ç–µ–∫—É—â–∏–º Primary
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å DCS –æ—Ç–¥–µ–ª—å–Ω–æ

---

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –í—ã–±–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É–∑–ª–æ–≤

**–î–ª—è production —Å–∏—Å—Ç–µ–º:**
```
–ù–∏–∑–∫–∞—è –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å (dev/staging):
‚Üí 1 —É–∑–µ–ª (–±–µ–∑ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏)

–°—Ä–µ–¥–Ω—è—è –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å (–Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ production –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è):
‚Üí 3 —É–∑–ª–∞
‚Üí –ü–µ—Ä–µ–∂–∏–≤—ë—Ç –ø–∞–¥–µ–Ω–∏–µ 1 —É–∑–ª–∞
‚Üí –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å —Å—Ç–æ–∏–º–æ—Å—Ç—å/–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å

–í—ã—Å–æ–∫–∞—è –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å (—Ñ–∏–Ω–∞–Ω—Å—ã, –ø–ª–∞—Ç–µ–∂–∏):
‚Üí 5 —É–∑–ª–æ–≤
‚Üí –ü–µ—Ä–µ–∂–∏–≤—ë—Ç –ø–∞–¥–µ–Ω–∏–µ 2 —É–∑–ª–æ–≤
‚Üí –í–æ–∑–º–æ–∂–Ω–æ geo-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:
‚Üí 7 —É–∑–ª–æ–≤
‚Üí –ü–µ—Ä–µ–∂–∏–≤—ë—Ç –ø–∞–¥–µ–Ω–∏–µ 3 —É–∑–ª–æ–≤
‚Üí –î–æ—Ä–æ–≥–æ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–¥–∫–æ
```

**–ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —á—ë—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (2, 4, 6):**
- 2 —É–∑–ª–∞: –Ω–µ –ø–µ—Ä–µ–∂–∏–≤—É—Ç –ø–∞–¥–µ–Ω–∏–µ –¥–∞–∂–µ 1 —É–∑–ª–∞ (–Ω–µ—Ç –∫–≤–æ—Ä—É–º–∞)
- 4 —É–∑–ª–∞: —Ç–∞–∫–∞—è –∂–µ —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å, –∫–∞–∫ 3, –Ω–æ –¥–æ—Ä–æ–∂–µ
- 6 —É–∑–ª–æ–≤: —Ç–∞–∫–∞—è –∂–µ —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å, –∫–∞–∫ 5, –Ω–æ –¥–æ—Ä–æ–∂–µ

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–µ–ª—å–∑—è –ø–æ—Ç–µ—Ä—è—Ç—å):**
```
Kafka:
acks=all
min.insync.replicas=2
replication.factor=3
unclean.leader.election.enable=false
enable.idempotence=true

MongoDB:
writeConcern: { w: "majority", j: true, wtimeout: 5000 }
readConcern: "majority"

PostgreSQL:
synchronous_commit = on
synchronous_standby_names = 'ANY 1 (standby1, standby2)'
data_checksums = on

etcd:
(–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å –∫–≤–æ—Ä—É–º–æ–º)
```

**–û–±—ã—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–º–æ–∂–Ω–æ –ø–æ—Ç–µ—Ä—è—Ç—å —Ä–µ–¥–∫–æ):**
```
Kafka:
acks=all
min.insync.replicas=2
replication.factor=3

MongoDB:
writeConcern: { w: "majority" }

PostgreSQL:
synchronous_commit = local
```

**–ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ª–æ–≥–∏, –º–µ—Ç—Ä–∏–∫–∏):**
```
Kafka:
acks=1 –∏–ª–∏ –¥–∞–∂–µ acks=0
replication.factor=2

MongoDB:
writeConcern: { w: 1 }

PostgreSQL:
synchronous_commit = off
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
```
Cluster Health:
‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ live —É–∑–ª–æ–≤ >= –∫–≤–æ—Ä—É–º
‚úÖ –ï—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –ª–∏–¥–µ—Ä
‚úÖ –ù–µ—Ç —á–∞—Å—Ç—ã—Ö –ø–µ—Ä–µ–∏–∑–±—Ä–∞–Ω–∏–π (< 2/hour)

Replication:
‚úÖ Replication lag < 10 —Å–µ–∫—É–Ω–¥ (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)
‚úÖ Replication lag < 60 —Å–µ–∫—É–Ω–¥ (–∫—Ä–∏—Ç–∏—á–Ω–æ)
‚úÖ –í—Å–µ —É–∑–ª—ã –≤ ISR/sync

Performance:
‚úÖ Request latency p99 < 1 —Å–µ–∫—É–Ω–¥–∞
‚úÖ Request timeout rate < 1%
‚úÖ Throughput –Ω–µ –¥–µ–≥—Ä–∞–¥–∏—Ä—É–µ—Ç

Durability:
‚úÖ Committed –∑–∞–ø–∏—Å–∏ –Ω–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —É–∑–ª–æ–≤
‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ checksum
‚úÖ Disk space > 20% free
```

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã:**
```
CRITICAL (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è):
- –ö–≤–æ—Ä—É–º –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω > 1 –º–∏–Ω—É—Ç–∞
- –ù–µ—Ç –ª–∏–¥–µ—Ä–∞ > election timeout
- Request timeout rate > 10%
- Data corruption detected

WARNING (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞):
- –û–¥–∏–Ω —É–∑–µ–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- Replication lag > 10 —Å–µ–∫—É–Ω–¥
- Leader –ø–µ—Ä–µ–∏–∑–±—Ä–∞–Ω > 2 —Ä–∞–∑ –∑–∞ —á–∞—Å
- Disk space < 20%
```

### 4. –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

**–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```
–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å dashboard —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ warnings
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å disk space

–ï–∂–µ–º–µ—Å—è—á–Ω–æ:
- –¢–µ—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ backup
- Chaos engineering test (—É–±–∏—Ç—å –æ–¥–∏–Ω —É–∑–µ–ª)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å runbooks

–ï–∂–µ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ:
- Disaster recovery drill (—É–±–∏—Ç—å –≤–µ—Å—å –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- Review incidents
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
```
1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ staging
2. –ü—Ä–∏–º–µ–Ω—è—Ç—å –Ω–∞ production –ø–æ –æ—á–µ—Ä–µ–¥–∏ (rolling update)
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –ò–º–µ—Ç—å rollback –ø–ª–∞–Ω
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π:**
```
1. –ß–∏—Ç–∞—Ç—å release notes (–æ—Å–æ–±–µ–Ω–Ω–æ breaking changes)
2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å upgrade –Ω–∞ staging
3. Backup –ø–µ—Ä–µ–¥ upgrade
4. Rolling upgrade (–ø–æ –æ–¥–Ω–æ–º—É —É–∑–ª—É)
5. –ù–µ –æ–±–Ω–æ–≤–ª—è—Ç—å –≤—Å–µ —É–∑–ª—ã —Å—Ä–∞–∑—É
6. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–µ—Ä—Å–∏–π
```

### 5. Disaster Recovery

**–°—Ü–µ–Ω–∞—Ä–∏–∏:**
```
–°—Ü–µ–Ω–∞—Ä–∏–π 1: –£–ø–∞–ª –æ–¥–∏–Ω —É–∑–µ–ª
‚Üí –ö–≤–æ—Ä—É–º –µ—Å—Ç—å ‚Üí –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚Üí –î–µ–π—Å—Ç–≤–∏–µ: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É–∑–µ–ª –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è

–°—Ü–µ–Ω–∞—Ä–∏–π 2: –£–ø–∞–ª–æ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É–∑–ª–æ–≤
‚Üí –ö–≤–æ—Ä—É–º–∞ –Ω–µ—Ç ‚Üí –°–∏—Å—Ç–µ–º–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
‚Üí –î–µ–π—Å—Ç–≤–∏–µ: –°—Ä–æ—á–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —É–∑–µ–ª –¥–ª—è –∫–≤–æ—Ä—É–º–∞

–°—Ü–µ–Ω–∞—Ä–∏–π 3: –£–ø–∞–ª –≤–µ—Å—å –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä
‚Üí Geo-replica –≤ –¥—Ä—É–≥–æ–º —Ä–µ–≥–∏–æ–Ω–µ
‚Üí –î–µ–π—Å—Ç–≤–∏–µ: Failover –Ω–∞ –¥—Ä—É–≥–æ–π —Ä–µ–≥–∏–æ–Ω (–≤—Ä—É—á–Ω—É—é –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

–°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚Üí Backup + point-in-time recovery
‚Üí –î–µ–π—Å—Ç–≤–∏–µ: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–∞–ª–∏–¥–Ω–æ–≥–æ backup
```

**Backup —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:**
```
–î–ª—è consistence:
- Snapshot –≤—Å–µ—Ö —É–∑–ª–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–∏–ª–∏ –±–ª–∏–∑–∫–æ –ø–æ –≤—Ä–µ–º–µ–Ω–∏)
- –ó–∞–ø–∏—Å–∞—Ç—å LSN/offset/revision –Ω–∞ –º–æ–º–µ–Ω—Ç snapshot
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å backup (test restore)

–î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–∏—Å—Ç–µ–º:
- Continuous backup (WAL archiving –≤ PostgreSQL, binlog –≤ MySQL)
- Point-in-time recovery –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å
- Geo-replicated backups
```

---

## –ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å–µ–º–∞–Ω—Ç–∏–∫

### –ö–æ–º–±–∏–Ω–∞—Ü–∏—è 1: Strong Consistency (–°—Ç—Ä–æ–≥–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –°–∏—Å—Ç–µ–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—ë–º

**–ö–∞–∫ –¥–æ—Å—Ç–∏—á—å:**
```
Leader Election: ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (–æ–¥–∏–Ω writer)
Log Replication: ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è
Commit: ‚úÖ Majority ACK
Majority Agreement: ‚úÖ –í—Å–µ–≥–¥–∞ –∫–≤–æ—Ä—É–º
Safety: ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏
Liveness: ‚ö†Ô∏è –ú–æ–∂–µ–º –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å (–µ—Å–ª–∏ –Ω–µ—Ç –∫–≤–æ—Ä—É–º–∞ ‚Üí unavailable)
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```
Kafka: acks=all, min.insync=2, idempotence=true
MongoDB: w:"majority", j:true, readConcern:"majority"
PostgreSQL: synchronous_commit=on, synchronous_standby
etcd: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

**Trade-offs:**
- ‚úÖ –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ—Ç–µ—Ä—è–µ–º committed –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –±—É–¥–µ—Ç inconsistency
- ‚ùå –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (–∂–¥—ë–º –∫–≤–æ—Ä—É–º–∞)
- ‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–Ω—ã –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞

### –ö–æ–º–±–∏–Ω–∞—Ü–∏—è 2: Eventual Consistency (–ò—Ç–æ–≥–æ–≤–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ (–ª–∞–π–∫–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
- –ú–µ—Ç—Ä–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ö–∞–∫ –¥–æ—Å—Ç–∏—á—å:**
```
Leader Election: ‚ö†Ô∏è –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (multi-master –≤–æ–∑–º–æ–∂–µ–Ω)
Log Replication: ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è
Commit: ‚ö†Ô∏è –õ–æ–∫–∞–ª—å–Ω—ã–π commit (–±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è —Ä–µ–ø–ª–∏–∫)
Majority Agreement: ‚ùå –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
Safety: ‚ö†Ô∏è –ë–∞–∑–æ–≤—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏
Liveness: ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```
Kafka: acks=1 –∏–ª–∏ acks=0
MongoDB: w:1, readConcern:"local"
PostgreSQL: synchronous_commit=off
Cassandra: CL=ONE (read and write)
```

**Trade-offs:**
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø–∏—Å–∏
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω—ã –¥–∞–∂–µ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞
- ‚ùå –í–æ–∑–º–æ–∂–Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω–∞—è inconsistency
- ‚ùå –í–æ–∑–º–æ–∂–Ω–∞ –ø–æ—Ç–µ—Ä—è –Ω–µ–¥–∞–≤–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π –ø—Ä–∏ —Å–±–æ—è—Ö

### –ö–æ–º–±–∏–Ω–∞—Ü–∏—è 3: Session Consistency (–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–µ—Å—Å–∏–∏
- –ö–æ—Ä–∑–∏–Ω—ã –ø–æ–∫—É–ø–æ–∫
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ö–∞–∫ –¥–æ—Å—Ç–∏—á—å:**
```
Leader Election: ‚úÖ –î–∞ (–Ω–æ —á—Ç–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å —Ä–µ–ø–ª–∏–∫)
Log Replication: ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è
Commit: ‚úÖ Majority ACK –¥–ª—è –∑–∞–ø–∏—Å–∏
Majority Agreement: ‚úÖ –î–ª—è –∑–∞–ø–∏—Å–∏
Safety: ‚úÖ –î–ª—è –∑–∞–ø–∏—Å–∏
Liveness: ‚úÖ –î–ª—è —á—Ç–µ–Ω–∏—è (–¥–∞–∂–µ –∏–∑ –æ—Ç—Å—Ç–∞—é—â–∏—Ö —Ä–µ–ø–ª–∏–∫)
```

**–ì–∞—Ä–∞–Ω—Ç–∏—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –∑–∞–ø–∏—Å–∏ (read-your-writes)
- –î—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```
MongoDB: w:"majority" –¥–ª—è –∑–∞–ø–∏—Å–∏, readPreference:"primary" –¥–ª—è —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
PostgreSQL: synchronous –¥–ª—è –∑–∞–ø–∏—Å–∏, async replicas –¥–ª—è —á—Ç–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

### –ö–æ–º–±–∏–Ω–∞—Ü–∏—è 4: Causal Consistency (–ü—Ä–∏—á–∏–Ω–Ω–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –æ—Ç–≤–µ—Ç—ã (reply)
- –°–∏—Å—Ç–µ–º—ã —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- –ß–∞—Ç—ã

**–ö–∞–∫ –¥–æ—Å—Ç–∏—á—å:**
```
Leader Election: ‚úÖ –î–∞
Log Replication: ‚úÖ –° —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º causality (version vectors)
Commit: ‚úÖ Majority ACK
Majority Agreement: ‚úÖ –î–∞
Safety: ‚úÖ Causal order preserved
Liveness: ‚úÖ –í—ã—Å–æ–∫–∞—è
```

**–ì–∞—Ä–∞–Ω—Ç–∏—è:**
- –ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è B causally –∑–∞–≤–∏—Å–∏—Ç –æ—Ç A, –≤—Å–µ —É–∑–ª—ã –≤–∏–¥—è—Ç A –ø–µ—Ä–µ–¥ B
- –ù–∞–ø—Ä–∏–º–µ—Ä: –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤—Å–µ–≥–¥–∞ –≤–∏–¥–µ–Ω –ø–æ—Å–ª–µ —Å–∞–º–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```
MongoDB: readConcern:"majority" + causally consistent sessions
Riak: dotted version vectors
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**Consensus Semantics** ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ –Ω–∞–¥—ë–∂–Ω—ã—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º. –ë–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∏ consistency, –Ω–∏ availability, –Ω–∏ durability –¥–∞–Ω–Ω—ã—Ö.

### –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

1. **Leader Election** —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É "–∫—Ç–æ –≥–ª–∞–≤–Ω—ã–π"
   - –û–¥–∏–Ω –ª–∏–¥–µ—Ä –∏–∑–±–µ–≥–∞–µ—Ç split-brain
   - Randomized timeouts –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç liveness
   - Term/epoch –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç zombie leaders

2. **Log Replication** –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –∏—Å—Ç–æ—Ä–∏—é
   - –í—Å–µ —É–∑–ª—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –æ–¥–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
   - Log matching property –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
   - –û—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ —Ä–µ–ø–ª–∏–∫ ‚Äî –Ω–æ—Ä–º–∞, –Ω–æ –Ω—É–∂–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

3. **Commit Semantics** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ—Å—Ç—å
   - Majority ACK ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - Uncommitted –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Ç–º–µ–Ω–µ–Ω—ã
   - –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç ACK —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ commit

4. **Majority Agreement** –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç inconsistency
   - –ö–≤–æ—Ä—É–º = ‚åäN/2‚åã + 1
   - –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –Ω–µ—á—ë—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ (3, 5, 7)
   - –î–≤–∞ –∫–≤–æ—Ä—É–º–∞ –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è

5. **Safety Guarantees** ‚Äî —ç—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
   - –ü–ª–æ—Ö–æ–µ –ù–ò–ö–û–ì–î–ê –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç
   - Election Safety, Log Matching, State Machine Safety
   - Checksums, validation, testing

6. **Liveness Guarantees** ‚Äî —ç—Ç–æ –ø—Ä–æ–≥—Ä–µ—Å—Å
   - –•–æ—Ä–æ—à–µ–µ –†–ê–ù–û –ò–õ–ò –ü–û–ó–î–ù–û –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç
   - Timeouts –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç liveness
   - Exponential backoff, circuit breakers

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —á–µ–∫–ª–∏—Å—Ç –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

‚úÖ **–î–æ –∑–∞–ø—É—Å–∫–∞ –≤ production:**
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏–ª –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö (–∫—Ä–∏—Ç–∏—á–Ω—ã–µ/–æ–±—ã—á–Ω—ã–µ/–Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ)
- [ ] –í—ã–±—Ä–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ (3, 5 –∏–ª–∏ 7)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ write concern / acks / synchronous_commit
- [ ] –í–∫–ª—é—á–∏–ª checksums / data validation
- [ ] –ù–∞—Å—Ç—Ä–æ–∏–ª timeouts –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
- [ ] –°–æ–∑–¥–∞–ª –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–∫–≤–æ—Ä—É–º, –ª–∞–≥–∏, latency, timeouts)
- [ ] –ù–∞–ø–∏—Å–∞–ª runbooks –¥–ª—è —Ç–∏–ø–∏—á–Ω—ã—Ö –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª failover (—É–±–∏—Ç—å –ª–∏–¥–µ—Ä–∞)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup
- [ ] –ü—Ä–æ–≤—ë–ª chaos engineering —Ç–µ—Å—Ç—ã

‚úÖ **–í–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:**
- [ ] –†–µ–≥—É–ª—è—Ä–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ backup'–æ–≤ (—Ä–∞–∑ –≤ –º–µ—Å—è—Ü)
- [ ] Chaos engineering (—Ä–∞–∑ –≤ –∫–≤–∞—Ä—Ç–∞–ª)
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤

‚úÖ **–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö:**
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ staging
- [ ] Rolling update (–ø–æ –æ–¥–Ω–æ–º—É —É–∑–ª—É)
- [ ] Rollback –ø–ª–∞–Ω
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –§–∏–Ω–∞–ª—å–Ω—ã–π —Å–æ–≤–µ—Ç

> **–ù–∞—á–Ω–∏ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ, —É—Å–ª–æ–∂–Ω—è–π –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.**

–î–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤:
1. –ù–∞—á–Ω–∏ —Å 3 —É–∑–ª–æ–≤
2. –ò—Å–ø–æ–ª—å–∑—É–π majority write concern
3. –í–∫–ª—é—á–∏ –≤—Å–µ safety features (checksums, validation)
4. –ù–∞—Å—Ç—Ä–æ–π –±–∞–∑–æ–≤—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
5. –¢–µ—Å—Ç–∏—Ä—É–π failover —Ä–µ–≥—É–ª—è—Ä–Ω–æ

–ö–æ–≥–¥–∞ —Å–∏—Å—Ç–µ–º–∞ –≤—ã—Ä–∞—Å—Ç–µ—Ç –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω—è—Ç—Å—è, –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é. –ù–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∂–µ—Ä—Ç–≤—É–π safety —Ä–∞–¥–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –±–µ–∑ –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π.

**Consensus ‚Äî —ç—Ç–æ –Ω–µ —Ç–æ, —á—Ç–æ –º–æ–∂–Ω–æ "–ø–æ—á—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ" —Å–¥–µ–ª–∞—Ç—å. –≠—Ç–æ –ª–∏–±–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –ª–∏–±–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∏–º —Å–±–æ—è–º.**

–£–¥–∞—á–∏ –≤ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –Ω–∞–¥—ë–∂–Ω—ã—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º! üöÄ
