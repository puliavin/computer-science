# Retry & Timeout Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –ø–æ–≤—Ç–æ—Ä–æ–≤ –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤)

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [Retry Policies (–ü–æ–ª–∏—Ç–∏–∫–∏ –ø–æ–≤—Ç–æ—Ä–∞)](#retry-policies-–ø–æ–ª–∏—Ç–∏–∫–∏-–ø–æ–≤—Ç–æ—Ä–∞)
3. [Retry Limits (–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–æ–≤)](#retry-limits-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è-–ø–æ–≤—Ç–æ—Ä–æ–≤)
4. [Backoff Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –∑–∞–¥–µ—Ä–∂–µ–∫)](#backoff-semantics-—Å–µ–º–∞–Ω—Ç–∏–∫–∞-–∑–∞–¥–µ—Ä–∂–µ–∫)
5. [Exponential Backoff (–≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)](#exponential-backoff-—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è-–∑–∞–¥–µ—Ä–∂–∫–∞)
6. [Jitter Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏)](#jitter-semantics-—Å–µ–º–∞–Ω—Ç–∏–∫–∞-—Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏)
7. [Deadline Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –¥–µ–¥–ª–∞–π–Ω–æ–≤)](#deadline-semantics-—Å–µ–º–∞–Ω—Ç–∏–∫–∞-–¥–µ–¥–ª–∞–π–Ω–æ–≤)
8. [Timeout Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤)](#timeout-semantics-—Å–µ–º–∞–Ω—Ç–∏–∫–∞-—Ç–∞–π–º–∞—É—Ç–æ–≤)
9. [Cancellation Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –æ—Ç–º–µ–Ω—ã)](#cancellation-semantics-—Å–µ–º–∞–Ω—Ç–∏–∫–∞-–æ—Ç–º–µ–Ω—ã)
10. [Circuit Breaker Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–∫–ª—é—á–∞—Ç–µ–ª—è)](#circuit-breaker-semantics-—Å–µ–º–∞–Ω—Ç–∏–∫–∞-–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ-–≤—ã–∫–ª—é—á–∞—Ç–µ–ª—è)
11. [–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤](#—Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è-—Ç–∞–±–ª–∏—Ü–∞-–≤—Å–µ—Ö-–º–µ—Ö–∞–Ω–∏–∑–º–æ–≤)
12. [Best Practices (–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏)](#best-practices-–ª—É—á—à–∏–µ-–ø—Ä–∞–∫—Ç–∏–∫–∏)
13. [–ó–∞–∫–ª—é—á–µ–Ω–∏–µ](#–∑–∞–∫–ª—é—á–µ–Ω–∏–µ)
14. [–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã](#–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ-–º–∞—Ç–µ—Ä–∏–∞–ª—ã)

---

## –í–≤–µ–¥–µ–Ω–∏–µ

Retry & Timeout Semantics (—Å–µ–º–∞–Ω—Ç–∏–∫–∞ –ø–æ–≤—Ç–æ—Ä–æ–≤ –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤) ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏—Ö, –∫–∞–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –≤–µ—Å—Ç–∏ —Å–µ–±—è –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö, –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö –∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤. –≠—Ç–æ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π** –∞—Å–ø–µ–∫—Ç –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–¥—ë–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.

üí° **–ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è**: –í —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö —Å–±–æ–∏ –∏ –∑–∞–¥–µ—Ä–∂–∫–∏ –Ω–µ–∏–∑–±–µ–∂–Ω—ã. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è retry –∏ timeout –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ –Ω–µ–∑–∞–º–µ—Ç–Ω—ã–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–±—ã—Ç–∏—è, –∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è ‚Äî –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∫–∞—Å–∫–∞–¥–Ω—ã–º –æ—Ç–∫–∞–∑–∞–º –∏ –ø–æ–ª–Ω–æ–º—É –ø–∞–¥–µ–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã.

### –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?

–ü—Ä–µ–¥—Å—Ç–∞–≤—å —Å–∏—Ç—É–∞—Ü–∏—é: —Ç–≤–æ–π —Å–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. –ó–∞–ø—Ä–æ—Å –∑–∞–≤–∏—Å–∞–µ—Ç. –ß—Ç–æ –¥–µ–ª–∞—Ç—å?

1. **–ë–µ–∑ timeout**: –∑–∞–ø—Ä–æ—Å –≤–∏—Å–∏—Ç –≤–µ—á–Ω–æ, –±–ª–æ–∫–∏—Ä—É–µ—Ç thread/connection, –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã –∑–∞–Ω—è—Ç—ã ‚Üí —Å–∏—Å—Ç–µ–º–∞ –ø–∞–¥–∞–µ—Ç
2. **–° timeout, –Ω–æ –±–µ–∑ retry**: –∑–∞–ø—Ä–æ—Å –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –æ—à–∏–±–∫—É (—Ö–æ—Ç—è –±–∞–∑–∞ –±—ã–ª–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–Ω—è—Ç–∞ –∏ —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É –æ—Å–≤–æ–±–æ–¥–∏–ª–∞—Å—å)
3. **–° timeout –∏ retry**: –∑–∞–ø—Ä–æ—Å –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è, –¥–µ–ª–∞–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞, —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–∞–∂–µ –Ω–µ –∑–∞–º–µ—Ç–∏–ª –ø—Ä–æ–±–ª–µ–º—ã

### –î–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è

**Timeout Semantics** –æ—Ç–≤–µ—á–∞—é—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å: "–ö–∞–∫ –¥–æ–ª–≥–æ –∂–¥–∞—Ç—å –æ—Ç–≤–µ—Ç–∞ –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ —Å—á–∏—Ç–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –Ω–µ—É—Å–ø–µ—à–Ω–æ–π?"

**Retry Semantics** –æ—Ç–≤–µ—á–∞—é—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å: "–ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø–æ—Å–ª–µ –Ω–µ—É–¥–∞—á–∏ ‚Äî —Å–¥–∞—Ç—å—Å—è –∏–ª–∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â—ë —Ä–∞–∑?"

–≠—Ç–∏ –º–µ—Ö–∞–Ω–∏–∑–º—ã —Ç–µ—Å–Ω–æ —Å–≤—è–∑–∞–Ω—ã –∏ –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–º–µ—Å—Ç–µ.

---

## Retry Policies (–ü–æ–ª–∏—Ç–∏–∫–∏ –ø–æ–≤—Ç–æ—Ä–∞)

**–ß—Ç–æ —ç—Ç–æ**: Retry Policy (–ø–æ–ª–∏—Ç–∏–∫–∞ –ø–æ–≤—Ç–æ—Ä–∞) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç **–ø—Ä–∞–≤–∏–ª–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –Ω–µ—É–¥–∞—á–∏. –≠—Ç–æ –Ω–∞–±–æ—Ä —É—Å–ª–æ–≤–∏–π, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏—Ö: –∫–æ–≥–¥–∞ –¥–µ–ª–∞—Ç—å retry, —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑, —Å –∫–∞–∫–∏–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏, –∏ –ø—Ä–∏ –∫–∞–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Retry Policy

1. **–ö–∞–∫–∏–µ –æ—à–∏–±–∫–∏ retry-able** (–º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å)
2. **–ö–∞–∫–∏–µ –æ—à–∏–±–∫–∏ non-retryable** (–Ω–µ–ª—å–∑—è –ø–æ–≤—Ç–æ—Ä—è—Ç—å)
3. **–°–∫–æ–ª—å–∫–æ –ø–æ–ø—ã—Ç–æ–∫ –¥–µ–ª–∞—Ç—å** (max retries)
4. **–° –∫–∞–∫–∏–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏** (backoff strategy)
5. **–ö–æ–≥–¥–∞ –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å** (deadline, max duration)

### Retryable vs Non-Retryable –æ—à–∏–±–∫–∏

**Retryable –æ—à–∏–±–∫–∏** (–≤—Ä–µ–º–µ–Ω–Ω—ã–µ, transient):
- Network timeout
- Connection refused (service restarting)
- HTTP 503 Service Unavailable
- HTTP 429 Too Many Requests
- Database deadlock (–º–æ–∂–Ω–æ retry —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é)
- "Resource temporarily unavailable"

**Non-retryable –æ—à–∏–±–∫–∏** (–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ, permanent):
- HTTP 400 Bad Request (–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- HTTP 401 Unauthorized (–Ω–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞)
- HTTP 404 Not Found (—Ä–µ—Å—É—Ä—Å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- Validation errors
- Business logic errors ("insufficient funds")

**–ê–Ω–∞–ª–æ–≥–∏—è –∏–∑ –∂–∏–∑–Ω–∏**: –¢—ã –∑–≤–æ–Ω–∏—à—å –¥—Ä—É–≥—É, –∏ –æ–Ω –Ω–µ –±–µ—Ä—ë—Ç —Ç—Ä—É–±–∫—É.
- **Retryable**: —Ç–µ–ª–µ—Ñ–æ–Ω –∑–∞–Ω—è—Ç –∏–ª–∏ –≤–Ω–µ –∑–æ–Ω—ã –ø–æ–∫—Ä—ã—Ç–∏—è ‚Üí –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç—å —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É
- **Non-retryable**: –Ω–æ–º–µ—Ä –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω ‚Üí –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–≤–æ–Ω–∫–∏ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã

### –ü—Ä–∏–º–µ—Ä—ã –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

#### Kafka Producer Retry Policy

**–°—Ü–µ–Ω–∞—Ä–∏–π**: Producer –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Kafka, –Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É.

```
Retryable –æ—à–∏–±–∫–∏:
- NOT_LEADER_FOR_PARTITION ‚Üí partition leader –º–µ–Ω—è–µ—Ç—Å—è (election)
- NETWORK_EXCEPTION ‚Üí –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–µ—Ç–µ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞
- BROKER_NOT_AVAILABLE ‚Üí broker –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- REQUEST_TIMED_OUT ‚Üí broker –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª –≤–æ–≤—Ä–µ–º—è

Non-retryable –æ—à–∏–±–∫–∏:
- INVALID_TOPIC_EXCEPTION ‚Üí topic –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- RECORD_TOO_LARGE ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ
- INVALID_REQUIRED_ACKS ‚Üí –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- AUTHORIZATION_FAILED ‚Üí –Ω–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
```
# Kafka Producer
retries = 3                    # –º–∞–∫—Å–∏–º—É–º 3 –ø–æ–≤—Ç–æ—Ä–∞
retry.backoff.ms = 100         # –∂–¥–∞—Ç—å 100ms –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
delivery.timeout.ms = 120000   # –æ–±—â–∏–π deadline 2 –º–∏–Ω—É—Ç—ã
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
1. Producer –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
2. –ü–æ–ª—É—á–∞–µ—Ç NOT_LEADER_FOR_PARTITION (leader election –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç)
3. –ñ–¥—ë—Ç 100ms
4. Retry #1: —Å–Ω–æ–≤–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ‚Üí —É—Å–ø–µ—Ö!
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–º–µ—Ç–∏–ª –ø—Ä–æ–±–ª–µ–º—ã

#### PostgreSQL Connection Retry

**–°—Ü–µ–Ω–∞—Ä–∏–π**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL, –Ω–æ –±–∞–∑–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è).

```
Retryable:
- Connection refused ‚Üí –±–∞–∑–∞ –µ—â—ë –Ω–µ –ø–æ–¥–Ω—è–ª–∞—Å—å –ø–æ—Å–ª–µ restart
- Connection timeout ‚Üí —Å–µ—Ç—å –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞
- "too many clients" ‚Üí –≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

Non-retryable:
- Invalid password ‚Üí —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ–≤–µ—Ä–Ω—ã–µ
- Database does not exist ‚Üí –±–∞–∑–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞
- SSL required ‚Üí –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è**:
```
–ü–æ–ø—ã—Ç–∫–∞ 1: —Å—Ä–∞–∑—É ‚Üí Connection refused
–ü–æ–ø—ã—Ç–∫–∞ 2: —á–µ—Ä–µ–∑ 1s ‚Üí Connection refused
–ü–æ–ø—ã—Ç–∫–∞ 3: —á–µ—Ä–µ–∑ 2s ‚Üí Connection refused
–ü–æ–ø—ã—Ç–∫–∞ 4: —á–µ—Ä–µ–∑ 4s ‚Üí Success! (–±–∞–∑–∞ –ø–æ–¥–Ω—è–ª–∞—Å—å)
```

#### Redis Client Retry

**–ü—Ä–∏–º–µ—Ä —Å Redis Cluster**:

```
–°–∏—Ç—É–∞—Ü–∏—è:
Client –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å–∞—Ç—å –∫–ª—é—á: SET user:123 "data"

–û—à–∏–±–∫–∞: MOVED 7008 192.168.1.2:7002
(–∫–ª—é—á –ø–µ—Ä–µ–µ—Ö–∞–ª –Ω–∞ –¥—Ä—É–≥–æ–π —É–∑–µ–ª –∏–∑-–∑–∞ resharding)

Retry policy:
1. –ü–æ–ª—É—á–∏–ª–∏ MOVED ‚Üí —ç—Ç–æ retryable
2. –û–±–Ω–æ–≤–ª—è–µ–º cluster topology –≤ –ø–∞–º—è—Ç–∏
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —É–∑–µ–ª (192.168.1.2:7002)
4. –£—Å–ø–µ—Ö!

–í—Å—ë –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, client library —Å–∫—Ä—ã–≤–∞–µ—Ç —ç—Ç—É —Å–ª–æ–∂–Ω–æ—Å—Ç—å
```

### –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã –ø—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π Retry Policy

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 1: Retry –Ω–∞ non-retryable –æ—à–∏–±–∫–∞—Ö

**–°–∏—Ç—É–∞—Ü–∏—è**: E-commerce —Å–∞–π—Ç. –°–µ—Ä–≤–∏—Å –æ–ø–ª–∞—Ç—ã –≤—ã–∑—ã–≤–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–π payment gateway.

```
–°—Ü–µ–Ω–∞—Ä–∏–π:
User –ø—ã—Ç–∞–µ—Ç—Å—è –æ–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑ —Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º
Payment Gateway –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: HTTP 400 "Insufficient funds"

–ü–ª–æ—Ö–∞—è retry policy:
- –°–µ—Ä–≤–∏—Å retry-–∏—Ç —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å 5 —Ä–∞–∑ —Å exponential backoff
- Payment Gateway –ø–æ–ª—É—á–∞–µ—Ç 5 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –í—Å–µ 5 —Ä–∞–∑ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "Insufficient funds"
- User –∂–¥—ë—Ç 30 —Å–µ–∫—É–Ω–¥ ‚Üí –≤–∏–¥–∏—Ç –æ—à–∏–±–∫—É

–ò—Ç–æ–≥:
- –ü–æ—Ç–µ—Ä—è –≤—Ä–µ–º–µ–Ω–∏ (30 —Å–µ–∫—É–Ω–¥ –≤–º–µ—Å—Ç–æ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞)
- –ù–µ–Ω—É–∂–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ Payment Gateway
- –ü–ª–æ—Ö–æ–π UX
```

**–ö–∞–∫ –Ω–∞–¥–æ**: –ù–µ retry-–∏—Ç—å HTTP 400 –æ—à–∏–±–∫–∏ ‚Äî –æ–Ω–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ.

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 2: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ retry –Ω–∞ retryable –æ—à–∏–±–∫–∞—Ö

**–°–∏—Ç—É–∞—Ü–∏—è**: –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞. Service A –≤—ã–∑—ã–≤–∞–µ—Ç Service B.

```
Timeline:
00:00 - Service B –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (deploy –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏)
00:01 - Service A –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å ‚Üí Connection refused
00:01 - Service A –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–±–µ–∑ retry)
00:02 - Service B –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–Ω—è–ª—Å—è

–ü—Ä–æ–±–ª–µ–º–∞:
- Service B –±—ã–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–≥–æ 2 —Å–µ–∫—É–Ω–¥—ã
- –ù–æ –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è retry –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥–µ–ª–∏ –æ—à–∏–±–∫–∏
- 100+ –∑–∞–ø—Ä–æ—Å–æ–≤ failed, —Ö–æ—Ç—è –º–æ–≥–ª–∏ –±—ã —É—Å–ø–µ—à–Ω–æ retry-–∏—Ç—å—Å—è
```

**–ö–∞–∫ –Ω–∞–¥–æ**: Retry connection refused –æ—à–∏–±–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π.

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 3: Retry –±–µ–∑ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

**–°–∏—Ç—É–∞—Ü–∏—è**: –ü–ª–∞—Ç—ë–∂–Ω—ã–π —Å–µ—Ä–≤–∏—Å —Å–ø–∏—Å—ã–≤–∞–µ—Ç –¥–µ–Ω—å–≥–∏ —Å–æ —Å—á—ë—Ç–∞.

```
–°—Ü–µ–Ω–∞—Ä–∏–π:
Client: POST /api/charge {"user_id": 123, "amount": 100}
Server: —Å–ø–∏—Å—ã–≤–∞–µ—Ç $100, –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ –ë–î, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç response
Network: response —Ç–µ—Ä—è–µ—Ç—Å—è (network glitch)
Client: –Ω–µ –ø–æ–ª—É—á–∏–ª response ‚Üí —Å—á–∏—Ç–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –Ω–µ—É—Å–ø–µ—à–Ω–æ–π
Client: retry ‚Üí POST /api/charge {"user_id": 123, "amount": 100}
Server: —Å–ø–∏—Å—ã–≤–∞–µ—Ç –µ—â—ë $100 (!!)

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø–∏—Å–∞–Ω –¥–≤–∞–∂–¥—ã
- Customer complain
- –í–æ–∑–≤—Ä–∞—Ç –¥–µ–Ω–µ–≥ –≤—Ä—É—á–Ω—É—é
```

**–ö–∞–∫ –Ω–∞–¥–æ**:
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å idempotency key: `POST /api/charge {"user_id": 123, "amount": 100, "idempotency_key": "abc-123"}`
2. Server –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è —Å —Ç–∞–∫–∏–º key —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ ‚Üí –≤–µ—Ä–Ω—É—Ç—å cached —Ä–µ–∑—É–ª—å—Ç–∞—Ç
3. Retry –±–µ–∑–æ–ø–∞—Å–µ–Ω

### –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å Retry Policy

**1. –û–ø—Ä–µ–¥–µ–ª–∏ retryable –æ—à–∏–±–∫–∏**:
- –ß–∏—Ç–∞–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API/–ø—Ä–æ—Ç–æ–∫–æ–ª–∞
- –°–º–æ—Ç—Ä–∏ –Ω–∞ HTTP status codes:
  - 5xx ‚Üí retry (server error)
  - 429 ‚Üí retry —Å backoff (rate limiting)
  - 408 ‚Üí retry (timeout)
  - 4xx (–∫—Ä–æ–º–µ 429, 408) ‚Üí –Ω–µ retry

**2. –û–≥—Ä–∞–Ω–∏—á—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ retry**:
```
max_retries = 3  # –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ

–ü–æ—á–µ–º—É –Ω–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ:
- –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤—Ä–µ–º–µ–Ω–Ω–∞—è ‚Üí retry –±–µ—Å–ø–æ–ª–µ–∑–µ–Ω
- –ë–ª–æ–∫–∏—Ä—É–µ—à—å —Ä–µ—Å—É—Ä—Å—ã (threads, connections)
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—à—å latency –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

**3. –ò—Å–ø–æ–ª—å–∑—É–π –ø–æ–¥—Ö–æ–¥—è—â—É—é backoff —Å—Ç—Ä–∞—Ç–µ–≥–∏—é**:
- Immediate retry ‚Üí –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è (MOVED –≤ Redis)
- Fixed delay ‚Üí –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤
- Exponential backoff ‚Üí –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤ (–ø–æ–¥—Ä–æ–±–Ω–µ–µ –Ω–∏–∂–µ)

**4. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π –æ–±—â–∏–π deadline**:
```
max_retries = 5
–Ω–æ
total_timeout = 30s

–î–∞–∂–µ –µ—Å–ª–∏ –Ω–µ –∏—Å—á–µ—Ä–ø–∞–ª–∏ –≤—Å–µ retry ‚Üí –ø—Ä–µ–∫—Ä–∞—â–∞–µ–º –ø–æ—Å–ª–µ 30s
```

**5. –î–µ–ª–∞–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º–∏**:
- –ò—Å–ø–æ–ª—å–∑—É–π unique operation IDs
- –ü—Ä–∏–º–µ–Ω—è–π optimistic locking (version fields)
- –ü—Ä–æ–µ–∫—Ç–∏—Ä—É–π API –∫–∞–∫ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ (PUT –≤–º–µ—Å—Ç–æ POST –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ)

**6. –õ–æ–≥–∏—Ä—É–π retry-–ø–æ–ø—ã—Ç–∫–∏**:
```
[WARN] Request failed, retrying (attempt 1/3): Connection timeout
[WARN] Request failed, retrying (attempt 2/3): Connection timeout
[INFO] Request succeeded on retry attempt 3
```

–≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ.

---

## Retry Limits (–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–æ–≤)

**–ß—Ç–æ —ç—Ç–æ**: Retry Limits (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–æ–≤) ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º—ã, –∫–æ—Ç–æ—Ä—ã–µ **–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—Ç** –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å retry-–ø–æ–ø—ã—Ç–æ–∫, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Ü–∏–∫–ª—ã –∏ —á—Ä–µ–∑–º–µ—Ä–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤.

### –¢–∏–ø—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

#### 1. Max Retry Count (–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫)

**–°–∞–º–æ–µ –ø—Ä–æ—Å—Ç–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ**: —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –º–∞–∫—Å–∏–º—É–º retry-–∏—Ç—å.

```
max_retries = 3

–ü–æ–ø—ã—Ç–∫–∞ 1: fail
–ü–æ–ø—ã—Ç–∫–∞ 2: fail (retry #1)
–ü–æ–ø—ã—Ç–∫–∞ 3: fail (retry #2)
–ü–æ–ø—ã—Ç–∫–∞ 4: fail (retry #3)
‚Üí –ü—Ä–µ–∫—Ä–∞—â–∞–µ–º, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É
```

**–ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ**:
- **1-3 retry** ‚Üí –¥–ª—è fast operations (sub-second), –∫–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ low latency
- **3-5 retry** ‚Üí —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤
- **5-10 retry** ‚Üí –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, –≥–¥–µ –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–∞
- **Unlimited** ‚Üí —Ç–æ–ª—å–∫–æ –¥–ª—è idempotent background jobs —Å exponential backoff

**–ü—Ä–∏–º–µ—Ä—ã**:
```
Kafka Producer: retries = 3 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
AWS SDK: max_attempts = 3
gRPC: default 5 retry attempts
```

#### 2. Max Total Duration (–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –æ–±—â–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

**–ü—Ä–æ–±–ª–µ–º–∞ —Å max_retries**: –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å exponential backoff —Å –±–æ–ª—å—à–∏–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏, –¥–∞–∂–µ 3 retry –º–æ–≥—É—Ç –∑–∞–Ω—è—Ç—å –º–∏–Ω—É—Ç—ã.

```
–ü—Ä–∏–º–µ—Ä —Å exponential backoff:
–ü–æ–ø—ã—Ç–∫–∞ 1: 0s
–ü–æ–ø—ã—Ç–∫–∞ 2: 1s (retry #1)
–ü–æ–ø—ã—Ç–∫–∞ 3: 2s (retry #2)
–ü–æ–ø—ã—Ç–∫–∞ 4: 4s (retry #3)
–ü–æ–ø—ã—Ç–∫–∞ 5: 8s (retry #4)
–ü–æ–ø—ã—Ç–∫–∞ 6: 16s (retry #5)
–ü–æ–ø—ã—Ç–∫–∞ 7: 32s (retry #6)

–ò—Ç–æ–≥–æ: 63 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è 6 retry!
```

**–†–µ—à–µ–Ω–∏–µ**: –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å **–æ–±—â–µ–µ –≤—Ä–µ–º—è**:

```
max_retries = 10
max_total_duration = 30s

–î–∞–∂–µ –µ—Å–ª–∏ –Ω–µ –∏—Å—á–µ—Ä–ø–∞–ª–∏ 10 –ø–æ–ø—ã—Ç–æ–∫, –ø–æ—Å–ª–µ 30 —Å–µ–∫—É–Ω–¥ ‚Üí –ø—Ä–µ–∫—Ä–∞—â–∞–µ–º
```

**Kafka Producer –ø—Ä–∏–º–µ—Ä**:
```
delivery.timeout.ms = 120000  # 2 –º–∏–Ω—É—Ç—ã –º–∞–∫—Å–∏–º—É–º
retries = Integer.MAX_VALUE   # unlimited retry

–ù–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ retry –ø—Ä–µ–∫—Ä–∞—Ç—è—Ç—Å—è —á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã
```

#### 3. Per-Operation Timeout (–¢–∞–π–º–∞—É—Ç –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é)

**–ß—Ç–æ —ç—Ç–æ**: –ö–∞–∂–¥–∞—è –æ—Ç–¥–µ–ª—å–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∏–º–µ–µ—Ç —Å–≤–æ–π timeout.

```
request_timeout = 5s
max_retries = 3

–ü–æ–ø—ã—Ç–∫–∞ 1: –Ω–∞—á–∏–Ω–∞–µ–º –∑–∞–ø—Ä–æ—Å, —á–µ—Ä–µ–∑ 5s ‚Üí timeout
–ü–æ–ø—ã—Ç–∫–∞ 2: retry, –Ω–∞—á–∏–Ω–∞–µ–º –∑–∞–ø—Ä–æ—Å, —á–µ—Ä–µ–∑ 2s ‚Üí —É—Å–ø–µ—Ö!

–ï—Å–ª–∏ –±—ã –Ω–µ –±—ã–ª–æ per-operation timeout:
–ü–æ–ø—ã—Ç–∫–∞ 1: –Ω–∞—á–∏–Ω–∞–µ–º –∑–∞–ø—Ä–æ—Å, –≤–∏—Å–∏—Ç –≤–µ—á–Ω–æ...
```

**–í–∞–∂–Ω–æ**: `total_timeout ‚â† request_timeout * max_retries`

```
request_timeout = 10s
max_retries = 3
total_timeout = 30s

–ù–ï 40s (10s * 4 –ø–æ–ø—ã—Ç–∫–∏)!
```

#### 4. Rate Limiting (–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ –≤—Å–µ –∫–ª–∏–µ–Ω—Ç—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ retry-—è—Ç ‚Üí thundering herd.

**–†–µ—à–µ–Ω–∏–µ**: –û–≥—Ä–∞–Ω–∏—á—å —á–∞—Å—Ç–æ—Ç—É retry –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞.

```
max_retry_rate = 10 requests/second

–ï—Å–ª–∏ –º–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ü–∏–π fail –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:
- –ù–µ retry-–∏–º –≤—Å–µ —Å—Ä–∞–∑—É
- Retry-–∏–º –º–∞–∫—Å–∏–º—É–º 10/sec
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ–º –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω—è–µ–º
```

**RabbitMQ –ø—Ä–∏–º–µ—Ä**:
```
Consumer –ø–æ–ª—É—á–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ failed ‚Üí nack with requeue
RabbitMQ –Ω–µ —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å
–ñ–¥—ë—Ç –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å tight retry loop)
```

### –ó–∞—á–µ–º –Ω—É–∂–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è?

#### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ retry-—Ü–∏–∫–ª—ã

**–°—Ü–µ–Ω–∞—Ä–∏–π**: Service A –≤—ã–∑—ã–≤–∞–µ—Ç Service B. Service B –∏–º–µ–µ—Ç –±–∞–≥ –∏ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTTP 500.

```
–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π:
–ü–æ–ø—ã—Ç–∫–∞ 1: HTTP 500
–ü–æ–ø—ã—Ç–∫–∞ 2: HTTP 500
–ü–æ–ø—ã—Ç–∫–∞ 3: HTTP 500
...
–ü–æ–ø—ã—Ç–∫–∞ 1000: HTTP 500
...

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- Request –≤–∏—Å–∏—Ç –≤–µ—á–Ω–æ
- Thread –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
- –ë–µ—Å–ø–æ–ª–µ–∑–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ Service B
```

**–° –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏**:
```
max_retries = 3
max_duration = 10s

–ü–æ–ø—ã—Ç–∫–∞ 1-4: HTTP 500
–ß–µ—Ä–µ–∑ 10s: –ø—Ä–µ–∫—Ä–∞—â–∞–µ–º, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É
```

#### –ü—Ä–æ–±–ª–µ–º–∞ 2: Thundering Herd (–≠—Ñ—Ñ–µ–∫—Ç —Å—Ç–∞–¥–∞)

**–°—Ü–µ–Ω–∞—Ä–∏–π**: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–ø–∞–ª–∞ –Ω–∞ 5 —Å–µ–∫—É–Ω–¥. 1000 –∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–µ–ª–∞—é—Ç –∑–∞–ø—Ä–æ—Å—ã.

```
–ë–µ–∑ jitter –∏ rate limiting:
T=0s: Database –ø–∞–¥–∞–µ—Ç
T=0s: 1000 –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–∞—é—Ç connection refused
T=0s: 1000 –∫–ª–∏–µ–Ω—Ç–æ–≤ –∂–¥—É—Ç 1s –¥–ª—è retry
T=1s: 1000 –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ retry
T=1s: Database –µ—â—ë –Ω–µ –ø–æ–¥–Ω—è–ª–∞—Å—å
T=1s: 1000 –∫–ª–∏–µ–Ω—Ç–æ–≤ –∂–¥—É—Ç 2s
T=3s: 1000 –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ retry
T=3s: Database –µ—â—ë –Ω–µ –ø–æ–¥–Ω—è–ª–∞—Å—å
T=3s: 1000 –∫–ª–∏–µ–Ω—Ç–æ–≤ –∂–¥—É—Ç 4s
T=7s: 1000 –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ retry
T=7s: Database –ø–æ–¥–Ω—è–ª–∞—Å—å, –Ω–æ –ø–æ–ª—É—á–∏–ª–∞ burst –∏–∑ 1000 requests
T=7s: Database –ø–∞–¥–∞–µ—Ç –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏!

–¶–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è...
```

**–° jitter –∏ rate limiting**:
```
T=0s: 1000 –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–∞—é—Ç connection refused
T=0s: Retry-–ø–æ–ø—ã—Ç–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤–æ –≤—Ä–µ–º–µ–Ω–∏ (jitter)
T=1-2s: –∫–ª–∏–µ–Ω—Ç—ã retry –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ
T=5s: Database –ø–æ–¥–Ω—è–ª–∞—Å—å
T=5-7s: –ö–ª–∏–µ–Ω—Ç—ã –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è
T=7s: –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
```

#### –ü—Ä–æ–±–ª–µ–º–∞ 3: Resource Exhaustion (–ò—Å—Ç–æ—â–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤)

**–°—Ü–µ–Ω–∞—Ä–∏–π**: Microservice —Å 100 threads –¥–µ–ª–∞–µ—Ç –≤—ã–∑–æ–≤—ã –≤ –º–µ–¥–ª–µ–Ω–Ω—ã–π external API.

```
–ë–µ–∑ timeout –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é:
Thread 1: request ‚Üí –≤–∏—Å–∏—Ç 5 –º–∏–Ω—É—Ç
Thread 2: request ‚Üí –≤–∏—Å–∏—Ç 5 –º–∏–Ω—É—Ç
...
Thread 100: request ‚Üí –≤–∏—Å–∏—Ç 5 –º–∏–Ω—É—Ç

–ß–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É:
- –í—Å–µ 100 threads –∑–∞–Ω—è—Ç—ã –≤–∏—Å—è—â–∏–º–∏ requests
- –ù–æ–≤—ã–µ requests –Ω–µ –º–æ–≥—É—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å—Å—è
- Service –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç –æ—Ç–≤–µ—á–∞—Ç—å
```

**–° timeout**:
```
request_timeout = 10s
max_retries = 2

Thread 1: request ‚Üí timeout —á–µ—Ä–µ–∑ 10s ‚Üí retry ‚Üí timeout ‚Üí retry ‚Üí fail
Thread 1 –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ ~30s, –∞ –Ω–µ —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç
```

### –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç: AWS S3 Outage Amplification (2017)

–í 2017 –≥–æ–¥—É AWS S3 –≤ US-EAST-1 —Ä–µ–≥–∏–æ–Ω–µ –∏—Å–ø—ã—Ç–∞–ª partial outage. –ü—Ä–æ–±–ª–µ–º–∞ —É—Å—É–≥—É–±–∏–ª–∞—Å—å –∏–∑-–∑–∞ retry-–ª–æ–≥–∏–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤:

```
–°–∏—Ç—É–∞—Ü–∏—è:
1. S3 –Ω–∞—á–∞–ª –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞—Ç—å (latency —É–≤–µ–ª–∏—á–∏–ª–∞—Å—å —Å 50ms –¥–æ 5s)
2. –ö–ª–∏–µ–Ω—Ç—ã –Ω–∞—á–∞–ª–∏ –ø–æ–ª—É—á–∞—Ç—å timeouts
3. –ö–ª–∏–µ–Ω—Ç—ã retry-–∏–ª–∏ –∑–∞–ø—Ä–æ—Å—ã (–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)
4. –ù–û –º–Ω–æ–≥–∏–µ –∫–ª–∏–µ–Ω—Ç—ã retry-–∏–ª–∏ –ë–ï–ó backoff
5. –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ S3 —É–¥–≤–æ–∏–ª–∞—Å—å, —É—Ç—Ä–æ–∏–ª–∞—Å—å
6. S3 —Å—Ç–∞–ª –æ—Ç–≤–µ—á–∞—Ç—å –µ—â—ë –º–µ–¥–ª–µ–Ω–Ω–µ–µ
7. –ï—â—ë –±–æ–ª—å—à–µ timeouts ‚Üí –µ—â—ë –±–æ–ª—å—à–µ retry
8. Positive feedback loop
9. Partial outage –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª—Å—è –≤ –ø–æ–ª–Ω—ã–π outage

–ß—Ç–æ –ø–æ–º–æ–≥–ª–æ –±—ã:
- Exponential backoff —Å jitter
- Circuit breaker (stop retry –ø–æ—Å–ª–µ N failures)
- Rate limiting –Ω–∞ retry
```

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç: Retry Storm –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞—Ö

**–°—Ü–µ–Ω–∞—Ä–∏–π**: –£ —Ç–µ–±—è 10 –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤, –∫–∞–∂–¥—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç –¥—Ä—É–≥–∏–µ.

```
Chain:
Frontend ‚Üí ServiceA ‚Üí ServiceB ‚Üí ServiceC ‚Üí Database

ServiceC –∏–º–µ–µ—Ç –±–∞–≥ ‚Üí –ø–∞–¥–∞–µ—Ç
ServiceB retry-–∏—Ç –≤—ã–∑–æ–≤—ã –∫ ServiceC (3 —Ä–∞–∑–∞)
ServiceA retry-–∏—Ç –≤—ã–∑–æ–≤—ã –∫ ServiceB (3 —Ä–∞–∑–∞)
Frontend retry-–∏—Ç –≤—ã–∑–æ–≤—ã –∫ ServiceA (3 —Ä–∞–∑–∞)

Amplification:
Frontend –¥–µ–ª–∞–µ—Ç 1 –∑–∞–ø—Ä–æ—Å
‚Üí ServiceA –¥–µ–ª–∞–µ—Ç 3 –∑–∞–ø—Ä–æ—Å–∞ (retry)
‚Üí ServiceB –¥–µ–ª–∞–µ—Ç 3*3=9 –∑–∞–ø—Ä–æ—Å–æ–≤
‚Üí ServiceC –ø–æ–ª—É—á–∞–µ—Ç 3*3*3=27 –∑–∞–ø—Ä–æ—Å–æ–≤

–û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí 27 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ ServiceC!
```

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π **deadline propagation** (–ø–æ–¥—Ä–æ–±–Ω–µ–µ –Ω–∏–∂–µ) ‚Äî –ø–µ—Ä–µ–¥–∞–≤–∞–π deadline –ø–æ —Ü–µ–ø–æ—á–∫–µ, —á—Ç–æ–±—ã upstream —Å–µ—Ä–≤–∏—Å—ã –∑–Ω–∞–ª–∏, –∫–æ–≥–¥–∞ –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å retry.

### –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å Retry Limits

**1. –í—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π max_retries**:
```
‚úÖ max_retries = 3
‚ùå max_retries = unlimited (—Ç–æ–ª—å–∫–æ –¥–ª—è background jobs!)
```

**2. –ò—Å–ø–æ–ª—å–∑—É–π per-operation timeout**:
```
request_timeout = 2s  # –∫–∞–∂–¥–∞—è –ø–æ–ø—ã—Ç–∫–∞
total_timeout = 10s   # –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –≤–º–µ—Å—Ç–µ
```

**3. –ü—Ä–∏–º–µ–Ω—è–π jitter** (—Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å –≤ backoff):
```
backoff = base_delay * 2^attempt + random(0, base_delay)

–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç thundering herd
```

**4. –ú–æ–Ω–∏—Ç–æ—Ä—å retry metrics**:
```
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ retry (–ø–æ –ø—Ä–∏—á–∏–Ω–∞–º)
- –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö retry
- Latency —Å —É—á—ë—Ç–æ–º retry
- Amplification factor
```

**5. –ò—Å–ø–æ–ª—å–∑—É–π circuit breaker**:
```
–ï—Å–ª–∏ 50% –∑–∞–ø—Ä–æ—Å–æ–≤ fail –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥
‚Üí –û—Ç–∫—Ä—ã—Ç—å circuit
‚Üí –ü—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å retry –Ω–∞ 30 —Å–µ–∫—É–Ω–¥
‚Üí –î–∞—Ç—å —Å–∏—Å—Ç–µ–º–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è
```

---

## Backoff Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –∑–∞–¥–µ—Ä–∂–µ–∫)

**–ß—Ç–æ —ç—Ç–æ**: Backoff Semantics (—Å–µ–º–∞–Ω—Ç–∏–∫–∞ –∑–∞–¥–µ—Ä–∂–µ–∫) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, **—Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∂–¥–∞—Ç—å** –º–µ–∂–¥—É retry-–ø–æ–ø—ã—Ç–∫–∞–º–∏. –≠—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ "–ø–æ–¥–æ–∂–¥–∏ —Å–µ–∫—É–Ω–¥—É –∏ –ø–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞" ‚Äî —ç—Ç–æ —Ü–µ–ª–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–æ–π –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º.

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω backoff?

**–ü—Ä–æ–±–ª–µ–º–∞ immediate retry** (–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø–æ–≤—Ç–æ—Ä):

```
–ë–µ–∑ backoff:
T=0.000s: –ü–æ–ø—ã—Ç–∫–∞ 1 ‚Üí fail (database –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞)
T=0.001s: –ü–æ–ø—ã—Ç–∫–∞ 2 ‚Üí fail (database –≤—Å—ë –µ—â—ë –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞)
T=0.002s: –ü–æ–ø—ã—Ç–∫–∞ 3 ‚Üí fail
T=0.003s: –ü–æ–ø—ã—Ç–∫–∞ 4 ‚Üí fail
...

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- –°–æ–∑–¥–∞—ë–º –µ—â—ë –±–æ–ª—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É
- –°–∏—Å—Ç–µ–º–∞ –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è
- –í—Å–µ retry –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã
```

**–° backoff**:
```
T=0.0s: –ü–æ–ø—ã—Ç–∫–∞ 1 ‚Üí fail (database –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞)
T=1.0s: –ü–æ–ø—ã—Ç–∫–∞ 2 ‚Üí fail (database –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è)
T=3.0s: –ü–æ–ø—ã—Ç–∫–∞ 3 ‚Üí success! (database –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å)

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- –î–∞–ª–∏ —Å–∏—Å—Ç–µ–º–µ –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è
- Retry –æ–∫–∞–∑–∞–ª—Å—è –ø–æ–ª–µ–∑–Ω—ã–º
- –ù–µ —Å–æ–∑–¥–∞–ª–∏ –ª–∏—à–Ω—é—é –Ω–∞–≥—Ä—É–∑–∫—É
```

### –¢–∏–ø—ã Backoff —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

#### 1. No Backoff (–ë–µ–∑ –∑–∞–¥–µ—Ä–∂–∫–∏)

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è**: Retry –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ, –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è.

```
–ü–æ–ø—ã—Ç–∫–∞ 1: fail
–ü–æ–ø—ã—Ç–∫–∞ 2: —Å—Ä–∞–∑—É –∂–µ ‚Üí fail
–ü–æ–ø—ã—Ç–∫–∞ 3: —Å—Ä–∞–∑—É –∂–µ ‚Üí fail
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- –û—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∏—Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- Redis MOVED (–∫–ª—é—á –ø–µ—Ä–µ–µ—Ö–∞–ª –Ω–∞ –¥—Ä—É–≥–æ–π —É–∑–µ–ª) ‚Äî —Å—Ä–∞–∑—É retry –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —É–∑–µ–ª
- Optimistic locking conflict ‚Äî —Å—Ä–∞–∑—É retry —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

**–ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- ‚ùå –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (—É—Å—É–≥—É–±–∏—Ç –ø—Ä–æ–±–ª–µ–º—É)
- ‚ùå Network timeouts (—Å–µ—Ç—å –Ω—É–∂–Ω–æ –≤—Ä–µ–º—è)
- ‚ùå Resource exhaustion

**–ü—Ä–∏–º–µ—Ä ‚Äî Redis Cluster**:
```
Client: GET user:123
Redis: MOVED 7008 192.168.1.2:7002
Client: –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç GET user:123 –Ω–∞ 192.168.1.2:7002
Redis: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

–ó–∞–¥–µ—Ä–∂–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞ ‚Äî –ø—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ —Ç–æ–ª—å–∫–æ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∞–¥—Ä–µ—Å–µ
```

#### 2. Fixed Backoff (–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è**: –ñ–¥–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–æ–π.

```
delay = 1 second

–ü–æ–ø—ã—Ç–∫–∞ 1: fail
–ñ–¥—ë–º 1s
–ü–æ–ø—ã—Ç–∫–∞ 2: fail
–ñ–¥—ë–º 1s
–ü–æ–ø—ã—Ç–∫–∞ 3: fail
–ñ–¥—ë–º 1s
–ü–æ–ø—ã—Ç–∫–∞ 4: success
```

**–ü–ª—é—Å—ã**:
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å (–ª–µ–≥–∫–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å total time)
- ‚úÖ –ù–µ —Å–æ–∑–¥–∞—ë—Ç burst –Ω–∞–≥—Ä—É–∑–∫–∏

**–ú–∏–Ω—É—Å—ã**:
- ‚ùå –ù–µ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —Å–µ—Ä—å—ë–∑–Ω–æ—Å—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã
- ‚ùå –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –¥–æ–ª–≥–∞—è ‚Üí —Ç–µ—Ä—è–µ–º –≤—Ä–µ–º—è –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏–µ delays
- ‚ùå –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –∫—Ä–∞—Ç–∫–∞—è ‚Üí —Å–ª–∏—à–∫–æ–º –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- –ü—Ä–æ—Å—Ç—ã–µ —Å–ª—É—á–∞–∏ —Å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º–∏ transient errors
- –ö–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å latency
- Rate limiting (HTTP 429) —Å header Retry-After

**–ü—Ä–∏–º–µ—Ä ‚Äî RabbitMQ Consumer**:
```
Consumer –ø–æ–ª—É—á–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí –æ—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ‚Üí nack
RabbitMQ requeue —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π (5 —Å–µ–∫—É–Ω–¥)
–ß–µ—Ä–µ–∑ 5s —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–Ω–æ–≤–∞ –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è consumer

–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç tight loop
```

#### 3. Linear Backoff (–õ–∏–Ω–µ–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è**: –ö–∞–∂–¥–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∂–¥—ë—Ç –¥–æ–ª—å—à–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π (–ª–∏–Ω–µ–π–Ω–æ).

```
delay = attempt_number * base_delay

base_delay = 1s

–ü–æ–ø—ã—Ç–∫–∞ 1: fail
–ñ–¥—ë–º 1s (1 * 1s)
–ü–æ–ø—ã—Ç–∫–∞ 2: fail
–ñ–¥—ë–º 2s (2 * 1s)
–ü–æ–ø—ã—Ç–∫–∞ 3: fail
–ñ–¥—ë–º 3s (3 * 1s)
–ü–æ–ø—ã—Ç–∫–∞ 4: success

Total time: 1s + 2s + 3s = 6s
```

**–ü–ª—é—Å—ã**:
- ‚úÖ –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º—É–ª–∞
- ‚úÖ –ù–µ —Ç–∞–∫ –∞–≥—Ä–µ—Å—Å–∏–≤–µ–Ω, –∫–∞–∫ exponential

**–ú–∏–Ω—É—Å—ã**:
- ‚ùå –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω—ã–º –¥–ª—è –¥–æ–ª–≥–∏—Ö retries
- ‚ùå –†–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (exponential –ª—É—á—à–µ –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- –†–µ–¥–∫–æ. –û–±—ã—á–Ω–æ exponential backoff –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ.

---

## Exponential Backoff (–≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)

**–ß—Ç–æ —ç—Ç–æ**: Exponential Backoff (—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞) ‚Äî —ç—Ç–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, –≥–¥–µ **–≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ —Ä–∞—Å—Ç—ë—Ç —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ**. –≠—Ç–æ –∏–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è retry logic.

### –§–æ—Ä–º—É–ª–∞

```
delay = base_delay * 2^attempt_number

base_delay = 1s

–ü–æ–ø—ã—Ç–∫–∞ 1: fail
–ñ–¥—ë–º 1s (1 * 2^0 = 1s)
–ü–æ–ø—ã—Ç–∫–∞ 2: fail
–ñ–¥—ë–º 2s (1 * 2^1 = 2s)
–ü–æ–ø—ã—Ç–∫–∞ 3: fail
–ñ–¥—ë–º 4s (1 * 2^2 = 4s)
–ü–æ–ø—ã—Ç–∫–∞ 4: fail
–ñ–¥—ë–º 8s (1 * 2^3 = 8s)
–ü–æ–ø—ã—Ç–∫–∞ 5: success

Total time: 1 + 2 + 4 + 8 = 15 —Å–µ–∫—É–Ω–¥
```

### –ü–æ—á–µ–º—É —ç—Ç–æ –ª—É—á—à–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è?

#### 1. –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–±–æ–∏

```
Transient error (–ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 1 —Å–µ–∫—É–Ω–¥–∞):
T=0.0s: –ü–æ–ø—ã—Ç–∫–∞ 1 ‚Üí fail
T=1.0s: –ü–æ–ø—ã—Ç–∫–∞ 2 ‚Üí success!

–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–∏–ª–∞—Å—å –±—ã—Å—Ç—Ä–æ ‚Üí retry —Ç–æ–∂–µ –±—ã—Å—Ç—Ä—ã–π (1s delay)
```

#### 2. –¢–µ—Ä–ø–µ–Ω–∏–µ –ø—Ä–∏ —Å–µ—Ä—å—ë–∑–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö

```
Serious outage (–ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 30 —Å–µ–∫—É–Ω–¥):
T=0s: –ü–æ–ø—ã—Ç–∫–∞ 1 ‚Üí fail
T=1s: –ü–æ–ø—ã—Ç–∫–∞ 2 ‚Üí fail (—Å–∏—Å—Ç–µ–º–∞ –µ—â—ë –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å)
T=3s: –ü–æ–ø—ã—Ç–∫–∞ 3 ‚Üí fail
T=7s: –ü–æ–ø—ã—Ç–∫–∞ 4 ‚Üí fail
T=15s: –ü–æ–ø—ã—Ç–∫–∞ 5 ‚Üí fail
T=31s: –ü–æ–ø—ã—Ç–∫–∞ 6 ‚Üí success!

–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∑–∞–¥–µ—Ä–∂–∫—É, –¥–∞–≤–∞—è —Å–∏—Å—Ç–µ–º–µ –≤—Ä–µ–º—è
```

#### 3. –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏

```
–ë–µ–∑ exponential backoff (fixed 1s delay):
–ó–∞ 10 —Å–µ–∫—É–Ω–¥: 10 retry attempts

–° exponential backoff:
–ó–∞ 10 —Å–µ–∫—É–Ω–¥: 1s + 2s + 4s = –≤—Å–µ–≥–æ 3 retry attempts

–ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—â—É—é—Å—è —Å–∏—Å—Ç–µ–º—É
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Exponential Backoff

#### Base Delay (–ë–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)

**–ß—Ç–æ —ç—Ç–æ**: –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ retry.

```
base_delay = 100ms ‚Üí –±—ã—Å—Ç—Ä—ã–π retry –¥–ª—è low-latency —Å–∏—Å—Ç–µ–º
base_delay = 1s ‚Üí —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–±–æ—Ä
base_delay = 5s ‚Üí –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö/—Ç—è–∂—ë–ª—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
```

**–ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å**:
- –°–º–æ—Ç—Ä–∏ –Ω–∞ —Ç–∏–ø–∏—á–Ω—É—é latency –æ–ø–µ—Ä–∞—Ü–∏–∏
- –î–ª—è sub-second –æ–ø–µ—Ä–∞—Ü–∏–π: 100-500ms
- –î–ª—è second-range –æ–ø–µ—Ä–∞—Ü–∏–π: 1-2s
- –î–ª—è long-running: 5-10s

#### Max Delay (–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)

**–ü—Ä–æ–±–ª–µ–º–∞ –±–µ–∑ max delay**:

```
base_delay = 1s
–ü–æ–ø—ã—Ç–∫–∞ 10: delay = 1s * 2^10 = 1024s = 17 –º–∏–Ω—É—Ç!

–ê–±—Å—É—Ä–¥–Ω–æ –¥–æ–ª–≥–æ –¥–ª—è retry
```

**–†–µ—à–µ–Ω–∏–µ ‚Äî cap maximum delay**:

```
max_delay = 60s

delay = min(base_delay * 2^attempt, max_delay)

–ü–æ–ø—ã—Ç–∫–∞ 1: 1s
–ü–æ–ø—ã—Ç–∫–∞ 2: 2s
–ü–æ–ø—ã—Ç–∫–∞ 3: 4s
–ü–æ–ø—ã—Ç–∫–∞ 4: 8s
–ü–æ–ø—ã—Ç–∫–∞ 5: 16s
–ü–æ–ø—ã—Ç–∫–∞ 6: 32s
–ü–æ–ø—ã—Ç–∫–∞ 7: 60s (capped)
–ü–æ–ø—ã—Ç–∫–∞ 8: 60s (capped)
–ü–æ–ø—ã—Ç–∫–∞ 9: 60s (capped)
```

**–¢–∏–ø–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**:
- Low-latency APIs: max_delay = 5-10s
- Standard services: max_delay = 30-60s
- Background jobs: max_delay = 5-10 minutes

#### Multiplier (–ú–Ω–æ–∂–∏—Ç–µ–ª—å)

**–ß—Ç–æ —ç—Ç–æ**: –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ä–æ—Å—Ç–∞ –∑–∞–¥–µ—Ä–∂–∫–∏ (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ 2).

```
–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π exponential (multiplier = 2):
1s ‚Üí 2s ‚Üí 4s ‚Üí 8s ‚Üí 16s

–ë–æ–ª–µ–µ –º–µ–¥–ª–µ–Ω–Ω—ã–π —Ä–æ—Å—Ç (multiplier = 1.5):
1s ‚Üí 1.5s ‚Üí 2.25s ‚Üí 3.4s ‚Üí 5.1s

–ë–æ–ª–µ–µ –±—ã—Å—Ç—Ä—ã–π —Ä–æ—Å—Ç (multiplier = 3):
1s ‚Üí 3s ‚Üí 9s ‚Üí 27s ‚Üí 81s
```

**–ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å**:
- **multiplier = 2**: —Å—Ç–∞–Ω–¥–∞—Ä—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ 90% —Å–ª—É—á–∞–µ–≤
- **multiplier = 1.5**: –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –±–æ–ª—å—à–µ retry attempts –≤ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
- **multiplier = 3**: –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –¥–æ—Å—Ç–∏—á—å max delay (—Ä–µ–¥–∫–æ)

### –ü—Ä–∏–º–µ—Ä—ã –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

#### AWS SDK Exponential Backoff

AWS SDK –∏—Å–ø–æ–ª—å–∑—É–µ—Ç sophisticated exponential backoff:

```
Parameters:
base_delay = 100ms
max_delay = 20s
max_attempts = 3

–§–æ—Ä–º—É–ª–∞:
delay = random(0, min(max_delay, base_delay * 2^attempt))

–ü—Ä–∏–º–µ—Ä:
–ü–æ–ø—ã—Ç–∫–∞ 1: fail
Delay: random(0, 200ms) = 87ms
–ü–æ–ø—ã—Ç–∫–∞ 2: fail
Delay: random(0, 400ms) = 312ms
–ü–æ–ø—ã—Ç–∫–∞ 3: fail
Delay: random(0, 800ms) = 654ms
–ü–æ–ø—ã—Ç–∫–∞ 4: success
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π jitter (random)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –¥–ª—è throttling errors (HTTP 429, 503)
- –†–∞–∑–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö AWS —Å–µ—Ä–≤–∏—Å–æ–≤

#### Google Cloud Client Libraries

```
Parameters:
initial_delay = 1s
max_delay = 32s
multiplier = 2
max_attempts = 5

Delay sequence:
1s ‚Üí 2s ‚Üí 4s ‚Üí 8s ‚Üí 16s ‚Üí 32s (capped)

Retryable errors:
- UNAVAILABLE
- DEADLINE_EXCEEDED
- RESOURCE_EXHAUSTED
```

#### Kafka Producer

```
retry.backoff.ms = 100 (base delay)
delivery.timeout.ms = 120000 (total timeout)
retries = Integer.MAX_VALUE

Exponential backoff –¥–æ delivery.timeout
```

#### PostgreSQL Connection Pool (HikariCP)

```
connectionTimeout = 30000ms (timeout –Ω–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ)
Retry logic —Å exponential backoff (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π)

–ü—Ä–∏ connection refused:
Delay: 100ms ‚Üí 200ms ‚Üí 400ms ‚Üí 800ms ‚Üí 1600ms ‚Üí fail
```

### –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ max_delay

**–°–∏—Ç—É–∞—Ü–∏—è**: Background job processing —Å–∏—Å—Ç–µ–º–∞ —Å exponential backoff, –Ω–æ –±–µ–∑ max_delay.

```
Job –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á—É ‚Üí fail ‚Üí retry —Å backoff

Sequence:
–ü–æ–ø—ã—Ç–∫–∞ 1: fail (0s)
–ü–æ–ø—ã—Ç–∫–∞ 2: fail (1s)
–ü–æ–ø—ã—Ç–∫–∞ 3: fail (2s)
–ü–æ–ø—ã—Ç–∫–∞ 4: fail (4s)
–ü–æ–ø—ã—Ç–∫–∞ 5: fail (8s)
–ü–æ–ø—ã—Ç–∫–∞ 6: fail (16s)
–ü–æ–ø—ã—Ç–∫–∞ 7: fail (32s)
–ü–æ–ø—ã—Ç–∫–∞ 8: fail (64s)
–ü–æ–ø—ã—Ç–∫–∞ 9: fail (128s = 2+ –º–∏–Ω—É—Ç—ã)
–ü–æ–ø—ã—Ç–∫–∞ 10: fail (256s = 4+ –º–∏–Ω—É—Ç—ã)
...
–ü–æ–ø—ã—Ç–∫–∞ 15: fail (16384s = 4.5 —á–∞—Å–∞!!!)

–ü—Ä–æ–±–ª–µ–º–∞:
- Job –∑–∞—Å—Ç—Ä—è–ª –Ω–∞ —á–∞—Å—ã
- –†–µ—Å—É—Ä—Å—ã –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è
- –û—á–µ—Ä–µ–¥—å –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è
```

**–†–µ—à–µ–Ω–∏–µ**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å max_delay = 5 –º–∏–Ω—É—Ç.

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç: –°–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π base_delay

**–°–∏—Ç—É–∞—Ü–∏—è**: Real-time API —Å exponential backoff, –Ω–æ base_delay = 10s.

```
User –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å ‚Üí timeout ‚Üí retry

Timeline:
T=0s: –ü–æ–ø—ã—Ç–∫–∞ 1 ‚Üí timeout (3s)
T=13s: –ü–æ–ø—ã—Ç–∫–∞ 2 ‚Üí success

User –∂–¥–∞–ª 13+ —Å–µ–∫—É–Ω–¥ –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞!
```

**–ü—Ä–æ–±–ª–µ–º–∞**: Base delay —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –¥–ª—è low-latency API.

**–†–µ—à–µ–Ω–∏–µ**: base_delay = 100ms –¥–ª—è fast APIs.

### –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å Exponential Backoff

**1. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** (–ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è 80% —Å–ª—É—á–∞–µ–≤):
```
base_delay = 1s
multiplier = 2
max_delay = 60s
max_attempts = 5
```

**2. –î–ª—è low-latency APIs**:
```
base_delay = 100ms
max_delay = 5s
max_attempts = 3
```

**3. –î–ª—è background jobs**:
```
base_delay = 5s
max_delay = 300s (5 –º–∏–Ω—É—Ç)
max_attempts = 10
```

**4. –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–π jitter** (–ø–æ–¥—Ä–æ–±–Ω–µ–µ –Ω–∏–∂–µ):
```
delay = (base_delay * 2^attempt) + random_jitter
```

**5. –ò—Å–ø–æ–ª—å–∑—É–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏**:
- –ù–µ —Ä–µ–∞–ª–∏–∑—É–π exponential backoff –≤—Ä—É—á–Ω—É—é
- AWS SDK, Google Cloud SDK, Tenacity (Python), Polly (.NET) ‚Äî —É–∂–µ –∏–º–µ—é—Ç –≥–æ—Ç–æ–≤—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## Jitter Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏)

**–ß—Ç–æ —ç—Ç–æ**: Jitter (–¥—Ä–æ–∂–∞–Ω–∏–µ, —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å) ‚Äî —ç—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ **—Å–ª—É—á–∞–π–Ω–æ–π –≤–∞—Ä–∏–∞—Ü–∏–∏** –∫ backoff delay, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ retry –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤.

### –ü—Ä–æ–±–ª–µ–º–∞: Thundering Herd –±–µ–∑ Jitter

**–°—Ü–µ–Ω–∞—Ä–∏–π**: 1000 –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ —Å–µ—Ä–≤–∏—Å—É. –°–µ—Ä–≤–∏—Å –ø–∞–¥–∞–µ—Ç –Ω–∞ 5 —Å–µ–∫—É–Ω–¥.

```
–ë–µ–∑ jitter (pure exponential backoff):

T=0s: –°–µ—Ä–≤–∏—Å –ø–∞–¥–∞–µ—Ç
T=0s: 1000 –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–∞—é—Ç connection refused
T=0s: –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã –≤—ã—á–∏—Å–ª—è—é—Ç delay = 1s * 2^0 = 1s
T=1s: 1000 –∫–ª–∏–µ–Ω—Ç–æ–≤ –û–î–ù–û–í–†–ï–ú–ï–ù–ù–û retry
T=1s: –°–µ—Ä–≤–∏—Å –µ—â—ë –Ω–µ –ø–æ–¥–Ω—è–ª—Å—è
T=1s: 1000 –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–∞—é—Ç connection refused
T=1s: –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã –≤—ã—á–∏—Å–ª—è—é—Ç delay = 1s * 2^1 = 2s
T=3s: 1000 –∫–ª–∏–µ–Ω—Ç–æ–≤ –û–î–ù–û–í–†–ï–ú–ï–ù–ù–û retry
T=3s: –°–µ—Ä–≤–∏—Å –µ—â—ë –Ω–µ –ø–æ–¥–Ω—è–ª—Å—è
T=3s: –í—Å–µ –ø–æ–ª—É—á–∞—é—Ç connection refused
T=7s: 1000 –∫–ª–∏–µ–Ω—Ç–æ–≤ –û–î–ù–û–í–†–ï–ú–ï–ù–ù–û retry
T=7s: –°–µ—Ä–≤–∏—Å —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø–æ–¥–Ω—è–ª—Å—è
T=7s: BURST –∏–∑ 1000 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö connections
T=7s: –°–µ—Ä–≤–∏—Å –ø–∞–¥–∞–µ—Ç –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏! üí•

–¶–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è...
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ jitter**:
```
Client 1: |----1s----|----2s----|----4s----|
Client 2: |----1s----|----2s----|----4s----|
Client 3: |----1s----|----2s----|----4s----|
...
Client 1000: |----1s----|----2s----|----4s----|

–í—Å–µ retry –û–î–ù–û–í–†–ï–ú–ï–ù–ù–û ‚Üì      ‚Üì      ‚Üì
```

### –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å Jitter

**–° jitter (—Å–ª—É—á–∞–π–Ω–∞—è –≤–∞—Ä–∏–∞—Ü–∏—è)**:

```
T=0s: –°–µ—Ä–≤–∏—Å –ø–∞–¥–∞–µ—Ç
T=0s: 1000 –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–∞—é—Ç connection refused
T=0s: –ö–ª–∏–µ–Ω—Ç—ã –≤—ã—á–∏—Å–ª—è—é—Ç delay —Å random jitter:
  Client 1: delay = 0.8s
  Client 2: delay = 1.3s
  Client 3: delay = 0.5s
  Client 4: delay = 1.1s
  ...
  Client 1000: delay = 1.2s

T=0.5-1.5s: Retry —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤–æ –≤—Ä–µ–º–µ–Ω–∏
T=7s: –°–µ—Ä–≤–∏—Å –ø–æ–¥–Ω—è–ª—Å—è
T=7-9s: –ö–ª–∏–µ–Ω—Ç—ã –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è
T=9s: –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ ‚úÖ

–ù–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å jitter**:
```
Client 1:   |-0.8s-|--2.1s---|---3.9s---|
Client 2:   |--1.3s--|--1.8s-|----4.2s---|
Client 3:   |-0.5s-|---2.4s----|--3.5s--|
...

Retry –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è ‚Üì ‚Üì‚Üì ‚Üì ‚Üì‚Üì‚Üì ‚Üì (—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã)
```

### –¢–∏–ø—ã Jitter

#### 1. Full Jitter (–ü–æ–ª–Ω–∞—è —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å)

**–§–æ—Ä–º—É–ª–∞**:
```
delay = random(0, base_delay * 2^attempt)
```

**–ü—Ä–∏–º–µ—Ä**:
```
base_delay = 1s
attempt = 2

–ë–µ–∑ jitter:
delay = 1s * 2^2 = 4s (–≤—Å–µ–≥–¥–∞)

–° full jitter:
delay = random(0, 4s)
‚Üí –º–æ–∂–µ—Ç –±—ã—Ç—å: 0.2s, 1.5s, 3.7s, 0.8s, 3.2s (—Ä–∞–∑–Ω–æ–µ –∫–∞–∂–¥—ã–π —Ä–∞–∑)
```

**–ü–ª—é—Å—ã**:
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –°–∞–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Ç–∏–≤ thundering herd
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è AWS

**–ú–∏–Ω—É—Å—ã**:
- ‚ùå –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–º (–∏–Ω–æ–≥–¥–∞ –∂–¥—ë—Ç –¥–æ–ª—å—à–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ)
- ‚ùå –ú–µ–Ω–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π worst-case latency

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- –ë–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ (1000+)
- –ö—Ä–∏—Ç–∏—á–Ω–æ –∏–∑–±–µ–∂–∞—Ç—å burst –Ω–∞–≥—Ä—É–∑–∫–∏
- AWS SDK –∏—Å–ø–æ–ª—å–∑—É–µ—Ç full jitter –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**AWS Paper (2015)**: Amazon –ø—Ä–æ–≤—ë–ª –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫–∞–∑–∞–ª, —á—Ç–æ full jitter –¥–∞—ë—Ç –ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è retry –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.

#### 2. Equal Jitter (–†–∞–≤–Ω–æ–º–µ—Ä–Ω–∞—è —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å)

**–§–æ—Ä–º—É–ª–∞**:
```
base = base_delay * 2^attempt
delay = base/2 + random(0, base/2)
```

**–ü—Ä–∏–º–µ—Ä**:
```
base_delay = 1s
attempt = 2
base = 4s

delay = 4s/2 + random(0, 4s/2)
     = 2s + random(0, 2s)
     = 2s + [0..2s]
     = [2s..4s]

–î–∏–∞–ø–∞–∑–æ–Ω: –æ—Ç 2s –¥–æ 4s
```

**–ü–ª—é—Å—ã**:
- ‚úÖ –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å—é
- ‚úÖ Worst-case delay –≤—Å—ë –µ—â—ë bounded (–Ω–µ –±–æ–ª—å—à–µ base)
- ‚úÖ –ù–µ —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π, –Ω–µ —Å–ª–∏—à–∫–æ–º –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π

**–ú–∏–Ω—É—Å—ã**:
- ‚ùå –ß—É—Ç—å –º–µ–Ω–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –ø—Ä–æ—Ç–∏–≤ thundering herd, —á–µ–º full jitter

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –ø—É–ª–∞ (100-1000)
- –í–∞–∂–Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å latency
- Google Cloud SDK –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–¥–æ–±–Ω—ã–π –ø–æ–¥—Ö–æ–¥

#### 3. Decorrelated Jitter (–î–µ–∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å)

**–§–æ—Ä–º—É–ª–∞**:
```
delay = random(base_delay, previous_delay * 3)
```

**–ü—Ä–∏–º–µ—Ä**:
```
base_delay = 1s

–ü–æ–ø—ã—Ç–∫–∞ 1:
previous_delay = 1s (initial)
delay = random(1s, 1s * 3) = random(1s, 3s) ‚Üí –Ω–∞–ø—Ä–∏–º–µ—Ä, 2.1s

–ü–æ–ø—ã—Ç–∫–∞ 2:
previous_delay = 2.1s
delay = random(1s, 2.1s * 3) = random(1s, 6.3s) ‚Üí –Ω–∞–ø—Ä–∏–º–µ—Ä, 4.5s

–ü–æ–ø—ã—Ç–∫–∞ 3:
previous_delay = 4.5s
delay = random(1s, 4.5s * 3) = random(1s, 13.5s) ‚Üí –Ω–∞–ø—Ä–∏–º–µ—Ä, 8.2s
```

**–ü–ª—é—Å—ã**:
- ‚úÖ –ö–∞–∂–¥—ã–π –∫–ª–∏–µ–Ω—Ç –∏–º–µ–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å delays (decorrelated)
- ‚úÖ –û—á–µ–Ω—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –ø—Ä–æ—Ç–∏–≤ synchronized retry
- ‚úÖ –†–æ—Å—Ç –Ω–µ —Å—Ç—Ä–æ–≥–æ exponential, –Ω–æ –±–ª–∏–∑–∫–æ

**–ú–∏–Ω—É—Å—ã**:
- ‚ùå –°–ª–æ–∂–Ω–µ–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
- ‚ùå –¢—Ä—É–¥–Ω–µ–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞—Ç—å worst-case time

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- –°–ª–æ–∂–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã —Å multiple retry layers
- AWS —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

#### 4. Fixed Jitter (–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å)

**–§–æ—Ä–º—É–ª–∞**:
```
delay = (base_delay * 2^attempt) + random(-jitter_range, +jitter_range)
```

**–ü—Ä–∏–º–µ—Ä**:
```
base_delay = 1s
jitter_range = 200ms
attempt = 2

base_time = 1s * 2^2 = 4s
delay = 4s + random(-200ms, +200ms)
     = 4s + [-0.2s..+0.2s]
     = [3.8s..4.2s]
```

**–ü–ª—é—Å—ã**:
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é exponential backoff —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–µ–±–æ–ª—å—à—É—é –≤–∞—Ä–∏–∞—Ü–∏—é –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- ‚úÖ –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π worst-case

**–ú–∏–Ω—É—Å—ã**:
- ‚ùå –ú–µ–Ω–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –ø—Ä–æ—Ç–∏–≤ thundering herd (–≤–∞—Ä–∏–∞—Ü–∏—è –Ω–µ–±–æ–ª—å—à–∞—è)
- ‚ùå –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤—Å—ë —Ä–∞–≤–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å burst

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- –ù–µ–±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ (10-100)
- –ö–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –∏ –±–ª–∏–∑–æ—Å—Ç—å –∫ "—á–∏—Å—Ç–æ–º—É" exponential backoff

### –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ Jitter —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

| –°—Ç—Ä–∞—Ç–µ–≥–∏—è | –§–æ—Ä–º—É–ª–∞ | –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ | Worst-case time | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è |
|-----------|---------|---------------|-----------------|-------------------|
| **No Jitter** | `base * 2^n` | ‚ùå –ù–µ—Ç | –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π | –¢–æ–ª—å–∫–æ –¥–ª—è single client |
| **Full Jitter** | `random(0, base * 2^n)` | ‚úÖ‚úÖ‚úÖ –û—Ç–ª–∏—á–Ω–æ | base * 2^n | –ú–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ (AWS) |
| **Equal Jitter** | `base/2 + random(0, base/2)` | ‚úÖ‚úÖ –•–æ—Ä–æ—à–æ | base * 2^n | –°—Ä–µ–¥–Ω–∏–π –ø—É–ª –∫–ª–∏–µ–Ω—Ç–æ–≤ |
| **Decorrelated** | `random(base, prev * 3)` | ‚úÖ‚úÖ‚úÖ –û—Ç–ª–∏—á–Ω–æ | –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π | –°–ª–æ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã |
| **Fixed Jitter** | `base * 2^n + random(¬±range)` | ‚úÖ –ë–∞–∑–æ–≤—ã–π | ~base * 2^n | –ú–∞–ª—ã–π –ø—É–ª –∫–ª–∏–µ–Ω—Ç–æ–≤ |

### –ü—Ä–∏–º–µ—Ä—ã –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

#### AWS SDK (Full Jitter)

```
// AWS —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç full jitter
delay = random(0, min(max_delay, base_delay * 2^attempt))

Example:
base_delay = 100ms
max_delay = 20s

Attempt 1: random(0, 200ms) ‚Üí 87ms
Attempt 2: random(0, 400ms) ‚Üí 312ms
Attempt 3: random(0, 800ms) ‚Üí 654ms
Attempt 4: random(0, 1600ms) ‚Üí 1203ms
```

#### Exponential Backoff with Jitter (Standard Library Pattern)

–ú–Ω–æ–≥–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç equal jitter:

```
Python Tenacity:
wait_exponential(multiplier=1, min=1, max=60)
+ wait_random(min=0, max=2)

Go backoff library:
b := backoff.NewExponentialBackOff()
b.InitialInterval = 500 * time.Millisecond
b.RandomizationFactor = 0.5 // –¥–æ–±–∞–≤–ª—è–µ—Ç ¬±50% jitter
```

### –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç: GitHub DDoS-–æ–æ–±—Ä–∞–∑–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç (2016)

**–°–∏—Ç—É–∞—Ü–∏—è**: GitHub –∏–º–µ–ª –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π outage (30 —Å–µ–∫—É–Ω–¥). –¢—ã—Å—è—á–∏ webhook-–∫–ª–∏–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ retry-–∏–ª–∏ –∑–∞–ø—Ä–æ—Å—ã.

```
Without jitter:
T=0s: GitHub –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
T=0s: 10,000 webhooks failed
T=1s: 10,000 webhooks retry –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
T=1s: GitHub –ø–æ–ª—É—á–∏–ª –û–ì–†–û–ú–ù–´–ô burst —Ç—Ä–∞—Ñ–∏–∫–∞
T=1s: Overload ‚Üí –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –µ—â—ë 30 —Å–µ–∫—É–Ω–¥
T=31s: 10,000 webhooks retry —Å–Ω–æ–≤–∞
...

Outage –ø—Ä–æ–¥–ª–∏–ª—Å—è 10 –º–∏–Ω—É—Ç –≤–º–µ—Å—Ç–æ 30 —Å–µ–∫—É–Ω–¥!
```

**–ß—Ç–æ –ø–æ–º–æ–≥–ª–æ –±—ã**: Full jitter ‚Üí –∑–∞–ø—Ä–æ—Å—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤–æ –≤—Ä–µ–º–µ–Ω–∏, –Ω–µ—Ç burst.

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç: Elasticsearch Cluster Recovery

**–°–∏—Ç—É–∞—Ü–∏—è**: Elasticsearch cluster temporary split-brain. –ö–æ–≥–¥–∞ —Å–µ—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å, –≤—Å–µ –∫–ª–∏–µ–Ω—Ç—ã retry-–∏–ª–∏.

```
Cluster –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è ‚Üí 500 clients retry –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
Cluster –ø–æ–ª—É—á–∏–ª burst –∏–∑ 500 connections
Connection pool exhausted
–ù–æ–≤—ã–µ connections rejected
Clients retry –µ—â—ë —Ä–∞–∑... —Ü–∏–∫–ª
```

**–†–µ—à–µ–Ω–∏–µ**: Clients –¥–æ–±–∞–≤–∏–ª–∏ jitter –∫ retry logic ‚Üí connections —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –Ω–∞ 10 —Å–µ–∫—É–Ω–¥ –≤–º–µ—Å—Ç–æ instant burst.

### –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å Jitter

**1. –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–π jitter** (–∫—Ä–æ–º–µ –µ–¥–∏–Ω–∏—á–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞):
```
‚úÖ delay = exponential_backoff + jitter
‚ùå delay = exponential_backoff (—Ç–æ–ª—å–∫–æ –¥–ª—è testing –∏–ª–∏ single client)
```

**2. –í—ã–±–æ—Ä —Ç–∏–ø–∞ jitter**:
```
–ú–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ (1000+):
‚Üí Full Jitter (AWS-style)

–°—Ä–µ–¥–Ω–∏–π –ø—É–ª (100-1000):
‚Üí Equal Jitter

–ú–∞–ª–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ (<100):
‚Üí Fixed Jitter –∏–ª–∏ Equal Jitter
```

**3. –ò—Å–ø–æ–ª—å–∑—É–π –≥–æ—Ç–æ–≤—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏**:
```
AWS SDK ‚Üí full jitter –≤—Å—Ç—Ä–æ–µ–Ω
Google Cloud SDK ‚Üí decorrelated jitter
Tenacity (Python) ‚Üí configurable jitter
Polly (.NET) ‚Üí decorrelated jitter
```

**4. –¢–µ—Å—Ç–∏—Ä—É–π —Å —Å–∏–º—É–ª—è—Ü–∏–µ–π**:
```
–ó–∞–ø—É—Å—Ç–∏ 1000 –∫–ª–∏–µ–Ω—Ç–æ–≤ –ª–æ–∫–∞–ª—å–Ω–æ
–°–∏–º—É–ª–∏—Ä—É–π outage —Å–µ—Ä–≤–∏—Å–∞
–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ retry —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤–æ –≤—Ä–µ–º–µ–Ω–∏
```

---

## Deadline Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –¥–µ–¥–ª–∞–π–Ω–æ–≤)

**–ß—Ç–æ —ç—Ç–æ**: Deadline (–¥–µ–¥–ª–∞–π–Ω, –∫—Ä–∞–π–Ω–∏–π —Å—Ä–æ–∫) ‚Äî —ç—Ç–æ **–∞–±—Å–æ–ª—é—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏**, –¥–æ –∫–æ—Ç–æ—Ä–æ–≥–æ –æ–ø–µ—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è. –ï—Å–ª–∏ deadline –∏—Å—Ç–µ–∫–∞–µ—Ç ‚Äî –æ–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –æ–Ω–∞ –∏–ª–∏ –Ω–µ—Ç.

### –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É Timeout –∏ Deadline

–≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ–µ —Ä–∞–∑–ª–∏—á–∏–µ!

**Timeout** (—Ç–∞–π–º–∞—É—Ç) ‚Äî **–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ** –≤—Ä–µ–º—è:
```
"–≠—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –∑–∞ 5 —Å–µ–∫—É–Ω–¥"

request_timeout = 5s

T=0s: –Ω–∞—á–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—é
T=5s: timeout ‚Üí –æ—Ç–º–µ–Ω—è–µ–º
```

**Deadline** (–¥–µ–¥–ª–∞–π–Ω) ‚Äî **–∞–±—Å–æ–ª—é—Ç–Ω–æ–µ** –≤—Ä–µ–º—è:
```
"–≠—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –¥–æ T=10s"

deadline = now() + 10s = "2025-01-20 14:35:10"

T=0s: –Ω–∞—á–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—é (deadline —á–µ—Ä–µ–∑ 10s)
T=3s: –≤—ã–∑–≤–∞–ª–∏ –ø–æ–¥–æ–ø–µ—Ä–∞—Ü–∏—é (deadline —á–µ—Ä–µ–∑ 7s)
T=7s: –µ—â—ë –æ–¥–Ω–∞ –ø–æ–¥–æ–ø–µ—Ä–∞—Ü–∏—è (deadline —á–µ—Ä–µ–∑ 3s)
T=10s: deadline –∏—Å—Ç—ë–∫ ‚Üí –æ—Ç–º–µ–Ω—è–µ–º –≤—Å—é —Ü–µ–ø–æ—á–∫—É
```

### –ó–∞—á–µ–º –Ω—É–∂–Ω—ã Deadlines?

#### –ü—Ä–æ–±–ª–µ–º–∞: Timeout –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ü–µ–ø–æ—á–∫–∞—Ö –≤—ã–∑–æ–≤–æ–≤

**–°—Ü–µ–Ω–∞—Ä–∏–π**: –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å chain –≤—ã–∑–æ–≤–æ–≤.

```
Client ‚Üí ServiceA (timeout=10s) ‚Üí ServiceB (timeout=10s) ‚Üí ServiceC (timeout=10s)

Timeline:
T=0s: Client –≤—ã–∑—ã–≤–∞–µ—Ç ServiceA
T=0s: ServiceA –≤—ã–∑—ã–≤–∞–µ—Ç ServiceB
T=0s: ServiceB –≤—ã–∑—ã–≤–∞–µ—Ç ServiceC
T=9s: ServiceC –≤—Å—ë –µ—â—ë –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
T=10s: Client timeout ‚Üí –æ—Ç–º–µ–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å
–ù–û:
T=10s: ServiceA –≤—Å—ë –µ—â—ë –∂–¥—ë—Ç ServiceB (timeout=10s –Ω–µ –∏—Å—Ç—ë–∫!)
T=10s: ServiceB –≤—Å—ë –µ—â—ë –∂–¥—ë—Ç ServiceC (timeout=10s –Ω–µ –∏—Å—Ç—ë–∫!)
T=10s: ServiceC –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É

–ü—Ä–æ–±–ª–µ–º–∞:
- Client —É–∂–µ –æ—Ç–º–µ–Ω–∏–ª –∑–∞–ø—Ä–æ—Å
- –ù–æ ServiceA, ServiceB, ServiceC –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç—É
- –ü–æ—Ç–µ—Ä—è —Ä–µ—Å—É—Ä—Å–æ–≤ (CPU, memory, connections)
- "Zombie" requests
```

**–†–µ—à–µ–Ω–∏–µ —Å Deadline**:

```
Client ‚Üí ServiceA (deadline=T+10s) ‚Üí ServiceB (deadline=T+10s) ‚Üí ServiceC (deadline=T+10s)

Timeline:
T=0s: Client —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç deadline = now() + 10s
T=0s: Client –≤—ã–∑—ã–≤–∞–µ—Ç ServiceA —Å deadline=T+10s
T=0s: ServiceA –≤—ã–∑—ã–≤–∞–µ—Ç ServiceB —Å deadline=T+10s
T=0s: ServiceB –≤—ã–∑—ã–≤–∞–µ—Ç ServiceC —Å deadline=T+10s
T=9s: ServiceC –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
T=10s: Deadline –∏—Å—Ç—ë–∫!
T=10s: ServiceC –ø—Ä–æ–≤–µ—Ä—è–µ—Ç deadline ‚Üí –æ—Ç–º–µ–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é
T=10s: ServiceB –ø—Ä–æ–≤–µ—Ä—è–µ—Ç deadline ‚Üí –æ—Ç–º–µ–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é
T=10s: ServiceA –ø—Ä–æ–≤–µ—Ä—è–µ—Ç deadline ‚Üí –æ—Ç–º–µ–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é
T=10s: Client –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- –í—Å—è —Ü–µ–ø–æ—á–∫–∞ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- –ù–µ—Ç zombie requests
- –†–µ—Å—É—Ä—Å—ã –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è
```

### Deadline Structure

**Deadline –æ–±—ã—á–Ω–æ –≤–∫–ª—é—á–∞–µ—Ç**:

1. **Timestamp** (–∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –≤—Ä–µ–º—è):
```
deadline = 2025-01-20T14:35:10.123Z
```

2. **Remaining time** (–æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è, –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞):
```
remaining = deadline - now()
```

3. **Cancelled flag** (—Ñ–ª–∞–≥ –æ—Ç–º–µ–Ω—ã):
```
cancelled = (remaining <= 0)
```

### Deadline Propagation (–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥–µ–¥–ª–∞–π–Ω–æ–≤)

**–ß—Ç–æ —ç—Ç–æ**: Deadline Propagation (—Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥–µ–¥–ª–∞–π–Ω–æ–≤) ‚Äî —ç—Ç–æ –ø–µ—Ä–µ–¥–∞—á–∞ deadline **–ø–æ —Ü–µ–ø–æ—á–∫–µ –≤—ã–∑–æ–≤–æ–≤** –æ—Ç upstream —Å–µ—Ä–≤–∏—Å–∞ –∫ downstream.

#### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

```
Client:
  deadline = now() + 10s
  call ServiceA with deadline

ServiceA:
  received deadline = T+10s
  remaining = deadline - now() = 8s (–ø—Ä–æ—à–ª–æ 2s)
  call ServiceB with deadline

ServiceB:
  received deadline = T+10s
  remaining = deadline - now() = 5s (–ø—Ä–æ—à–ª–æ 5s)
  call Database with timeout = min(5s, default_timeout)

Database:
  query timeout = 5s
  –µ—Å–ª–∏ –Ω–µ —É—Å–ø–µ–ª–∏ ‚Üí –æ—Ç–º–µ–Ω–∞
```

**–ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è**: Deadline **–æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ** –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ —Ü–µ–ø–æ—á–∫–µ. –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –≤—ã—á–∏—Å–ª—è–µ—Ç `remaining time = deadline - now()`.

### –ü—Ä–∏–º–µ—Ä—ã –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

#### gRPC Deadlines

gRPC –∏–º–µ–µ—Ç first-class support –¥–ª—è deadlines:

```
Client:
ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)
defer cancel()

resp, err := client.SomeMethod(ctx, request)

gRPC –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç deadline = now() + 10s
2. –ü–µ—Ä–µ–¥–∞—ë—Ç deadline –≤ HTTP/2 header "grpc-timeout"
3. Server –ø–æ–ª—É—á–∞–µ—Ç deadline –∏ propagates –¥–∞–ª—å—à–µ
4. –ï—Å–ª–∏ deadline –∏—Å—Ç–µ–∫–∞–µ—Ç ‚Üí –≤—Å–µ –≤—ã–∑–æ–≤—ã –æ—Ç–º–µ–Ω—è—é—Ç—Å—è
```

**gRPC timeout header**:
```
grpc-timeout: 8500m  (8.5 —Å–µ–∫—É–Ω–¥ remaining)
```

Format: `{value}{unit}` –≥–¥–µ unit = H (hours), M (minutes), S (seconds), m (milliseconds), u (microseconds), n (nanoseconds).

**Server-side**:
```
func (s *server) SomeMethod(ctx context.Context, req *pb.Request) (*pb.Response, error) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º deadline
    deadline, ok := ctx.Deadline()
    if ok && time.Now().After(deadline) {
        return nil, status.Error(codes.DeadlineExceeded, "deadline exceeded")
    }

    // Propagate ctx –¥–∞–ª—å—à–µ
    resp, err := s.downstreamClient.AnotherMethod(ctx, ...)
    return resp, err
}
```

#### Nginx Proxy Timeout

Nginx –∏–º–µ–µ—Ç –∫–æ–Ω—Ü–µ–ø—Ü–∏—é timeout, –Ω–æ –Ω–µ deadline (limitation):

```
nginx.conf:
  proxy_connect_timeout 5s;    # timeout –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
  proxy_send_timeout 10s;      # timeout –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –∑–∞–ø—Ä–æ—Å–∞
  proxy_read_timeout 30s;      # timeout –Ω–∞ —á—Ç–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞

–ü—Ä–æ–±–ª–µ–º–∞:
- –≠—Ç–∏ timeouts –ù–ï —É—á–∏—Ç—ã–≤–∞—é—Ç upstream deadline
- –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —É—Å—Ç–∞–Ω–æ–≤–∏–ª deadline=5s, –Ω–æ proxy_read_timeout=30s
  ‚Üí backend –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å 30s, —Ö–æ—Ç—è –∫–ª–∏–µ–Ω—Ç —É–∂–µ –æ—Ç–º–µ–Ω–∏–ª –∑–∞–ø—Ä–æ—Å
```

**Workaround**: –ü–µ—Ä–µ–¥–∞–≤–∞–π deadline –≤ custom HTTP header:
```
proxy_set_header X-Request-Deadline $msec+10;  # now + 10s
```

Backend –¥–æ–ª–∂–µ–Ω —á–∏—Ç–∞—Ç—å —ç—Ç–æ—Ç header –∏ —Å–æ–±–ª—é–¥–∞—Ç—å deadline.

#### PostgreSQL Statement Timeout

PostgreSQL –∏–º–µ–µ—Ç `statement_timeout`:

```
SET statement_timeout = '5s';

SELECT * FROM huge_table WHERE ...;

–ï—Å–ª–∏ query –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –∑–∞ 5s ‚Üí PostgreSQL –æ—Ç–º–µ–Ω—è–µ—Ç –µ–≥–æ
```

**–ö–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å deadlines**:

```
Client:
  deadline = now() + 10s
  call ServiceA with deadline

ServiceA:
  remaining = deadline - now() = 7s
  SET statement_timeout = '7s'
  execute query

Query –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –º–∞–∫—Å–∏–º—É–º –∑–∞ 7s (—Å–æ–±–ª—é–¥–∞—è –æ–±—â–∏–π deadline)
```

#### Kafka Producer Deadline

Kafka Producer –∏–º–µ–µ—Ç `delivery.timeout.ms`:

```
delivery.timeout.ms = 120000  # 2 –º–∏–Ω—É—Ç—ã –º–∞–∫—Å–∏–º—É–º

Producer.send(record)

–ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –∑–∞ 2 –º–∏–Ω—É—Ç—ã ‚Üí callback —Å –æ—à–∏–±–∫–æ–π
```

–≠—Ç–æ **–Ω–µ deadline propagation** (Kafka –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç deadline –º–µ–∂–¥—É brokers), –Ω–æ –ª–æ–∫–∞–ª—å–Ω—ã–π deadline –¥–ª—è producer operation.

### Deadline Exceeded Error

–ö–æ–≥–¥–∞ deadline –∏—Å—Ç–µ–∫–∞–µ—Ç, —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –æ—à–∏–±–∫—É:

```
gRPC: status.Code = DEADLINE_EXCEEDED
HTTP: 504 Gateway Timeout (–Ω–µ —Å–æ–≤—Å–µ–º —Ç–æ—á–Ω–æ, –Ω–æ –±–ª–∏–∑–∫–æ)
Kafka: TimeoutException
PostgreSQL: "canceling statement due to statement timeout"
Redis: "(error) TIMEOUT"
```

**–í–∞–∂–Ω–æ**: –ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è **–æ—Ç–º–µ–Ω–µ–Ω–∞ –∏–∑-–∑–∞ deadline**, –∞ –Ω–µ –∏–∑-–∑–∞ –¥—Ä—É–≥–æ–π –æ—à–∏–±–∫–∏.

### –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç: Zombie Requests –±–µ–∑ Deadline Propagation

**–°–∏—Ç—É–∞—Ü–∏—è**: E-commerce —Å–∞–π—Ç. User –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞.

```
Chain:
Browser ‚Üí API Gateway (timeout=5s) ‚Üí Product Service (timeout=30s) ‚Üí Database

Timeline:
T=0s: User –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É
T=0s: Browser ‚Üí API Gateway ‚Üí Product Service ‚Üí Database query
T=5s: API Gateway timeout ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 504 Gateway Timeout
T=5s: Browser –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É
–ù–û:
T=5s: Product Service –≤—Å—ë –µ—â—ë –∂–¥—ë—Ç Database (timeout=30s)
T=5s: Database –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å slow query

T=20s: Query –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è (–Ω–∞–∫–æ–Ω–µ—Ü!)
T=20s: Product Service –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
T=20s: Product Service –ø—ã—Ç–∞–µ—Ç—Å—è –≤–µ—Ä–Ω—É—Ç—å –æ—Ç–≤–µ—Ç API Gateway
T=20s: Connection —É–∂–µ –∑–∞–∫—Ä—ã—Ç (API Gateway timeout)

–ü—Ä–æ–±–ª–µ–º–∞:
- User –≤–∏–¥–µ–ª –æ—à–∏–±–∫—É —á–µ—Ä–µ–∑ 5s
- –ù–æ Database —Ä–∞–±–æ—Ç–∞–ª 20 —Å–µ–∫—É–Ω–¥ –∑—Ä—è
- –ü–æ—Ç–µ—Ä—è —Ä–µ—Å—É—Ä—Å–æ–≤ (CPU, I/O)
- –ï—Å–ª–∏ –º–Ω–æ–≥–æ —Ç–∞–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí Database –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç—Å—è
```

**–†–µ—à–µ–Ω–∏–µ**: Deadline propagation.

```
Browser —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç deadline = now() + 5s
API Gateway propagates deadline
Product Service —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç query timeout = remaining time
Database query –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ 5s (–≤–º–µ—Å—Ç–µ —Å–æ –≤—Å–µ–π —Ü–µ–ø–æ—á–∫–æ–π)
```

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç: Deadline Amplification

**–°—Ü–µ–Ω–∞—Ä–∏–π**: –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–µ–ª–∞–µ—Ç N downstream –≤—ã–∑–æ–≤–æ–≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ.

```
ServiceA:
  deadline = now() + 10s
  call ServiceB (takes 3s)
  call ServiceC (takes 3s)
  call ServiceD (takes 3s)
  call ServiceE (takes 3s)

Timeline:
T=0s: ServiceA begins
T=3s: ServiceB –∑–∞–≤–µ—Ä—à–∏–ª—Å—è (remaining deadline = 7s)
T=6s: ServiceC –∑–∞–≤–µ—Ä—à–∏–ª—Å—è (remaining deadline = 4s)
T=9s: ServiceD –∑–∞–≤–µ—Ä—à–∏–ª—Å—è (remaining deadline = 1s)
T=10s: ServiceE –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–±–æ—Ç—É
T=10s: Deadline exceeded! ServiceE –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è

–ü—Ä–æ–±–ª–µ–º–∞:
- –ü–æ—Ç—Ä–∞—Ç–∏–ª–∏ 9 —Å–µ–∫—É–Ω–¥ –Ω–∞ ServiceB, C, D
- ServiceE –Ω–µ —É—Å–ø–µ–ª –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è
- –í–µ—Å—å –∑–∞–ø—Ä–æ—Å failed
```

**–†–µ—à–µ–Ω–∏–µ**:
1. –î–µ–ª–∞–π downstream –≤—ã–∑–æ–≤—ã **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ**, –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π **—Ä–∞–∑—É–º–Ω—ã–µ deadlines** —Å –∑–∞–ø–∞—Å–æ–º
3. –ú–æ–Ω–∏—Ç–æ—Ä—å `deadline_remaining` –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ

### –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å Deadlines

**1. –ò—Å–ø–æ–ª—å–∑—É–π Deadline –¥–ª—è cross-service calls**:
```
‚úÖ gRPC Context with deadline
‚úÖ HTTP header: X-Request-Deadline
‚ùå –¢–æ–ª—å–∫–æ timeout (–Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç upstream –≤—Ä–µ–º—è)
```

**2. Propagate deadline –ø–æ –≤—Å–µ–π —Ü–µ–ø–æ—á–∫–µ**:
```
Client ‚Üí ServiceA ‚Üí ServiceB ‚Üí ServiceC

–ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å:
1. –ü–æ–ª—É—á–∞–µ—Ç deadline –∏–∑ context/header
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç remaining time –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
3. Propagates deadline downstream
```

**3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π per-operation timeout –Ω–∞ –æ—Å–Ω–æ–≤–µ deadline**:
```
remaining = deadline - now()
operation_timeout = min(remaining, default_timeout)
```

**4. –ü—Ä–æ–≤–µ—Ä—è–π deadline —Ä–µ–≥—É–ª—è—Ä–Ω–æ**:
```
–í long-running –æ–ø–µ—Ä–∞—Ü–∏—è—Ö:
for item in items:
    if deadline_exceeded():
        return Error("deadline exceeded")
    process(item)
```

**5. –û—Ç–º–µ–Ω—è–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏ deadline exceeded**:
```
Database query ‚Üí cancel –µ—Å–ª–∏ deadline –∏—Å—Ç—ë–∫
Network request ‚Üí close connection
Background job ‚Üí stop processing
```

**6. –õ–æ–≥–∏—Ä—É–π deadline violations**:
```
[WARN] Operation exceeded deadline: expected=10s, actual=12.5s
```

---

## Timeout Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤)

**–ß—Ç–æ —ç—Ç–æ**: Timeout (—Ç–∞–π–º–∞—É—Ç) ‚Äî —ç—Ç–æ **–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è** –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏. –ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –∑–∞ —ç—Ç–æ –≤—Ä–µ–º—è ‚Äî –æ–Ω–∞ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π timeout.

### –¢–∏–ø—ã Timeouts

#### 1. Connection Timeout

**–ß—Ç–æ —ç—Ç–æ**: –í—Ä–µ–º—è –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É TCP connection.

```
Client –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Server

Connection Timeout = 5s

Timeline:
T=0s: Client –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç SYN packet
T=1s: SYN retransmit (–Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞)
T=2s: SYN retransmit
T=3s: SYN retransmit
T=5s: Connection Timeout ‚Üí fail
```

**–ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
- Server –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (down, firewall –±–ª–æ–∫–∏—Ä—É–µ—Ç)
- Network partition
- Server –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω (listen queue –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞)

**–¢–∏–ø–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**:
- Low-latency: 1-3s
- Standard: 5-10s
- Tolerant: 30s

**–ü—Ä–∏–º–µ—Ä—ã**:
```
Nginx:
proxy_connect_timeout 5s;

Python requests:
requests.get(url, timeout=(5, 30))  # (connect_timeout, read_timeout)

Java:
socket.connect(address, 5000);  // 5000ms
```

#### 2. Read Timeout (Response Timeout)

**–ß—Ç–æ —ç—Ç–æ**: –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è **–æ—Ç–≤–µ—Ç–∞** –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞.

```
Client –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è –∫ Server
Client –æ—Ç–ø—Ä–∞–≤–∏–ª HTTP request

Read Timeout = 30s

Timeline:
T=0s: Request –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
T=10s: Server –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç...
T=20s: Server –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç...
T=30s: Read Timeout ‚Üí fail (server —Ç–∞–∫ –∏ –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª)
```

**–ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
- Slow query –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- Server –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω
- Deadlock –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- Long-running computation

**–¢–∏–ø–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**:
- APIs: 10-30s
- Databases: 5-60s
- Background jobs: –º–∏–Ω—É—Ç—ã/—á–∞—Å—ã

**–ü—Ä–∏–º–µ—Ä—ã**:
```
Nginx:
proxy_read_timeout 30s;

PostgreSQL:
statement_timeout = '60s';

Redis:
redis-cli --timeout 5  # 5 seconds
```

#### 3. Write Timeout

**–ß—Ç–æ —ç—Ç–æ**: –í—Ä–µ–º—è –Ω–∞ **–æ—Ç–ø—Ä–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö** –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

```
Client –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –±–æ–ª—å—à–æ–π —Ñ–∞–π–ª –Ω–∞ Server

Write Timeout = 60s

–ï—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç > 60s ‚Üí timeout
```

**–ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
- –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Å–µ—Ç—å (upload bandwidth –Ω–∏–∑–∫–∏–π)
- Server –Ω–µ —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (buffer full)
- Large payload

**–ú–µ–Ω–µ–µ –∫—Ä–∏—Ç–∏—á–Ω–æ**: –æ–±—ã—á–Ω–æ write –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º read.

**–ü—Ä–∏–º–µ—Ä—ã**:
```
Nginx:
proxy_send_timeout 60s;

Python requests:
requests.post(url, data=large_data, timeout=(5, 60))  # write –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 60s
```

#### 4. Idle Timeout

**–ß—Ç–æ —ç—Ç–æ**: –í—Ä–µ–º—è, –≤ —Ç–µ—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ connection –º–æ–∂–µ—Ç –±—ã—Ç—å **–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º** –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º.

```
Client –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è –∫ Server
Client –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç

Idle Timeout = 120s

Timeline:
T=0s: Connection established
T=60s: Idle (–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)
T=120s: Idle Timeout ‚Üí connection –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è
```

**–ó–∞—á–µ–º**:
- –û—Å–≤–æ–±–æ–∂–¥–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã (file descriptors, memory)
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—Ç—å —É—Ç–µ—á–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- Half-open connections cleanup

**–ü—Ä–∏–º–µ—Ä—ã**:
```
Nginx:
keepalive_timeout 75s;  # HTTP keep-alive idle timeout

PostgreSQL:
idle_in_transaction_session_timeout = '10min';  # —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è idle > 10 –º–∏–Ω—É—Ç ‚Üí rollback

Load Balancer:
idle_timeout = 60s  # –∑–∞–∫—Ä—ã—Ç—å idle —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
```

#### 5. Request Timeout (Total Operation Timeout)

**–ß—Ç–æ —ç—Ç–æ**: **–û–±—â–µ–µ –≤—Ä–µ–º—è** –Ω–∞ –≤—Å—é –æ–ø–µ—Ä–∞—Ü–∏—é (connection + send + receive).

```
Total Request Timeout = 30s

Timeline:
T=0s: –ù–∞—á–∏–Ω–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é
T=3s: Connection —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (3s)
T=3s: –û—Ç–ø—Ä–∞–≤–∫–∞ request (instant)
T=3-25s: –û–∂–∏–¥–∞–Ω–∏–µ response (22s)
T=25s: –ü–æ–ª—É—á–µ–Ω–∏–µ response (instant)
T=25s: Success! (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 30s)

–ï—Å–ª–∏ –±—ã –∑–∞–Ω—è–ª–æ > 30s ‚Üí timeout
```

**–°–∞–º—ã–π –≤–∞–∂–Ω—ã–π timeout** –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ ‚Äî –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –≤—Å—é –æ–ø–µ—Ä–∞—Ü–∏—é —Ü–µ–ª–∏–∫–æ–º.

**–ü—Ä–∏–º–µ—Ä—ã**:
```
Python requests:
requests.get(url, timeout=30)  # single value = total timeout

Kafka Producer:
delivery.timeout.ms = 120000  # 2 –º–∏–Ω—É—Ç—ã –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫—É

gRPC:
ctx, cancel := context.WithTimeout(ctx, 10*time.Second)
```

### Timeout Hierarchy (–ò–µ—Ä–∞—Ä—Ö–∏—è —Ç–∞–π–º–∞—É—Ç–æ–≤)

**–ü—Ä–∞–≤–∏–ª–æ**: –ö–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å –∏–º–µ–µ—Ç timeout –∫–æ—Ä–æ—á–µ –≤—ã—à–µ—Å—Ç–æ—è—â–µ–≥–æ.

```
User-facing timeout: 10s
  ‚Üì
API Gateway timeout: 9s
  ‚Üì
Service A timeout: 8s
  ‚Üì
Service B timeout: 7s
  ‚Üì
Database query timeout: 5s
```

**–ü–æ—á–µ–º—É**: –ï—Å–ª–∏ –≤—Å–µ timeouts –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ, –Ω–∏–∂–µ—Å—Ç–æ—è—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ —É—Å–ø–µ–≤–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏.

```
–ü–ª–æ—Ö–æ (–≤—Å–µ timeouts = 10s):
T=10s: User timeout
T=10s: API Gateway timeout (–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ!)
T=10s: Service A timeout (–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ!)
T=10s: Database query –≤—Å—ë –µ—â—ë –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è

–•–æ—Ä–æ—à–æ (—É–±—ã–≤–∞—é—â–∏–µ timeouts):
T=5s: Database query timeout ‚Üí –æ—Ç–º–µ–Ω—è–µ—Ç query
T=5s: Service A –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç upstream
T=6s: API Gateway –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç (–æ—à–∏–±–∫–∞)
T=6s: User –ø–æ–ª—É—á–∞–µ—Ç 500 Internal Server Error

User –∂–¥–∞–ª 6s –≤–º–µ—Å—Ç–æ 10s, –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ—Ç–º–µ–Ω–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
```

### –ü—Ä–∏–º–µ—Ä—ã –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

#### PostgreSQL Timeouts

```
# Connection timeout
connect_timeout = 10  # client-side (psql, libpq)

# Query timeout
statement_timeout = '30s'  # server-side

# Idle timeout
idle_in_transaction_session_timeout = '10min'

# Lock timeout
lock_timeout = '5s'  # –µ—Å–ª–∏ –Ω–µ –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å lock –∑–∞ 5s ‚Üí fail
```

**–ü—Ä–∏–º–µ—Ä**:
```
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
conn = psycopg2.connect(host="db", connect_timeout=10)
conn.execute("SET statement_timeout = '5s'")
conn.execute("SELECT * FROM huge_table JOIN ...")

–ï—Å–ª–∏ query > 5s:
PostgreSQL –æ—Ç–º–µ–Ω—è–µ—Ç query
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ—Ç: "canceling statement due to statement timeout"
```

#### Nginx Timeouts

```
nginx.conf:

# Connection –∫ backend
proxy_connect_timeout 5s;

# –û—Ç–ø—Ä–∞–≤–∫–∞ request –∫ backend
proxy_send_timeout 10s;

# –ß—Ç–µ–Ω–∏–µ response –æ—Ç backend
proxy_read_timeout 30s;

# Idle connection –∫ backend
keepalive_timeout 75s;

# Client ‚Üí Nginx
client_body_timeout 60s;  # timeout –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ body –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
send_timeout 60s;  # timeout –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –æ—Ç–≤–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç—É
```

#### Kafka Timeouts

**Producer**:
```
# Connection timeout
connections.max.idle.ms = 540000  # 9 –º–∏–Ω—É—Ç idle ‚Üí close

# Request timeout (–æ–∂–∏–¥–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç broker)
request.timeout.ms = 30000  # 30s

# Total delivery timeout
delivery.timeout.ms = 120000  # 2 –º–∏–Ω—É—Ç—ã –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫—É (–≤–∫–ª—é—á–∞—è retry)
```

**Consumer**:
```
# Poll timeout
session.timeout.ms = 10000  # –µ—Å–ª–∏ consumer –Ω–µ poll-–∏—Ç 10s ‚Üí —Å—á–∏—Ç–∞–µ—Ç—Å—è –º—ë—Ä—Ç–≤—ã–º
heartbeat.interval.ms = 3000  # –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å heartbeat –∫–∞–∂–¥—ã–µ 3s

# Fetch timeout
fetch.max.wait.ms = 500  # –∂–¥–∞—Ç—å –¥–∞–Ω–Ω—ã—Ö –æ—Ç broker –º–∞–∫—Å–∏–º—É–º 500ms
```

#### Redis Timeouts

```
# Client timeout
redis-cli --timeout 5  # 5 seconds

# Server-side timeout
timeout 300  # –∑–∞–∫—Ä—ã—Ç—å idle client connections –ø–æ—Å–ª–µ 300 —Å–µ–∫—É–Ω–¥

# Cluster node timeout
cluster-node-timeout 15000  # 15s –±–µ–∑ –æ—Ç–≤–µ—Ç–∞ ‚Üí —Å—á–∏—Ç–∞–µ–º —É–∑–µ–ª failed
```

#### MongoDB Timeouts

```
# Connection timeout
connectTimeoutMS = 10000  # 10s –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

# Socket timeout
socketTimeoutMS = 30000  # 30s –Ω–∞ read/write

# Server selection timeout
serverSelectionTimeoutMS = 30000  # 30s –Ω–∞ –≤—ã–±–æ—Ä primary/secondary
```

### –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç: Timeout Cascade (–ö–∞—Å–∫–∞–¥ —Ç–∞–π–º–∞—É—Ç–æ–≤)

**–°–∏—Ç—É–∞—Ü–∏—è**: –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞. Database –Ω–∞—á–∞–ª–∞ –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞—Ç—å.

```
Normal flow:
User ‚Üí API Gateway (timeout=30s) ‚Üí Service (timeout=30s) ‚Üí DB

Database suddenly slow (queries take 45s):

T=0s: User –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
T=0s: API Gateway ‚Üí Service ‚Üí DB
T=30s: Service timeout (DB –≤—Å—ë –µ—â—ë –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å)
T=30s: Service –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç error API Gateway
T=30s: API Gateway timeout (–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ!)
T=30s: User –≤–∏–¥–∏—Ç timeout error

–ù–æ:
T=45s: Database –∑–∞–≤–µ—Ä—à–∞–µ—Ç query (–∑—Ä—è)

–ü—Ä–æ–±–ª–µ–º–∞:
- Database –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –ø–æ—Å–ª–µ timeout
- –†–µ—Å—É—Ä—Å—ã (connections, CPU) –∑–∞–Ω—è—Ç—ã
- –ú–Ω–æ–≥–æ —Ç–∞–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí Database –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç—Å—è –µ—â—ë –±–æ–ª—å—à–µ
- Cascade failure
```

**–†–µ—à–µ–Ω–∏–µ**:
1. –£–±—ã–≤–∞—é—â–∏–µ timeouts (DB timeout = 20s, Service = 25s, Gateway = 30s)
2. Database query cancellation –ø—Ä–∏ timeout
3. Circuit breaker

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç: –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π timeout

**–°–∏—Ç—É–∞—Ü–∏—è**: Analytics API —Å timeout = 2s. –ù–æ queries –æ–±—ã—á–Ω–æ –∑–∞–Ω–∏–º–∞—é—Ç 3-5s.

```
–†–µ–∑—É–ª—å—Ç–∞—Ç:
- 90% –∑–∞–ø—Ä–æ—Å–æ–≤ timeout
- Users –≤–∏–¥—è—Ç –æ—à–∏–±–∫–∏
- –ù–æ queries –≤—Å—ë —Ä–∞–≤–Ω–æ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ database (zombie queries)
- Database –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç—Å—è
```

**–†–µ—à–µ–Ω–∏–µ**: –£–≤–µ–ª–∏—á–∏—Ç—å timeout –¥–æ 10s (p99 latency + –±—É—Ñ–µ—Ä) –∏–ª–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å queries.

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ connection timeout

**–°–∏—Ç—É–∞—Ü–∏—è**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ database –±–µ–∑ connection timeout.

```
DB —Å–µ—Ä–≤–µ—Ä —É–ø–∞–ª (firewall –±–ª–æ–∫–∏—Ä—É–µ—Ç)

Application:
conn = connect(db)  # –Ω–µ—Ç timeout

Connection –≤–∏—Å–∏—Ç –≤–µ—á–Ω–æ (–∏–ª–∏ –º–∏–Ω—É—Ç—ã):
- Thread –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
- –ù–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è blocked threads
- Application –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç –æ—Ç–≤–µ—á–∞—Ç—å
```

**–†–µ—à–µ–Ω–∏–µ**: –í—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π connection timeout (5-10s).

### –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å Timeouts

**1. –í—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π timeout –Ω–∞ I/O –æ–ø–µ—Ä–∞—Ü–∏–∏**:
```
‚úÖ db.query(sql, timeout=5s)
‚úÖ http.get(url, timeout=10s)
‚úÖ redis.get(key, timeout=1s)

‚ùå db.query(sql)  # –º–æ–∂–µ—Ç –≤–∏—Å–µ—Ç—å –≤–µ—á–Ω–æ
```

**2. –ò—Å–ø–æ–ª—å–∑—É–π –∏–µ—Ä–∞—Ä—Ö–∏—é timeouts**:
```
Client: 30s
API Gateway: 25s
Service: 20s
Database: 15s

–ö–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å –∫–æ—Ä–æ—á–µ –Ω–∞ 5-10s
```

**3. –í—ã–±–∏—Ä–∞–π timeout –Ω–∞ –æ—Å–Ω–æ–≤–µ percentiles**:
```
–°–º–æ—Ç—Ä–∏ p95, p99 latency
timeout = p99 + buffer

–ü—Ä–∏–º–µ—Ä:
p95 = 200ms
p99 = 500ms
timeout = 500ms + 500ms = 1s
```

**4. –†–∞–∑–¥–µ–ª—è–π connection –∏ read timeout**:
```
‚úÖ requests.get(url, timeout=(5, 30))  # connect=5s, read=30s
‚ùå requests.get(url, timeout=30)  # –æ–±–∞ timeout = 30s (connection –º–æ–∂–µ—Ç –≤–∏—Å–µ—Ç—å 30s)
```

**5. –ò—Å–ø–æ–ª—å–∑—É–π exponential backoff —Å timeouts**:
```
–ü–æ–ø—ã—Ç–∫–∞ 1: timeout=5s ‚Üí fail
–ü–æ–ø—ã—Ç–∫–∞ 2: timeout=5s ‚Üí fail (–ø–æ—Å–ª–µ backoff)
...

Timeout –æ—Å—Ç–∞—ë—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º, backoff –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
```

**6. –ú–æ–Ω–∏—Ç–æ—Ä—å timeout metrics**:
```
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ timeouts (–ø–æ –æ–ø–µ—Ä–∞—Ü–∏—è–º)
- –ü—Ä–æ—Ü–µ–Ω—Ç timeout requests
- Latency distribution (p50, p95, p99)
```

---

## Cancellation Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –æ—Ç–º–µ–Ω—ã)

**–ß—Ç–æ —ç—Ç–æ**: Cancellation (–æ—Ç–º–µ–Ω–∞) ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º **—è–≤–Ω–æ–≥–æ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è** –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ –µ—ë –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç timeout (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–º–µ–Ω–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏), cancellation –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∞ –∫–ª–∏–µ–Ω—Ç–æ–º, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏–ª–∏ –¥—Ä—É–≥–∏–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º —Å–∏—Å—Ç–µ–º—ã.

### –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ Cancellation?

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: User –æ—Ç–º–µ–Ω–∏–ª –∑–∞–ø—Ä–æ—Å

```
User –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞
–í–≤–æ–¥–∏—Ç –∑–∞–ø—Ä–æ—Å "laptop"
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç search request ‚Üí Server –Ω–∞—á–∏–Ω–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É

User –ø–µ—Ä–µ–¥—É–º–∞–ª, –∑–∞–∫—Ä—ã–ª –≤–∫–ª–∞–¥–∫—É –±—Ä–∞—É–∑–µ—Ä–∞

–ë–µ–∑ cancellation:
- Server –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å search
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ—Ç–æ–≤—ã —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
- –ü—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å response
- Connection —É–∂–µ –∑–∞–∫—Ä—ã—Ç
- –ü–æ—Ç–µ—Ä—è —Ä–µ—Å—É—Ä—Å–æ–≤ (CPU, DB queries)

–° cancellation:
- Browser –∑–∞–∫—Ä—ã–≤–∞–µ—Ç connection
- Server –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç closed connection
- –û—Ç–º–µ–Ω—è–µ—Ç search operation
- –û—Ç–º–µ–Ω—è–µ—Ç DB queries
- –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: Deadline –∏—Å—Ç—ë–∫

```
Deadline-based cancellation:
Client —É—Å—Ç–∞–Ω–æ–≤–∏–ª deadline = now() + 10s

Timeline:
T=0s: Client –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç request
T=5s: Server –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
T=10s: Deadline –∏—Å—Ç—ë–∫
T=10s: Client –æ—Ç–º–µ–Ω—è–µ—Ç request (cancellation)
T=10s: Server –ø–æ–ª—É—á–∞–µ—Ç cancellation signal
T=10s: Server –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: Cascade cancellation

```
Client ‚Üí ServiceA ‚Üí ServiceB ‚Üí ServiceC

Client –æ—Ç–º–µ–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å (user closed page)
ServiceA –ø–æ–ª—É—á–∞–µ—Ç cancellation
ServiceA propagates cancellation –∫ ServiceB
ServiceB propagates cancellation –∫ ServiceC
ServiceC –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É

–í—Å—è —Ü–µ–ø–æ—á–∫–∞ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
```

### Cancellation Patterns

#### 1. Cooperative Cancellation (–ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –æ—Ç–º–µ–Ω–∞)

**–ß—Ç–æ —ç—Ç–æ**: Operation **–ø—Ä–æ–≤–µ—Ä—è–µ—Ç** cancellation flag –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∏ **–¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ** –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É.

```
function processItems(items, cancellationToken):
    for item in items:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º cancellation
        if cancellationToken.isCancelled():
            return Error("operation cancelled")

        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º item
        process(item)

    return Success
```

**–ü–ª—é—Å—ã**:
- ‚úÖ Graceful shutdown (–º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ–∫—É—â–∏–π item)
- ‚úÖ –ú–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å cleanup (–∑–∞–∫—Ä—ã—Ç—å —Ä–µ—Å—É—Ä—Å—ã)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è (–Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–µ–∫—Ü–∏–∏)

**–ú–∏–Ω—É—Å—ã**:
- ‚ùå –¢—Ä–µ–±—É–µ—Ç —è–≤–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ –∫–æ–¥–µ
- ‚ùå –ï—Å–ª–∏ code –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç flag ‚Üí cancellation –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå –î–æ–ª–≥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –¥–æ–ª–≥–æ –Ω–µ –∑–∞–º–µ—á–∞—Ç—å cancellation

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- Application-level logic
- Loops –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
- Background jobs

**–ü—Ä–∏–º–µ—Ä—ã**:
```
Go context.Context:
for {
    select {
    case <-ctx.Done():
        return ctx.Err()  // cancelled
    default:
        process()
    }
}

C# CancellationToken:
while (!cancellationToken.IsCancellationRequested) {
    ProcessItem();
}
```

#### 2. Preemptive Cancellation (–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–º–µ–Ω–∞)

**–ß—Ç–æ —ç—Ç–æ**: Operation **–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è** –±–µ–∑ –µ—ë —Å–æ–≥–ª–∞—Å–∏—è.

```
Thread –≤—ã–ø–æ–ª–Ω—è–µ—Ç long-running operation
–î—Ä—É–≥–æ–π thread: thread.interrupt()  // force stop
Operation –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è
```

**–ü–ª—é—Å—ã**:
- ‚úÖ –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ—Ç–º–µ–Ω–∞
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç cooperation –æ—Ç –∫–æ–¥–∞
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ

**–ú–∏–Ω—É—Å—ã**:
- ‚ùå –ú–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∏—Ç—å inconsistent state
- ‚ùå –†–µ—Å—É—Ä—Å—ã –º–æ–≥—É—Ç –Ω–µ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å—Å—è (leaks)
- ‚ùå –°–ª–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å safely

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- OS-level operations (kill process)
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ safety scenarios (emergency shutdown)
- –†–µ–¥–∫–æ –≤ application code (–æ–ø–∞—Å–Ω–æ)

**–ü—Ä–∏–º–µ—Ä—ã**:
```
Unix: kill -9 <pid>  # SIGKILL (preemptive)
Docker: docker kill <container>  # force stop

–ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤ application logic!
```

#### 3. Timeout-based Cancellation

**–ß—Ç–æ —ç—Ç–æ**: Cancellation —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ timeout.

```
operation_timeout = 30s

Start operation
Wait 30s
If not completed ‚Üí cancel
```

–≠—Ç–æ —Ç–æ, —á—Ç–æ –º—ã –æ–±—Å—É–∂–¥–∞–ª–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ Timeout Semantics.

### Cancellation Propagation (–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–º–µ–Ω—ã)

**–ß—Ç–æ —ç—Ç–æ**: Cancellation –¥–æ–ª–∂–Ω–æ **—Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å—Å—è –ø–æ —Ü–µ–ø–æ—á–∫–µ** –≤—ã–∑–æ–≤–æ–≤.

```
Client ‚Üí ServiceA ‚Üí ServiceB ‚Üí Database

Client cancels request:
1. Client –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç cancellation signal
2. ServiceA –ø–æ–ª—É—á–∞–µ—Ç signal ‚Üí cancels —Å–≤–æ—é —Ä–∞–±–æ—Ç—É
3. ServiceA propagates cancellation –∫ ServiceB
4. ServiceB –ø–æ–ª—É—á–∞–µ—Ç signal ‚Üí cancels —Å–≤–æ—é —Ä–∞–±–æ—Ç—É
5. ServiceB cancels Database query
6. Database –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ query

–í—Å—è —Ü–µ–ø–æ—á–∫–∞ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è
```

### –ü—Ä–∏–º–µ—Ä—ã –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

#### gRPC Cancellation

gRPC –∏–º–µ–µ—Ç first-class support –¥–ª—è cancellation —á–µ—Ä–µ–∑ Go context:

**Client-side**:
```
ctx, cancel := context.WithCancel(context.Background())
defer cancel()

// –ó–∞–ø—É—Å–∫–∞–µ–º request
resp, err := client.SomeMethod(ctx, request)

// User –æ—Ç–º–µ–Ω–∏–ª ‚Üí –≤—ã–∑—ã–≤–∞–µ–º cancel()
cancel()

// gRPC –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
// 1. –û—Ç–º–µ–Ω—è–µ—Ç pending request
// 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç RST_STREAM frame (HTTP/2)
// 3. Server –ø–æ–ª—É—á–∞–µ—Ç cancellation
```

**Server-side**:
```
func (s *server) SomeMethod(ctx context.Context, req *Request) (*Response, error) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º cancellation
    select {
    case <-ctx.Done():
        return nil, ctx.Err()  // context.Canceled
    default:
    }

    // Long operation
    for item in items {
        select {
        case <-ctx.Done():
            return nil, ctx.Err()  // cancelled by client
        default:
            process(item)
        }
    }

    return response, nil
}
```

#### PostgreSQL Query Cancellation

**Client-side**:
```
Python psycopg2:
conn = psycopg2.connect(...)
cursor = conn.cursor()

# –ó–∞–ø—É—Å–∫–∞–µ–º slow query
cursor.execute("SELECT * FROM huge_table ...")

# User –æ—Ç–º–µ–Ω—è–µ—Ç ‚Üí –≤—ã–∑—ã–≤–∞–µ–º cancel
conn.cancel()

PostgreSQL:
- –ü–æ–ª—É—á–∞–µ—Ç cancellation signal
- –ü—Ä–µ—Ä—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ query
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É: "canceling statement due to user request"
```

**Server-side** (PostgreSQL –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏):
```
PostgreSQL –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç interrupts:
while (processing_query) {
    CHECK_FOR_INTERRUPTS();  // –ø—Ä–æ–≤–µ—Ä–∫–∞ cancellation
    process_next_row();
}

–ï—Å–ª–∏ cancellation signal –ø–æ–ª—É—á–µ–Ω ‚Üí –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç ERROR
```

#### HTTP/2 Cancellation (RST_STREAM)

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
```
Client –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTTP/2 request (stream ID = 5)
Server –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç request

Client —Ä–µ—à–∞–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å:
Client –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç RST_STREAM frame (stream ID = 5, error = CANCEL)

Server –ø–æ–ª—É—á–∞–µ—Ç RST_STREAM:
Server –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É stream 5
Server –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç response
```

**Browser example**:
```
User –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
Browser –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 10 requests –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫

User –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤–∫–ª–∞–¥–∫—É:
Browser –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç RST_STREAM –¥–ª—è –≤—Å–µ—Ö 10 streams
Server –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –∫–∞—Ä—Ç–∏–Ω–æ–∫
```

#### Redis Cancellation (–û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ)

Redis **–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç** cancellation –¥–ª—è –≤—ã–ø–æ–ª–Ω—è—é—â–∏—Ö—Å—è –∫–æ–º–∞–Ω–¥ (single-threaded nature).

```
Client –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: KEYS * (–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è)
Client –∑–∞–∫—Ä—ã–≤–∞–µ—Ç connection

Redis:
- –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç closed connection
- –ù–û –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å KEYS * –¥–æ –∫–æ–Ω—Ü–∞
- –ü—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å result
- Connection –∑–∞–∫—Ä—ã—Ç ‚Üí Redis –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –ø—Ä–µ—Ä–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω—è—é—â—É—é—Å—è –∫–æ–º–∞–Ω–¥—É!
```

**Workaround**: –ò—Å–ø–æ–ª—å–∑—É–π `CLIENT KILL` –∏–∑ –¥—Ä—É–≥–æ–≥–æ connection, —á—Ç–æ–±—ã —É–±–∏—Ç—å client connection (–Ω–æ –∫–æ–º–∞–Ω–¥–∞ –≤—Å—ë —Ä–∞–≤–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è).

#### Kafka Consumer Cancellation

```
Kafka Consumer poll loop:

while (true) {
    records = consumer.poll(Duration.ofMillis(100));
    for (record : records) {
        process(record);
    }
}

Cancellation:
// –î—Ä—É–≥–æ–π thread
consumer.wakeup();  // –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç poll()

–í main thread:
try {
    records = consumer.poll(...);  // WakeupException –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
} catch (WakeupException e) {
    // Graceful shutdown
    consumer.close();
}
```

### –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ cancellation propagation

**–°–∏—Ç—É–∞—Ü–∏—è**: Web application —Å long-running search.

```
User:
1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç search page
2. –í–≤–æ–¥–∏—Ç –∑–∞–ø—Ä–æ—Å "machine learning books"
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç request
4. –ß–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤–∫–ª–∞–¥–∫—É (–ø–µ—Ä–µ–¥—É–º–∞–ª)

Server (–±–µ–∑ cancellation handling):
- Connection –æ—Ç –±—Ä–∞—É–∑–µ—Ä–∞ –∑–∞–∫—Ä—ã—Ç–∞
- Server –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å search
- –î–µ–ª–∞–µ—Ç 5 slow DB queries
- Aggregates results
- –ì–æ—Ç–æ–≤–∏—Ç JSON response
- –ü—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å ‚Üí connection closed
- 10 —Å–µ–∫—É–Ω–¥ —Ä–∞–±–æ—Ç—ã –≤–ø—É—Å—Ç—É—é

–ú–∞—Å—à—Ç–∞–±:
- 1000 users –≤ –¥–µ–Ω—å –∑–∞–∫—Ä—ã–≤–∞—é—Ç search –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- 1000 * 10 —Å–µ–∫—É–Ω–¥ = 10,000 —Å–µ–∫—É–Ω–¥ CPU time –ø–æ—Ç—Ä–∞—á–µ–Ω–æ –∑—Ä—è
- DB –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–µ–Ω—É–∂–Ω—ã–º–∏ queries
```

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—è–π connection status, cancel DB queries –ø—Ä–∏ closed connection.

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç: Leaking resources –ø—Ä–∏ cancellation

**–°–∏—Ç—É–∞—Ü–∏—è**: Background job processing —Å —Ñ–∞–π–ª–∞–º–∏.

```
Job:
1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ñ–∞–π–ª
2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—Å—Ç—Ä–æ—á–Ω–æ (long operation)
3. –ó–∞–∫—Ä—ã–≤–∞–µ—Ç —Ñ–∞–π–ª

Cancellation (–ø–ª–æ—Ö–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è):
if cancellationToken.isCancelled():
    return Error("cancelled")  # –≤—ã—Ö–æ–¥ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏

–ü—Ä–æ–±–ª–µ–º–∞:
- –§–∞–π–ª –Ω–µ –∑–∞–∫—Ä—ã—Ç!
- File descriptor leak
- –ß–µ—Ä–µ–∑ N cancellations ‚Üí "too many open files"
```

**–†–µ—à–µ–Ω–∏–µ**:
```
try:
    file = open("data.txt")
    for line in file:
        if cancellationToken.isCancelled():
            raise CancelledException()
        process(line)
finally:
    file.close()  # –≤—Å–µ–≥–¥–∞ –∑–∞–∫—Ä—ã–≤–∞–µ–º
```

### –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å Cancellation

**1. –ò—Å–ø–æ–ª—å–∑—É–π context/cancellation tokens**:
```
Go:
ctx, cancel := context.WithCancel(context.Background())

C#:
CancellationTokenSource cts = new CancellationTokenSource();
CancellationToken token = cts.Token;

Python (asyncio):
async with asyncio.timeout(10):
    await long_operation()
```

**2. –ü—Ä–æ–≤–µ—Ä—è–π cancellation –≤ loops**:
```
for item in items:
    if ctx.Done():  # check cancellation
        return
    process(item)
```

**3. Propagate cancellation downstream**:
```
func ServiceA(ctx context.Context) {
    // Propagate ctx –∫ ServiceB
    resp, err := ServiceB(ctx, ...)

    // –ï—Å–ª–∏ ctx cancelled ‚Üí ServiceB —Ç–æ–∂–µ –ø–æ–ª—É—á–∏—Ç cancellation
}
```

**4. Cleanup resources –ø—Ä–∏ cancellation**:
```
defer cleanup()  // Go

try/finally  // Python, Java, C#

RAII  // C++
```

**5. –ë—ã—Å—Ç—Ä–æ —Ä–µ–∞–≥–∏—Ä—É–π –Ω–∞ cancellation**:
```
‚ùå –ü–ª–æ—Ö–æ: –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
for item in items:
    process(item)  # long operation
    if cancelled:
        return

‚úÖ –•–æ—Ä–æ—à–æ: –ø—Ä–æ–≤–µ—Ä—è–µ–º —á–∞—Å—Ç–æ
for item in items:
    if cancelled:
        return
    process_small_chunk(item)
```

**6. –õ–æ–≥–∏—Ä—É–π cancellations**:
```
[INFO] Operation cancelled by user: request_id=abc123, duration=3.5s
```

---

## Circuit Breaker Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–∫–ª—é—á–∞—Ç–µ–ª—è)

**–ß—Ç–æ —ç—Ç–æ**: Circuit Breaker (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–∫–ª—é—á–∞—Ç–µ–ª—å) ‚Äî —ç—Ç–æ pattern –∑–∞—â–∏—Ç—ã –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤. –û–Ω **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç** –ø–æ–ø—ã—Ç–∫–∏ –≤—ã–∑–æ–≤–∞ failing service, –¥–∞–≤–∞—è –µ–º—É –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è.

### –ê–Ω–∞–ª–æ–≥–∏—è –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –º–∏—Ä–∞

–ü—Ä–µ–¥—Å—Ç–∞–≤—å **—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π –∞–≤—Ç–æ–º–∞—Ç** (circuit breaker) –≤ –¥–æ–º–µ:

```
–ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞:
–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ —Ç–µ—á—ë—Ç ‚Üí –ø—Ä–∏–±–æ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç ‚Üí –∞–≤—Ç–æ–º–∞—Ç CLOSED (–∑–∞–º–∫–Ω—É—Ç)

–ö–æ—Ä–æ—Ç–∫–æ–µ –∑–∞–º—ã–∫–∞–Ω–∏–µ:
–°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π —Ç–æ–∫ ‚Üí –∞–≤—Ç–æ–º–∞—Ç "–≤—ã–∫–ª—é—á–∞–µ—Ç—Å—è" ‚Üí –∞–≤—Ç–æ–º–∞—Ç OPEN (—Ä–∞–∑–æ–º–∫–Ω—É—Ç)
–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ –ù–ï —Ç–µ—á—ë—Ç ‚Üí –ø—Ä–∏–±–æ—Ä—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–∂–∞—Ä–∞)

–ß–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è:
–ß–µ–ª–æ–≤–µ–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–æ–≤–æ–¥–∫—É ‚Üí –ø—ã—Ç–∞–µ—Ç—Å—è –≤–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç ‚Üí HALF-OPEN
–ï—Å–ª–∏ –≤—Å—ë OK ‚Üí –∞–≤—Ç–æ–º–∞—Ç CLOSED (–Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å ‚Üí –∞–≤—Ç–æ–º–∞—Ç —Å–Ω–æ–≤–∞ OPEN
```

–¢–æ –∂–µ —Å–∞–º–æ–µ –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö:

```
–ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞:
Requests –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ ‚Üí Service –æ—Ç–≤–µ—á–∞–µ—Ç ‚Üí Circuit Breaker CLOSED

Service –Ω–∞—á–∞–ª fail:
–ú–Ω–æ–≥–æ –æ—à–∏–±–æ–∫ –ø–æ–¥—Ä—è–¥ ‚Üí Circuit Breaker –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è ‚Üí OPEN
Requests –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ Service ‚Üí Fail-fast

–ß–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è:
Circuit Breaker –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å Service ‚Üí HALF-OPEN
–ï—Å–ª–∏ requests —É—Å–ø–µ—à–Ω—ã ‚Üí CLOSED
–ï—Å–ª–∏ –æ—à–∏–±–∫–∏ ‚Üí –æ–±—Ä–∞—Ç–Ω–æ –≤ OPEN
```

### –°–æ—Å—Ç–æ—è–Ω–∏—è Circuit Breaker

#### 1. CLOSED (–ó–∞–∫—Ä—ã—Ç ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞)

```
–°–æ—Å—Ç–æ—è–Ω–∏–µ: Requests –ø—Ä–æ—Ö–æ–¥—è—Ç –∫ service

–°—á—ë—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ < threshold
‚Üí –û—Å—Ç–∞—ë–º—Å—è CLOSED

Request ‚Üí Service ‚Üí Success ‚Üí CLOSED
Request ‚Üí Service ‚Üí Success ‚Üí CLOSED
Request ‚Üí Service ‚Üí Error ‚Üí CLOSED (–æ–¥–Ω–∞ –æ—à–∏–±–∫–∞ OK)
Request ‚Üí Service ‚Üí Error ‚Üí CLOSED (–¥–≤–µ –æ—à–∏–±–∫–∏)
Request ‚Üí Service ‚Üí Error ‚Üí OPEN (3+ –æ—à–∏–±–∫–∏ ‚Üí –ø–æ—Ä–æ–≥ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç)
```

**–ü–µ—Ä–µ—Ö–æ–¥ –∫ OPEN**: –ö–æ–≥–¥–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ/–ø—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫ –ø—Ä–µ–≤—ã—à–∞–µ—Ç threshold.

#### 2. OPEN (–û—Ç–∫—Ä—ã—Ç ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ requests)

```
–°–æ—Å—Ç–æ—è–Ω–∏–µ: Requests –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ service

Request ‚Üí Circuit Breaker ‚Üí –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç error (fail-fast)
–ù–ï –ø—ã—Ç–∞–µ–º—Å—è –≤—ã–∑–≤–∞—Ç—å service

–ñ–¥—ë–º timeout (–Ω–∞–ø—Ä–∏–º–µ—Ä, 60 —Å–µ–∫—É–Ω–¥)

–ü–æ—Å–ª–µ timeout ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ HALF-OPEN
```

**–ó–∞—á–µ–º**: –î–∞—ë–º service –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è, –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ–º –µ–≥–æ requests.

#### 3. HALF-OPEN (–ü–æ–ª—É–æ—Ç–∫—Ä—ã—Ç ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

```
–°–æ—Å—Ç–æ—è–Ω–∏–µ: –ü—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ test requests

Request ‚Üí Circuit Breaker ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ Service ‚Üí Success
Request ‚Üí Circuit Breaker ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ Service ‚Üí Success
Request ‚Üí Circuit Breaker ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ Service ‚Üí Success

–ï—Å–ª–∏ N —É—Å–ø–µ—à–Ω—ã—Ö requests –ø–æ–¥—Ä—è–¥:
‚Üí –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ CLOSED (service –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è)

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞:
‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ OPEN (service –µ—â—ë –Ω–µ –≥–æ—Ç–æ–≤)
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Circuit Breaker

#### 1. Failure Threshold (–ü–æ—Ä–æ–≥ –æ—à–∏–±–æ–∫)

**–ß—Ç–æ —ç—Ç–æ**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–ª–∏ –ø—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ CLOSED ‚Üí OPEN.

```
–ê–±—Å–æ–ª—é—Ç–Ω—ã–π threshold:
failure_threshold = 5 –æ—à–∏–±–æ–∫

CLOSED:
Success, Success, Error, Error, Error, Error, Error
                        ‚Üë 5-—è –æ—à–∏–±–∫–∞
‚Üí OPEN

–ü—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–π threshold:
failure_threshold = 50%
window_size = 10 requests

CLOSED:
10 requests: 6 errors, 4 success ‚Üí 60% error rate
‚Üí OPEN
```

**–¢–∏–ø–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**:
- –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π: 3 –æ—à–∏–±–∫–∏ –∏–ª–∏ 30%
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π: 5 –æ—à–∏–±–æ–∫ –∏–ª–∏ 50%
- –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π: 10 –æ—à–∏–±–æ–∫ –∏–ª–∏ 70%

#### 2. Timeout (–í—Ä–µ–º—è –≤ OPEN —Å–æ—Å—Ç–æ—è–Ω–∏–∏)

**–ß—Ç–æ —ç—Ç–æ**: –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ circuit –æ—Å—Ç–∞—ë—Ç—Å—è OPEN –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –≤ HALF-OPEN.

```
timeout = 60s

OPEN:
T=0s: Circuit –æ—Ç–∫—Ä—ã–ª—Å—è
T=0-60s: –í—Å–µ requests fail-fast
T=60s: –ü–µ—Ä–µ—Ö–æ–¥ –≤ HALF-OPEN
```

**–¢–∏–ø–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**:
- Fast recovery: 10-30s
- Standard: 60s
- Slow services: 2-5 –º–∏–Ω—É—Ç

#### 3. Success Threshold (–ü–æ—Ä–æ–≥ —É—Å–ø–µ—Ö–æ–≤ –≤ HALF-OPEN)

**–ß—Ç–æ —ç—Ç–æ**: –°–∫–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—ã—Ö requests –Ω—É–∂–Ω–æ –≤ HALF-OPEN –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ CLOSED.

```
success_threshold = 3

HALF-OPEN:
Success ‚Üí 1/3
Success ‚Üí 2/3
Success ‚Üí 3/3 ‚Üí CLOSED (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å!)
```

#### 4. Window Size (–†–∞–∑–º–µ—Ä –æ–∫–Ω–∞)

**–ß—Ç–æ —ç—Ç–æ**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ requests –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è error rate.

```
window_size = 100

–ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 requests:
70 success, 30 errors ‚Üí 30% error rate

–ï—Å–ª–∏ threshold = 50% ‚Üí –æ—Å—Ç–∞—ë–º—Å—è CLOSED
–ï—Å–ª–∏ threshold = 20% ‚Üí OPEN
```

### –ü—Ä–∏–º–µ—Ä—ã –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

#### Hystrix (Netflix) - –ö–ª–∞—Å—Å–∏–∫–∞

Netflix —Å–æ–∑–¥–∞–ª Hystrix ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫—É circuit breaker –¥–ª—è Java:

```
@HystrixCommand(
    fallbackMethod = "fallback",
    commandProperties = {
        @HystrixProperty(name = "circuitBreaker.requestVolumeThreshold", value = "10"),
        @HystrixProperty(name = "circuitBreaker.errorThresholdPercentage", value = "50"),
        @HystrixProperty(name = "circuitBreaker.sleepWindowInMilliseconds", value = "60000")
    }
)
public String callService() {
    return restTemplate.getForObject("http://service/api", String.class);
}

public String fallback() {
    return "Service unavailable, try later";
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `requestVolumeThreshold = 10`: –º–∏–Ω–∏–º—É–º 10 requests –≤ –æ–∫–Ω–µ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ error rate
- `errorThresholdPercentage = 50`: –µ—Å–ª–∏ ‚â•50% –æ—à–∏–±–æ–∫ ‚Üí OPEN
- `sleepWindowInMilliseconds = 60000`: –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è OPEN 60 —Å–µ–∫—É–Ω–¥

#### Resilience4j (Modern Alternative)

```
CircuitBreakerConfig config = CircuitBreakerConfig.custom()
    .failureRateThreshold(50)  // 50% error rate
    .waitDurationInOpenState(Duration.ofSeconds(60))
    .slidingWindowSize(100)  // –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 requests
    .minimumNumberOfCalls(10)  // –º–∏–Ω–∏–º—É–º 10 calls –¥–ª—è –æ—Ü–µ–Ω–∫–∏
    .build();

CircuitBreaker circuitBreaker = CircuitBreaker.of("service", config);

Supplier<String> decoratedSupplier = CircuitBreaker
    .decorateSupplier(circuitBreaker, () -> callService());

String result = Try.ofSupplier(decoratedSupplier)
    .recover(throwable -> "fallback")
    .get();
```

#### Envoy Proxy Circuit Breaking

Envoy (service mesh proxy) –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π circuit breaker:

```
clusters:
- name: backend_service
  circuit_breakers:
    thresholds:
    - priority: DEFAULT
      max_connections: 1000  # –º–∞–∫—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
      max_pending_requests: 1000  # –º–∞–∫—Å pending requests
      max_requests: 1000  # –º–∞–∫—Å –∞–∫—Ç–∏–≤–Ω—ã—Ö requests
      max_retries: 3  # –º–∞–∫—Å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö retries
```

–ï—Å–ª–∏ –ª–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω ‚Üí requests –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è (circuit "open").

#### Istio Circuit Breaker

```
apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: backend-circuit-breaker
spec:
  host: backend.default.svc.cluster.local
  trafficPolicy:
    connectionPool:
      tcp:
        maxConnections: 100
      http:
        http1MaxPendingRequests: 50
        maxRequestsPerConnection: 2
    outlierDetection:  # circuit breaker config
      consecutiveErrors: 5  # 5 –æ—à–∏–±–æ–∫ –ø–æ–¥—Ä—è–¥
      interval: 30s  # –æ–∫–Ω–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
      baseEjectionTime: 60s  # –≤—Ä–µ–º—è –≤ "ejected" (OPEN)
      maxEjectionPercent: 50  # –º–∞–∫—Å–∏–º—É–º 50% pods –º–æ–∂–Ω–æ "–≤—ã–±—Ä–æ—Å–∏—Ç—å"
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Circuit Breaker —Å Retry

Circuit Breaker –∏ Retry —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ:

```
Retry wrapper:
  –ü–æ–ø—ã—Ç–∫–∞ 1 ‚Üí Circuit Breaker ‚Üí Service ‚Üí Error
  Backoff 1s
  –ü–æ–ø—ã—Ç–∫–∞ 2 ‚Üí Circuit Breaker ‚Üí Service ‚Üí Error
  Backoff 2s
  –ü–æ–ø—ã—Ç–∫–∞ 3 ‚Üí Circuit Breaker ‚Üí Service ‚Üí Error
  ‚Üí Circuit opens (3 errors)

–°–ª–µ–¥—É—é—â–∏–µ requests:
  –ü–æ–ø—ã—Ç–∫–∞ 1 ‚Üí Circuit Breaker (OPEN) ‚Üí Fail-fast (–Ω–µ –∏–¥—ë–º –≤ Service)
  Retry –ù–ï –ø–æ–º–æ–≥–∞–µ—Ç (circuit –æ—Ç–∫—Ä—ã—Ç)

–ß–µ—Ä–µ–∑ 60s (circuit HALF-OPEN):
  –ü–æ–ø—ã—Ç–∫–∞ 1 ‚Üí Circuit Breaker ‚Üí Service ‚Üí Success
  ‚Üí Circuit CLOSED
```

**–ü—Ä–∞–≤–∏–ª–æ**: Circuit Breaker **—Å–Ω–∞—Ä—É–∂–∏** retry logic.

```
request ‚Üí [Circuit Breaker] ‚Üí [Retry Logic] ‚Üí Service

–ü—Ä–∞–≤–∏–ª—å–Ω–æ!

request ‚Üí [Retry Logic] ‚Üí [Circuit Breaker] ‚Üí Service

–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! (retry –±—É–¥–µ—Ç –ø—ã—Ç–∞—Ç—å—Å—è –≤—ã–∑–≤–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–π circuit)
```

### –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Circuit Breaker

**–°–∏—Ç—É–∞—Ü–∏—è**: E-commerce —Å–∞–π—Ç. Payment service –Ω–∞—á–∞–ª –ø–∞–¥–∞—Ç—å (database deadlock).

```
Timeline:
T=0s: Payment service OK
T=10s: Database deadlock ‚Üí Payment service requests –≤–∏—Å—è—Ç 30s
T=10s: Frontend ‚Üí Payment service (timeout=30s)
T=40s: Request timeout
T=40s: Frontend retry #1 ‚Üí Payment service (timeout=30s)
T=70s: Request timeout
T=70s: Frontend retry #2 ‚Üí Payment service
...

–ü—Ä–æ–±–ª–µ–º–∞:
- Frontend –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å–ª–∞—Ç—å requests –Ω–∞ broken Payment service
- –ö–∞–∂–¥—ã–π request –≤–∏—Å–∏—Ç 30s
- Frontend threads –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
- –ß–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç: Frontend thread pool –∏—Å—á–µ—Ä–ø–∞–Ω
- Frontend –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –í–°–ï –∑–∞–ø—Ä–æ—Å—ã (–Ω–µ —Ç–æ–ª—å–∫–æ payment)
- Cascade failure!
```

**–†–µ—à–µ–Ω–∏–µ —Å Circuit Breaker**:

```
T=0s: Payment service OK
T=10s: Payment service –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–∞–¥–∞—Ç—å
T=10-40s: 3 requests timeout –ø–æ–¥—Ä—è–¥
T=40s: Circuit Breaker –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
T=40s: –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ requests fail-fast (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)
T=40s: Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "Payment unavailable, try later"
T=40s: Frontend threads –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
T=40s: Frontend –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ requests
T=5min: Payment service –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
T=5min: Circuit Breaker –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç HALF-OPEN ‚Üí CLOSED
T=5min: Payment —Å–Ω–æ–≤–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç: –°–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π Circuit Breaker

**–°–∏—Ç—É–∞—Ü–∏—è**: API —Å sporadic errors (1-2% requests fail).

```
Circuit Breaker config:
failure_threshold = 2 errors
timeout = 300s (5 –º–∏–Ω—É—Ç)

Result:
Request ‚Üí Error (transient)
Request ‚Üí Error (transient)
‚Üí Circuit OPEN (2 –æ—à–∏–±–∫–∏)
‚Üí –°–ª–µ–¥—É—é—â–∏–µ 5 –º–∏–Ω—É—Ç: ALL requests fail-fast
‚Üí Service –±—ã–ª –≤ –æ—Å–Ω–æ–≤–Ω–æ–º OK, –Ω–æ circuit –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –≤—Å—ë

–ü—Ä–æ–±–ª–µ–º–∞:
- Threshold —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π
- Timeout —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π
- Circuit –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –æ—Ç –º–∞–ª–µ–π—à–∏—Ö –ø—Ä–æ–±–ª–µ–º
```

**–†–µ—à–µ–Ω–∏–µ**: –£–≤–µ–ª–∏—á–∏—Ç—å threshold (5-10 –æ—à–∏–±–æ–∫ –∏–ª–∏ 50%) –∏ —É–º–µ–Ω—å—à–∏—Ç—å timeout (60s).

### Fallback Strategies (–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∑–∞–ø–∞—Å–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)

–ö–æ–≥–¥–∞ circuit OPEN, —á—Ç–æ –¥–µ–ª–∞—Ç—å?

#### 1. Return Cached Data

```
Circuit OPEN:
‚Üí –í–µ—Ä–Ω—É—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–µ—à–∞ (–ø—É—Å—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ)

E-commerce:
Product recommendations service –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
‚Üí –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–µ—à–∞
```

#### 2. Return Default Value

```
Circuit OPEN:
‚Üí –í–µ—Ä–Ω—É—Ç—å default –∑–Ω–∞—á–µ–Ω–∏–µ

Weather API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
‚Üí –í–µ—Ä–Ω—É—Ç—å "Weather information unavailable"
```

#### 3. Degrade Functionality

```
Circuit OPEN:
‚Üí –†–∞–±–æ—Ç–∞—Ç—å —Å –ø–æ–Ω–∏–∂–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é

Search service –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
‚Üí –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ (–±–µ–∑ search)
```

#### 4. Fail Explicitly

```
Circuit OPEN:
‚Üí –í–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

Payment service –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
‚Üí "Payment processing unavailable, please try later"

–ß–µ—Å—Ç–Ω–æ, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞ –ª—É—á—à–∏–π UX
```

### –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å Circuit Breaker

**1. –ò—Å–ø–æ–ª—å–∑—É–π –≥–æ—Ç–æ–≤—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏**:
```
Java: Resilience4j, Hystrix
.NET: Polly
Python: pybreaker
Go: gobreaker
JavaScript: opossum
```

**2. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ SLA**:
```
Service SLA = 99.9% uptime

failure_threshold = 50% (–ø–æ–ª–æ–≤–∏–Ω–∞ requests fail)
window_size = 20
timeout = 60s
```

**3. –ü—Ä–∏–º–µ–Ω—è–π Circuit Breaker –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö —Å–µ—Ä–≤–∏—Å–æ–≤**:
```
‚úÖ Client ‚Üí [Circuit Breaker] ‚Üí External Service
‚úÖ Service A ‚Üí [Circuit Breaker] ‚Üí Service B

‚ùå –ù–µ –Ω—É–∂–µ–Ω –¥–ª—è in-process calls
```

**4. –ö–æ–º–±–∏–Ω–∏—Ä—É–π —Å Retry –∏ Timeout**:
```
[Circuit Breaker] ‚Üí [Retry] ‚Üí [Timeout] ‚Üí Service

Layered protection
```

**5. –†–µ–∞–ª–∏–∑—É–π Fallback**:
```
try:
    result = callService()
except CircuitOpenException:
    result = fallbackMethod()
```

**6. –ú–æ–Ω–∏—Ç–æ—Ä—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ Circuit Breaker**:
```
Metrics:
- circuit_breaker_state (CLOSED/OPEN/HALF-OPEN)
- circuit_breaker_failures_total
- circuit_breaker_calls_total
- circuit_breaker_fallback_calls_total

Alerts:
- Circuit opened –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
```

---

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤

| –ú–µ—Ö–∞–Ω–∏–∑–º | –¶–µ–ª—å | –ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è—Ç—å | –ß—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç |
|----------|------|-----------------|-------------------|
| **Retry** | –ü–æ–≤—Ç–æ—Ä–∏—Ç—å failed –æ–ø–µ—Ä–∞—Ü–∏—é | Transient errors | –ü–æ—Ç–µ—Ä—è requests –∏–∑-–∑–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ–µ–≤ |
| **Backoff** | –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É retries | –í—Å–µ–≥–¥–∞ —Å retry | –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ recovering —Å–∏—Å—Ç–µ–º—ã |
| **Exponential Backoff** | –†–∞—Å—Ç—É—â–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ | Standard retry | Thundering herd, –±—ã—Å—Ç—Ä–æ–µ –∏—Å—Ç–æ—â–µ–Ω–∏–µ retry |
| **Jitter** | –°–ª—É—á–∞–π–Ω–æ—Å—Ç—å –≤ backoff | –ú–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ | Synchronized retry burst |
| **Timeout** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è | –í—Å–µ I/O –æ–ø–µ—Ä–∞—Ü–∏–∏ | –í–∏—Å—è—â–∏–µ requests, resource exhaustion |
| **Deadline** | –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –∫—Ä–∞–π–Ω–∏–π —Å—Ä–æ–∫ | –¶–µ–ø–æ—á–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ | Zombie requests, –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ |
| **Cancellation** | –Ø–≤–Ω–∞—è –æ—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ | User-initiated, deadline exceeded | –ü–æ—Ç–µ—Ä—è —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–∞ –Ω–µ–Ω—É–∂–Ω—É—é —Ä–∞–±–æ—Ç—É |
| **Circuit Breaker** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ failing service | –ú–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ | Cascade failures, –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ failing —Å–µ—Ä–≤–∏—Å–∞ |

---

## Best Practices (–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏)

### 1. –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞

–ò—Å–ø–æ–ª—å–∑—É–π –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –≤–º–µ—Å—Ç–µ:

```
Request flow:
[Client]
  ‚Üì
[Deadline: 30s]  ‚Üê –æ–±—â–∏–π –∫—Ä–∞–π–Ω–∏–π —Å—Ä–æ–∫
  ‚Üì
[Circuit Breaker]  ‚Üê –∑–∞—â–∏—Ç–∞ –æ—Ç cascade failures
  ‚Üì
[Retry: max 3, exponential backoff with jitter]  ‚Üê resilience –∫ transient errors
  ‚Üì
[Timeout: 5s per attempt]  ‚Üê –∑–∞—â–∏—Ç–∞ –æ—Ç –≤–∏—Å—è—â–∏—Ö requests
  ‚Üì
[Service]
```

### 2. Observability (–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å)

–õ–æ–≥–∏—Ä—É–π –∏ –º–æ–Ω–∏—Ç–æ—Ä—å:

```
Metrics:
- retry_attempts_total{service, reason}
- retry_success_rate
- timeout_total{service, operation}
- deadline_exceeded_total
- circuit_breaker_state{service}
- cancellation_total{reason}

Logs:
[WARN] Request timeout: service=payment, timeout=5s, duration=5.2s
[INFO] Retry attempt 2/3: service=user, delay=2s
[ERROR] Circuit breaker opened: service=recommendation, failures=10
```

### 3. Graceful Degradation

–í—Å–µ–≥–¥–∞ –∏–º–µ–π fallback:

```
try:
    result = callService()  # primary
except TimeoutError:
    result = getCachedData()  # fallback
except CircuitOpenError:
    result = getDefaultData()  # fallback
```

### 4. Testing (–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

–¢–µ—Å—Ç–∏—Ä—É–π retry/timeout/circuit breaker logic:

```
Unit tests:
- –°–∏–º—É–ª–∏—Ä—É–π transient errors ‚Üí –ø—Ä–æ–≤–µ—Ä—å retry
- –°–∏–º—É–ª–∏—Ä—É–π timeout ‚Üí –ø—Ä–æ–≤–µ—Ä—å cancellation
- –°–∏–º—É–ª–∏—Ä—É–π series of failures ‚Üí –ø—Ä–æ–≤–µ—Ä—å circuit breaker

Chaos Engineering:
- Inject latency ‚Üí –ø—Ä–æ–≤–µ—Ä—å timeout handling
- Kill services ‚Üí –ø—Ä–æ–≤–µ—Ä—å circuit breaker
- Network partition ‚Üí –ø—Ä–æ–≤–µ—Ä—å deadline propagation
```

### 5. Configuration (–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

–î–µ–ª–∞–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–º–∏:

```
config.yaml:
services:
  payment:
    timeout: 10s
    retry:
      max_attempts: 3
      backoff: exponential
      base_delay: 1s
      max_delay: 30s
    circuit_breaker:
      failure_threshold: 50%
      timeout: 60s
```

–ù–µ —Ö–∞—Ä–¥–∫–æ–¥—å –∑–Ω–∞—á–µ–Ω–∏—è!

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã**:

1. **Retry & Timeout ‚Äî –Ω–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ "nice to have"**, –∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏
2. **Exponential backoff —Å jitter ‚Äî –∏–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç** –¥–ª—è retry logic
3. **Deadline –ª—É—á—à–µ timeout** –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º (propagation!)
4. **Circuit Breaker –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã–µ —Å–±–æ–∏** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –≤—Å–µ–≥–¥–∞ –¥–ª—è –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
5. **–ö–æ–º–±–∏–Ω–∏—Ä—É–π –º–µ—Ö–∞–Ω–∏–∑–º—ã** –¥–ª—è –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –∑–∞—â–∏—Ç—ã
6. **–ú–æ–Ω–∏—Ç–æ—Ä—å –≤—Å—ë** ‚Äî –±–µ–∑ observability —Ç—ã —Å–ª–µ–ø

**–ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø**:

> Assume failures will happen. Design your system to handle them gracefully through retry, timeout, deadline, and circuit breaker patterns.

**–ß—Ç–æ –¥–∞–ª—å—à–µ**:

- –ò–∑—É—á–∏ libraries: Resilience4j, Polly, Tenacity
- –ü—Ä–∞–∫—Ç–∏–∫—É–π Chaos Engineering (Chaos Monkey, Gremlin)
- –ß–∏—Ç–∞–π post-mortems –∫—Ä—É–ø–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π (AWS, Google, GitHub)
- –ü—Ä–∏–º–µ–Ω—è–π patterns –≤ —Å–≤–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö

**–ü–æ–º–Ω–∏**: –ù–∞–¥—ë–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ ‚Äî —ç—Ç–æ –Ω–µ —Ç–∞, –∫–æ—Ç–æ—Ä–∞—è –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–∞–¥–∞–µ—Ç. –≠—Ç–æ —Ç–∞, –∫–æ—Ç–æ—Ä–∞—è **–±—ã—Å—Ç—Ä–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è** –∏ **–º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç impact** —Å–±–æ–µ–≤ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

**–ö–Ω–∏–≥–∏**:
- "Release It!" by Michael Nygard ‚Äî patterns —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏
- "Site Reliability Engineering" by Google ‚Äî –ø—Ä–∞–∫—Ç–∏–∫–∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏
- "Designing Data-Intensive Applications" by Martin Kleppmann ‚Äî —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

**Papers**:
- "Exponential Backoff and Jitter" (AWS Architecture Blog)
- "The Circuit Breaker Pattern" (Martin Fowler)
- "Timeouts and Cancellation for Humans" (gRPC documentation)

**Libraries**:
- Java: Resilience4j (https://resilience4j.readme.io/)
- .NET: Polly (https://github.com/App-vNext/Polly)
- Python: Tenacity (https://tenacity.readthedocs.io/)
- Go: gobreaker, backoff
- JavaScript: opossum

**–£–¥–∞—á–∏ –≤ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —É—Å—Ç–æ–π—á–∏–≤—ã—Ö —Å–∏—Å—Ç–µ–º!** üöÄ
