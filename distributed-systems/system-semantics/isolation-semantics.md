# Isolation Semantics (–°–µ–º–∞–Ω—Ç–∏–∫–∞ –ò–∑–æ–ª—è—Ü–∏–∏ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)

## –í–≤–µ–¥–µ–Ω–∏–µ

**Isolation Semantics** (—Å–µ–º–∞–Ω—Ç–∏–∫–∞ –∏–∑–æ–ª—è—Ü–∏–∏) ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä –≥–∞—Ä–∞–Ω—Ç–∏–π, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏—Ö –∫–∞–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤ —Å–∏—Å—Ç–µ–º–µ.

–ü—Ä–µ–¥—Å—Ç–∞–≤—å –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –±–∞–Ω–∫. –¢—ã—Å—è—á–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–µ—Ä–µ–≤–æ–¥—è—Ç –¥–µ–Ω—å–≥–∏, –ø—Ä–æ–≤–µ—Ä—è—é—Ç –±–∞–ª–∞–Ω—Å, –æ—Ç–∫—Ä—ã–≤–∞—é—Ç —Å—á–µ—Ç–∞. –ö–∞–∂–¥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è ‚Äî —ç—Ç–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è. –ù–æ —á—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç, –µ—Å–ª–∏:
- –¢—ã –ø—Ä–æ–≤–µ—Ä—è–µ—à—å –±–∞–ª–∞–Ω—Å, –∞ –≤ —ç—Ç–æ –≤—Ä–µ–º—è –∫—Ç–æ-—Ç–æ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Ç–µ–±–µ –¥–µ–Ω—å–≥–∏ ‚Äî –∫–∞–∫—É—é —Å—É–º–º—É —Ç—ã —É–≤–∏–¥–∏—à—å?
- –î–≤–∞ —á–µ–ª–æ–≤–µ–∫–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –±—Ä–æ–Ω–∏—Ä—É—é—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–µ –º–µ—Å—Ç–æ –≤ —Å–∞–º–æ–ª—ë—Ç–µ ‚Äî –ø–æ–ª—É—á–∞—Ç –ª–∏ –æ–±–∞ –±–∏–ª–µ—Ç?
- –¢—ã –ø–µ—Ä–µ–≤–æ–¥–∏—à—å –¥–µ–Ω—å–≥–∏ –≤ –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö –±–∞–Ω–∫–∞, –∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ –±–∞–ª–∞–Ω—Å—ã –≤ –∫–∞–∂–¥–æ–º?

Isolation (–∏–∑–æ–ª—è—Ü–∏—è) ‚Äî —ç—Ç–æ –±—É–∫–≤–∞ "I" –≤ ACID. –û–Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞. –ß–µ–º –≤—ã—à–µ —É—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏, —Ç–µ–º –º–µ–Ω—å—à–µ —Å—Ç—Ä–∞–Ω–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ —Ç—ã —É–≤–∏–¥–∏—à—å, –Ω–æ —Ç–µ–º –º–µ–¥–ª–µ–Ω–Ω–µ–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å–∏—Å—Ç–µ–º–∞.

**–ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ?**

–í —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö (Postgres, MongoDB, ClickHouse, –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã) –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è –∏–∑–æ–ª—è—Ü–∏–∏ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:
- üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–º –ø–æ—Ç–µ—Ä—è–º (–¥–≤–æ–π–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –±–∞–ª–∞–Ω—Å—ã)
- üé´ Overselling (–ø—Ä–æ–¥–∞–ª–∏ –±–æ–ª—å—à–µ –±–∏–ª–µ—Ç–æ–≤, —á–µ–º –º–µ—Å—Ç)
- üìä –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –æ—Ç—á—ë—Ç–∞–º (–≤–∏–¥–∏—à—å –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- üîÑ Race conditions (–¥–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏–∑–º–µ–Ω–∏–ª–∏ –æ–¥–Ω–∏ –¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
- üëª Phantom reads (–¥–∞–Ω–Ω—ã–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –∏ –∏—Å—á–µ–∑–∞—é—Ç –≤–æ –≤—Ä–µ–º—è —á—Ç–µ–Ω–∏—è)

**–ì–ª–∞–≤–Ω—ã–π trade-off –∏–∑–æ–ª—è—Ü–∏–∏:**
```
–í—ã—à–µ –∏–∑–æ–ª—è—Ü–∏—è = –ú–µ–Ω—å—à–µ –∞–Ω–æ–º–∞–ª–∏–π = –ë–æ–ª—å—à–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ = –ù–∏–∂–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
–ù–∏–∂–µ –∏–∑–æ–ª—è—Ü–∏—è = –ë–æ–ª—å—à–µ –∞–Ω–æ–º–∞–ª–∏–π = –ú–µ–Ω—å—à–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ = –í—ã—à–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
```

---

## –ü—Ä–æ–±–ª–µ–º—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (Read Phenomena)

–ü—Ä–µ–∂–¥–µ —á–µ–º —Ä–∞–∑–±–∏—Ä–∞—Ç—å —É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏, –Ω—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –æ–Ω–∏ —Ä–µ—à–∞—é—Ç. –≠—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è **read phenomena** (—Ñ–µ–Ω–æ–º–µ–Ω—ã —á—Ç–µ–Ω–∏—è) –∏–ª–∏ **anomalies** (–∞–Ω–æ–º–∞–ª–∏–∏).

### 1. Dirty Read (–ì—Ä—è–∑–Ω–æ–µ —á—Ç–µ–Ω–∏–µ)

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã –¥—Ä—É–≥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π, –Ω–æ –µ—â—ë –Ω–µ –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã (–Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã).

**–ü—Ä–∏–º–µ—Ä –∏–∑ –∂–∏–∑–Ω–∏:**

–ü—Ä–µ–¥—Å—Ç–∞–≤—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω. –ê–ª–∏—Å–∞ –ø–æ–∫—É–ø–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π iPhone:

```
–í—Ä–µ–º—è    | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ê–ª–∏—Å—ã           | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ë–æ—Ä–∏—Å–∞
---------|----------------------------|---------------------------
10:00:00 | SELECT stock FROM products |
         | WHERE id = 'iphone'        |
         | ‚Üí –í–∏–¥–∏—Ç: stock = 1         |
---------|----------------------------|---------------------------
10:00:01 |                            | UPDATE products
         |                            | SET stock = 0
         |                            | WHERE id = 'iphone'
         |                            | (–µ—â—ë –Ω–µ COMMIT!)
---------|----------------------------|---------------------------
10:00:02 | SELECT stock FROM products |
         | WHERE id = 'iphone'        |
         | ‚Üí –í–∏–¥–∏—Ç: stock = 0 üò±      |
         | (–≥—Ä—è–∑–Ω–æ–µ —á—Ç–µ–Ω–∏–µ!)          |
---------|----------------------------|---------------------------
10:00:03 |                            | ROLLBACK
         |                            | (–æ—Ç–º–µ–Ω–∏–ª –ø–æ–∫—É–ø–∫—É!)
---------|----------------------------|---------------------------
10:00:04 | –†–µ—à–∞–µ—Ç –Ω–µ –ø–æ–∫—É–ø–∞—Ç—å         |
         | (–¥—É–º–∞–µ—Ç, —á—Ç–æ —Ç–æ–≤–∞—Ä–∞ –Ω–µ—Ç)   |
```

–ê–ª–∏—Å–∞ –≤–∏–¥–∏—Ç `stock = 0`, —Ö–æ—Ç—è –ë–æ—Ä–∏—Å –µ—â—ë –Ω–µ –∑–∞–∫–æ–º–º–∏—Ç–∏–ª –∏–∑–º–µ–Ω–µ–Ω–∏—è. –ë–æ–ª–µ–µ —Ç–æ–≥–æ, –ë–æ—Ä–∏—Å –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é! –ê–ª–∏—Å–∞ –ø—Ä–∏–Ω—è–ª–∞ —Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–æ –≤ committed —Å–æ—Å—Ç–æ—è–Ω–∏–∏.

**–ü–æ—á–µ–º—É —ç—Ç–æ –æ–ø–∞—Å–Ω–æ:**
- –ü—Ä–∏–Ω–∏–º–∞–µ—à—å —Ä–µ—à–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –∏—Å—á–µ–∑–Ω—É—Ç—å
- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∫–∞—Å–∫–∞–¥–Ω—ã–º –æ—Ç–∫–∞—Ç–∞–º (cascading rollbacks)
- –ù–∞—Ä—É—à–∞–µ—Ç—Å—è –ª–æ–≥–∏—á–µ—Å–∫–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

---

### 2. Non-repeatable Read (–ù–µ–ø–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è —á—Ç–µ–Ω–∏–µ)

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —á–∏—Ç–∞–µ—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ –¥–≤–∞–∂–¥—ã, –Ω–æ –ø–æ–ª—É—á–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –ø–æ—Ç–æ–º—É —á—Ç–æ –¥—Ä—É–≥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∏–∑–º–µ–Ω–∏–ª–∞ –∏ –∑–∞–∫–æ–º–º–∏—Ç–∏–ª–∞ –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É —á—Ç–µ–Ω–∏—è–º–∏.

**–ü—Ä–∏–º–µ—Ä –∏–∑ –∂–∏–∑–Ω–∏:**

–¢—ã –ø—Ä–æ–≤–µ—Ä—è–µ—à—å –±–∞–ª–∞–Ω—Å –≤ –±–∞–Ω–∫–æ–≤—Å–∫–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:

```
–í—Ä–µ–º—è    | –¢–≤–æ—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è            | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥—Ä—É–≥–∞
---------|----------------------------|---------------------------
10:00:00 | BEGIN                      |
---------|----------------------------|---------------------------
10:00:01 | SELECT balance             |
         | FROM accounts              |
         | WHERE id = 'alice'         |
         | ‚Üí –í–∏–¥–∏—à—å: 1000‚ÇΩ            |
---------|----------------------------|---------------------------
10:00:02 |                            | BEGIN
         |                            | UPDATE accounts
         |                            | SET balance = balance + 500
         |                            | WHERE id = 'alice'
         |                            | COMMIT
         |                            | (–¥—Ä—É–≥ –ø–µ—Ä–µ–≤—ë–ª —Ç–µ–±–µ 500‚ÇΩ)
---------|----------------------------|---------------------------
10:00:03 | SELECT balance             |
         | FROM accounts              |
         | WHERE id = 'alice'         |
         | ‚Üí –í–∏–¥–∏—à—å: 1500‚ÇΩ üò±         |
         | (–¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ!)         |
---------|----------------------------|---------------------------
10:00:04 | COMMIT                     |
```

–¢—ã –ø—Ä–æ—á–∏—Ç–∞–ª –±–∞–ª–∞–Ω—Å –¥–≤–∞–∂–¥—ã –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –Ω–æ –ø–æ–ª—É—á–∏–ª —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è. –≠—Ç–æ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å –ª–æ–≥–∏–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –æ–∂–∏–¥–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

**–ü–æ—á–µ–º—É —ç—Ç–æ –æ–ø–∞—Å–Ω–æ:**
- –°–ª–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏—è (—Å—É–º–º–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –º–µ–∂–¥—É —á—Ç–µ–Ω–∏—è–º–∏)
- –ù–∞—Ä—É—à–∞–µ—Ç—Å—è snapshot consistency (–ø–æ—Å—Ç–æ—è–Ω—Å—Ç–≤–æ —Å–Ω–∏–º–∫–∞)
- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –±–∏–∑–Ω–µ—Å-—Ä–µ—à–µ–Ω–∏—è–º

---

### 3. Phantom Read (–§–∞–Ω—Ç–æ–º–Ω–æ–µ —á—Ç–µ–Ω–∏–µ)

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∑–∞–ø—Ä–æ—Å –¥–≤–∞–∂–¥—ã, –Ω–æ –ø–æ–ª—É—á–∞–µ—Ç —Ä–∞–∑–Ω—ã–π –Ω–∞–±–æ—Ä —Å—Ç—Ä–æ–∫, –ø–æ—Ç–æ–º—É —á—Ç–æ –¥—Ä—É–≥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–æ–±–∞–≤–∏–ª–∞ –∏–ª–∏ —É–¥–∞–ª–∏–ª–∞ —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ø–∞–¥–∞—é—Ç –ø–æ–¥ —É—Å–ª–æ–≤–∏—è –∑–∞–ø—Ä–æ—Å–∞.

**–ü—Ä–∏–º–µ—Ä –∏–∑ –∂–∏–∑–Ω–∏:**

–¢—ã –º–µ–Ω–µ–¥–∂–µ—Ä –æ—Ç–¥–µ–ª–∞ –ø—Ä–æ–¥–∞–∂ –∏ —Å—á–∏—Ç–∞–µ—à—å –±–æ–Ω—É—Å—ã:

```
–í—Ä–µ–º—è    | –¢–≤–æ—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è            | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∫–æ–ª–ª–µ–≥–∏
---------|----------------------------|---------------------------
10:00:00 | BEGIN                      |
---------|----------------------------|---------------------------
10:00:01 | SELECT COUNT(*)            |
         | FROM sales                 |
         | WHERE date = '2025-01-15'  |
         | ‚Üí –í–∏–¥–∏—à—å: 10 –ø—Ä–æ–¥–∞–∂        |
---------|----------------------------|---------------------------
10:00:02 | (–¥—É–º–∞–µ—à—å: –±–æ–Ω—É—Å = 10 * 100)|
---------|----------------------------|---------------------------
10:00:03 |                            | BEGIN
         |                            | INSERT INTO sales
         |                            | (date, amount)
         |                            | VALUES ('2025-01-15', 5000)
         |                            | COMMIT
         |                            | (–∫–æ–ª–ª–µ–≥–∞ –¥–æ–±–∞–≤–∏–ª –ø—Ä–æ–¥–∞–∂—É)
---------|----------------------------|---------------------------
10:00:04 | SELECT COUNT(*)            |
         | FROM sales                 |
         | WHERE date = '2025-01-15'  |
         | ‚Üí –í–∏–¥–∏—à—å: 11 –ø—Ä–æ–¥–∞–∂ üò±     |
         | (–ø–æ—è–≤–∏–ª–∞—Å—å —Ñ–∞–Ω—Ç–æ–º–Ω–∞—è —Å—Ç—Ä–æ–∫–∞!)
---------|----------------------------|---------------------------
10:00:05 | (—Ç–µ–ø–µ—Ä—å –±–æ–Ω—É—Å = 11 * 100?) |
         | COMMIT                     |
```

–ü–æ—è–≤–∏–ª–∞—Å—å –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞, –∫–æ—Ç–æ—Ä–æ–π –Ω–µ –±—ã–ª–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —á—Ç–µ–Ω–∏–∏. –≠—Ç–æ "—Ñ–∞–Ω—Ç–æ–º" ‚Äî –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–ª–∏—Å—å –∏–∑ –Ω–∏–æ—Ç–∫—É–¥–∞.

**–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É Non-repeatable Read –∏ Phantom Read:**
- **Non-repeatable Read:** –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä–æ–∫–∞—Ö
- **Phantom Read:** –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ (INSERT/DELETE)

**–ü–æ—á–µ–º—É —ç—Ç–æ –æ–ø–∞—Å–Ω–æ:**
- –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á—ë—Ç—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏
- –ê–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (COUNT, SUM, AVG) –¥–∞—é—Ç —Ä–∞–∑–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –ù–∞—Ä—É—à–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

---

### 4. Lost Update (–ü–æ—Ç–µ—Ä—è–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –î–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á–∏—Ç–∞—é—Ç –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ, –∏–∑–º–µ–Ω—è—é—Ç –µ–≥–æ –∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç –æ–±—Ä–∞—Ç–Ω–æ. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –æ–¥–Ω–æ –∏–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Ç–µ—Ä—è–µ—Ç—Å—è.

**–ü—Ä–∏–º–µ—Ä –∏–∑ –∂–∏–∑–Ω–∏:**

–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä —Å –±–∞–Ω–∫–æ–≤—Å–∫–∏–º —Å—á—ë—Ç–æ–º:

```
–í—Ä–µ–º—è    | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è A               | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è B
---------|----------------------------|---------------------------
10:00:00 | BEGIN                      | BEGIN
---------|----------------------------|---------------------------
10:00:01 | SELECT balance             | SELECT balance
         | FROM accounts              | FROM accounts
         | WHERE id = 'alice'         | WHERE id = 'alice'
         | ‚Üí balance = 1000‚ÇΩ          | ‚Üí balance = 1000‚ÇΩ
---------|----------------------------|---------------------------
10:00:02 | (–≤—ã—á–∏—Å–ª—è–µ–º: 1000 + 100)    | (–≤—ã—á–∏—Å–ª—è–µ–º: 1000 - 50)
---------|----------------------------|---------------------------
10:00:03 | UPDATE accounts            |
         | SET balance = 1100         |
         | WHERE id = 'alice'         |
         | COMMIT                     |
---------|----------------------------|---------------------------
10:00:04 |                            | UPDATE accounts
         |                            | SET balance = 950
         |                            | WHERE id = 'alice'
         |                            | COMMIT
---------|----------------------------|---------------------------
–ò—Ç–æ–≥:    | –û–∂–∏–¥–∞–ª–∏: 1000 + 100 - 50 = 1050‚ÇΩ
         | –ü–æ–ª—É—á–∏–ª–∏: 950‚ÇΩ üò±
         | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ A –ø–æ—Ç–µ—Ä—è–Ω–æ!
```

–û–±–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–æ—á–∏—Ç–∞–ª–∏ `balance = 1000`, –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∞–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è B –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–ª–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ A.

**–í–∞—Ä–∏–∞–Ω—Ç—ã Lost Update:**

1. **Last write wins (–ø–æ–±–µ–∂–¥–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å):**
   - –ü—Ä–æ—Å—Ç–µ–π—à–∏–π —Å–ª—É—á–∞–π –≤—ã—à–µ
   - –ß–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤ NoSQL (Cassandra, DynamoDB)

2. **First write wins (–ø–æ–±–µ–∂–¥–∞–µ—Ç –ø–µ—Ä–≤–∞—è –∑–∞–ø–∏—Å—å):**
   - –í—Ç–æ—Ä–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Optimistic Locking

**–ü–æ—á–µ–º—É —ç—Ç–æ –æ–ø–∞—Å–Ω–æ:**
- –ú–æ–ª—á–∞–ª–∏–≤–∞—è –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö (—Å–∏—Å—Ç–µ–º–∞ –Ω–µ —Å–æ–æ–±—â–∞–µ—Ç –æ–± –æ—à–∏–±–∫–µ)
- –û—Å–æ–±–µ–Ω–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –°–ª–æ–∂–Ω–æ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å –∏ –æ—Ç–ª–∞–¥–∏—Ç—å

---

### 5. Write Skew (–ü–µ—Ä–µ–∫–æ—Å –∑–∞–ø–∏—Å–∏)

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –î–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á–∏—Ç–∞—é—Ç –ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏–π—Å—è –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–∏–Ω–∏–º–∞—é—Ç —Ä–µ—à–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ, –∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –Ω–∞—Ä—É—à–∞–µ—Ç—Å—è –±–∏–∑–Ω–µ—Å-–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç (–±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ).

**–ü—Ä–∏–º–µ—Ä –∏–∑ –∂–∏–∑–Ω–∏:**

–ë–æ–ª—å–Ω–∏—Ü–∞ —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã –≤ –æ—Ç–¥–µ–ª–µ–Ω–∏–∏ –≤—Å–µ–≥–¥–∞ –±—ã–ª–æ –º–∏–Ω–∏–º—É–º 2 –¥–µ–∂—É—Ä–Ω—ã—Ö –≤—Ä–∞—á–∞:

```
–ò–∑–Ω–∞—á–∞–ª—å–Ω–æ: –ê–ª–∏—Å–∞ (–¥–µ–∂—É—Ä–∏—Ç), –ë–æ–± (–¥–µ–∂—É—Ä–∏—Ç), –í–∏–∫—Ç–æ—Ä (—Å–≤–æ–±–æ–¥–µ–Ω)

–í—Ä–µ–º—è    | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ê–ª–∏—Å—ã           | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ë–æ–±–∞
---------|----------------------------|---------------------------
10:00:00 | BEGIN                      | BEGIN
---------|----------------------------|---------------------------
10:00:01 | SELECT COUNT(*)            | SELECT COUNT(*)
         | FROM doctors               | FROM doctors
         | WHERE on_duty = true       | WHERE on_duty = true
         | ‚Üí –í–∏–¥–∏—Ç: 2 –≤—Ä–∞—á–∞           | ‚Üí –í–∏–¥–∏—Ç: 2 –≤—Ä–∞—á–∞
---------|----------------------------|---------------------------
10:00:02 | –î—É–º–∞–µ—Ç: "2 –≤—Ä–∞—á–∞ –¥–µ–∂—É—Ä–∏—Ç,  | –î—É–º–∞–µ—Ç: "2 –≤—Ä–∞—á–∞ –¥–µ–∂—É—Ä–∏—Ç,
         | –µ—Å–ª–∏ —è —É–π–¥—É, –æ—Å—Ç–∞–Ω–µ—Ç—Å—è 1,  | –µ—Å–ª–∏ —è —É–π–¥—É, –æ—Å—Ç–∞–Ω–µ—Ç—Å—è 1,
         | –Ω–æ –ë–æ–± –∂–µ –Ω–∞ –º–µ—Å—Ç–µ! OK"    | –Ω–æ –ê–ª–∏—Å–∞ –∂–µ –Ω–∞ –º–µ—Å—Ç–µ! OK"
---------|----------------------------|---------------------------
10:00:03 | UPDATE doctors             |
         | SET on_duty = false        |
         | WHERE name = 'Alice'       |
         | COMMIT                     |
---------|----------------------------|---------------------------
10:00:04 |                            | UPDATE doctors
         |                            | SET on_duty = false
         |                            | WHERE name = 'Bob'
         |                            | COMMIT
---------|----------------------------|---------------------------
–ò—Ç–æ–≥:    | –î–µ–∂—É—Ä–∏—Ç: 0 –≤—Ä–∞—á–µ–π üò±
         | –ë–∏–∑–Ω–µ—Å-–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç –Ω–∞—Ä—É—à–µ–Ω!
```

–û–±–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–æ—á–∏—Ç–∞–ª–∏ –æ–¥–Ω–∏ –¥–∞–Ω–Ω—ã–µ, –ø—Ä–∏–Ω—è–ª–∏ —Ä–µ—à–µ–Ω–∏–µ, —á—Ç–æ –º–æ–∂–Ω–æ —É–π—Ç–∏, –∏ –∏–∑–º–µ–Ω–∏–ª–∏ —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏. –í –∏—Ç–æ–≥–µ –Ω–∞—Ä—É—à–∏–ª–æ—Å—å –ø—Ä–∞–≤–∏–ª–æ "–º–∏–Ω–∏–º—É–º 2 –≤—Ä–∞—á–∞".

**–î—Ä—É–≥–æ–π –ø—Ä–∏–º–µ—Ä: –¥–≤–æ–π–Ω–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–∫–∏**

```
–ü—Ä–∞–≤–∏–ª–æ: –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–∫—É –Ω–µ–ª—å–∑—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –¥–≤–∞–∂–¥—ã –Ω–∞ –æ–¥–Ω–æ –≤—Ä–µ–º—è

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è A:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: SELECT * FROM bookings WHERE room = 101 AND time = '14:00'
   ‚Üí –ü—É—Å—Ç–æ, –Ω–∏–∫—Ç–æ –Ω–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–ª
2. –ë—Ä–æ–Ω–∏—Ä—É–µ—Ç: INSERT INTO bookings (room, time, user) VALUES (101, '14:00', 'Alice')

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è B (–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ):
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: SELECT * FROM bookings WHERE room = 101 AND time = '14:00'
   ‚Üí –ü—É—Å—Ç–æ, –Ω–∏–∫—Ç–æ –Ω–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–ª
2. –ë—Ä–æ–Ω–∏—Ä—É–µ—Ç: INSERT INTO bookings (room, time, user) VALUES (101, '14:00', 'Bob')

–ò—Ç–æ–≥: –æ–±–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–æ—à–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –∏ —Å–æ–∑–¥–∞–ª–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ!
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –æ–ø–∞—Å–Ω–æ:**
- –ù–∞—Ä—É—à–∞—é—Ç—Å—è –±–∏–∑–Ω–µ—Å-–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (–ø—Ä–∞–≤–∏–ª–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏)
- –°–ª–æ–∂–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å, —á–µ–º Lost Update (–∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏)
- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è–º (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –≤—Ä–∞—á–µ–π, –¥–≤–æ–π–Ω–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)

**–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É Lost Update –∏ Write Skew:**
- **Lost Update:** –¥–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑–º–µ–Ω—è—é—Ç –æ–¥–Ω—É –∏ —Ç—É –∂–µ —Å—Ç—Ä–æ–∫—É
- **Write Skew:** –¥–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑–º–µ–Ω—è—é—Ç —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏, –Ω–æ –Ω–∞—Ä—É—à–∞—é—Ç –æ–±—â–∏–π –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç

---

### 6. Read Skew (–ü–µ—Ä–µ–∫–æ—Å —á—Ç–µ–Ω–∏—è)

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ –¥—Ä—É–≥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∏–∑–º–µ–Ω—è–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É —á—Ç–µ–Ω–∏—è–º–∏.

**–ü—Ä–∏–º–µ—Ä –∏–∑ –∂–∏–∑–Ω–∏:**

–£ —Ç–µ–±—è –¥–≤–∞ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —Å—á—ë—Ç–∞, —Ç—ã –¥–µ–ª–∞–µ—à—å –±—ç–∫–∞–ø –±–∞–ª–∞–Ω—Å–æ–≤:

```
–ò–∑–Ω–∞—á–∞–ª—å–Ω–æ: –°—á—ë—Ç A = 500‚ÇΩ, –°—á—ë—Ç B = 500‚ÇΩ, –ò—Ç–æ–≥–æ = 1000‚ÇΩ

–í—Ä–µ–º—è    | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ë—ç–∫–∞–ø–∞          | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ü–µ—Ä–µ–≤–æ–¥–∞
---------|----------------------------|---------------------------
10:00:00 | BEGIN                      |
---------|----------------------------|---------------------------
10:00:01 | SELECT balance             |
         | FROM accounts              |
         | WHERE id = 'account_A'     |
         | ‚Üí –ß–∏—Ç–∞–µ—Ç: 500‚ÇΩ             |
---------|----------------------------|---------------------------
10:00:02 |                            | BEGIN
         |                            | UPDATE accounts
         |                            | SET balance = 300
         |                            | WHERE id = 'account_A'
         |                            |
         |                            | UPDATE accounts
         |                            | SET balance = 700
         |                            | WHERE id = 'account_B'
         |                            | COMMIT
         |                            | (–ø–µ—Ä–µ–≤–µ–ª–∏ 200‚ÇΩ –∏–∑ A –≤ B)
---------|----------------------------|---------------------------
10:00:03 | SELECT balance             |
         | FROM accounts              |
         | WHERE id = 'account_B'     |
         | ‚Üí –ß–∏—Ç–∞–µ—Ç: 700‚ÇΩ             |
---------|----------------------------|---------------------------
10:00:04 | –ò—Ç–æ–≥–æ –≤ –±—ç–∫–∞–ø–µ:            |
         | 500 + 700 = 1200‚ÇΩ üò±       |
         | (–Ω–∞ 200‚ÇΩ –±–æ–ª—å—à–µ!)          |
         | COMMIT                     |
```

–ë—ç–∫–∞–ø –ø—Ä–æ—á–∏—Ç–∞–ª –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: `account_A` –¥–æ –ø–µ—Ä–µ–≤–æ–¥–∞, –∞ `account_B` –ø–æ—Å–ª–µ –ø–µ—Ä–µ–≤–æ–¥–∞. –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–µ–Ω–µ–≥ –±—ã–ª–æ –≤—Å–µ–≥–¥–∞ 1000‚ÇΩ, –Ω–æ –±—ç–∫–∞–ø –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 1200‚ÇΩ.

**–ü–æ—á–µ–º—É —ç—Ç–æ –æ–ø–∞—Å–Ω–æ:**
- –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –≤–∏–¥—è—Ç –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ë—ç–∫–∞–ø—ã –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –û—Ç—á—ë—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω–µ–≤–µ—Ä–Ω—ã–µ —Å—É–º–º—ã

---

## –£—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –º—ã –∑–Ω–∞–µ–º, –∫–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å, –¥–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º —É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —ç—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–∞—é—Ç.

**–°—Ç–∞–Ω–¥–∞—Ä—Ç SQL-92 –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç 4 —É—Ä–æ–≤–Ω—è:**
1. Read Uncommitted
2. Read Committed
3. Repeatable Read
4. Serializable

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—Ç:**
5. Snapshot Isolation (–Ω–µ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ SQL, –Ω–æ —à–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
6. Strict Serializability (–≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö)

---

## 1. Read Uncommitted (–ß—Ç–µ–Ω–∏–µ –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Read Uncommitted** ‚Äî —ç—Ç–æ —Å–∞–º—ã–π –Ω–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

–≠—Ç–æ –∫–∞–∫ —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —á–µ—Ä–Ω–æ–≤–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –µ—â—ë —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è. –¢—ã –≤–∏–¥–∏—à—å –≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, –¥–∞–∂–µ —Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ—Ä –µ—â—ë –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª –∏ –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å.

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

**–û—á–µ–Ω—å –º–∞–ª–æ:**
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
- –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ω–∞ —á—Ç–µ–Ω–∏–µ
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

**–ü–æ—á—Ç–∏ –≤—Å—ë:**
- ‚ùå Dirty Read –≤–æ–∑–º–æ–∂–µ–Ω
- ‚ùå Non-repeatable Read –≤–æ–∑–º–æ–∂–µ–Ω
- ‚ùå Phantom Read –≤–æ–∑–º–æ–∂–µ–Ω
- ‚ùå Lost Update –≤–æ–∑–º–æ–∂–µ–Ω
- ‚ùå Write Skew –≤–æ–∑–º–æ–∂–µ–Ω
- ‚ùå Read Skew –≤–æ–∑–º–æ–∂–µ–Ω

### üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü—Ä–∏ Read Uncommitted —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –ø–∞–º—è—Ç–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏. –ù–∏–∫–∞–∫–∏—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ω–∞ —á—Ç–µ–Ω–∏–µ –Ω–µ—Ç.

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:**

```
–í—Ä–µ–º—è ‚Üí
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è A:  BEGIN ‚îÄ‚Üí UPDATE x=5 ‚îÄ‚Üí ... ‚îÄ‚Üí ROLLBACK
                          ‚Üì (–Ω–µ –∑–∞–∫–æ–º–º–∏—á–µ–Ω–æ!)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è B:         BEGIN ‚îÄ‚Üí SELECT x
                                  ‚Üì
                              –≤–∏–¥–∏—Ç x=5 üò±
                              (–≥—Ä—è–∑–Ω–æ–µ —á—Ç–µ–Ω–∏–µ!)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
```

### üí° –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

**–ü–æ—á—Ç–∏ –Ω–∏–∫–æ–≥–¥–∞.** –≠—Ç–æ—Ç —É—Ä–æ–≤–µ–Ω—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö:

1. **–ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã:**
   - –°—á–∏—Ç–∞–µ—à—å –ø—Ä–∏–º–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–Ω–ª–∞–π–Ω
   - –¢–æ—á–Ω–æ—Å—Ç—å –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞
   - –í–∞–∂–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:**
   - Dashboard —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
   - –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
   - –ù–µ–±–æ–ª—å—à–∞—è –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç—å –¥–æ–ø—É—Å—Ç–∏–º–∞

### ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 1: –î–≤–æ–π–Ω–∞—è –ø—Ä–æ–¥–∞–∂–∞ —Ç–æ–≤–∞—Ä–∞**

–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª Read Uncommitted –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è —Ç–æ–≤–∞—Ä–∞:

```
1. –ö–ª–∏–µ–Ω—Ç A –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: SELECT stock WHERE id = 'iphone' ‚Üí stock = 1
2. –ö–ª–∏–µ–Ω—Ç B –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–æ–∫—É–ø–∫—É: UPDATE stock SET stock = 0 (–Ω–µ –∑–∞–∫–æ–º–º–∏—Ç–∏–ª)
3. –ö–ª–∏–µ–Ω—Ç A —á–∏—Ç–∞–µ—Ç: SELECT stock WHERE id = 'iphone' ‚Üí stock = 0
4. –ö–ª–∏–µ–Ω—Ç A –≤–∏–¥–∏—Ç "—Ç–æ–≤–∞—Ä –∑–∞–∫–æ–Ω—á–∏–ª—Å—è", —É—Ö–æ–¥–∏—Ç
5. –ö–ª–∏–µ–Ω—Ç B –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (–ø—Ä–æ–±–ª–µ–º–∞ —Å –∫–∞—Ä—Ç–æ–π)
6. –¢–æ–≤–∞—Ä –æ—Å—Ç–∞–ª—Å—è –Ω–µ–ø—Ä–æ–¥–∞–Ω–Ω—ã–º, –∫–ª–∏–µ–Ω—Ç A –ø–æ—Ç–µ—Ä—è–Ω
```

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç 2: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç**

–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è –∑–∞–ø—É—Å—Ç–∏–ª–∞ –æ—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º –∑–∞ –º–µ—Å—è—Ü:

```
1. –û—Ç—á—ë—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
2. –í —ç—Ç–æ –≤—Ä–µ–º—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –æ—à–∏–±–∫—É –≤ —Å—á—ë—Ç–µ (–±–æ–ª—å—à–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è)
3. –û—Ç—á—ë—Ç —á–∏—Ç–∞–µ—Ç —á–∞—Å—Ç–∏—á–Ω–æ —Å—Ç–∞—Ä—ã–µ, —á–∞—Å—Ç–∏—á–Ω–æ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
4. –ë—É—Ö–≥–∞–ª—Ç–µ—Ä –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Ä–µ—à–∏–ª –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ-–¥—Ä—É–≥–æ–º—É)
5. –û—Ç—á—ë—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—ã–ª–æ –≤ –ë–î
6. –û—Ç—á—ë—Ç —É—à—ë–ª –Ω–∞–ª–æ–≥–æ–≤–æ–π üò±
```

### üèóÔ∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É

–ï—Å–ª–∏ —Ç—ã –≤—Å—ë-—Ç–∞–∫–∏ —Ä–µ—à–∏–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Read Uncommitted:

**1. –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
   - –ú–µ—Ç—Ä–∏–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
   - –ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–¥—Å—á—ë—Ç—ã
   - –î–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –±—ã—Å—Ç—Ä–æ —É—Å—Ç–∞—Ä–µ–≤–∞—é—Ç

**2. –ù–∏–∫–æ–≥–¥–∞ –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏:**
   - –ù–µ –ø—Ä–æ–≤–µ—Ä—è–π –±–∞–ª–∞–Ω—Å—ã
   - –ù–µ —Å—á–∏—Ç–∞–π –æ—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
   - –ù–µ –ø—Ä–∏–Ω–∏–º–∞–π –±–∏–∑–Ω–µ—Å-—Ä–µ—à–µ–Ω–∏–π

**3. –î–æ–±–∞–≤—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   - –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - Valid–∞tion –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª
   - –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏

**4. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π —Ä–∏—Å–∫–∏:**
   - –ö–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–Ω–∏–º–∞—Ç—å, –ø–æ—á–µ–º—É –≤—ã–±—Ä–∞–Ω —ç—Ç–æ—Ç —É—Ä–æ–≤–µ–Ω—å
   - –ö–∞–∫–∏–µ –∞–Ω–æ–º–∞–ª–∏–∏ –≤–æ–∑–º–æ–∂–Ω—ã
   - –ì–¥–µ —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ, –∞ –≥–¥–µ –Ω–µ—Ç

### üóÉÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö

- **PostgreSQL:** –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Read Committed –∫–∞–∫ –º–∏–Ω–∏–º—É–º
- **MySQL/InnoDB:** –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç, –Ω–æ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
- **Oracle:** –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç
- **SQL Server:** –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç

---

## 2. Read Committed (–ß—Ç–µ–Ω–∏–µ –∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Read Committed** ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã –¥–æ –Ω–∞—á–∞–ª–∞ —á—Ç–µ–Ω–∏—è. –≠—Ç–æ —Å–∞–º—ã–π —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏ –∏ –¥–µ—Ñ–æ–ª—Ç –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –ë–î.

–≠—Ç–æ –∫–∞–∫ —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–∞. –¢—ã –Ω–µ –≤–∏–¥–∏—à—å —á–µ—Ä–Ω–æ–≤–∏–∫–∏, —Ç–æ–ª—å–∫–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ, —É—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏.

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- ‚úÖ **–ù–µ—Ç Dirty Read:** –≤–∏–¥–∏—à—å —Ç–æ–ª—å–∫–æ –∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ **–ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏:** —á–∏—Ç–∞—é—â–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –ø–∏—à—É—â–∏–µ
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:** –ø–æ–Ω—è—Ç–Ω–∞—è —Å–µ–º–∞–Ω—Ç–∏–∫–∞, –ª–µ–≥–∫–æ —Ä–∞—Å—Å—É–∂–¥–∞—Ç—å –æ –∫–æ–¥–µ

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- ‚ùå Non-repeatable Read –≤–æ–∑–º–æ–∂–µ–Ω (–∑–Ω–∞—á–µ–Ω–∏—è –º–æ–≥—É—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –º–µ–∂–¥—É —á—Ç–µ–Ω–∏—è–º–∏)
- ‚ùå Phantom Read –≤–æ–∑–º–æ–∂–µ–Ω (—Å—Ç—Ä–æ–∫–∏ –º–æ–≥—É—Ç –ø–æ—è–≤–∏—Ç—å—Å—è/–∏—Å—á–µ–∑–Ω—É—Ç—å)
- ‚ùå Write Skew –≤–æ–∑–º–æ–∂–µ–Ω (–º–æ–∂–µ—Ç –Ω–∞—Ä—É—à–∏—Ç—å—Å—è –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç)
- ‚ùå Lost Update –≤–æ–∑–º–æ–∂–µ–Ω (–±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –º–µ—Ä)

### üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ú–µ—Ö–∞–Ω–∏–∑–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **–î–ª—è —á—Ç–µ–Ω–∏—è:** —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —á–∏—Ç–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –¥–∞–Ω–Ω—ã—Ö
2. **–î–ª—è –∑–∞–ø–∏—Å–∏:** —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –Ω–∞ –∏–∑–º–µ–Ω—è–µ–º—ã–µ —Å—Ç—Ä–æ–∫–∏ –¥–æ COMMIT

**–í–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö (MVCC):**

–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ë–î –∏—Å–ø–æ–ª—å–∑—É—é—Ç MVCC (Multi-Version Concurrency Control):

```
–†–µ–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Row ID  ‚îÇ Value   ‚îÇ Transaction  ‚îÇ Committed?  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ x       ‚îÇ 10      ‚îÇ T1           ‚îÇ Yes         ‚îÇ
‚îÇ x       ‚îÇ 15      ‚îÇ T2           ‚îÇ No          ‚îÇ ‚Üê T2 –µ—â—ë –Ω–µ –∑–∞–∫–æ–º–º–∏—Ç–∏–ª–∞
‚îÇ x       ‚îÇ 20      ‚îÇ T3           ‚îÇ Yes         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è T4 —á–∏—Ç–∞–µ—Ç x:
‚Üí –í–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ committed –≤–µ—Ä—Å–∏–∏: 10 –∏ 20
‚Üí –ë–µ—Ä—ë—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é: 20
‚Üí –ù–µ –≤–∏–¥–∏—Ç x=15 (–Ω–µ –∑–∞–∫–æ–º–º–∏—á–µ–Ω–æ)
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π —à–∫–∞–ª—ã:**

```
–í—Ä–µ–º—è ‚Üí
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è A:  BEGIN ‚îÄ‚Üí UPDATE x=5 ‚îÄ‚Üí ... ‚îÄ‚Üí COMMIT
                          ‚Üì (–Ω–µ –≤–∏–¥–Ω–æ)         ‚Üì (–≤–∏–¥–Ω–æ!)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è B:         BEGIN ‚îÄ‚Üí SELECT x ‚îÄ‚Üí SELECT x
                                  ‚Üì             ‚Üì
                              –≤–∏–¥–∏—Ç x=10    –≤–∏–¥–∏—Ç x=5
                              (—Å—Ç–∞—Ä–æ–µ)      (–Ω–æ–≤–æ–µ)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
```

### üí° –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ 90% —Å–ª—É—á–∞–µ–≤.** –≠—Ç–æ default –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –ë–î:

1. **PostgreSQL:** –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
2. **Oracle:** –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
3. **SQL Server:** –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å

**–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –û–±—ã—á–Ω—ã–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- E-commerce (—Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏)
- –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏
- CMS —Å–∏—Å—Ç–µ–º—ã

### ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 1: Lost Update –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–µ

```
–ü—Ä–æ–±–ª–µ–º–∞: –¥–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–∫—É–ø–∞—é—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ç–æ–≤–∞—Ä

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è A (–ö–ª–∏–µ–Ω—Ç 1):
10:00:00 - BEGIN
10:00:01 - SELECT stock FROM products WHERE id = 'iphone' ‚Üí stock = 1
10:00:02 - (–¥—É–º–∞–µ—Ç: "—Ç–æ–≤–∞—Ä –µ—Å—Ç—å, –∫—É–ø–ª—é")
10:00:05 - UPDATE products SET stock = 0 WHERE id = 'iphone'
10:00:06 - COMMIT

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è B (–ö–ª–∏–µ–Ω—Ç 2):
10:00:00 - BEGIN
10:00:01 - SELECT stock FROM products WHERE id = 'iphone' ‚Üí stock = 1
10:00:03 - (–¥—É–º–∞–µ—Ç: "—Ç–æ–≤–∞—Ä –µ—Å—Ç—å, –∫—É–ø–ª—é")
10:00:04 - UPDATE products SET stock = 0 WHERE id = 'iphone'
10:00:07 - COMMIT

–ò—Ç–æ–≥: –æ–±–∞ –∫–ª–∏–µ–Ω—Ç–∞ –∫—É–ø–∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ç–æ–≤–∞—Ä!
      –°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç –¥–≤–∞ –∑–∞–∫–∞–∑–∞, –Ω–æ —Ç–æ–≤–∞—Ä —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω.
```

**–ß—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:**
- –û–±–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–æ—á–∏—Ç–∞–ª–∏ `stock = 1`
- –û–±–µ —Ä–µ—à–∏–ª–∏, —á—Ç–æ —Ç–æ–≤–∞—Ä –µ—Å—Ç—å
- –û–±–µ –æ–±–Ω–æ–≤–∏–ª–∏ stock
- Read Committed –Ω–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç Lost Update

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
```
1. SELECT FOR UPDATE (–ø–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞):
   SELECT stock FROM products WHERE id = 'iphone' FOR UPDATE;

2. Optimistic locking (–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ):
   UPDATE products SET stock = stock - 1, version = version + 1
   WHERE id = 'iphone' AND version = <–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–∞—è_–≤–µ—Ä—Å–∏—è>

3. Atomic –æ–ø–µ—Ä–∞—Ü–∏–∏:
   UPDATE products SET stock = stock - 1
   WHERE id = 'iphone' AND stock > 0
```

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 2: Non-repeatable Read –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ

```
–ü—Ä–æ–±–ª–µ–º–∞: —Ä–∞—Å—á—ë—Ç –±–æ–Ω—É—Å–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∑–∞ –º–µ—Å—è—Ü

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è (–†–∞—Å—á—ë—Ç –±–æ–Ω—É—Å–æ–≤):
10:00:00 - BEGIN
10:00:01 - SELECT SUM(sales) FROM orders WHERE user = 'Alice'
           ‚Üí –í–∏–¥–∏—Ç: 10,000‚ÇΩ
10:00:02 - (–≤—ã—á–∏—Å–ª—è–µ—Ç –±–æ–Ω—É—Å: 10,000 * 0.1 = 1,000‚ÇΩ)

          [–í —ç—Ç–æ –≤—Ä–µ–º—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä –¥–æ–±–∞–≤–∏–ª –∑–∞–±—ã—Ç—ã–π –∑–∞–∫–∞–∑]

10:00:03 - SELECT SUM(sales) FROM orders WHERE user = 'Alice'
           ‚Üí –í–∏–¥–∏—Ç: 15,000‚ÇΩ (–¥–æ–±–∞–≤–∏–ª–∏ –∑–∞–∫–∞–∑ –Ω–∞ 5,000‚ÇΩ)
10:00:04 - (—Ç–µ–ø–µ—Ä—å –±–æ–Ω—É—Å: 15,000 * 0.1 = 1,500‚ÇΩ)
10:00:05 - –ö–∞–∫–æ–π –±–æ–Ω—É—Å –Ω–∞—á–∏—Å–ª–∏—Ç—å? ü§î
```

**–ß—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:**
- –ú–µ–∂–¥—É –¥–≤—É–º—è —á—Ç–µ–Ω–∏—è–º–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤–∏–¥–∏—Ç —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π —Ä–∞—Å—á—ë—Ç

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Repeatable Read –∏–ª–∏ Snapshot Isolation
- –ò–ª–∏ –¥–µ–ª–∞—Ç—å —Ä–∞—Å—á—ë—Ç –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö —á—Ç–µ–Ω–∏–π

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 3: Phantom Read –≤ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏

```
–ü—Ä–æ–±–ª–µ–º–∞: –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–Ω–æ–π –∫–æ–º–Ω–∞—Ç—ã

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è A (–ê–ª–∏—Å–∞ –±—Ä–æ–Ω–∏—Ä—É–µ—Ç):
10:00:00 - BEGIN
10:00:01 - SELECT COUNT(*) FROM bookings
           WHERE room = 101 AND time = '14:00'
           ‚Üí –í–∏–¥–∏—Ç: 0 (—Å–≤–æ–±–æ–¥–Ω–∞)
10:00:02 - (–¥—É–º–∞–µ—Ç: "–∫–æ–º–Ω–∞—Ç–∞ —Å–≤–æ–±–æ–¥–Ω–∞")

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è B (–ë–æ–± –±—Ä–æ–Ω–∏—Ä—É–µ—Ç):
10:00:01 - BEGIN
10:00:02 - SELECT COUNT(*) FROM bookings
           WHERE room = 101 AND time = '14:00'
           ‚Üí –í–∏–¥–∏—Ç: 0 (—Å–≤–æ–±–æ–¥–Ω–∞)
10:00:03 - INSERT INTO bookings (room, time, user)
           VALUES (101, '14:00', 'Bob')
10:00:04 - COMMIT

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è A (–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ):
10:00:05 - INSERT INTO bookings (room, time, user)
           VALUES (101, '14:00', 'Alice')
10:00:06 - COMMIT

–ò—Ç–æ–≥: –∫–æ–º–Ω–∞—Ç–∞ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∞ –¥–≤–∞–∂–¥—ã!
```

**–ß—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:**
- –û–±–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∏–ª–∏, —á—Ç–æ –∫–æ–º–Ω–∞—Ç–∞ —Å–≤–æ–±–æ–¥–Ω–∞
- –û–±–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–ª–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- Read Committed –Ω–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç Phantom Read

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
```
1. Unique constraint:
   UNIQUE (room, time)

2. Serializable isolation level

3. Advisory locks:
   SELECT pg_advisory_lock(hash(room || time))

4. SELECT FOR UPDATE –Ω–∞ "—Ñ–∞–Ω—Ç–æ–º–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω":
   SELECT * FROM rooms WHERE id = 101 FOR UPDATE
```

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 4: Write Skew —Å –¥–µ–∂—É—Ä–Ω—ã–º–∏ –≤—Ä–∞—á–∞–º–∏

–ú—ã —É–∂–µ –≤–∏–¥–µ–ª–∏ —ç—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –≤ —Ä–∞–∑–¥–µ–ª–µ –∞–Ω–æ–º–∞–ª–∏–π. –ü—Ä–∏ Read Committed –¥–≤–∞ –≤—Ä–∞—á–∞ –º–æ–≥—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —É–π—Ç–∏ —Å –¥–µ–∂—É—Ä—Å—Ç–≤–∞, –Ω–∞—Ä—É—à–∏–≤ –ø—Ä–∞–≤–∏–ª–æ "–º–∏–Ω–∏–º—É–º 2 –≤—Ä–∞—á–∞".

**–ü–æ—á–µ–º—É Read Committed –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç:**
- –ö–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —á–∏—Ç–∞–µ—Ç committed –¥–∞–Ω–Ω—ã–µ (2 –≤—Ä–∞—á–∞)
- –ö–∞–∂–¥–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- –ö–∞–∂–¥–∞—è –∏–∑–º–µ–Ω—è–µ—Ç —Å–≤–æ—é —Å—Ç—Ä–æ–∫—É
- –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç –Ω–∞—Ä—É—à–∞–µ—Ç—Å—è

### üèóÔ∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Å Read Committed

#### 1. –ò—Å–ø–æ–ª—å–∑—É–π –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

**–ü–ª–æ—Ö–æ:**
```
SELECT balance FROM accounts WHERE id = 'alice';
-- balance = 1000
UPDATE accounts SET balance = 1100 WHERE id = 'alice';
```

**–•–æ—Ä–æ—à–æ:**
```
UPDATE accounts SET balance = balance + 100 WHERE id = 'alice';
```

#### 2. –ò—Å–ø–æ–ª—å–∑—É–π SELECT FOR UPDATE –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —á—Ç–µ–Ω–∏–π

**–ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞:**
```
–ü–ª–æ—Ö–æ:
SELECT stock FROM products WHERE id = 'iphone';
-- –ø—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω—è–µ–º, –ø–∏—à–µ–º

–•–æ—Ä–æ—à–æ:
SELECT stock FROM products WHERE id = 'iphone' FOR UPDATE;
-- –¥–µ—Ä–∂–∏–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–æ –∫–æ–Ω—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```

#### 3. –ò—Å–ø–æ–ª—å–∑—É–π –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

**–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã:
products (id, stock, version)

–ü—Ä–∏ —á—Ç–µ–Ω–∏–∏:
SELECT stock, version FROM products WHERE id = 'iphone';

–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:
UPDATE products
SET stock = stock - 1, version = version + 1
WHERE id = 'iphone' AND version = <–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–∞—è_–≤–µ—Ä—Å–∏—è>;

–ï—Å–ª–∏ –∑–∞—Ç—Ä–æ–Ω—É—Ç–æ 0 —Å—Ç—Ä–æ–∫ ‚Üí –∫–æ–Ω—Ñ–ª–∏–∫—Ç, retry
```

#### 4. –ò—Å–ø–æ–ª—å–∑—É–π constraints –¥–ª—è –∑–∞—â–∏—Ç—ã –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

**–ü—Ä–∏–º–µ—Ä—ã:**
```
1. UNIQUE constraint:
   UNIQUE (room, time) -- –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–≤–æ–π–Ω–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

2. CHECK constraint:
   CHECK (stock >= 0) -- –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫

3. Foreign key —Å ON DELETE RESTRICT:
   –ó–∞—â–∏—Ç–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
```

#### 5. –†–∞–∑–¥–µ–ª—è–π –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏ (CQRS)

–î–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –æ—Ç—á—ë—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π read replicas –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:
- –ü–∏—à—É—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Üí master –ë–î —Å Read Committed
- –ß–∏—Ç–∞—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Üí replica —Å Snapshot Isolation –∏–ª–∏ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–µ OLAP —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

#### 6. –ò—Å–ø–æ–ª—å–∑—É–π idempotent –æ–ø–µ—Ä–∞—Ü–∏–∏

–ü—Ä–∏ retry –æ–ø–µ—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –¥–∞–≤–∞—Ç—å —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

**–ü–ª–æ—Ö–æ (–Ω–µ idempotent):**
```
UPDATE accounts SET balance = balance + 100;
-- –ø—Ä–∏ retry –¥–µ–Ω—å–≥–∏ –¥–æ–±–∞–≤—è—Ç—Å—è –¥–≤–∞–∂–¥—ã
```

**–•–æ—Ä–æ—à–æ (idempotent):**
```
INSERT INTO transfers (id, amount) VALUES ('txn-123', 100)
ON CONFLICT DO NOTHING;
-- id —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
```

### üóÉÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö

| –ë–î          | Read Committed | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|-------------|----------------|-------------|
| PostgreSQL  | ‚úÖ Default     | MVCC, snapshot per statement |
| MySQL       | ‚úÖ Default     | MVCC –≤ InnoDB |
| Oracle      | ‚úÖ Default     | MVCC |
| SQL Server  | ‚úÖ Default     | Pessimistic locking by default |
| MongoDB     | ‚úÖ             | –î–æ—Å—Ç—É–ø–Ω–æ —Å –≤–µ—Ä—Å–∏–∏ 4.0 |
| Cassandra   | ‚ùå             | Eventual consistency |

---

## 3. Repeatable Read (–ü–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è —á—Ç–µ–Ω–∏–µ)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Repeatable Read** ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤–∏–¥–∏—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–π snapshot –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–µ—Ä–≤–æ–≥–æ —á—Ç–µ–Ω–∏—è. –ï—Å–ª–∏ —Ç—ã –ø—Ä–æ—á–∏—Ç–∞–ª –∑–Ω–∞—á–µ–Ω–∏–µ –æ–¥–∏–Ω —Ä–∞–∑, –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º —á—Ç–µ–Ω–∏–∏ –≤ —Ç–æ–π –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ç—ã —É–≤–∏–¥–∏—à—å —Ç–æ –∂–µ —Å–∞–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –¥–∞–∂–µ –µ—Å–ª–∏ –¥—Ä—É–≥–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –µ–≥–æ –∏–∑–º–µ–Ω–∏–ª–∏.

–≠—Ç–æ –∫–∞–∫ —Å—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –≤ –Ω–∞—á–∞–ª–µ —Ä–∞–±–æ—Ç—ã. –ü–æ–∫–∞ —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å, –¥—Ä—É–≥–∏–µ –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª, –Ω–æ —Ç—ã —Å–º–æ—Ç—Ä–∏—à—å –Ω–∞ —Å–≤–æ—é –Ω–µ–∏–∑–º–µ–Ω–Ω—É—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é.

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- ‚úÖ **–ù–µ—Ç Dirty Read:** –≤–∏–¥–∏—à—å —Ç–æ–ª—å–∫–æ committed –¥–∞–Ω–Ω—ã–µ
- ‚úÖ **–ù–µ—Ç Non-repeatable Read:** –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —Ç–æ–π –∂–µ —Å—Ç—Ä–æ–∫–∏ –¥–∞—ë—Ç —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ **Consistent snapshot:** –≤—Å–µ —á—Ç–µ–Ω–∏—è –≤–∏–¥—è—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–∏–ª–∏ –ø–µ—Ä–≤–æ–≥–æ —á—Ç–µ–Ω–∏—è)
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π:** –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –º–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- ‚ùå Phantom Read **–º–æ–∂–µ—Ç –±—ã—Ç—å –≤–æ–∑–º–æ–∂–µ–Ω** (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
  - –í PostgreSQL: **–Ω–µ—Ç Phantom Read** (snapshot –≤–∫–ª—é—á–∞–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω—ã)
  - –í MySQL: **–≤–æ–∑–º–æ–∂–Ω—ã Phantom Read** (snapshot —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä–æ–∫)
- ‚ùå Write Skew –≤–æ–∑–º–æ–∂–µ–Ω
- ‚ùå Lost Update –≤–æ–∑–º–æ–∂–µ–Ω (–±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –º–µ—Ä)

### üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ú–µ—Ö–∞–Ω–∏–∑–º MVCC —Å snapshot isolation:**

–ü—Ä–∏ Repeatable Read —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–æ–∑–¥–∞—ë—Ç snapshot –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–≤–æ–º SELECT –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ—Ç snapshot –¥–ª—è –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —á—Ç–µ–Ω–∏–π.

```
Timeline:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
T1: BEGIN ‚îÄ‚Üí UPDATE x=10 ‚îÄ‚Üí COMMIT
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
T2:        BEGIN ‚îÄ‚Üí SELECT x ‚îÄ‚Üí UPDATE x=20 ‚îÄ‚Üí COMMIT
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
T3:                       ‚Üë
                   –Ω–∞—á–∞–ª–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏,
                   —Å–æ–∑–¥–∞—ë—Ç—Å—è snapshot:
                   x = 5 (initial value)

           SELECT x ‚Üí –≤–∏–¥–∏—Ç 5 (–∏–∑ snapshot)
           SELECT x ‚Üí –≤–∏–¥–∏—Ç 5 (–∏–∑ snapshot)
           SELECT x ‚Üí –≤–∏–¥–∏—Ç 5 (–∏–∑ snapshot)
                   ‚Üì
             –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏—Ç –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ!
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
```

**–î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ PostgreSQL:**

PostgreSQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç transaction ID (XID) –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–æ–∫:

```
–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ –∏–º–µ–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:
- xmin: ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞–ª–∞ —Å—Ç—Ä–æ–∫—É
- xmax: ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è —É–¥–∞–ª–∏–ª–∞ —Å—Ç—Ä–æ–∫—É (–∏–ª–∏ 0)

–ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è T3 (XID = 1000):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Row ID  ‚îÇ Value   ‚îÇ xmin ‚îÇ xmax ‚îÇ Visible? ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ x       ‚îÇ 5       ‚îÇ 100  ‚îÇ 500  ‚îÇ No       ‚îÇ ‚Üê xmax < 1000 (—É–¥–∞–ª–µ–Ω–∞)
‚îÇ x       ‚îÇ 10      ‚îÇ 500  ‚îÇ 900  ‚îÇ Yes      ‚îÇ ‚Üê xmin < 1000, xmax < 1000
‚îÇ x       ‚îÇ 20      ‚îÇ 900  ‚îÇ 0    ‚îÇ No       ‚îÇ ‚Üê xmin < 1000, –Ω–æ –µ—â—ë –Ω–µ committed
‚îÇ x       ‚îÇ 30      ‚îÇ 1100 ‚îÇ 0    ‚îÇ No       ‚îÇ ‚Üê xmin > 1000 (—Å–æ–∑–¥–∞–Ω–∞ –ø–æ–∑–∂–µ)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è T3 –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ x = 10
```

### üí° –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

**–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è:**

1. **–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á—ë—Ç—ã –∏ —Ä–∞—Å—á—ë—Ç—ã:**
   - –†–∞—Å—á—ë—Ç –±–æ–Ω—É—Å–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
   - –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ—Ç—á—ë—Ç—ã –∑–∞ –ø–µ—Ä–∏–æ–¥
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂
   - –°–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–æ–≤

2. **–ë—ç–∫–∞–ø—ã –∏ —ç–∫—Å–ø–æ—Ä—Ç—ã:**
   - Consistent snapshot –¥–ª—è –±—ç–∫–∞–ø–∞
   - –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ –¥—Ä—É–≥—É—é —Å–∏—Å—Ç–µ–º—É
   - –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

3. **–î–æ–ª–≥–∏–µ —á–∏—Ç–∞—é—â–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF-–æ—Ç—á—ë—Ç–æ–≤
   - –í—ã—á–∏—Å–ª–µ–Ω–∏—è, —Ç—Ä–µ–±—É—é—â–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —á—Ç–µ–Ω–∏–π
   - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –∞–≥—Ä–µ–≥–∞—Ç–æ–≤

### ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 1: Write Skew –≤ booking —Å–∏—Å—Ç–µ–º–µ

```
–ü—Ä–æ–±–ª–µ–º–∞: –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü-–∑–∞–ª–æ–≤ —Å –ª–∏–º–∏—Ç–æ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

–ü—Ä–∞–≤–∏–ª–æ: –≤ –∑–∞–ª–µ –º–∞–∫—Å–∏–º—É–º 100 —á–µ–ª–æ–≤–µ–∫

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è A (–û—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂):
10:00:00 - BEGIN (Repeatable Read)
10:00:01 - SELECT SUM(participants) FROM bookings
           WHERE room = 'Hall-A' AND date = '2025-01-20'
           ‚Üí –í–∏–¥–∏—Ç: 60 —á–µ–ª–æ–≤–µ–∫
10:00:02 - (–¥—É–º–∞–µ—Ç: "60 + 30 = 90, –≤–ª–µ–∑–µ–º!")
10:00:05 - INSERT INTO bookings VALUES ('Sales', 30, ...)
10:00:06 - COMMIT

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è B (–û—Ç–¥–µ–ª –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞):
10:00:00 - BEGIN (Repeatable Read)
10:00:01 - SELECT SUM(participants) FROM bookings
           WHERE room = 'Hall-A' AND date = '2025-01-20'
           ‚Üí –í–∏–¥–∏—Ç: 60 —á–µ–ª–æ–≤–µ–∫ (—Ç–æ—Ç –∂–µ snapshot!)
10:00:03 - (–¥—É–º–∞–µ—Ç: "60 + 35 = 95, –≤–ª–µ–∑–µ–º!")
10:00:04 - INSERT INTO bookings VALUES ('Marketing', 35, ...)
10:00:07 - COMMIT

–ò—Ç–æ–≥: 60 + 30 + 35 = 125 —á–µ–ª–æ–≤–µ–∫ üò±
      –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ª–∞!
```

**–ü–æ—á–µ–º—É Repeatable Read –Ω–µ –ø–æ–º–æ–≥:**
- –û–±–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–∏–¥—è—Ç snapshot —Å 60 —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
- –û–±–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç —Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ snapshot
- –û–±–µ –¥–æ–±–∞–≤–ª—è—é—Ç –Ω–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ (–Ω–µ conflicting writes)
- –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç –Ω–∞—Ä—É—à–∞–µ—Ç—Å—è

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
```
1. Serializable Isolation Level

2. Materialized –ª–∏–º–∏—Ç:
   CREATE TABLE room_capacity (room, date, used, max);
   UPDATE room_capacity SET used = used + 30
   WHERE room = 'Hall-A' AND date = '2025-01-20' AND used + 30 <= max;

3. Application-level lock:
   SELECT pg_advisory_xact_lock(hashcode('Hall-A', '2025-01-20'));
```

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 2: Lost Update –≤ inventory —Å–∏—Å—Ç–µ–º–µ

```
–ü—Ä–æ–±–ª–µ–º–∞: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥–æ–º

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è A (–ü—Ä–æ–¥–∞–∂–∞):
10:00:00 - BEGIN (Repeatable Read)
10:00:01 - SELECT stock FROM inventory WHERE sku = 'WIDGET-123'
           ‚Üí stock = 100
10:00:02 - (–≤—ã—á–∏—Å–ª—è–µ—Ç: 100 - 5)
10:00:05 - UPDATE inventory SET stock = 95 WHERE sku = 'WIDGET-123'
10:00:06 - COMMIT

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è B (–í–æ–∑–≤—Ä–∞—Ç):
10:00:00 - BEGIN (Repeatable Read)
10:00:01 - SELECT stock FROM inventory WHERE sku = 'WIDGET-123'
           ‚Üí stock = 100 (—Ç–æ—Ç –∂–µ snapshot)
10:00:03 - (–≤—ã—á–∏—Å–ª—è–µ—Ç: 100 + 3)
10:00:04 - UPDATE inventory SET stock = 103 WHERE sku = 'WIDGET-123'
10:00:07 - COMMIT ‚Üê –ø–æ–±–µ–∂–¥–∞–µ—Ç!

–ò—Ç–æ–≥: stock = 103, –Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 98 (100 - 5 + 3)
      –ü–æ—Ç–µ—Ä—è–ª–∏ –ø—Ä–æ–¥–∞–∂—É 5 –µ–¥–∏–Ω–∏—Ü!
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- –û–±–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–æ—á–∏—Ç–∞–ª–∏ `stock = 100`
- –û–±–µ –≤—ã—á–∏—Å–ª–∏–ª–∏ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- –ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å –ø–æ–±–µ–¥–∏–ª–∞ (last write wins)
- Read-Modify-Write –ø–∞—Ç—Ç–µ—Ä–Ω —Å–ª–æ–º–∞–ª—Å—è

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
```
1. –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
   UPDATE inventory SET stock = stock - 5;
   UPDATE inventory SET stock = stock + 3;

2. SELECT FOR UPDATE:
   SELECT stock FROM inventory WHERE sku = 'WIDGET-123' FOR UPDATE;

3. Optimistic locking (–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ):
   UPDATE inventory SET stock = 95, version = version + 1
   WHERE sku = 'WIDGET-123' AND version = <–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–∞—è>;
```

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 3: Phantom Read –≤ MySQL

```
–ü—Ä–æ–±–ª–µ–º–∞: –ø–æ–¥—Å—á—ë—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (MySQL/InnoDB)

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è (Repeatable Read –≤ MySQL):
10:00:00 - BEGIN
10:00:01 - SELECT COUNT(*) FROM users WHERE status = 'active'
           ‚Üí –í–∏–¥–∏—Ç: 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

           [–î—Ä—É–≥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è]
           INSERT INTO users (id, status) VALUES (101, 'active')
           COMMIT

10:00:05 - SELECT COUNT(*) FROM users WHERE status = 'active'
           ‚Üí –í–∏–¥–∏—Ç: 101 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å üò±
10:00:06 - (—Ñ–∞–Ω—Ç–æ–º –ø–æ—è–≤–∏–ª—Å—è!)
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ MySQL:**
- MySQL Repeatable Read –∑–∞—â–∏—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏
- –ù–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ (phantoms) –º–æ–≥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è
- –≠—Ç–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç PostgreSQL, –≥–¥–µ phantoms –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ MySQL:**
```
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Serializable

2. SELECT ... FOR UPDATE:
   SELECT COUNT(*) FROM users WHERE status = 'active' FOR UPDATE;
   (–±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω)

3. LOCK TABLES (–≥—Ä—É–±–æ, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç):
   LOCK TABLES users READ;
```

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 4: Read-only transaction –≤–∏–¥–∏—Ç –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏

```
–ü—Ä–æ–±–ª–µ–º–∞: —É —Ç–µ–±—è –µ—Å—Ç—å read-write –∏ read-only —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è A (Read-Write):
10:00:00 - BEGIN (Repeatable Read)
10:00:01 - SELECT balance FROM accounts WHERE id = 'alice' ‚Üí 1000
10:00:05 - UPDATE accounts SET balance = 900 WHERE id = 'alice'
10:00:10 - SELECT balance FROM accounts WHERE id = 'alice' ‚Üí 900
10:00:11 - COMMIT

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è B (Read-Only, –Ω–∞—á–∞—Ç–∞ —Ä–∞–Ω—å—à–µ A):
09:59:00 - BEGIN (Repeatable Read)
10:00:15 - SELECT balance FROM accounts WHERE id = 'alice'
           ‚Üí –í–∏–¥–∏—Ç: 1000 üò±
           (–≤–∏–¥–∏—Ç —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ö–æ—Ç—è A —É–∂–µ –∑–∞–∫–æ–º–º–∏—Ç–∏–ª–∞!)
```

**–≠—Ç–æ –Ω–µ –±–∞–≥, —ç—Ç–æ —Ñ–∏—á–∞:**
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è B –≤–∏–¥–∏—Ç snapshot –Ω–∞ 09:59:00
- –ò–∑–º–µ–Ω–µ–Ω–∏—è A (committed –≤ 10:00:11) –Ω–µ –≤–∏–¥–Ω—ã
- –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—è Repeatable Read

**–ö–æ–≥–¥–∞ —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
- –î–æ–ª–≥–æ–∂–∏–≤—É—â–∏–µ read-only —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –í–∏–¥—è—Ç –≤—Å—ë –±–æ–ª–µ–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ
- –ú–æ–≥—É—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å vacuum/cleanup

### üèóÔ∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Å Repeatable Read

#### 1. –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –¥–æ–ª–≥–∏—Ö —á–∏—Ç–∞—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–ò–¥–µ–∞–ª—å–Ω–æ:**
```
–°—Ü–µ–Ω–∞—Ä–∏–π: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º –∑–∞ –º–µ—Å—è—Ü

BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;

total_sales = SELECT SUM(amount) FROM orders WHERE month = 'Jan';
total_refunds = SELECT SUM(amount) FROM refunds WHERE month = 'Jan';
total_tax = SELECT SUM(tax) FROM orders WHERE month = 'Jan';

net_revenue = total_sales - total_refunds - total_tax;

COMMIT;

–í—Å–µ —á—Ç–µ–Ω–∏—è –≤–∏–¥—è—Ç consistent snapshot,
–¥–∞–∂–µ –µ—Å–ª–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã.
```

#### 2. –ò–∑–±–µ–≥–∞–π Read-Modify-Write –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

**–ü–ª–æ—Ö–æ:**
```
BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;
balance = SELECT balance FROM accounts WHERE id = 'alice';
new_balance = balance - 100;
UPDATE accounts SET balance = new_balance WHERE id = 'alice';
COMMIT;
```

**–•–æ—Ä–æ—à–æ:**
```
BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;
balance = SELECT balance FROM accounts WHERE id = 'alice' FOR UPDATE;
new_balance = balance - 100;
UPDATE accounts SET balance = new_balance WHERE id = 'alice';
COMMIT;
```

#### 3. –ó–∞—â–∏—â–∞–π –æ—Ç Write Skew —Å –ø–æ–º–æ—â—å—é materialize conflicts

**–ü—Ä–æ–±–ª–µ–º–∞:** –¥–≤–∞ –≤—Ä–∞—á–∞ —É—Ö–æ–¥—è—Ç —Å –¥–µ–∂—É—Ä—Å—Ç–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:** —Å–æ–∑–¥–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å—á—ë—Ç—á–∏–∫

```
–í–º–µ—Å—Ç–æ:
  SELECT COUNT(*) FROM doctors WHERE on_duty = true;

–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É:
  CREATE TABLE duty_counter (count INT);
  INSERT INTO duty_counter VALUES (2);

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏:
  UPDATE duty_counter SET count = count - 1 WHERE count >= 2;
  -- –µ—Å–ª–∏ count < 2, UPDATE –Ω–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω–∏—Ç, –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

  UPDATE doctors SET on_duty = false WHERE name = 'Alice';
```

–¢–µ–ø–µ—Ä—å –æ–±–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É, –∏ –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç write conflict.

#### 4. –ö–æ—Ä–æ—Ç–∫–æ –¥–µ—Ä–∂–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º—ã –¥–æ–ª–≥–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:**
```
1. Snapshot —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–º:
   - –ß–∏—Ç–∞–µ—à—å –¥–∞–Ω–Ω—ã–µ 10-–º–∏–Ω—É—Ç–Ω–æ–π –¥–∞–≤–Ω–æ—Å—Ç–∏

2. –ë–ª–æ–∫–∏—Ä—É—é—Ç VACUUM (PostgreSQL):
   - –°—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ —Å—Ç—Ä–æ–∫ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è
   - –¢–∞–±–ª–∏—Ü—ã —Ä–∞–∑–¥—É–≤–∞—é—Ç—Å—è (bloat)

3. –†–∏—Å–∫ deadlock —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è:
   - –ß–µ–º –¥–æ–ª—å—à–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, —Ç–µ–º –±–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –¥–ª–∏—Ç—å—Å—è —Å–µ–∫—É–Ω–¥—ã, –Ω–µ –º–∏–Ω—É—Ç—ã
- –í—ã—á–∏—Å–ª–µ–Ω–∏—è –¥–µ–ª–∞–π –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

#### 5. –ú–æ–Ω–∏—Ç–æ—Ä—å –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**PostgreSQL:**
```
SELECT pid, now() - xact_start AS duration, state, query
FROM pg_stat_activity
WHERE state <> 'idle'
  AND now() - xact_start > interval '5 minutes'
ORDER BY duration DESC;
```

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å –¥–æ–ª–≥–∏–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏:**
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏ –∞–ª–µ—Ä—Ç–∏—Ç—å
- –í–æ–∑–º–æ–∂–Ω–æ, –µ—Å—Ç—å deadlock –∏–ª–∏ –∑–∞–≤–∏—Å—à–∏–π –ø—Ä–æ—Ü–µ—Å—Å
- –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è kill

### üóÉÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö

| –ë–î          | Repeatable Read | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|-------------|-----------------|-------------|
| PostgreSQL  | ‚úÖ              | True snapshot, –Ω–µ—Ç Phantom Read |
| MySQL       | ‚úÖ Default      | –í–æ–∑–º–æ–∂–Ω—ã Phantom Read –±–µ–∑ FOR UPDATE |
| Oracle      | ‚ùå              | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Snapshot Isolation –≤–º–µ—Å—Ç–æ RR |
| SQL Server  | ‚úÖ              | Pessimistic locking, –≤–æ–∑–º–æ–∂–Ω—ã phantoms |
| MongoDB     | ‚úÖ              | Snapshot read concern |

---

## 4. Snapshot Isolation (–ò–∑–æ–ª—è—Ü–∏—è —Å–Ω–∏–º–∫–æ–≤)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Snapshot Isolation** ‚Äî –∫–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å consistent snapshot (—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–º —Å–Ω–∏–º–∫–æ–º) –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –º–æ–º–µ–Ω—Ç –µ—ë –Ω–∞—á–∞–ª–∞. –≠—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ Repeatable Read, –Ω–æ —Å –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–º–∏ –≥–∞—Ä–∞–Ω—Ç–∏—è–º–∏ –∏ –¥—Ä—É–≥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.

–≠—Ç–æ –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –≤–µ—Ä—Å–∏–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ Git. –¢—ã –¥–µ–ª–∞–µ—à—å checkout –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π commit –∏ —Ä–∞–±–æ—Ç–∞–µ—à—å —Å —ç—Ç–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º. –î—Ä—É–≥–∏–µ –º–æ–≥—É—Ç –¥–µ–ª–∞—Ç—å –∫–æ–º–º–∏—Ç—ã, –Ω–æ —Ç—ã –≤–∏–¥–∏—à—å —Å–≤–æ—é –≤–µ—Ä—Å–∏—é. –ö–æ–≥–¥–∞ –≥–æ—Ç–æ–≤ ‚Äî –¥–µ–ª–∞–µ—à—å merge (commit), –∏ –µ—Å–ª–∏ –µ—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã ‚Äî Git –∏—Ö –æ–±–Ω–∞—Ä—É–∂–∏—Ç.

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- ‚úÖ **–ù–µ—Ç Dirty Read:** –≤–∏–¥–∏—à—å —Ç–æ–ª—å–∫–æ committed –¥–∞–Ω–Ω—ã–µ
- ‚úÖ **–ù–µ—Ç Non-repeatable Read:** –≤—Å–µ —á—Ç–µ–Ω–∏—è –≤–∏–¥—è—Ç –æ–¥–∏–Ω snapshot
- ‚úÖ **–ù–µ—Ç Phantom Read:** snapshot –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- ‚úÖ **–ù–µ—Ç Read Skew:** —á–∏—Ç–∞–µ—à—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ–π –ë–î
- ‚úÖ **First-committer-wins:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ write-write –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

### ‚ùå –ß—Ç–æ –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- ‚ùå **Write Skew –≤–æ–∑–º–æ–∂–µ–Ω** (–¥–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑–º–µ–Ω—è—é—Ç —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏, –Ω–∞—Ä—É—à–∞—è –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç)
- ‚ùå **–ù–µ –ø–æ–ª–Ω–∞—è serializability** (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∞–Ω–æ–º–∞–ª–∏–∏ –≤—Å—ë –µ—â—ë –≤–æ–∑–º–æ–∂–Ω—ã)

### üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–û—Ç–ª–∏—á–∏—è –æ—Ç Repeatable Read:**

1. **Snapshot —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ BEGIN, –∞ –Ω–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º SELECT**
2. **Write-write –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**
3. **First-committer-wins –≤–º–µ—Å—Ç–æ last-writer-wins**

**–ú–µ—Ö–∞–Ω–∏–∑–º:**

```
Timeline:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Initial: x = 5, y = 5

T1: BEGIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí COMMIT
    Snapshot: x=5, y=5
    UPDATE x = 10

T2:        BEGIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí COMMIT?
           Snapshot: x=5, y=5
           SELECT x ‚Üí –≤–∏–¥–∏—Ç 5 (–Ω–µ 10!)
           UPDATE x = 20 ‚Üê conflict! üò±
                             T1 —É–∂–µ –∏–∑–º–µ–Ω–∏–ª–∞ x
                             T2 –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
```

**Write-write conflict detection:**

```
–ü—Ä–∞–≤–∏–ª–æ: –µ—Å–ª–∏ –¥–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—ã—Ç–∞—é—Ç—Å—è –∏–∑–º–µ–Ω–∏—Ç—å –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É,
–ø–æ–±–µ–∂–¥–∞–µ—Ç —Ç–∞, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–∫–æ–º–º–∏—Ç–∏–ª–∞ –ø–µ—Ä–≤–æ–π.

–ü—Ä–∏–º–µ—Ä:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è A         –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è B       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ BEGIN                BEGIN              ‚îÇ
‚îÇ UPDATE x = 10                           ‚îÇ
‚îÇ COMMIT ‚úÖ                                ‚îÇ
‚îÇ                      UPDATE x = 20      ‚îÇ
‚îÇ                      COMMIT ‚ùå          ‚îÇ
‚îÇ                      Error: could not   ‚îÇ
‚îÇ                      serialize access   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üí° –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

**–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è:**

1. **OLTP —Å–∏—Å—Ç–µ–º—ã —Å –≤—ã—Å–æ–∫–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–µ–π:**
   - E-commerce
   - –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - Booking —Å–∏—Å—Ç–µ–º—ã

2. **–ö–æ–≥–¥–∞ –Ω—É–∂–Ω—ã –¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ —á–∏—Ç–∞—é—â–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤
   - –ë—ç–∫–∞–ø—ã
   - Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞

3. **–ö–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, –Ω–æ –Ω–µ –Ω—É–∂–Ω–∞ full serializability:**
   - –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
   - CRM —Å–∏—Å—Ç–µ–º—ã
   - Inventory management

### ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 1: Write Skew —Å –≤—Ä–∞—á–∞–º–∏ (–≤—Å—ë –µ—â—ë –≤–æ–∑–º–æ–∂–µ–Ω!)

```
–ü—Ä–∞–≤–∏–ª–æ: –º–∏–Ω–∏–º—É–º 2 –≤—Ä–∞—á–∞ –Ω–∞ –¥–µ–∂—É—Ä—Å—Ç–≤–µ

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è A (–ê–ª–∏—Å–∞):
10:00:00 - BEGIN (Snapshot Isolation)
           Snapshot: Alice=on_duty, Bob=on_duty
10:00:01 - SELECT COUNT(*) FROM doctors WHERE on_duty = true ‚Üí 2
10:00:02 - (–¥—É–º–∞–µ—Ç: "2 –≤—Ä–∞—á–∞, —è –º–æ–≥—É —É–π—Ç–∏")
10:00:05 - UPDATE doctors SET on_duty = false WHERE name = 'Alice'
10:00:06 - COMMIT ‚úÖ

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è B (–ë–æ–±):
10:00:00 - BEGIN (Snapshot Isolation)
           Snapshot: Alice=on_duty, Bob=on_duty
10:00:01 - SELECT COUNT(*) FROM doctors WHERE on_duty = true ‚Üí 2
10:00:03 - (–¥—É–º–∞–µ—Ç: "2 –≤—Ä–∞—á–∞, —è –º–æ–≥—É —É–π—Ç–∏")
10:00:04 - UPDATE doctors SET on_duty = false WHERE name = 'Bob'
10:00:07 - COMMIT ‚úÖ

–ò—Ç–æ–≥: 0 –≤—Ä–∞—á–µ–π –Ω–∞ –¥–µ–∂—É—Ä—Å—Ç–≤–µ üò±
```

**–ü–æ—á–µ–º—É Snapshot Isolation –Ω–µ –ø–æ–º–æ–≥:**
- –û–±–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑–º–µ–Ω–∏–ª–∏ **—Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏** (Alice vs Bob)
- Write-write –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –Ω–µ—Ç!
- Snapshot Isolation –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
- –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç –Ω–∞—Ä—É—à–µ–Ω

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
```
1. Serializable isolation level

2. Materialized constraint:
   CREATE TABLE duty_count (count INT);
   -- –æ–±–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
   UPDATE duty_count SET count = count - 1 WHERE count > 2;

3. SELECT FOR UPDATE –Ω–∞ –≤—Å–µ —Å—Ç—Ä–æ–∫–∏:
   SELECT * FROM doctors WHERE on_duty = true FOR UPDATE;
```

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 2: –°–µ—Ä–∏—è —Ä–µ—Ç—Ä–∞–µ–≤ –∏–∑-–∑–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

```
–ü—Ä–æ–±–ª–µ–º–∞: –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω —Å –ø–æ–ø—É–ª—è—Ä–Ω—ã–º —Ç–æ–≤–∞—Ä–æ–º

100 –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–∫—É–ø–∞—é—Ç iPhone:

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 1:
BEGIN;
SELECT stock FROM products WHERE id = 'iphone' FOR UPDATE; ‚Üí stock = 50
UPDATE products SET stock = 49 WHERE id = 'iphone';
COMMIT ‚úÖ

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 2:
BEGIN;
SELECT stock FROM products WHERE id = 'iphone' FOR UPDATE; ‚Üí stock = 50
UPDATE products SET stock = 49 WHERE id = 'iphone';
COMMIT ‚ùå Error: could not serialize

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 3:
BEGIN;
SELECT stock FROM products WHERE id = 'iphone' FOR UPDATE; ‚Üí stock = 50
UPDATE products SET stock = 49 WHERE id = 'iphone';
COMMIT ‚ùå Error: could not serialize

... 99 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–ª—É—á–∞—é—Ç –æ—à–∏–±–∫—É!
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- –í—Å–µ 100 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞—á–∞–ª–∏—Å—å –ø–æ—á—Ç–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –í—Å–µ –ø—Ä–æ—á–∏—Ç–∞–ª–∏ `stock = 50` –∏–∑ snapshot
- –¢–æ–ª—å–∫–æ –ø–µ—Ä–≤–∞—è –∑–∞–∫–æ–º–º–∏—Ç–∏–ª–∞—Å—å
- –û—Å—Ç–∞–ª—å–Ω—ã–µ 99 –ø–æ–ª—É—á–∏–ª–∏ serialization error

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–µ–ª–∞–µ—Ç retry
- Retry —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
- –¶–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞–¥–∞–µ—Ç
- –ö–ª–∏–µ–Ω—Ç—ã –≤–∏–¥—è—Ç –æ—à–∏–±–∫–∏

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
```
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Read Committed –¥–ª—è —Ç–∞–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:
   UPDATE products SET stock = stock - 1
   WHERE id = 'iphone' AND stock > 0;
   -- –∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è, –±–µ–∑ snapshot

2. –û—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤ (queue):
   -- —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–∫—É–ø–∫–∏

3. Pessimistic locking:
   SELECT ... FOR UPDATE SKIP LOCKED
   -- –±–µ—Ä—ë–º —Ç–æ–ª—å–∫–æ –Ω–µ–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
```

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 3: Bloat –≤ PostgreSQL –∏–∑-–∑–∞ –¥–æ–ª–≥–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

```
–ü—Ä–æ–±–ª–µ–º–∞: –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á—ë—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–∞—Å

10:00:00 - BEGIN (Snapshot Isolation)
           Snapshot —Å–æ–∑–¥–∞–Ω, —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è XID = 1000

11:00:00 - SELECT ... (—á–∞—Å –≤—ã—á–∏—Å–ª–µ–Ω–∏–π)
           COMMIT

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —ç—Ç–æ –≤—Ä–µ–º—è:
- –í—Å–µ –≤–µ—Ä—Å–∏–∏ —Å—Ç—Ä–æ–∫ —Å XID < 1000 –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å (VACUUM –Ω–µ –º–æ–∂–µ—Ç –∏—Ö –æ—á–∏—Å—Ç–∏—Ç—å)
- –¢–∞–±–ª–∏—Ü—ã —Ä–∞–∑–¥—É–≤–∞—é—Ç—Å—è (bloat)
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—Å–µ–π –ë–î –ø–∞–¥–∞–µ—Ç
- –î—Ä—É–≥–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ç–æ—Ä–º–æ–∑—è—Ç
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
```
# –î–æ –¥–æ–ª–≥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
table_size = 1 GB

# –ü–æ—Å–ª–µ —á–∞—Å–æ–≤–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
table_size = 5 GB (bloat 4 GB!)

# –ó–∞–ø—Ä–æ—Å—ã –∑–∞–º–µ–¥–ª–∏–ª–∏—Å—å:
SELECT ... FROM table -- –±—ã–ª–æ 100ms, —Å—Ç–∞–ª–æ 500ms
```

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
```
1. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π Snapshot Isolation –¥–ª—è –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:
   -- –¥–µ–ª–∞–π –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   -- —á–∏—Ç–∞–π –¥–∞–Ω–Ω—ã–µ –ø–æ—Ä—Ü–∏—è–º–∏ —Å Read Committed

2. –ò—Å–ø–æ–ª—å–∑—É–π –ª–æ–≥–∏—á–µ—Å–∫—É—é —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤:
   -- –æ—Ç—á—ë—Ç—ã —á–∏—Ç–∞—é—Ç replica
   -- replica –Ω–µ –º–µ—à–∞–µ—Ç VACUUM –Ω–∞ master

3. –ú–æ–Ω–∏—Ç–æ—Ä—å –¥–æ–ª–≥–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
   SELECT * FROM pg_stat_activity
   WHERE state = 'active' AND now() - xact_start > '5 min';
```

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 4: –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏

```
–ü—Ä–æ–±–ª–µ–º–∞: Order Service –∏ Payment Service

–ö–ª–∏–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç –∑–∞–∫–∞–∑:

Order Service:
BEGIN (Snapshot Isolation)
INSERT INTO orders (id, status) VALUES (123, 'created');
COMMIT ‚úÖ

Payment Service (—á–µ—Ä–µ–∑ HTTP):
BEGIN (Snapshot Isolation) ‚Üê –Ω–æ–≤—ã–π snapshot!
SELECT * FROM orders WHERE id = 123 ‚Üí –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç! üò±
(snapshot Payment Service –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç–∞—Ä—à–µ –∫–æ–º–º–∏—Ç–∞ Order Service)
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- Order Service –∑–∞–∫–æ–º–º–∏—Ç–∏–ª –≤ 10:00:00.500
- Payment Service –Ω–∞—á–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ 10:00:00.499
- Snapshot Payment Service –Ω–µ –≤–∏–¥–∏—Ç –∑–∞–∫–∞–∑–∞
- –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
```
1. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:
   -- –∏—Å–ø–æ–ª—å–∑—É–π eventual consistency
   -- —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å (Kafka, RabbitMQ)

2. Sagas –≤–º–µ—Å—Ç–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:
   -- –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É—é—â–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–∏ –æ—Ç–∫–∞—Ç–µ

3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ read-your-writes:
   -- –ø–µ—Ä–µ–¥–∞–≤–∞–π commit timestamp
   -- —á–∏—Ç–∞–π —Å wait until timestamp
```

### üèóÔ∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Å–æ Snapshot Isolation

#### 1. –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ OLTP –æ–ø–µ—Ä–∞—Ü–∏–π

**–ò–¥–µ–∞–ª—å–Ω–æ:**
```
–°—Ü–µ–Ω–∞—Ä–∏–π: —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ e-commerce

BEGIN TRANSACTION ISOLATION LEVEL SNAPSHOT;

-- –ß–∏—Ç–∞–µ–º —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞
price = SELECT price FROM products WHERE id = 'widget-123';

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ
stock = SELECT stock FROM products WHERE id = 'widget-123';
IF stock < 1 THEN ROLLBACK;

-- –°–æ–∑–¥–∞—ë–º –∑–∞–∫–∞–∑
INSERT INTO orders (user_id, product_id, amount)
VALUES ('alice', 'widget-123', price);

-- –£–º–µ–Ω—å—à–∞–µ–º —Å—Ç–æ–∫
UPDATE products SET stock = stock - 1 WHERE id = 'widget-123';

COMMIT;

–í—Å–µ —á—Ç–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã (–æ–¥–∏–Ω snapshot),
write-write –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
```

#### 2. –ó–∞—â–∏—â–∞–π—Å—è –æ—Ç Write Skew —á–µ—Ä–µ–∑ materialize

**–ü–ª–æ—Ö–æ:**
```
-- –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç —á–µ—Ä–µ–∑ COUNT(*)
SELECT COUNT(*) FROM doctors WHERE on_duty = true;
IF count >= 2 THEN UPDATE ...
```

**–•–æ—Ä–æ—à–æ:**
```
-- —Å–æ–∑–¥–∞—ë–º material counter
CREATE TABLE duty_stats (on_duty_count INT);

-- –æ–±–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑–º–µ–Ω—è—é—Ç –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É ‚Üí –∫–æ–Ω—Ñ–ª–∏–∫—Ç –æ–±–Ω–∞—Ä—É–∂–∏—Ç—Å—è
UPDATE duty_stats SET on_duty_count = on_duty_count - 1;
UPDATE doctors SET on_duty = false WHERE name = 'Alice';
```

#### 3. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π serialization errors

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —É–º–µ—Ç—å retry:**
```
def buy_product(product_id):
    max_retries = 3
    for attempt in range(max_retries):
        try:
            with transaction(isolation=SNAPSHOT):
                stock = SELECT stock FROM products WHERE id = product_id
                if stock < 1:
                    raise OutOfStock
                UPDATE products SET stock = stock - 1 WHERE id = product_id
                CREATE order...
            return success
        except SerializationError:
            if attempt == max_retries - 1:
                raise
            sleep(exponential_backoff(attempt))
            continue
```

#### 4. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–ü–ª–æ—Ö–æ:**
```
BEGIN TRANSACTION ISOLATION LEVEL SNAPSHOT;
-- –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞ –Ω–∞ 30 –º–∏–Ω—É—Ç
-- –±–ª–æ–∫–∏—Ä—É–µ—Ç VACUUM, —Å–æ–∑–¥–∞—ë—Ç bloat
COMMIT;
```

**–•–æ—Ä–æ—à–æ:**
```
1. –î–µ–ª–∞–π –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
   data = SELECT ... ; -- –±—ã—Å—Ç—Ä–æ —á–∏—Ç–∞–µ–º
   result = compute(data); -- –≤—ã—á–∏—Å–ª—è–µ–º –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   BEGIN; INSERT INTO reports VALUES (result); COMMIT;

2. –ò—Å–ø–æ–ª—å–∑—É–π read replica:
   -- –æ—Ç—á—ë—Ç—ã —á–∏—Ç–∞—é—Ç replica
   -- master –Ω–µ —Å—Ç—Ä–∞–¥–∞–µ—Ç –æ—Ç –¥–æ–ª–≥–∏—Ö snapshots

3. –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∏ batching:
   -- —á–∏—Ç–∞–π –¥–∞–Ω–Ω—ã–µ –ø–æ—Ä—Ü–∏—è–º–∏
   -- –∫–∞–∂–¥–∞—è –ø–æ—Ä—Ü–∏—è ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–æ—Ä–æ—Ç–∫–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
```

#### 5. –ú–æ–Ω–∏—Ç–æ—Ä—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã

**PostgreSQL:**
```
SELECT datname,
       blks_hit,
       blks_read,
       tup_returned,
       tup_fetched,
       xact_commit,
       xact_rollback,
       deadlocks
FROM pg_stat_database;

-- –í—ã—Å–æ–∫–∏–π % rollback ‚Üí –º–Ω–æ–≥–æ serialization errors
```

**–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤:**
- –ü—Ä–æ—Ü–µ–Ω—Ç rollback / (commit + rollback)
- –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ serialization errors

### üóÉÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö

| –ë–î          | Snapshot Isolation | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|-------------|-------------------|-------------|
| PostgreSQL  | ‚úÖ (–∫–∞–∫ Repeatable Read) | True SI, first-committer-wins |
| Oracle      | ‚úÖ Default        | –ù–∞–∑—ã–≤–∞–µ—Ç—Å—è "Read Committed" –Ω–æ —Ä–µ–∞–ª—å–Ω–æ SI |
| SQL Server  | ‚úÖ RCSI/SI        | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å |
| MySQL       | ‚ùå                | Repeatable Read –ø–æ—Ö–æ–∂, –Ω–æ –Ω–µ –∏–¥–µ–Ω—Ç–∏—á–µ–Ω |
| MongoDB     | ‚úÖ                | snapshot read concern |
| CockroachDB | ‚úÖ Default        | –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π SI |

---

## 5. Serializable (–°–µ—Ä–∏–∞–ª–∏–∑—É–µ–º–æ—Å—Ç—å)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Serializable** ‚Äî —Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Ç–∞–∫, –∫–∞–∫ –±—É–¥—Ç–æ –æ–Ω–∏ –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –æ–¥–Ω–∞ –∑–∞ –¥—Ä—É–≥–æ–π, —Ö–æ—Ç—è –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

–≠—Ç–æ –∫–∞–∫ –µ—Å–ª–∏ –±—ã –≤ –±–∞–Ω–∫–µ –±—ã–ª —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –æ–ø–µ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å—Ç—Ä–æ–≥–æ –ø–æ –æ—á–µ—Ä–µ–¥–∏. –ù–∏–∫–∞–∫–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏, –Ω–∏–∫–∞–∫–∏—Ö race conditions, –Ω–æ –∏ –æ—á–µ—Ä–µ–¥—å –¥–≤–∏–∂–µ—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–µ–µ.

**–¢–µ–æ—Ä–µ–º–∞:** —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–µ–Ω –Ω–µ–∫–æ—Ç–æ—Ä–æ–º—É –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é —ç—Ç–∏—Ö –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- ‚úÖ **–ù–µ—Ç Dirty Read**
- ‚úÖ **–ù–µ—Ç Non-repeatable Read**
- ‚úÖ **–ù–µ—Ç Phantom Read**
- ‚úÖ **–ù–µ—Ç Lost Update**
- ‚úÖ **–ù–µ—Ç Write Skew**
- ‚úÖ **–ù–µ—Ç Read Skew**
- ‚úÖ **–í—Å–µ –∞–Ω–æ–º–∞–ª–∏–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω—ã**
- ‚úÖ **–ì–∞—Ä–∞–Ω—Ç–∏—è —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é**

### ‚ùå Trade-offs

- ‚ùå **–ù–∏–∑–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** (–º–Ω–æ–≥–æ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏–ª–∏ aborts)
- ‚ùå **–í—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤** (–º–Ω–æ–≥–æ serialization errors)
- ‚ùå **–°–ª–æ–∂–Ω–æ—Å—Ç—å retry –ª–æ–≥–∏–∫–∏** –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

### üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–°—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–ø–æ—Å–æ–±–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Serializable:

#### 1. Two-Phase Locking (2PL)

**–ò–¥–µ—è:** –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–π –≤—Å–µ lock'–∏ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º, –æ—Ç–ø—É—Å–∫–∞–π —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ COMMIT.

```
–ü—Ä–∞–≤–∏–ª–∞:
1. –ü–µ—Ä–µ–¥ —á—Ç–µ–Ω–∏–µ–º —Å—Ç—Ä–æ–∫–∏ ‚Äî –±–µ—Ä—ë—à—å shared lock
2. –ü–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é —Å—Ç—Ä–æ–∫–∏ ‚Äî –±–µ—Ä—ë—à—å exclusive lock
3. –ù–µ –º–æ–∂–µ—à—å –æ—Ç–ø—É—Å—Ç–∏—Ç—å lock –¥–æ COMMIT
4. –ë–ª–æ–∫–∏—Ä—É–µ—à—å –¥–∏–∞–ø–∞–∑–æ–Ω—ã (range locks) –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è phantoms

–ü—Ä–∏–º–µ—Ä:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ T1: BEGIN                                  ‚îÇ
‚îÇ     SELECT * FROM products WHERE id = 5    ‚îÇ
‚îÇ     ‚Üí –±–µ—Ä—ë—Ç shared lock –Ω–∞ —Å—Ç—Ä–æ–∫—É 5        ‚îÇ
‚îÇ     UPDATE products SET price = 100        ‚îÇ
‚îÇ     ‚Üí –∞–ø–≥—Ä–µ–π–¥–∏—Ç –¥–æ exclusive lock          ‚îÇ
‚îÇ     ... –¥–µ—Ä–∂–∏—Ç lock ...                    ‚îÇ
‚îÇ     COMMIT                                 ‚îÇ
‚îÇ     ‚Üí –æ—Ç–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ locks                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ T2: BEGIN                                  ‚îÇ
‚îÇ     SELECT * FROM products WHERE id = 5    ‚îÇ
‚îÇ     ‚Üí –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è (–∂–¥—ë—Ç T1) üò¥             ‚îÇ
‚îÇ     ...                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–æ–±–ª–µ–º–∞:** deadlocks —á–∞—Å—Ç—ã

```
T1: SELECT x FOR UPDATE;  ‚Üê –¥–µ—Ä–∂–∏—Ç lock –Ω–∞ x
T2: SELECT y FOR UPDATE;  ‚Üê –¥–µ—Ä–∂–∏—Ç lock –Ω–∞ y
T1: SELECT y FOR UPDATE;  ‚Üê –∂–¥—ë—Ç T2 üò¥
T2: SELECT x FOR UPDATE;  ‚Üê –∂–¥—ë—Ç T1 üò¥

üíÄ Deadlock! –û–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –±—É–¥–µ—Ç —É–±–∏—Ç–∞.
```

#### 2. Serializable Snapshot Isolation (SSI)

**–ò–¥–µ—è:** –∏—Å–ø–æ–ª—å–∑—É–π Snapshot Isolation + –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π read-write –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã.

–≠—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ PostgreSQL.

```
–ê–ª–≥–æ—Ä–∏—Ç–º:
1. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ snapshot (–∫–∞–∫ –≤ SI)
2. –ë–î –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç:
   - –ß—Ç–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø—Ä–æ—á–∏—Ç–∞–ª–∞ (read set)
   - –ß—Ç–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∏–∑–º–µ–Ω–∏–ª–∞ (write set)
3. –ü—Ä–∏ COMMIT –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
   - –ï—Å—Ç—å –ª–∏ dangerous structure (–æ–ø–∞—Å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)?
4. –ï—Å–ª–∏ –¥–∞ ‚Üí abort –æ–¥–Ω–æ–π –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

Dangerous structure:
T1 ‚Üí T2 ‚Üí T3, –≥–¥–µ:
- T1 –∏ T2 –∏–º–µ—é—Ç rw-–∫–æ–Ω—Ñ–ª–∏–∫—Ç (T1 —á–∏—Ç–∞–µ—Ç, T2 –ø–∏—à–µ—Ç)
- T2 –∏ T3 –∏–º–µ—é—Ç rw-–∫–æ–Ω—Ñ–ª–∏–∫—Ç
‚Üí –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –Ω–µ—Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º–æ!
```

**–ü—Ä–∏–º–µ—Ä: Write Skew —Å –≤—Ä–∞—á–∞–º–∏**

```
T1 (Alice):
  BEGIN;
  SELECT COUNT(*) FROM doctors WHERE on_duty = true; ‚Üí 2
  -- –ë–î –ø–æ–º–µ—á–∞–µ—Ç: T1 —á–∏—Ç–∞–µ—Ç "–≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —Å on_duty=true"
  UPDATE doctors SET on_duty = false WHERE name = 'Alice';
  -- –ë–î –ø–æ–º–µ—á–∞–µ—Ç: T1 –ø–∏—à–µ—Ç —Å—Ç—Ä–æ–∫—É Alice
  COMMIT;

T2 (Bob):
  BEGIN;
  SELECT COUNT(*) FROM doctors WHERE on_duty = true; ‚Üí 2
  -- –ë–î –ø–æ–º–µ—á–∞–µ—Ç: T2 —á–∏—Ç–∞–µ—Ç "–≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —Å on_duty=true"
  UPDATE doctors SET on_duty = false WHERE name = 'Bob';
  -- –ë–î –ø–æ–º–µ—á–∞–µ—Ç: T2 –ø–∏—à–µ—Ç —Å—Ç—Ä–æ–∫—É Bob
  COMMIT ‚ùå

Error: could not serialize access due to read/write dependencies

–ü–æ—á–µ–º—É:
- T1 –ø—Ä–æ—á–∏—Ç–∞–ª "–≤—Å–µ on_duty" (–≤–∫–ª—é—á–∞—è Bob)
- T2 –∏–∑–º–µ–Ω–∏–ª Bob
- T2 –ø—Ä–æ—á–∏—Ç–∞–ª "–≤—Å–µ on_duty" (–≤–∫–ª—é—á–∞—è Alice)
- T1 –∏–∑–º–µ–Ω–∏–ª Alice
‚Üí –¶–∏–∫–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π! Abort T2.
```

#### 3. Actual Serial Execution

**–ò–¥–µ—è:** –ø—Ä–æ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω—è–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –æ–¥–Ω—É –∑–∞ –¥—Ä—É–≥–æ–π.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Redis, VoltDB, Datomic.

```
Single-threaded transaction processor:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Queue: [T1, T2, T3, T4, T5, ...]   ‚îÇ
‚îÇ           ‚Üì                         ‚îÇ
‚îÇ  Executor: –≤—ã–ø–æ–ª–Ω—è–µ—Ç T1             ‚îÇ
‚îÇ           ‚Üì                         ‚îÇ
‚îÇ  Executor: –≤—ã–ø–æ–ª–Ω—è–µ—Ç T2             ‚îÇ
‚îÇ           ‚Üì                         ‚îÇ
‚îÇ  ...                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- –ù–µ—Ç lock overhead
- –ù–µ—Ç –∞–±–æ—Ä—Ç–æ–≤ –∏–∑-–∑–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –û–ß–ï–ù–¨ –±—ã—Å—Ç—Ä—ã–º–∏ (< 1ms)
- –í—Å—è –ë–î –¥–æ–ª–∂–Ω–∞ –ø–æ–º–µ—â–∞—Ç—å—Å—è –≤ RAM
- –ù–∏–∫–∞–∫–∏—Ö I/O –æ–ø–µ—Ä–∞—Ü–∏–π –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```

### üí° –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

**–ò—Å–ø–æ–ª—å–∑—É–π Serializable –∫–æ–≥–¥–∞:**

1. **–ö—Ä–∏—Ç–∏—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å:**
   - –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–±–∞–Ω–∫–∏, –±–∏—Ä–∂–∏)
   - –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º—ã
   - –°–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —è–¥–µ—Ä–Ω—ã–º–∏ —Ä–µ–∞–∫—Ç–æ—Ä–∞–º–∏ üòÖ

2. **–°–ª–æ–∂–Ω—ã–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:**
   - –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–ª—å–∑—è –≤—ã—Ä–∞–∑–∏—Ç—å —á–µ—Ä–µ–∑ constraints
   - Cross-table constraints
   - –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏

3. **–ù–∏–∑–∫–∞—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è:**
   - –ú–∞–ª–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
   - –†–∞–∑–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ä–µ–¥–∫–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–¥–Ω–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏

**–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π Serializable –∫–æ–≥–¥–∞:**

1. **–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:**
   - 1000+ TPS (transactions per second)
   - –ú–Ω–æ–≥–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

2. **–ü—Ä–æ—Å—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**
   - –ê—Ç–æ–º–∞—Ä–Ω—ã–µ UPDATE
   - –ú–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏—Å—å Read Committed + –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

3. **–î–æ–ª–≥–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
   - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ > 1 —Å–µ–∫—É–Ω–¥—ã
   - –ë—É–¥—É—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –∞–±—É—Ä—Ç—ã

### ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 1: –õ–∞–≤–∏–Ω–∞ –∞–±–æ—Ä—Ç–æ–≤ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ

```
–ü—Ä–æ–±–ª–µ–º–∞: Black Friday –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–µ

10:00:00 - –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∞
10:00:01 - 10,000 –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–∫—É–ø–∞—é—Ç —Ç–æ–≤–∞—Ä—ã
10:00:02 - 9,500 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–ª—É—á–∞—é—Ç serialization error
10:00:03 - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–µ–ª–∞—é—Ç retry
10:00:04 - –°–Ω–æ–≤–∞ 9,000 –æ—à–∏–±–æ–∫
10:00:05 - –°–∏—Å—Ç–µ–º–∞ –∫–æ–ª–ª–∞–ø—Å–∏—Ä—É–µ—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É—Ö–æ–¥—è—Ç

–ú–µ—Ç—Ä–∏–∫–∏:
- TPS (transactions per second): —É–ø–∞–ª —Å 1000 –¥–æ 50
- Abort rate: 95%
- User experience: —Å–∞–π—Ç "–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- Serializable –æ–±–Ω–∞—Ä—É–∂–∏–ª –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –º–µ–∂–¥—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
- –ú–∞—Å—Å–æ–≤—ã–µ –∞–±–æ—Ä—Ç—ã
- Retry —É—Å—É–≥—É–±–ª—è–µ—Ç –ø—Ä–æ–±–ª–µ–º—É
- –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å (—á–µ–º –±–æ–ª—å—à–µ retry, —Ç–µ–º –±–æ–ª—å—à–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
```
1. –ü–æ–Ω–∏–∑–∏—Ç—å isolation level:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Snapshot Isolation –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –æ–ø–µ—Ä–∞—Ü–∏–π
   - Serializable —Ç–æ–ª—å–∫–æ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö

2. Pessimistic locking –¥–ª—è hot rows:
   SELECT * FROM products WHERE id = 'hot-item' FOR UPDATE;

3. Sharding:
   - –†–∞–∑–¥–µ–ª–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –ø–æ shards
   - –£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—é –Ω–∞ –æ–¥–Ω–æ–º —É–∑–ª–µ

4. Caching + eventual consistency:
   - –ü—Ä–æ–≤–µ—Ä–∫—É stock –¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ –∫—ç—à (Read Committed)
   - –§–∏–Ω–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ (Serializable)
```

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 2: Deadlock cascade

```
–ü—Ä–æ–±–ª–µ–º–∞: Serializable —Å 2PL –≤ SQL Server

T1: UPDATE accounts SET balance = ... WHERE id = 'alice';
    UPDATE accounts SET balance = ... WHERE id = 'bob';

T2: UPDATE accounts SET balance = ... WHERE id = 'bob';
    UPDATE accounts SET balance = ... WHERE id = 'alice';

üíÄ Deadlock!

SQL Server —É–±–∏–≤–∞–µ—Ç T2:
Error: Transaction was deadlocked and has been chosen as the deadlock victim.

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–µ–ª–∞–µ—Ç retry:
T2 (retry): UPDATE accounts SET balance = ... WHERE id = 'bob';
            ... deadlock —Å–Ω–æ–≤–∞!

–ü–æ—Å–ª–µ 10 retries:
Error 500 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: "Service temporarily unavailable"
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—Ç locks –≤ —Ä–∞–∑–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
- –í–æ–∑–Ω–∏–∫–∞–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
- Deadlock detector —É–±–∏–≤–∞–µ—Ç –æ–¥–Ω—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
- Retry –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ø—Ä–æ–±–ª–µ–º—É

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
```
1. Lock ordering:
   -- –≤—Å–µ–≥–¥–∞ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–π locks –≤ –æ–¥–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
   -- –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ—Ä—Ç–∏—Ä—É–π id: MIN(alice, bob) –ø–µ—Ä–≤—ã–π
   UPDATE accounts ... WHERE id IN ('alice', 'bob') ORDER BY id;

2. Retry with exponential backoff:
   for attempt in range(max_retries):
       try:
           transaction()
       except Deadlock:
           sleep(2 ** attempt + random())

3. –ü–æ–Ω–∏–∑–∏—Ç—å isolation level –¥–æ Snapshot Isolation:
   -- –º–µ–Ω—å—à–µ lock'–æ–≤, –º–µ–Ω—å—à–µ deadlocks
```

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 3: False positive –∞–±—É—Ä—Ç—ã –≤ SSI

```
–ü—Ä–æ–±–ª–µ–º–∞: PostgreSQL Serializable (SSI)

T1: SELECT SUM(amount) FROM transactions WHERE user_id = 'alice';
    -- —á–∏—Ç–∞–µ—Ç 10 —Å—Ç—Ä–æ–∫

T2: INSERT INTO transactions (user_id, amount) VALUES ('bob', 100);
    -- –¥–æ–±–∞–≤–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –¥–ª—è bob
    COMMIT;

T1: SELECT SUM(amount) FROM transactions WHERE user_id = 'alice';
    -- —Å–Ω–æ–≤–∞ —á–∏—Ç–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ alice (—Ç–µ –∂–µ —Å–∞–º—ã–µ!)
    COMMIT ‚ùå

Error: could not serialize access due to read/write dependencies

–ü–æ—á–µ–º—É:
- SSI –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–µ–Ω (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π)
- T1 —Å–¥–µ–ª–∞–ª –∑–∞–ø—Ä–æ—Å —Å WHERE user_id = 'alice'
- T2 –¥–æ–±–∞–≤–∏–ª —Å—Ç—Ä–æ–∫—É –≤ —Ç—É –∂–µ —Ç–∞–±–ª–∏—Ü—É
- SSI –Ω–µ —É–≤–µ—Ä–µ–Ω, —á—Ç–æ –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –Ω–µ –ø–æ–ø–∞–¥—ë—Ç –≤ WHERE T1
- –ê–±–æ—Ä—Ç T1 –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π (false positive!)
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- SSI –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–∞–Ω–∏—Ü/–¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
- –ù–µ –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç
- –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç abort –≤–º–µ—Å—Ç–æ —Ä–∏—Å–∫–∞ –∞–Ω–æ–º–∞–ª–∏–∏

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
```
1. –°–º–∏—Ä–∏—Ç—å—Å—è:
   -- false positives —Ä–µ–¥–∫–∏ –≤ –ø—Ä–∞–∫—Ç–∏–∫–µ
   -- retry –æ–±—ã—á–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç

2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å explicit locks:
   SELECT ... FOR SHARE; -- –µ—Å–ª–∏ –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—à—å –∏–∑–º–µ–Ω—è—Ç—å
   SELECT ... FOR UPDATE; -- –µ—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—à—å –∏–∑–º–µ–Ω—è—Ç—å

3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö:
   -- –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ user_id
   -- —É–º–µ–Ω—å—à–∏—Ç—å overlap –º–µ–∂–¥—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
```

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 4: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä—É—Ö–Ω—É–ª–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```
–ü—Ä–æ–±–ª–µ–º–∞: –º–∏–≥—Ä–∞—Ü–∏—è —Å Read Committed –Ω–∞ Serializable

–î–æ:
- Isolation level: Read Committed
- TPS: 5,000
- Latency p99: 50ms
- Error rate: 0.1%

–ü–æ—Å–ª–µ:
- Isolation level: Serializable
- TPS: 200 üò±
- Latency p99: 5,000ms üò±
- Error rate: 40% üò±

–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:
- 25x –ø–∞–¥–µ–Ω–∏–µ throughput
- 100x —Ä–æ—Å—Ç latency
- 400x —Ä–æ—Å—Ç –æ—à–∏–±–æ–∫
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –≥–æ—Ç–æ–≤–æ –∫ serialization errors (–Ω–µ—Ç retry)
- –î–æ–ª–≥–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–±—ã–ª–∏ OK –¥–ª—è RC, –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞ –¥–ª—è Serializable)
- –í—ã—Å–æ–∫–∞—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è (–º–Ω–æ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–¥–Ω–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏)

**–£—Ä–æ–∫:**
- –ù–µ –º–∏–≥—Ä–∏—Ä—É–π –Ω–∞ Serializable –±–µ–∑ —Ç—â–∞—Ç–µ–ª—å–Ω–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏
- –ü—Ä–æ—Ñ–∏–ª–∏—Ä—É–π –∏ —Ç–µ—Å—Ç–∏—Ä—É–π –Ω–∞ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
- –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–µ–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### üèóÔ∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Å Serializable

#### 1. –î–µ—Ä–∂–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫–æ—Ä–æ—Ç–∫–∏–º–∏

**–ü–ª–æ—Ö–æ:**
```
BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;
  data = SELECT ... ; -- 10ms
  result = heavy_computation(data); -- 5 —Å–µ–∫—É–Ω–¥! üò±
  INSERT INTO results VALUES (result);
COMMIT;

–ü—Ä–æ–±–ª–µ–º—ã:
- –î–µ—Ä–∂–∏—Ç locks/snapshot 5 —Å–µ–∫—É–Ω–¥
- –ë–ª–æ–∫–∏—Ä—É–µ—Ç –¥—Ä—É–≥–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –í—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞
```

**–•–æ—Ä–æ—à–æ:**
```
-- –ß–∏—Ç–∞–µ–º –¥–∞–Ω–Ω—ã–µ
data = SELECT ... ; -- –±—ã—Å—Ç—Ä–æ, –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–ª–∏ RC

-- –í—ã—á–∏—Å–ª—è–µ–º –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
result = heavy_computation(data);

-- –ü–∏—à–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;
  INSERT INTO results VALUES (result); -- –±—ã—Å—Ç—Ä–æ!
COMMIT;
```

#### 2. –†–µ–∞–ª–∏–∑—É–π robust retry –ª–æ–≥–∏–∫—É

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:**
```
def execute_transaction(fn, max_retries=5):
    for attempt in range(max_retries):
        try:
            return fn()
        except SerializationError as e:
            if attempt == max_retries - 1:
                # –ò—Å—á–µ—Ä–ø–∞–ª–∏ –ø–æ–ø—ã—Ç–∫–∏
                log_error("Transaction failed after {} retries".format(max_retries))
                raise

            # Exponential backoff —Å jitter
            wait = (2 ** attempt) + random.uniform(0, 1)
            sleep(wait)
            continue
        except DeadlockError as e:
            # Deadlock ‚Äî retry –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
            if attempt == max_retries - 1:
                raise
            continue

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
execute_transaction(lambda: transfer_money('alice', 'bob', 100))
```

#### 3. –ò—Å–ø–æ–ª—å–∑—É–π Serializable –≤—ã–±–æ—Ä–æ—á–Ω–æ

**–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥:**
```
# 95% –æ–ø–µ—Ä–∞—Ü–∏–π ‚Äî Read Committed –∏–ª–∏ Snapshot
BEGIN TRANSACTION ISOLATION LEVEL READ COMMITTED;
  -- –æ–±—ã—á–Ω—ã–µ CRUD
COMMIT;

# 5% –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π ‚Äî Serializable
BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;
  -- –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
  -- —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
COMMIT;

–ü—Ä–∏–º–µ—Ä—ã:
- Browsing —Ç–æ–≤–∞—Ä–æ–≤ ‚Üí Read Committed
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É ‚Üí Read Committed
- –§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–∫—É–ø–∫–∞ ‚Üí Serializable (–ø—Ä–æ–≤–µ—Ä–∫–∞ stock, payment)
```

#### 4. –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π overlap –º–µ–∂–¥—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

**–ü–ª–æ—Ö–æ:**
```
-- –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Å—á—ë—Ç—á–∏–∫
UPDATE global_stats SET total_sales = total_sales + amount;
-- –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –Ω–∞ –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏!
```

**–•–æ—Ä–æ—à–æ:**
```
-- –ö–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
INSERT INTO sales (user_id, amount) VALUES ('alice', 100);

-- –ê–≥—Ä–µ–≥–∞—Ç—ã —Å—á–∏—Ç–∞–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º
-- –∏–ª–∏ —á–µ—Ä–µ–∑ materialized view
```

#### 5. –ú–æ–Ω–∏—Ç–æ—Ä—å –∏ –∞–ª–µ—Ä—Ç–∏—Ä—É–π

**–ú–µ—Ç—Ä–∏–∫–∏:**
```
1. Serialization error rate:
   errors_per_second / transactions_per_second
   –ê–ª–µ—Ä—Ç: > 5%

2. Deadlock rate:
   deadlocks_per_second
   –ê–ª–µ—Ä—Ç: > 0.1/sec

3. Transaction latency p99:
   –ê–ª–µ—Ä—Ç: > 1 second

4. Abort/rollback rate:
   rollbacks / (commits + rollbacks)
   –ê–ª–µ—Ä—Ç: > 10%
```

**–ü—Ä–∏–º–µ—Ä –¥–ª—è PostgreSQL:**
```
SELECT
    datname,
    xact_commit,
    xact_rollback,
    ROUND(100.0 * xact_rollback / NULLIF(xact_commit + xact_rollback, 0), 2)
      AS rollback_ratio
FROM pg_stat_database
WHERE datname = 'production';
```

### üóÉÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö

| –ë–î          | Serializable | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|-------------|--------------|------------|
| PostgreSQL  | ‚úÖ           | SSI (Serializable Snapshot Isolation) |
| MySQL       | ‚úÖ           | 2PL (Two-Phase Locking) + Gap locks |
| Oracle      | ‚úÖ           | SSI + Optimistic |
| SQL Server  | ‚úÖ           | 2PL + Range locks |
| MongoDB     | ‚ùå           | –ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (–º–∞–∫—Å. Snapshot) |
| CockroachDB | ‚úÖ Default   | SSI (—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π) |
| Redis       | ‚úÖ           | Actual Serial Execution |
| VoltDB      | ‚úÖ           | Actual Serial Execution |

---

## 6. Strict Serializability (–°—Ç—Ä–æ–≥–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º–æ—Å—Ç—å)

### üìã –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**Strict Serializability** ‚Äî —ç—Ç–æ Serializability + linearizability (–ª–∏–Ω–µ–∞—Ä–∏–∑—É–µ–º–æ—Å—Ç—å). –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ —Ç–æ–ª—å–∫–æ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é, –Ω–æ –∏ –ø–æ—Ä—è–¥–æ–∫ –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ (wall-clock time).

**–§–æ—Ä–º–∞–ª—å–Ω–æ:**
- –ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è T1 –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å (committed) –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º T2, —Ç–æ –≤ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ T1 –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–µ—Ä–µ–¥ T2.

–≠—Ç–æ –∫–∞–∫ –µ—Å–ª–∏ –±—ã –∫–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∏–º–µ–ª–∞ —Ç–æ—á–Ω—É—é –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É, –∏ –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –≤ —Å—Ç—Ä–æ–≥–æ–º –ø–æ—Ä—è–¥–∫–µ —ç—Ç–∏—Ö –º–µ—Ç–æ–∫, –≤–∏–¥–∏–º–æ–º –¥–ª—è –≤—Å–µ—Ö.

**–û—Ç–ª–∏—á–∏–µ –æ—Ç –æ–±—ã—á–Ω–æ–π Serializability:**

```
Serializability:
T1: BEGIN (10:00:00) ‚Üí UPDATE x=5 ‚Üí COMMIT (10:00:05)
T2: BEGIN (10:00:01) ‚Üí SELECT x ‚Üí COMMIT (10:00:02)

–î–æ–ø—É—Å—Ç–∏–º—ã–π –ø–æ—Ä—è–¥–æ–∫: T2 ‚Üí T1
(T2 –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ x, —Ö–æ—Ç—è –Ω–∞—á–∞–ª–∞—Å—å –ø–æ–∑–∂–µ T1)

Strict Serializability:
T1: BEGIN (10:00:00) ‚Üí UPDATE x=5 ‚Üí COMMIT (10:00:05)
T2: BEGIN (10:00:06) ‚Üí SELECT x ‚Üí COMMIT (10:00:07)
          ‚Üë –Ω–∞—á–∞–ª–∞—Å—å –ø–æ—Å–ª–µ COMMIT T1

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫: T1 ‚Üí T2
(T2 –î–û–õ–ñ–ù–ê –≤–∏–¥–µ—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è T1, —Ç.–∫. –Ω–∞—á–∞–ª–∞—Å—å –ø–æ—Å–ª–µ commit T1)
```

### ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

- ‚úÖ –í—Å–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏ Serializable
- ‚úÖ **Real-time ordering:** –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ **External consistency:** –≤–Ω–µ—à–Ω–∏–π –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
- ‚úÖ **Linearizability –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:** –∫–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∫–∞–∂–µ—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ–π –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏

### ‚ùå Trade-offs

- ‚ùå **–û—á–µ–Ω—å —Å–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö
- ‚ùå **–¢—Ä–µ–±—É–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —á–∞—Å–æ–≤** –º–µ–∂–¥—É —É–∑–ª–∞–º–∏
- ‚ùå **–í—ã—Å–æ–∫–∏–µ latency** –∏–∑-–∑–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏
- ‚ùå **–ü–ª–æ—Ö–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –ø—Ä–∏ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏

### üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

#### –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö:

```
–ü—Ä–æ–±–ª–µ–º–∞: —á–∞—Å—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö –∏–¥—É—Ç –ø–æ-—Ä–∞–∑–Ω–æ–º—É

Server 1 (clock: 10:00:00.500):
  T1: UPDATE x = 5
  COMMIT (timestamp: 10:00:00.500)

Server 2 (clock: 10:00:00.400 ‚Üê –æ—Ç—Å—Ç–∞—ë—Ç!):
  T2: BEGIN (timestamp: 10:00:00.400)
  SELECT x ‚Üí –¥–æ–ª–∂–Ω–∞ –≤–∏–¥–µ—Ç—å 5? –∏–ª–∏ —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ?

–ü—Ä–æ–±–ª–µ–º–∞: T2 –Ω–∞—á–∞–ª–∞—Å—å "–≤ –ø—Ä–æ—à–ª–æ–º" (–ø–æ —á–∞—Å–∞–º Server 2),
–Ω–æ –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ ‚Äî –ø–æ—Å–ª–µ commit T1!
```

#### –†–µ—à–µ–Ω–∏—è:

**1. TrueTime (Google Spanner):**

```
–ò–¥–µ—è: –∫–∞–∂–¥–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ ‚Äî —ç—Ç–æ interval [earliest, latest]

Server 1:
  T1 COMMIT: timestamp = [10:00:00.490, 10:00:00.510]
  WAIT until 10:00:00.510 (commit wait) ‚Üê –≥–∞—Ä–∞–Ω—Ç–∏—è!

Server 2:
  T2 BEGIN: timestamp = [10:00:00.600, 10:00:00.620]

–ü—Ä–æ–≤–µ—Ä–∫–∞: T2.earliest > T1.latest?
  10:00:00.600 > 10:00:00.510 ‚úÖ

‚Üí T1 –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –¥–æ –Ω–∞—á–∞–ª–∞ T2
‚Üí T2 –¥–æ–ª–∂–Ω–∞ –≤–∏–¥–µ—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è T1
```

**TrueTime API:**
```
TT.now() ‚Üí [earliest, latest]
  earliest: –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ–µ —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
  latest: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ–µ —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è

Epsilon (Œµ): uncertainty interval
  Google: Œµ ‚âà 7ms (–∞—Ç–æ–º–∞—Ä–Ω—ã–µ —á–∞—Å—ã + GPS)

Commit wait:
  COMMIT at time t
  WAIT until TT.now().earliest > t
  ‚Üí –≥–∞—Ä–∞–Ω—Ç–∏—è, —á—Ç–æ commit –≤–∏–¥–∏–º –≤—Å–µ–º
```

**2. Hybrid Logical Clocks (CockroachDB):**

```
–ò–¥–µ—è: –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å physical time –∏ logical counter

HLC = (physical_time, logical_counter)

–ü—Ä–∞–≤–∏–ª–∞:
1. –ü—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–æ–±—ã—Ç–∏–∏:
   pt = max(physical_clock, last_pt)
   lc = last_lc + 1 –µ—Å–ª–∏ pt == last_pt, –∏–Ω–∞—á–µ 0

2. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:
   pt = max(physical_clock, last_pt, received_pt)
   lc = max(last_lc, received_lc) + 1 –µ—Å–ª–∏ pt == received_pt

–†–µ–∑—É–ª—å—Ç–∞—Ç: HLC –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ —Ä–∞—Å—Ç—ë—Ç –∏ –ø—Ä–∏–º–µ—Ä–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏
```

**3. Centralized Timestamp Oracle (HBase, Percolator):**

```
–ò–¥–µ—è: –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä –≤—ã–¥–∞—ë—Ç –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ —Ä–∞—Å—Ç—É—â–∏–µ timestamp'—ã

Timestamp Oracle:
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ current = 1000      ‚îÇ
  ‚îÇ                     ‚îÇ
  ‚îÇ get_timestamp():    ‚îÇ
  ‚îÇ   current += 1      ‚îÇ
  ‚îÇ   return current    ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì      ‚Üì      ‚Üì
      Node1  Node2  Node3

–ü—Ä–æ–±–ª–µ–º—ã:
- Single point of failure
- Bottleneck (–≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–¥—É—Ç —á–µ—Ä–µ–∑ Oracle)
```

### üí° –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

**Strict Serializability –Ω—É–∂–µ–Ω –∫–æ–≥–¥–∞:**

1. **–í–Ω–µ—à–Ω—è—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–∞:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–¥–µ–ª–∞–ª –∑–∞–∫–∞–∑ (T1)
   - –¢—É—Ç –∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å (T2)
   - T2 **–¥–æ–ª–∂–Ω–∞** –≤–∏–¥–µ—Ç—å –∑–∞–∫–∞–∑

2. **–†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏:**
   - –°–ø–∏—Å–∞–ª–∏ –¥–µ–Ω—å–≥–∏ —Å –∫–∞—Ä—Ç—ã (–≤–Ω–µ—à–Ω–∏–π API)
   - –ó–∞–ø–∏—Å–∞–ª–∏ –≤ –ë–î
   - –õ—é–±–æ–π –ø–æ—Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–∞–Ω–∏–µ

3. **–°–∏–ª—å–Ω—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –≤ multi-region:**
   - –î–∞–Ω–Ω—ã–µ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É—é—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–≥–∏–æ–Ω–æ–≤
   - –ö–ª–∏–µ–Ω—Ç—ã —á–∏—Ç–∞—é—Ç –∏–∑ –ª—é–±–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞
   - –í—Å–µ –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å consistent –ø–æ—Ä—è–¥–æ–∫

**–ü—Ä–∏–º–µ—Ä—ã —Å–∏—Å—Ç–µ–º:**
- Google Spanner (—Ñ–∏–Ω–∞–Ω—Å—ã, AdWords)
- CockroachDB
- FaunaDB
- FoundationDB

### ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 1: Clock skew –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –ë–î

```
–ü—Ä–æ–±–ª–µ–º–∞: —á–∞—Å—ã –Ω–∞ —É–∑–ª–∞—Ö —Ä–∞—Å—Ö–æ–¥—è—Ç—Å—è

Node 1 (clock drift: +500ms):
  10:00:00.500 - T1: UPDATE account_balance = 1000
  10:00:00.500 - COMMIT with timestamp 10:00:00.500

Node 2 (clock drift: -300ms):
  10:00:00.200 - T2: BEGIN with timestamp 10:00:00.200
  10:00:00.200 - SELECT account_balance ‚Üí –≤–∏–¥–∏—Ç —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ üò±

–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è:
  T1 commit: 10:00:00.000 (—Ä–µ–∞–ª—å–Ω–æ)
  T2 begin:  10:00:00.500 (—Ä–µ–∞–ª—å–Ω–æ)

–ù–æ timestamp'—ã –≥–æ–≤–æ—Ä—è—Ç –æ–±—Ä–∞—Ç–Ω–æ–µ:
  T1: 10:00:00.500
  T2: 10:00:00.200
  ‚Üí T2 "–≤ –ø—Ä–æ—à–ª–æ–º", –Ω–µ –≤–∏–¥–∏—Ç T1
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–æ–ª–Ω–∏–ª –±–∞–ª–∞–Ω—Å (T1)
- –°—Ä–∞–∑—É –ø—ã—Ç–∞–µ—Ç—Å—è –∫—É–ø–∏—Ç—å (T2)
- –í–∏–¥–∏—Ç —Å—Ç–∞—Ä—ã–π –±–∞–ª–∞–Ω—Å, –ø–æ–∫—É–ø–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —è—Ä–æ—Å—Ç–∏

**–ö–∞–∫ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å:**
```
1. NTP (Network Time Protocol):
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π —á–∞—Å—ã —á–µ—Ä–µ–∑ NTP
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: —Ç–æ—á–Ω–æ—Å—Ç—å ~100ms

2. PTP (Precision Time Protocol):
   - –¢–æ—á–Ω–æ—Å—Ç—å ~1¬µs (–º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥–∞)
   - –¢—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ

3. TrueTime (Google):
   - –ê—Ç–æ–º–∞—Ä–Ω—ã–µ —á–∞—Å—ã + GPS
   - Epsilon ~7ms

4. –ú–æ–Ω–∏—Ç–æ—Ä—å clock drift:
   if |node1.clock - node2.clock| > threshold:
     ALERT!
```

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 2: Commit wait —É–≤–µ–ª–∏—á–∏–ª latency

```
–ü—Ä–æ–±–ª–µ–º–∞: Google Spanner commit wait

–ë–µ–∑ commit wait (–æ–±—ã—á–Ω–∞—è Serializability):
  BEGIN ‚Üí UPDATE ‚Üí COMMIT
  Latency: 10ms

–° commit wait (Strict Serializability):
  BEGIN ‚Üí UPDATE ‚Üí COMMIT ‚Üí WAIT(2*epsilon) ‚Üí DONE
  Latency: 10ms + 14ms = 24ms üò±

Epsilon = 7ms
2*epsilon = 14ms

–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
  –ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å —Å—Ç–∞–ª–∞ –≤ 2.4 —Ä–∞–∑–∞ –º–µ–¥–ª–µ–Ω–Ω–µ–µ!
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- P99 latency –≤—ã—Ä–æ—Å —Å 50ms –¥–æ 120ms
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∂–∞–ª—É—é—Ç—Å—è –Ω–∞ "–º–µ–¥–ª–µ–Ω–Ω—ã–π —Å–∞–π—Ç"
- Throughput —É–ø–∞–ª (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–æ–ª—å—à–µ –¥–µ—Ä–∂–∞—Ç —Ä–µ—Å—É—Ä—Å—ã)

**–†–µ—à–µ–Ω–∏—è:**
```
1. Batch commit wait:
   -- –∂–¥—ë–º –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è batch —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   -- –∞–º–æ—Ä—Ç–∏–∑–∏—Ä—É–µ–º commit wait

2. Async commit –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:
   -- –Ω–µ –∂–¥—ë–º commit wait
   -- eventual consistency –¥–ª—è —Ç–∞–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

3. –£–º–µ–Ω—å—à–∏—Ç—å epsilon:
   -- –ª—É—á—à–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–∞—Å–æ–≤
   -- –¥–æ—Ä–æ–≥–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ (–∞—Ç–æ–º–∞—Ä–Ω—ã–µ —á–∞—Å—ã)
```

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 3: Cross-region latency –≤–∑–ª–µ—Ç–µ–ª–∞

```
–ü—Ä–æ–±–ª–µ–º–∞: multi-region setup

Region US-East (Node 1):
  T1: BEGIN ‚Üí UPDATE user_profile

Region Europe (Node 2):
  –†–µ–ø–ª–∏–∫–∞ –ø–æ–ª—É—á–∞–µ—Ç UPDATE

Region Asia (Node 3):
  –†–µ–ø–ª–∏–∫–∞ –ø–æ–ª—É—á–∞–µ—Ç UPDATE

–î–ª—è Strict Serializability:
  - –ù—É–∂–Ω–æ –¥–æ–∂–¥–∞—Ç—å—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞
  - Latency = time to furthest region

RTT (Round-Trip Time):
  US ‚Üí Europe: 80ms
  US ‚Üí Asia: 200ms

Total commit latency: ~200ms üò±

–°—Ä–∞–≤–Ω–µ–Ω–∏–µ:
  Single-region Serializable: 10ms
  Multi-region Strict Serializable: 200ms
  20x –º–µ–¥–ª–µ–Ω–Ω–µ–µ!
```

**–£—Ä–æ–∫:**
- Strict Serializability –ø–ª–æ—Ö–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏
- Latency = —Å–∫–æ—Ä–æ—Å—Ç—å —Å–≤–µ—Ç–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ

**–†–µ—à–µ–Ω–∏—è:**
```
1. Region affinity:
   -- –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∂–∏–≤—É—Ç –≤ –µ–≥–æ —Ä–µ–≥–∏–æ–Ω–µ
   -- –º–∏–Ω–∏–º—É–º cross-region –æ–ø–µ—Ä–∞—Ü–∏–π

2. Eventual consistency –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
   -- –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí Strict Serializable
   -- —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ ‚Üí Eventual

3. Async replication:
   -- commit –ª–æ–∫–∞–ª—å–Ω–æ (–±—ã—Å—Ç—Ä–æ)
   -- —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
   -- trade-off: —Ç–µ—Ä—è–µ–º Strict Serializability
```

#### –ò–Ω—Ü–∏–¥–µ–Ω—Ç 4: Timestamp Oracle —Å—Ç–∞–ª bottleneck

```
–ü—Ä–æ–±–ª–µ–º–∞: centralized timestamp oracle

–í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
  BEGIN:
    timestamp = get_timestamp_from_oracle()

Oracle:
  current_timestamp = 1000
  def get_timestamp():
    lock.acquire()
    current_timestamp += 1
    result = current_timestamp
    lock.release()
    return result

–ü—Ä–∏ 10,000 TPS:
  Oracle –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 10,000 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫
  –° —Å–µ—Ç–µ–≤—ã–º RTT ~1ms:
  Max throughput ‚âà 1,000 TPS üò±

10x –º–µ–Ω—å—à–µ —Ç—Ä–µ–±—É–µ–º–æ–≥–æ!
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –û—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Oracle —Ä–∞—Å—Ç—ë—Ç
- Latency —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è
- –°–∏—Å—Ç–µ–º–∞ –Ω–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏—è:**
```
1. Batch timestamp allocation:
   Oracle –≤—ã–¥–∞—ë—Ç –¥–∏–∞–ø–∞–∑–æ–Ω—ã:
   Node 1: –ø–æ–ª—É—á–∞–µ—Ç [1000-1999]
   Node 2: –ø–æ–ª—É—á–∞–µ—Ç [2000-2999]
   –ö–∞–∂–¥—ã–π Node —Ä–∞–∑–¥–∞—ë—Ç –∏–∑ —Å–≤–æ–µ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞

2. Hybrid Logical Clocks:
   –ò–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç centralized Oracle
   –ö–∞–∂–¥—ã–π Node –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–≤–æ–∏ timestamp'—ã

3. Spanner TrueTime:
   –ö–∞–∂–¥—ã–π Node –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ —á–∞—Å—ã
   –ì–∞—Ä–∞–Ω—Ç–∏–∏ —á–µ—Ä–µ–∑ commit wait
```

### üèóÔ∏è –ö–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Å–æ Strict Serializability

#### 1. –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ

**–°–ø—Ä–æ—Å–∏ —Å–µ–±—è:**
- –ù—É–∂–Ω–∞ –ª–∏ –º–Ω–µ external consistency?
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –æ–±—ã—á–Ω–æ–π Serializability?
- –ú–æ–≥—É –ª–∏ —è –æ–±–æ–π—Ç–∏—Å—å Eventual Consistency –¥–ª—è —á–∞—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö?

**–ü—Ä–∏–º–µ—Ä—ã:**

```
–ù—É–∂–Ω–∞ Strict Serializability:
‚úÖ –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç —Å–ø–∏—Å–∞–Ω–∏–µ)
‚úÖ Inventory —Å external —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏ (–æ—Ç–ø—Ä–∞–≤–∫–∞ email –ø–æ—Å–ª–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
‚úÖ –ê—É–∫—Ü–∏–æ–Ω—ã (–ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç–∞–≤–∫–∞ –ø–æ–±–µ–∂–¥–∞–µ—Ç –ø–æ —Ä–µ–∞–ª—å–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏)

–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Serializability:
‚úì –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
‚úì Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚úì Analytics

–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Eventual Consistency:
‚úì –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ (–ª–∞–π–∫–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
‚úì –ú–µ—Ç—Ä–∏–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚úì –†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã
```

#### 2. –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π cross-region —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**–ü–ª–æ—Ö–æ:**
```
User –≤ –ï–≤—Ä–æ–ø–µ:
  T1: UPDATE user_profile (—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ US-East)
  Latency: 200ms
```

**–•–æ—Ä–æ—à–æ:**
```
User –≤ –ï–≤—Ä–æ–ø–µ:
  T1: UPDATE user_profile (—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Europe)
  Latency: 10ms

Data placement:
- –î–∞–Ω–Ω—ã–µ —é–∑–µ—Ä–∞ –∂–∏–≤—É—Ç –≤ –µ–≥–æ —Ä–µ–≥–∏–æ–Ω–µ
- Cross-region —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–¥–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
```

#### 3. –ú–æ–Ω–∏—Ç–æ—Ä—å clock skew

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:**
```
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–∑–Ω–∏—Ü—ã —á–∞—Å–æ–≤ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏
SELECT node_id,
       clock_timestamp,
       abs(clock_timestamp - coordinator_clock) as skew
FROM cluster_nodes
WHERE skew > threshold
ORDER BY skew DESC;

–ê–ª–µ—Ä—Ç—ã:
- skew > 100ms ‚Üí WARNING
- skew > 500ms ‚Üí CRITICAL (–º–æ–∂–µ—Ç –Ω–∞—Ä—É—à–∏—Ç—å strict serializability)
```

#### 4. –ò—Å–ø–æ–ª—å–∑—É–π read-only —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–µ–∑ commit wait

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
```
Read-write transaction:
  BEGIN
  UPDATE ...
  COMMIT
  WAIT (commit wait) ‚Üê –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è strict serializability

Read-only transaction:
  BEGIN READ ONLY
  SELECT ...
  COMMIT
  NO WAIT ‚Üê –º–æ–∂–Ω–æ –Ω–µ –∂–¥–∞—Ç—å!

–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:
- Read-only –Ω–µ –º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
- –ú–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å —Å –Ω–µ–º–Ω–æ–≥–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏–º timestamp
- –≠–∫–æ–Ω–æ–º–∏—è 14ms –Ω–∞ –∫–∞–∂–¥–æ–π read-only —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```

#### 5. –ò—Å–ø–æ–ª—å–∑—É–π witness-based replication

**–ò–¥–µ—è –¥–ª—è multi-region:**
```
–í–º–µ—Å—Ç–æ:
  –ü–æ–ª–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞ –≤ –∫–∞–∂–¥–æ–º —Ä–µ–≥–∏–æ–Ω–µ

–ò—Å–ø–æ–ª—å–∑—É–π:
  - –ü–æ–ª–Ω—ã–µ —Ä–µ–ø–ª–∏–∫–∏ –≤ 2 –±–ª–∏–∑–∫–∏—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö (US-East, US-West)
  - Witness (lightweight) –≤ 3-–º —Ä–µ–≥–∏–æ–Ω–µ (Europe)

Commit:
  –ù—É–∂–µ–Ω quorum 2/3
  US-East + US-West = –±—ã—Å—Ç—Ä—ã–π quorum (–Ω–∏–∑–∫–∏–π RTT)
  Europe witness –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è failover

Latency: 50ms (US-East ‚Üî US-West)
–í–º–µ—Å—Ç–æ: 200ms (US ‚Üî Europe)
```

### üóÉÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö

| –ë–î              | Strict Serializability | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|-----------------|------------------------|------------|
| Google Spanner  | ‚úÖ Default             | TrueTime (–∞—Ç–æ–º–∞—Ä–Ω—ã–µ —á–∞—Å—ã + GPS) |
| CockroachDB     | ‚úÖ                     | Hybrid Logical Clocks |
| FaunaDB         | ‚úÖ                     | Calvin (deterministic ordering) |
| FoundationDB    | ‚úÖ                     | Optimistic concurrency control |
| PostgreSQL      | ‚ùå                     | –¢–æ–ª—å–∫–æ Serializable |
| MySQL           | ‚ùå                     | –¢–æ–ª—å–∫–æ Serializable |
| MongoDB         | ‚ùå                     | –ú–∞–∫—Å–∏–º—É–º Snapshot Isolation |
| Cassandra       | ‚ùå                     | Eventual consistency |

---

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —É—Ä–æ–≤–Ω–µ–π –∏–∑–æ–ª—è—Ü–∏–∏

| –£—Ä–æ–≤–µ–Ω—å | Dirty Read | Non-repeatable Read | Phantom Read | Lost Update | Write Skew | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|---------|-----------|---------------------|--------------|-------------|------------|-------------------|-------------------|
| **Read Uncommitted** | ‚ùå –í–æ–∑–º–æ–∂–µ–Ω | ‚ùå –í–æ–∑–º–æ–∂–µ–Ω | ‚ùå –í–æ–∑–º–æ–∂–µ–Ω | ‚ùå –í–æ–∑–º–æ–∂–µ–Ω | ‚ùå –í–æ–∑–º–æ–∂–µ–Ω | ‚ö°‚ö°‚ö°‚ö°‚ö° –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è | –ü–æ—á—Ç–∏ –Ω–∏–∫–æ–≥–¥–∞; —Ç–æ–ª—å–∫–æ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ |
| **Read Committed** | ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω | ‚ùå –í–æ–∑–º–æ–∂–µ–Ω | ‚ùå –í–æ–∑–º–æ–∂–µ–Ω | ‚ùå –í–æ–∑–º–æ–∂–µ–Ω | ‚ùå –í–æ–∑–º–æ–∂–µ–Ω | ‚ö°‚ö°‚ö°‚ö° –í—ã—Å–æ–∫–∞—è | Default –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π |
| **Repeatable Read** | ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω | ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω | ‚ö†Ô∏è –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –ë–î | ‚ùå –í–æ–∑–º–æ–∂–µ–Ω | ‚ùå –í–æ–∑–º–æ–∂–µ–Ω | ‚ö°‚ö°‚ö° –°—Ä–µ–¥–Ω—è—è | –ê–Ω–∞–ª–∏—Ç–∏–∫–∞, –æ—Ç—á—ë—Ç—ã, –±—ç–∫–∞–ø—ã |
| **Snapshot Isolation** | ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω | ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω | ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω | ‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è | ‚ùå –í–æ–∑–º–æ–∂–µ–Ω | ‚ö°‚ö°‚ö° –°—Ä–µ–¥–Ω—è—è | OLTP —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–µ–π |
| **Serializable** | ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω | ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω | ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω | ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω | ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω | ‚ö°‚ö° –ù–∏–∑–∫–∞—è | –ö—Ä–∏—Ç–∏—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å |
| **Strict Serializable** | ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω | ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω | ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω | ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω | ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω | ‚ö° –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è | External consistency |

---

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è –∏–∑–æ–ª—è—Ü–∏–∏

**Flowchart:**

```
–ù—É–∂–Ω–∞ –ª–∏ external consistency (strict real-time ordering)?
‚îÇ
‚îú‚îÄ –î–∞ ‚Üí Strict Serializability
‚îÇ        (–Ω–æ –ø–æ–¥—É–º–∞–π –¥–≤–∞–∂–¥—ã: –æ—á–µ–Ω—å –¥–æ—Ä–æ–≥–æ!)
‚îÇ
‚îî‚îÄ –ù–µ—Ç ‚Üí –ï—Å—Ç—å –ª–∏ —Å–ª–æ–∂–Ω—ã–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫–∞–º–∏/—Ç–∞–±–ª–∏—Ü–∞–º–∏?
         ‚îÇ
         ‚îú‚îÄ –î–∞ ‚Üí Serializable
         ‚îÇ        (–≥–æ—Ç–æ–≤—å—Å—è –∫ retry –ª–æ–≥–∏–∫–µ)
         ‚îÇ
         ‚îî‚îÄ –ù–µ—Ç ‚Üí –ù—É–∂–Ω—ã –ª–∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —á—Ç–µ–Ω–∏—è?
                  ‚îÇ
                  ‚îú‚îÄ –î–∞ ‚Üí Repeatable Read / Snapshot Isolation
                  ‚îÇ        (–æ—Ç—á—ë—Ç—ã, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
                  ‚îÇ
                  ‚îî‚îÄ –ù–µ—Ç ‚Üí Read Committed ‚úÖ
                           (default –¥–ª—è 90% —Å–ª—É—á–∞–µ–≤)
```

### 2. –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∑–∞—â–∏—Ç—ã –æ—Ç –∞–Ω–æ–º–∞–ª–∏–π

#### –ü–∞—Ç—Ç–µ—Ä–Ω 1: –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

**–í–º–µ—Å—Ç–æ Read-Modify-Write:**
```
‚ùå –ü–ª–æ—Ö–æ:
balance = SELECT balance FROM accounts WHERE id = 'alice';
UPDATE accounts SET balance = balance - 100 WHERE id = 'alice';

‚úÖ –•–æ—Ä–æ—à–æ:
UPDATE accounts SET balance = balance - 100 WHERE id = 'alice' AND balance >= 100;
```

#### –ü–∞—Ç—Ç–µ—Ä–Ω 2: Optimistic Locking

**–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```
–¢–∞–±–ª–∏—Ü–∞:
  products (id, stock, version)

–ß—Ç–µ–Ω–∏–µ:
  SELECT stock, version FROM products WHERE id = 'widget';
  ‚Üí stock = 10, version = 5

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
  UPDATE products
  SET stock = 9, version = 6
  WHERE id = 'widget' AND version = 5;

–ï—Å–ª–∏ –∑–∞—Ç—Ä–æ–Ω—É—Ç–æ 0 —Å—Ç—Ä–æ–∫ ‚Üí –∫–æ–Ω—Ñ–ª–∏–∫—Ç ‚Üí retry
```

#### –ü–∞—Ç—Ç–µ—Ä–Ω 3: Pessimistic Locking

**SELECT FOR UPDATE:**
```
BEGIN;
SELECT stock FROM products WHERE id = 'widget' FOR UPDATE;
-- –¥–µ—Ä–∂–∏—Ç exclusive lock –¥–æ COMMIT
UPDATE products SET stock = stock - 1 WHERE id = 'widget';
COMMIT;
```

#### –ü–∞—Ç—Ç–µ—Ä–Ω 4: Materialized Constraints

**–î–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç Write Skew:**
```
–í–º–µ—Å—Ç–æ:
  SELECT COUNT(*) FROM doctors WHERE on_duty = true;

–°–æ–∑–¥–∞–π:
  CREATE TABLE duty_stats (count INT);
  UPDATE duty_stats SET count = count - 1 WHERE count > 2;
  -- –æ–±–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥—É—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
```

### 3. –û–±—â–∏–µ –æ—à–∏–±–∫–∏ –∏ –∫–∞–∫ –∏—Ö –∏–∑–±–µ–∂–∞—Ç—å

#### –û—à–∏–±–∫–∞ 1: "–£ –º–µ–Ω—è –µ—Å—Ç—å UNIQUE constraint, Lost Update –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω"

**–ù–µ–ø—Ä–∞–≤–¥–∞:**
```
‚ùå UNIQUE constraint –∑–∞—â–∏—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:

CREATE TABLE products (sku VARCHAR UNIQUE, stock INT);

T1: UPDATE products SET stock = 5 WHERE sku = 'WIDGET';
T2: UPDATE products SET stock = 3 WHERE sku = 'WIDGET';

–û–±–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —É—Å–ø–µ—à–Ω—ã (sku –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è),
–Ω–æ –æ–¥–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ (last write wins).
```

**–†–µ—à–µ–Ω–∏–µ:** –∏—Å–ø–æ–ª—å–∑—É–π –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ SELECT FOR UPDATE.

#### –û—à–∏–±–∫–∞ 2: "Read Committed –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π"

**–ù–µ–ø—Ä–∞–≤–¥–∞:**
```
‚ùå Read Committed –Ω–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç Lost Update:

balance = SELECT balance FROM accounts WHERE id = 'alice'; -- 1000
-- –¥—Ä—É–≥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–ø–∏—Å—ã–≤–∞–µ—Ç 100
UPDATE accounts SET balance = 900 WHERE id = 'alice';
-- –Ω–∞—à–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç
UPDATE accounts SET balance = 800 WHERE id = 'alice';

–ò—Ç–æ–≥: —Å–ø–∏—Å–∞–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –≤–º–µ—Å—Ç–æ –¥–≤—É—Ö.
```

**–†–µ—à–µ–Ω–∏–µ:** –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ `SET balance = balance - 100`.

#### –û—à–∏–±–∫–∞ 3: "Serializable —Ä–µ—à–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã"

**–ß–∞—Å—Ç–∏—á–Ω–æ –ø—Ä–∞–≤–¥–∞:**
```
‚úÖ Serializable –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∞–Ω–æ–º–∞–ª–∏–∏
‚ùå –ù–æ –Ω–µ —Ä–µ—à–∞–µ—Ç:
  - –ù–∏–∑–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
  - –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å retry –ª–æ–≥–∏–∫–∏
  - Deadlocks
  - Bloat –æ—Ç –¥–æ–ª–≥–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
```

**–†–µ—à–µ–Ω–∏–µ:** –∏—Å–ø–æ–ª—å–∑—É–π Serializable —Ç–æ–ª—å–∫–æ –≥–¥–µ –Ω—É–∂–Ω–æ.

#### –û—à–∏–±–∫–∞ 4: "–ú–Ω–µ –Ω–µ –Ω—É–∂–Ω–∞ –∏–∑–æ–ª—è—Ü–∏—è, —É –º–µ–Ω—è NoSQL"

**–ù–µ–ø—Ä–∞–≤–¥–∞:**
```
‚ùå –ê–Ω–æ–º–∞–ª–∏–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –≤ –ª—é–±–æ–π —Å–∏—Å—Ç–µ–º–µ —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º:
  - MongoDB: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –∏–∑–æ–ª—è—Ü–∏–µ–π
  - Cassandra: lightweight transactions (Paxos)
  - Redis: MULTI/EXEC –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏
```

**–†–µ—à–µ–Ω–∏–µ:** –ø–æ–Ω–∏–º–∞–π –º–æ–¥–µ–ª—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ —Ç–≤–æ–µ–π –ë–î.

### 4. –ö–æ–≥–¥–∞ –∫–∞–∫–æ–π —É—Ä–æ–≤–µ–Ω—å –≤ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ë–î

#### PostgreSQL

```
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- Default: Read Committed ‚úÖ
  (–¥–ª—è 90% –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π)

- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: Repeatable Read
  BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;

- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: Serializable
  BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;
  (–≥–æ—Ç–æ–≤—å—Å—è –∫ serialization errors)
```

#### MySQL/InnoDB

```
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- Default: Repeatable Read
  (–Ω–æ —Å Phantom Read!)

- –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ Read Committed:
  SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;
  (–µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω—ã –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —á—Ç–µ–Ω–∏—è)

- Serializable –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:
  SET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;
  (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç locks, –º–µ–¥–ª–µ–Ω–Ω–æ)
```

#### MongoDB

```
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- Default: Read Committed

- Snapshot isolation:
  session.start_transaction(read_concern="snapshot")

- Causal consistency:
  -- –¥–ª—è read-your-writes –≥–∞—Ä–∞–Ω—Ç–∏–π
  session.start_transaction(read_concern="majority",
                            write_concern="majority")
```

### 5. Debugging –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

#### –°–∏–º–ø—Ç–æ–º: –î–∞–Ω–Ω—ã–µ –∏—Å—á–µ–∑–∞—é—Ç

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
```
1. Lost Update:
   - –î–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞
   - –†–µ—à–µ–Ω–∏–µ: –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–ª–∏ versioning

2. Dirty Read:
   - –ß–∏—Ç–∞–µ—à—å uncommitted –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–∫–∞—Ç—ã–≤–∞—é—Ç—Å—è
   - –†–µ—à–µ–Ω–∏–µ: –º–∏–Ω–∏–º—É–º Read Committed

3. Rollback –ø–æ—Å–ª–µ Dirty Write:
   - –†–µ–¥–∫–æ, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ –≤ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö
```

#### –°–∏–º–ø—Ç–æ–º: –î–∞–Ω–Ω—ã–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –∏ –∏—Å—á–µ–∑–∞—é—Ç

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
```
1. Non-repeatable Read:
   - –î—Ä—É–≥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∏–∑–º–µ–Ω–∏–ª–∞ –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É —á—Ç–µ–Ω–∏—è–º–∏
   - –†–µ—à–µ–Ω–∏–µ: Repeatable Read

2. Phantom Read:
   - –°—Ç—Ä–æ–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è/—É–¥–∞–ª—è—é—Ç—Å—è –¥—Ä—É–≥–∏–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
   - –†–µ—à–µ–Ω–∏–µ: Snapshot Isolation –∏–ª–∏ Serializable
```

#### –°–∏–º–ø—Ç–æ–º: –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞—Ä—É—à–∞—é—Ç—Å—è

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
```
1. Write Skew:
   - –î–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑–º–µ–Ω—è—é—Ç —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏, –Ω–∞—Ä—É—à–∞—è –æ–±—â–∏–π –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç
   - –†–µ—à–µ–Ω–∏–µ: Serializable –∏–ª–∏ materialized constraint

2. Read Skew:
   - –ß–∏—Ç–∞–µ—à—å –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É –¥–æ, –¥—Ä—É–≥—É—é –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
   - –†–µ—à–µ–Ω–∏–µ: Snapshot Isolation
```

#### –°–∏–º–ø—Ç–æ–º: –í—ã—Å–æ–∫–∏–π % serialization errors

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
```
1. –í—ã—Å–æ–∫–∞—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è:
   - –ú–Ω–æ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–¥–Ω–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
   - –†–µ—à–µ–Ω–∏–µ: sharding, partitioning

2. –î–æ–ª–≥–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
   - –î–µ—Ä–∂–∞—Ç snapshot –¥–æ–ª–≥–æ, –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç —Å –Ω–æ–≤—ã–º–∏
   - –†–µ—à–µ–Ω–∏–µ: —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

3. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏:
   - Serializable —Ç–∞–º, –≥–¥–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Read Committed
   - –†–µ—à–µ–Ω–∏–µ: –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ö–ª—é—á–µ–≤—ã–µ takeaways:**

üéØ **–ù–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç "–ª—É—á—à–µ–≥–æ" —É—Ä–æ–≤–Ω—è –∏–∑–æ–ª—è—Ü–∏–∏:**
- Read Committed: –±–∞–ª–∞–Ω—Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏
- Repeatable Read / Snapshot: –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- Serializable: –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–æ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏
- Strict Serializable: –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ external consistency

üí° **Trade-off –Ω–µ–∏–∑–±–µ–∂–µ–Ω:**
- –í—ã—à–µ –∏–∑–æ–ª—è—Ü–∏—è = –±–æ–ª—å—à–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏, –º–µ–Ω—å—à–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ù–∏–∂–µ –∏–∑–æ–ª—è—Ü–∏—è = –±–æ–ª—å—à–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ä–∏—Å–∫ –∞–Ω–æ–º–∞–ª–∏–π

üõ°Ô∏è **–ó–∞—â–∏—Ç–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:**
- –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- Optimistic/Pessimistic locking
- Materialized constraints
- Idempotency
- Retry –ª–æ–≥–∏–∫–∞

‚ö†Ô∏è **–ü–æ–Ω–∏–º–∞–π —Å–≤–æ—é –ë–î:**
- –ö–∞–∂–¥–∞—è –ë–î —Ä–µ–∞–ª–∏–∑—É–µ—Ç —É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏ –ø–æ-—Å–≤–æ–µ–º—É
- –ß–∏—Ç–∞–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- –¢–µ—Å—Ç–∏—Ä—É–π –Ω–∞ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ

üîç **–ú–æ–Ω–∏—Ç–æ—Ä—å –∏ –∏–∑–º–µ—Ä—è–π:**
- Serialization error rate
- Transaction latency
- Deadlock rate
- Rollback ratio

–ò–∑–æ–ª—è—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π ‚Äî —ç—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –Ω–∞–¥—ë–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è –∏–∑–æ–ª—è—Ü–∏–∏ –º–æ–∂–µ—Ç —Å–ø–∞—Å—Ç–∏ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö, —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ—Ç–µ—Ä—å –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤. –ù–æ –ø–æ–º–Ω–∏: –Ω–µ—Ç silver bullet, –≤—Å–µ–≥–¥–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–≤–æ–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è!
